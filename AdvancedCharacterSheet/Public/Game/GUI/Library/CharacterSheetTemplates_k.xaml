<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
                    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                    xmlns:ls="clr-namespace:ls;assembly=SharedGUI"
                    xmlns:noesis="clr-namespace:NoesisGUIExtensions;assembly=Noesis.GUI.Extensions"
                    xmlns:System="clr-namespace:System;assembly=mscorlib"
                    mc:Ignorable="d">

    <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="DataTemplates_k.xaml"/>
        <ResourceDictionary Source="CharacterSheetTemplates.xaml"/>
        <ResourceDictionary Source="ACS_k.xaml"/>
    </ResourceDictionary.MergedDictionaries>

    <BitmapImage x:Key="InventorySlotsTileImage" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/invSlot.png"/>

    <ImageSource x:Key="SavingThrowDice">pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/mainStats_ability_single.png</ImageSource>
    <ImageSource x:Key="ProficientAbility">pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/proficient_ability.png</ImageSource>
    <ImageSource x:Key="NoResistanceIcon">pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/resistance_none_bg.png</ImageSource>
    <ImageSource x:Key="ProficientDice">pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/ico_proficient.png</ImageSource>


    <System:Double x:Key="ExaminePanelWidth">1720</System:Double>

    <System:Double x:Key="CSDollHeight">1380</System:Double>
    <System:Double x:Key="CSDollWidth">1400</System:Double>
    <System:Double x:Key="EXDollWidth">1050</System:Double>
    
    <System:Double x:Key="CornerRadius">20</System:Double>

    <!-- MOD_ACS: Update InventoryColumnWidth // BG3: 676 -->
    <System:Double x:Key="InventoryColumnWidth">676</System:Double>
    <!-- MOD_ACS: Update InventoryColumnHeight // MOD_BCPP: 1620 // BG3: 1468 -->
    <System:Double x:Key="InventoryColumnHeight">1618</System:Double>

    <!-- MOD_ACS: Update CSContentHeight 1550 // MOD_BCPP: 1550 // BG3: 1340 -->
    <System:Double x:Key="CSContentHeight">1550</System:Double>
    <System:Double x:Key="CSColumnWidth">648</System:Double>

    <Thickness x:Key="CSInfoMargin">52,52,52,24</Thickness>
    <Thickness x:Key="ScrollOffset">0,0,-38,0</Thickness>

    <GridLength x:Key="CSSlotSize">88</GridLength>

    <!-- MOD_ACS: Add colors -->
    <Color x:Key="ACS_bonusColor">#43BC66</Color>
    <SolidColorBrush x:Key="ACS_LS_bonusTxtColor" Color="{StaticResource ACS_bonusColor}"/>
    <Color x:Key="ACS_alertColor">#E53262</Color>
    <SolidColorBrush x:Key="ACS_LS_alertTxtColor" Color="{StaticResource ACS_alertColor}"/>

      <!--ROW STYLES-->
    <Style x:Key="RowBG_d" TargetType="Border">
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="CornerRadius" Value="12,12,12,12"/>
    </Style>
    <SolidColorBrush x:Key="RowBG_h" Opacity="0.4" Color="{StaticResource accent75Color}"/>

    <Style x:Key="ListSectionBackground" TargetType="Border">
        <Setter Property="Background" Value="{StaticResource ContentBGShade}"/>
        <Setter Property="CornerRadius" Value="12"/>
    </Style>

    <Style x:Key="DetailedListText" TargetType="TextBlock">
        <Setter Property="FontSize" Value="{StaticResource ScaledSmallishFontSize}"/>
        <Setter Property="Foreground" Value="{StaticResource LS_baseTxtColor}"/>
    </Style>

    <Style x:Key="DetailedListValue" TargetType="TextBlock">
        <Setter Property="FontSize" Value="{StaticResource ScaledSmallishFontSize}"/>
        <Setter Property="Foreground" Value="{StaticResource LS_accent100TxtColor}"/>
    </Style>

    <Style x:Key="SummaryListText" TargetType="TextBlock">
        <Setter Property="FontSize" Value="{StaticResource ScaledSmallishFontSize}"/>
        <Setter Property="Foreground" Value="{StaticResource LS_baseTxtColor}"/>
        <Setter Property="VerticalAlignment" Value="Center"/>
        <Setter Property="Margin" Value="8,0"/>
    </Style>

    <!-- MOD_ACS: Add style for conditions & passive features -->
    <Style x:Key="SummaryListTextConditionsAndFeats" TargetType="TextBlock">
        <Setter Property="FontSize" Value="{StaticResource ScaledSmallFontSize}"/>
        <Setter Property="Foreground" Value="{StaticResource LS_baseTxtColor}"/>
        <Setter Property="VerticalAlignment" Value="Center"/>
        <Setter Property="Margin" Value="8,0"/>
    </Style>

    <Style x:Key="SummaryRoundIcons" TargetType="Rectangle">
        <Setter Property="Width" Value="48"/>
        <Setter Property="Height" Value="48"/>
        <Setter Property="RadiusX" Value="24"/>
        <Setter Property="RadiusY" Value="24"/>
        <Setter Property="VerticalAlignment" Value="Center"/>
        <Setter Property="HorizontalAlignment" Value="Center"/>
    </Style>

    <!-- MOD_ACS: Add style for conditions & passive features -->
    <Style x:Key="SummaryRoundIconsConditionsAndFeats" TargetType="Rectangle">
        <Setter Property="Width" Value="42"/>
        <Setter Property="Height" Value="42"/>
        <Setter Property="RadiusX" Value="24"/>
        <Setter Property="RadiusY" Value="24"/>
        <Setter Property="VerticalAlignment" Value="Center"/>
        <Setter Property="HorizontalAlignment" Value="Center"/>
    </Style>

    <Style x:Key="SkillTextStyle" TargetType="TextBlock" BasedOn="{StaticResource DetailedListText}">
        <Setter Property="HorizontalAlignment" Value="Left"/>
        <Setter Property="VerticalAlignment" Value="Center"/>
        <Setter Property="TextWrapping" Value="Wrap"/>
        <Setter Property="DockPanel.Dock" Value="Left"/>
        <Setter Property="Margin" Value="8,0,0,0"/>
    </Style>

    <Style x:Key="StatsNameStyle" TargetType="Control">
        <Setter Property="FontSize" Value="{StaticResource ScaledSmallFontSize}"/>
        <Setter Property="Foreground" Value="{StaticResource LS_baseTxtColor}"/>
        <Setter Property="HorizontalAlignment" Value="Left"/>
        <Setter Property="VerticalAlignment" Value="Center"/>
        <Setter Property="DockPanel.Dock" Value="Left"/>
        <Setter Property="Margin" Value="8,0,0,0"/>
    </Style>

    <Style x:Key="SkillTitleTextStyle" TargetType="TextBlock" BasedOn="{StaticResource DetailedListValue}">
        <Setter Property="ToolTipService.Placement" Value="Right"/>
        <Setter Property="HorizontalAlignment" Value="Right"/>
        <Setter Property="VerticalAlignment" Value="Center"/>
        <Setter Property="DockPanel.Dock" Value="Right"/>
        <Setter Property="Margin" Value="0,0,8,0"/>
    </Style>



    <!--NO RESULTS TEMPLATE-->
    <ControlTemplate x:Key="NoResultsFoundTemplate" TargetType="Control">
        <Grid>
            <!-- MOD_ACS: Update source // BG3: .../Assets/CharacterPanel/..." -->
            <Image Source="/GustavNoesisGUI;component/Assets/ACS/CharacterPanel/invSlot_message_bg.png" Stretch="None" HorizontalAlignment="Center"/>
            <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="{StaticResource LS_extraspecialTxtColor}" FontSize="{StaticResource SmallFontSize}" ls:TextBlockFormatter.SourceText="{Binding Source='h7f09be65g3d97g45dfg87f1gb70869a7ae24', Converter={StaticResource TranslatedStringConverter}}"/>
        </Grid>
    </ControlTemplate>

    <!-- MOD_ACS: NO RESULTS SEARCH TEMPLATE-->
    <ControlTemplate x:Key="NoResultsFoundSearchTemplate" TargetType="Control">
        <Grid>
            <Image Source="pack://application:,,,/GustavNoesisGUI;component/Assets/ACS/CharacterPanel/invSlot_message_bg.png" Stretch="Fill" HorizontalAlignment="Center"/>
            <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="{StaticResource LS_extraspecialTxtColor}" FontSize="{StaticResource SmallFontSize}" ls:TextBlockFormatter.SourceText="{Binding Source='h7f09be65g3d97g45dfg87f1gb70869a7ae24', Converter={StaticResource TranslatedStringConverter}}"/>
        </Grid>
    </ControlTemplate>

    <BitmapImage  x:Key="ActiveSlot_h_img" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/activeSlot_overlay_h_selected.png" />

    <!-- General -->
    <Style x:Key="ModifierTextStyle" TargetType="TextBlock">
        <Setter Property="FontSize" Value="{DynamicResource ScaledMediumFontSize}"/>
        <Setter Property="Foreground" Value="{StaticResource LS_ActivePanelFontColor}"/>
    </Style>
    
    <DataTemplate x:Key="ModifierTemplate">
        <Grid ToolTipService.Placement="Right" ToolTip="{StaticResource ManagedTooltip}">
            <Image x:Name="BgImg" Source="pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/frame_EQstat.png" Stretch="None"/>
            <TextBlock HorizontalAlignment="Left" VerticalAlignment="Center" Margin="60,0,0,0" Text="{Binding Name}" Style="{DynamicResource ModifierTextStyle}"/>
            <TextBlock x:Name="ValueTxt" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,2,60,-2" Text="{Binding Value}" Foreground="{StaticResource LS_PrimaryColor}" FontSize="{DynamicResource ScaledDefaultFontSize}"/>
            <b:Interaction.Triggers>
                <b:EventTrigger EventName="MouseEnter">
                    <ls:LSPlaySound Sound="UI_Shared_Hover"/>
                </b:EventTrigger>
            </b:Interaction.Triggers>
        </Grid>
        <DataTemplate.Triggers>
            <Trigger Property="IsMouseOver" Value="True">
                <Setter TargetName="BgImg" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/selector_EQstat.png"/>
            </Trigger>
            <DataTrigger Binding="{Binding Path=Tag, RelativeSource={RelativeSource Mode=Self}}" Value="modifier">
                <Setter TargetName="ValueTxt" Property="Text" Value="{Binding Value, StringFormat={}{0:+#;-#;+0}}"/>
            </DataTrigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <!--===== REACTIONS TEMPLATE =====-->
    <ControlTemplate x:Key="InterruptPanelTemplate" TargetType="Control">
        <ControlTemplate.Resources>
            <BitmapImage x:Key="QuestionMarkIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Reactions_c/c_ico_reactionAsk_active.png"/>
        </ControlTemplate.Resources>
        <!-- MOD_ACS: Add dynamic height -->
        <Grid x:Name="Interrupts" Height="{Binding ActualHeight, ElementName=Reactions}">
            <Grid.IsEnabled>
                <MultiBinding Converter="{StaticResource EqualConverter}">
                    <Binding RelativeSource="{RelativeSource AncestorType={x:Type ls:UIWidget}}" Path="DataContext.CurrentPlayer.UserId"/>
                    <Binding Path="OwnerUserID"/>
                </MultiBinding>
            </Grid.IsEnabled>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- MOD_ACS: Update margin // BG3: Margin="440,24" -->
            <TextBlock Grid.Row="0" HorizontalAlignment="Center" x:Name="Description" Text="{Binding Source=h4683b44fg5f66g4001gbc80gbcb307102d8d,Converter={StaticResource TranslatedStringConverter}}" TextAlignment="Center" TextWrapping="Wrap" FontSize="{StaticResource ScaledMediumFontSize}" Foreground="{StaticResource LS_accent100TxtColor}" Margin="440,23,440,13"/>

            <TextBlock Grid.Row="1" x:Name="NoReactionsMsg" Foreground="{StaticResource LS_baseTxtColor}" TextWrapping="Wrap" MaxWidth="600" IsHitTestVisible="False" HorizontalAlignment="Center" TextAlignment="Center" FontStyle="Italic" Visibility="Collapsed" Margin="20,368,40,20" noesis:Text.StrokeThickness="6">
                <noesis:Text.Stroke>
                    <SolidColorBrush Color="{DynamicResource TextOutlineColor}" />
                </noesis:Text.Stroke>
                <TextBlock.Text>
                    <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}" ConverterParameter="he8acd09ag2560g47f2gbbb2g29d01baa3cb9">
                        <Binding Path="Name" />
                    </MultiBinding>
                </TextBlock.Text>
            </TextBlock>
            
            <!-- MOD_ACS: Move margin to 'Reactions' // MOD_BCPP: MaxHeight="1178" // BG3: Margin="0,0,0,22" -->
            <Grid Grid.Row="1" HorizontalAlignment="Center" VerticalAlignment="Top">
                <Rectangle x:Name="DecorativeStroke" Width="{Binding ActualWidth, ElementName=ListSectionBackground}" Height="{Binding ActualHeight, ElementName=ListSectionBackground}" StrokeDashArray="5,3" StrokeThickness="2" Stroke="{StaticResource LS_PanelBorder}" RadiusX="{StaticResource CornerRadius}" RadiusY="{StaticResource CornerRadius}" Fill="{StaticResource ContentBGShade}"/>

                <!-- MOD_ACS: Add Name / Update scroller padding & margin // BG3: Padding=ScrollOffset Margin="30" -->
                <ScrollViewer x:Name="ReactionScrollerViewer" Template="{StaticResource NoForcedStyleScrollViewerTemplate}" Padding="28,0,-28,0" HorizontalAlignment="Left" Margin="20,20,-8,15">
                    <!-- MOD_ACS: Update HorizontalAlignment // BG3: HorizontalAlignment=Left -->
                    <ItemsControl x:Name="InterruptList" ItemsSource="{Binding Interrupts}" HorizontalAlignment="Center">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="ls:VMInterrupt">
                                <DataTemplate.Resources>
                                    <BitmapImage x:Key="ReactionCheckBoxBGImg" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Reactions/checkbox_d.png"/>
                                </DataTemplate.Resources>
                                <!-- MOD_ACS: Add align center -->
                                <Grid HorizontalAlignment="Center" >
                                    <!-- MOD_ACS: Use dynamic template "InterruptToggleBtnTemplateDynamic" // BG3: "InterruptToggleBtnTemplate" -->
                                    <ls:LSToggleButton x:Name="ToggleEnableButton" IsChecked="{Binding Enabled, Mode=OneWay}" Command="{Binding DataContext.InterruptToggleDisableCommand,RelativeSource={RelativeSource AncestorType=ls:UIWidget}}" CommandParameter="{Binding .}" Template="{StaticResource InterruptToggleBtnTemplateDynamic}" Content ="{Binding .}" IsEnabled="{Binding Available}"/>

                                    <ls:LSToggleButton x:Name="ToggleManagementButton" IsChecked="{Binding Ask, Mode=OneWay}" Command="{Binding DataContext.InterruptChangeAskCommand,RelativeSource={RelativeSource AncestorType=ls:UIWidget}}" CommandParameter="{Binding .}" VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="0,0,10,4">

                                        <ls:LSToggleButton.Template>
                                            <ControlTemplate TargetType="ToggleButton">
                                                <StackPanel Orientation="Horizontal" Background="Transparent">
                                                    <StackPanel.ToolTip>
                                                        <ls:LSTooltip IsHitTestVisible="False">
                                                            <TextBlock  Text="{Binding Source='h4353cf8eg6bb3g46f5g92eage382a75f4338', Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource TooltipBaseTextStyle}"/>
                                                        </ls:LSTooltip>
                                                    </StackPanel.ToolTip>
                                                    <TextBlock x:Name="State" Text="{Binding Source=h0b717014gd250g44ccg9653g68b111f2fefb,Converter={StaticResource TranslatedStringConverter}}" Foreground="{StaticResource LS_baseTxtColor}" FontSize="{StaticResource ScaledMediumFontSize}" VerticalAlignment="Center"/>
                                                    <Image Source="{StaticResource QuestionMarkIcon}" Stretch="Uniform" Margin="4,0,0,0" Height="36"/>
                                                    <Grid VerticalAlignment="Center">
                                                        <Image x:Name="bg" Source="{StaticResource ReactionCheckBoxBGImg}" Stretch="None"/>
                                                        <Image x:Name="CheckImg" Source="{StaticResource ReactionCheckImg}" Stretch="None" Visibility="Hidden" Margin="0,0,0,4"/>
                                                    </Grid>
                                                </StackPanel>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="bg" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Reactions/checkbox_h.png"/>
                                                        <Setter TargetName="CheckImg" Property="Source" Value="{StaticResource ReactionCheckImgH}"/>
                                                        <Setter TargetName="State" Property="Foreground" Value="{StaticResource LS_accent75TxtColor}"/>
                                                    </Trigger>
                                                    <Trigger Property="IsChecked" Value="True">
                                                        <Setter TargetName="CheckImg" Property="Visibility" Value="Visible"/>
                                                    </Trigger>
                                                    <Trigger Property="IsEnabled" Value="False">
                                                        <Setter TargetName="bg" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Reactions/checkbox_disabled.png"/>
                                                        <Setter TargetName="CheckImg" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Reactions/ico_check_disabled.png"/>
                                                        <Setter TargetName="State" Property="Foreground" Value="{StaticResource LS_accent00TxtColor}"/>
                                                    </Trigger>
                                                    <DataTrigger Binding="{Binding Enabled}" Value="False">
                                                        <Setter TargetName="State" Property="Foreground" Value="{StaticResource LS_accent25TxtColor}"/>
                                                    </DataTrigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </ls:LSToggleButton.Template>
                                    </ls:LSToggleButton>
                                </Grid>
                            </DataTemplate>

                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>

            <b:Interaction.Triggers>
                <b:DataTrigger Binding="{Binding IsVisible, ElementName=Interrupts}" Value="True">
                    <!-- Tutorial UI Event - Reactions Opened-->
                    <b:InvokeCommandAction Command="{Binding DataContext.TutorialEvent, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="266efe77-4587-4b3f-9217-605923add7c5"/>
                </b:DataTrigger>
            </b:Interaction.Triggers>
        </Grid>
        <ControlTemplate.Triggers>
            <DataTrigger Binding="{Binding Interrupts.Count}" Value="0">
                <Setter TargetName="NoReactionsMsg" Property="Visibility" Value="Visible"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ParentState, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel">
                <Setter TargetName="Description" Property="Margin" Value="24"/>
                <Setter TargetName="DecorativeStroke" Property="Visibility" Value="Collapsed"/>

                <!-- MOD_ACS: Add reactions scroller padding & margin when in PartyPanel -->
                <Setter TargetName="ReactionScrollerViewer" Property="Margin" Value="14,0,-14,35"/>
                <Setter TargetName="ReactionScrollerViewer" Property="Padding" Value="2,0,-2,0"/>
            </DataTrigger>

            <!-- MOD_ACS: Add reactions scroller padding & margin when in PartyPanel and BCPP is detected -->            
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding ParentState, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel"/>
                    <Condition Binding="{Binding VerticalAlignment, ElementName=CharacterRoot}" Value="Top"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="Description" Property="Margin" Value="16,16,16,17"/>
                <Setter TargetName="ReactionScrollerViewer" Property="Margin" Value="18,0,-10,0"/>
                <Setter TargetName="ReactionScrollerViewer" Property="Padding" Value="-2,0,2,18"/>
                <Setter TargetName="InterruptList" Property="Margin" Value="0,0,0,18"/>
            </MultiDataTrigger> 
            
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <!--INVENTORY FILTER TEMPLATE-->
    <!-- DataContext: VMCharacter or null | Tag: inventory or inventories to filter -->
    <ControlTemplate x:Key="FilterHolderTemplate" TargetType="ls:FilteringContainer">
        <StackPanel d:DataContext="{d:DesignInstance {x:Type ls:Character}, IsDesignTimeCreatable=True}">
            <Border>
                <Grid HorizontalAlignment="Left">
                <TextBlock x:Name="CategoryName" Visibility="Collapsed" Text="{Binding Source=hda234862gff1ag4acdgbc37gef3abaabd610, Converter={StaticResource TranslatedStringConverter}}"/>
                <TextBlock x:Name="AdditionalFilters" Visibility="Collapsed" Text=""/>
                <TextBlock x:Name="CurrentItemFilteredName" Visibility="Collapsed" Text="{Binding CurrentFilter.Item.Name, RelativeSource={RelativeSource Mode=TemplatedParent}}"/>
                <TextBlock x:Name="CurrentFilterName" Visibility="Collapsed" Text="{Binding CurrentFilter.Name, RelativeSource={RelativeSource Mode=TemplatedParent}}"/>

                <Image Source="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/frame_filters.png" Stretch="None" HorizontalAlignment="Left" VerticalAlignment="Top"/>
                <Image Source="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/ico_search.png" Margin="12,16,0,0" Stretch="None" VerticalAlignment="Top" HorizontalAlignment="Left"/>


                    <ls:LSTextBox x:Name="PART_FilterSearchBox" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="60,14,0,0" Height="56" Width="400" TextAlignment="Left" FontSize="{DynamicResource ScaledMediumFontSize}" TextWrapping="NoWrap">
                    <noesis:Text.Placeholder>
                        <MultiBinding StringFormat="{}{0}{1}{2} {3}">
                            <Binding Path="Text" ElementName="CategoryName"/>
                            <Binding Path="Text" ElementName="CurrentItemFilteredName"/>
                            <Binding Path="Text" ElementName="CurrentFilterName"/>
                            <Binding Path="Text" ElementName="AdditionalFilters"/>
                        </MultiBinding>
                    </noesis:Text.Placeholder>
                    <b:Interaction.Triggers>
                        <b:EventTrigger EventName="MouseEnter">
                            <ls:LSPlaySound Sound="UI_Shared_Hover"/>
                        </b:EventTrigger>
                        <b:EventTrigger EventName="PreviewMouseDown">
                            <ls:LSPlaySound Sound="UI_Shared_Press"/>
                        </b:EventTrigger>
                    </b:Interaction.Triggers>
                </ls:LSTextBox>

                <Image Source="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/frame_filters_EQ.png" Stretch="None" HorizontalAlignment="Left" VerticalAlignment="Top" Visibility="{Binding IsFocused, ElementName=PART_FilterSearchBox, Converter={StaticResource BoolToVisibleConverter}}" IsHitTestVisible="False"/>

                <ls:LSButton x:Name="ClearFilter" VerticalAlignment="Top" HorizontalAlignment="Right" Margin="0,16,32,0" BoundEvent="UICancel" Command="ls:FilteringContainer.ClearFilterCommand">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Grid x:Name="BtnHolder">
                                <Image x:Name="bg" Source="{StaticResource BtnSmallRound}" Stretch="None"/>
                                <Image x:Name="icon" Source="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_cancel.png" Stretch="None"/>
                            </Grid>

                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="bg" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/btn_small_round_h.png"/>
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="bg" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/btn_small_round_p.png"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Button.Template>
                </ls:LSButton>
            </Grid>
            </Border>


            <Popup IsOpen="{TemplateBinding IsPopupVisible}">
                <ls:LSNineSliceImage x:Name="PopularFiltersHolder" Margin="0,-12,0,0"  HorizontalAlignment="Stretch" ImageSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/sorting_bg.png" Slices="60" Padding="10,40">
                    <StackPanel>
                        <TextBlock Foreground="{StaticResource LS_accent25TxtColor}" FontSize="{StaticResource SmallishFontSize}" Text="{Binding Source='hc0ed9c5ag8a2cg4167g8242g5076d73d695f',Converter={StaticResource TranslatedStringConverter}}" Margin="20,0" VerticalAlignment="Top"/>

                        <ListBox x:Name="FilterListHolder" ItemsSource="{TemplateBinding SuggestedFiltersList}" SelectedItem="{Binding CurrentFilterInternal,RelativeSource={RelativeSource TemplatedParent}}" ScrollViewer.HorizontalScrollBarVisibility="Disabled" ScrollViewer.VerticalScrollBarVisibility="Auto" Margin="20,0,0,0" VerticalAlignment="Top">
                            <ListBox.Resources>
                                <DataTemplate DataType="{x:Type ls:VMEnumFilter}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Image Grid.Column="0" Grid.ColumnSpan="2" x:Name="BtnBorder" Stretch="None" Source="/GustavNoesisGUI;component/Assets/CharacterPanel/selector_listitem_d.png"/>
                                        <Image Grid.Column="0" Stretch="None" Source="/GustavNoesisGUI;component/Assets/CharacterPanel/ico_filter.png" VerticalAlignment="Center" Margin="4,0,16,0"/>
                                        <TextBlock Grid.Column="1" x:Name="BtnText" Text="{Binding }" Foreground="{StaticResource LS_baseTxtColor}" FontSize="{StaticResource MediumFontSize}" HorizontalAlignment="Left" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" Width="400"/>
                                    </Grid>
                                    <DataTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="BtnBorder" Property="Source" Value="/GustavNoesisGUI;component/Assets/CharacterPanel/selector_listitem_h.png"/>
                                            <Setter TargetName="BtnText" Property="Foreground" Value="{StaticResource LS_accent100TxtColor}"/>
                                        </Trigger>

                                        <DataTrigger Binding="{Binding Enum, Converter={StaticResource NullToBoolTrueConverter}}" Value="False">
                                            <Setter TargetName="BtnText" Property="Text" Value="{Binding Name}"/>
                                        </DataTrigger>
                                    </DataTemplate.Triggers>
                                </DataTemplate>

                                <DataTemplate DataType="{x:Type ls:VMInventorySlot}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Image Grid.Column="0" Grid.ColumnSpan="2" x:Name="BtnBorder" Stretch="None" Source="/GustavNoesisGUI;component/Assets/CharacterPanel/selector_listitem_d.png"/>
                                        <Rectangle Grid.Column="0" Height="28" Width="28" Fill="{Binding Object.Icon}" VerticalAlignment="Center" Margin="4,0,16,0"/>
                                        <TextBlock Grid.Column="1" x:Name="BtnText" Text="{Binding Object.Name}" Foreground="{StaticResource LS_baseTxtColor}" FontSize="{StaticResource MediumFontSize}" HorizontalAlignment="Left" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" Width="400"/>
                                    </Grid>
                                    <DataTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="BtnBorder" Property="Source" Value="/GustavNoesisGUI;component/Assets/CharacterPanel/selector_listitem_h.png"/>
                                            <Setter TargetName="BtnText" Property="Foreground" Value="{StaticResource LS_accent100TxtColor}"/>
                                        </Trigger>
                                    </DataTemplate.Triggers>
                                </DataTemplate>
                            </ListBox.Resources>

                            <ListBox.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Vertical"/>
                                </ItemsPanelTemplate>
                            </ListBox.ItemsPanel>
                        </ListBox>
                    </StackPanel>
                </ls:LSNineSliceImage>
            </Popup>
        </StackPanel>

        <ControlTemplate.Triggers>
            <DataTrigger Binding="{Binding CurrentFilter, RelativeSource={RelativeSource Self}, Converter={StaticResource NullToBoolTrueConverter}, ConverterParameter='EmptyString'}" Value="False">
                <Setter TargetName="CategoryName" Property="Text" Value=""/>
            </DataTrigger>

            <DataTrigger Binding="{Binding CurrentFilter.AdditionalBoolProperty, RelativeSource={RelativeSource Self}}" Value="True">
                <Setter TargetName="AdditionalFilters" Property="Text" Value="{Binding Source='h038b1421g2efeg4283g9b88gcdd3b6e46f80',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding IsChecked, ElementName=ChangePartyContextButton}" Value="True">
                <Setter TargetName="AdditionalFilters" Property="Text" Value="{Binding Source='h582dd86fgb0f8g497dg963ag203dad565aef',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding IsChecked, ElementName=ChangePartyContextButton}" Value="True"/>
                    <Condition Binding="{Binding CurrentFilter.AdditionalBoolProperty, RelativeSource={RelativeSource Self}}" Value="True"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="AdditionalFilters" Property="Text" Value="{Binding Source='h5626aa7cgbedfg4432gb542g164b65efccb2',Converter={StaticResource TranslatedStringConverter}}"/>
            </MultiDataTrigger>

            <DataTrigger Binding="{Binding IsFocused, ElementName=PART_FilterSearchBox}" Value="True">
                <Setter TargetName="CategoryName" Property="Text" Value="{Binding Source='hdd323f92g1283g4e22g8aacg3d2dcea4b945',Converter={StaticResource TranslatedStringConverter}}"/>
                <Setter TargetName="AdditionalFilters" Property="Text" Value=""/>
            </DataTrigger>

            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding CurrentFilter, RelativeSource={RelativeSource Self}, Converter={StaticResource NullToBoolTrueConverter}}" Value="True"/>
                    <Condition Binding="{Binding IsPopupVisible,RelativeSource={RelativeSource Self}}" Value="False"/>
                    <Condition Binding="{Binding Text, ElementName='PART_FilterSearchBox', Converter={StaticResource NullToBoolTrueConverter}, ConverterParameter='EmptyString'}" Value="True"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="ClearFilter" Property="Visibility" Value="Collapsed"/>
            </MultiDataTrigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <!--SPELLS FILTER TEMPLATE-->
    <ControlTemplate x:Key="SpellFilterCategoryTemplate" TargetType="Control">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Image Grid.Column="0" Grid.ColumnSpan="2" x:Name="BtnBorder" Stretch="None" Source="/GustavNoesisGUI;component/Assets/CharacterPanel/selector_listitem_d.png"/>
            <Image Grid.Column="0" Stretch="None" Source="/GustavNoesisGUI;component/Assets/CharacterPanel/ico_bullet_d.png" VerticalAlignment="Center" Margin="4,0,16,0"/>
            <TextBlock Grid.Column="1" x:Name="BtnText" Text="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self},Converter={StaticResource TranslatedStringConverter}, StringFormat={}{0}...}" Foreground="{StaticResource LS_baseTxtColor}" FontSize="{StaticResource MediumFontSize}" HorizontalAlignment="Left" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" Width="400"/>

            <Popup x:Name="SubMenuPopup" IsOpen="False">
                <ls:LSNineSliceImage x:Name="FilterCategories" Margin="400,-100,0,0"  HorizontalAlignment="Left" ImageSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/sorting_bg.png" Slices="60" Padding="10,40">

                    <ListBox x:Name="FilterSpellListHolder" ItemsSource="{Binding .}" SelectedItem="{Binding CurrentFilterInternal,RelativeSource={RelativeSource AncestorType={x:Type ls:FilteringContainer}}}" ScrollViewer.HorizontalScrollBarVisibility="Disabled" ScrollViewer.VerticalScrollBarVisibility="Auto" Margin="20,0,0,0" VerticalAlignment="Top">
                        <ListBox.ItemTemplate>
                            <DataTemplate DataType="{x:Type ls:VMEnumFilter}">
                                <TextBlock Grid.Column="1" x:Name="BtnText" Text="{Binding }" Foreground="{StaticResource LS_baseTxtColor}" FontSize="{StaticResource MediumFontSize}" HorizontalAlignment="Left" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" Width="400">
                                    <b:Interaction.Behaviors>
                                        <ls:CollectionContainsItemBehavior x:Name="AvailabilityBehavior" ItemSource="{Binding .}" CollectionSource="{Binding AvailableEnumFilters, RelativeSource={RelativeSource AncestorType={x:Type ls:FilteringContainer}}}"/>
                                    </b:Interaction.Behaviors>
                                </TextBlock>

                                <DataTemplate.Triggers>
                                    <Trigger Property="IsMouseOver"  Value="True">
                                        <Setter TargetName="BtnText" Property="Foreground" Value="{StaticResource LS_accent100TxtColor}"/>
                                    </Trigger>
                                    <DataTrigger Binding="{Binding Enum, Converter={StaticResource NullToBoolTrueConverter}}" Value="False">
                                        <Setter TargetName="BtnText" Property="Text" Value="{Binding Name}"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Path=(b:Interaction.Behaviors)[0].Result, ElementName=BtnText}" Value="False">
                                        <Setter TargetName="BtnText" Property="Foreground" Value="{StaticResource LS_accent25TxtColor}"/>
                                    </DataTrigger>
                                </DataTemplate.Triggers>
                            </DataTemplate>
                        </ListBox.ItemTemplate>

                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem" BasedOn="{StaticResource {x:Type ListBoxItem}}">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ListBoxItem">
                                            <Grid>
                                                <Image x:Name="BtnBorder" Stretch="None" Source="/GustavNoesisGUI;component/Assets/CharacterPanel/selector_listitem_d.png">
                                                    <b:Interaction.Behaviors>
                                                        <ls:CollectionContainsItemBehavior x:Name="AvailabilityBehavior" ItemSource="{Binding .}" CollectionSource="{Binding AvailableEnumFilters, RelativeSource={RelativeSource AncestorType={x:Type ls:FilteringContainer}}}"/>
                                                    </b:Interaction.Behaviors>
                                                </Image>
                                                <ContentPresenter Margin="20,0"/>
                                            </Grid>

                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="BtnBorder" Property="Source" Value="/GustavNoesisGUI;component/Assets/CharacterPanel/selector_listitem_h.png"/>
                                                </Trigger>
                                                <DataTrigger Binding="{Binding Path=(b:Interaction.Behaviors)[0].Result, ElementName=BtnBorder}" Value="False">
                                                    <Setter Property="IsEnabled" Value="False"/>
                                                </DataTrigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </ListBox.ItemContainerStyle>

                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Vertical"/>
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                    </ListBox>
                </ls:LSNineSliceImage>
            </Popup>
        </Grid>
        <ControlTemplate.Triggers>
            <Trigger Property="IsMouseOver" Value="True">
                <Setter TargetName="SubMenuPopup" Property="IsOpen" Value="True"/>
                <Setter TargetName="BtnBorder" Property="Source" Value="/GustavNoesisGUI;component/Assets/CharacterPanel/selector_listitem_h.png"/>
            </Trigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <!-- MOD_ACS: Add ControlTemplate decoratedHeader -->
    <ControlTemplate x:Key="ACS_decoratedHeader">
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
            <StackPanel.Resources>
                <BitmapImage x:Key="decor_header">pack://application:,,,/GustavNoesisGUI;component/Assets/CC/decor_header.png</BitmapImage>
            </StackPanel.Resources>
            <Image Source="{StaticResource decor_header}" Stretch="None"/>
            <ContentPresenter Margin="30,0,30,0"/>
            <Image Source="{StaticResource decor_header}" Stretch="None">
                <Image.RenderTransform>
                    <ScaleTransform ScaleX="-1" CenterX="42"/>
                </Image.RenderTransform>
            </Image>
        </StackPanel>
    </ControlTemplate>

    <!-- MOD_ACS: Add Style BaseTitleStyle for SpellBook -->
    <Style x:Key="ACS_SB_BaseTitleStyle" TargetType="ContentControl">
        <Style.Resources>
            <Style TargetType="TextBlock" >
                <Setter Property="FontSize" Value="{DynamicResource ScaledMediumFontSize}"/>
                <Setter Property="Foreground" Value="{StaticResource LS_accent100TxtColor}"/>
            </Style>
        </Style.Resources>
        <Setter Property="Margin" Value="0,20,0,0"/>
        <Setter Property="Template" Value="{StaticResource ACS_decoratedHeader}"/>
    </Style>

    <!--===== MULTICLASS SPELLBOOK TEMPLATE =====-->
    <ControlTemplate x:Key="MultiClassSpellbookTemplate">
        <!-- DataContext of this should be a VMCharacter -->
        <ControlTemplate.Resources>
            
            <!-- MOD_ACS: Add images -->
            <BitmapImage x:Key="ACS_SeparatorThin" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/ACS/Separators/separator_thin.png"/>
            
            <BitmapImage x:Key="SpellbookBg_Small" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/spellbook_bg_small.png"/>

            <BitmapImage x:Key="SpellsBorder_Small" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/knownSpells_frame_small.png" />

            <!-- MOD_ACS: ClassBorderEdges_Small not used -->
            <BitmapImage x:Key="ClassBorder_Small" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/spellbookTop_frame_small.png" />
            <ImageBrush x:Key="ClassBorderEdges_Small" ImageSource="{StaticResource ClassBorder_Small}" Stretch="None" ViewboxUnits="Absolute" Viewbox="0,0,668,22"/>
            <ImageBrush x:Key="ClassBorderCenter_Small" ImageSource="{StaticResource ClassBorder_Small}" Stretch="Fill" TileMode="Tile" AlignmentY="Top" ViewboxUnits="Absolute" Viewbox="0,22,668,28" ViewportUnits="Absolute" Viewport="0,22,668,28"/>

            <BitmapImage x:Key="PreparedSpellsTop_Small" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/preparedBoxTile_small_top.png" />
            <BitmapImage x:Key="PreparedSpellsCenter_Small" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/preparedBoxTile_small_middle.png" />
            <!-- MOD_ACS: Add square less PreparedSpellsCenter -->
            <BitmapImage x:Key="PreparedSpellsCenter_Small_SquareLess" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/ACS/SpellBook/preparedBoxTile_small_middle.png" />
            <BitmapImage x:Key="PreparedSpellsBottom_Small" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/preparedBoxTile_small_bottom.png" />

            <System:Double x:Key="PageIconSize">200</System:Double>
            <System:Double x:Key="SpellCellSize">72</System:Double>
            <System:Double x:Key="SpellCellContentSize">68</System:Double>

            <System:Double x:Key="TopBarHeight">76</System:Double>
            <GridLength x:Key="TopBarHeightGridLength">76</GridLength>

            <System:Int32 x:Key="InitialTab">0</System:Int32>

            <BitmapImage x:Key="SpellbookBg" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/spellbook_bg.png"/>

            <BitmapImage x:Key="CantripsIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_classCantrip.png" />
            <BitmapImage x:Key="ClassActionIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_classAction.png" />
            <BitmapImage x:Key="TadpoleActionIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_illithid.png" />
            <BitmapImage x:Key="MetamagicIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_sorcerer.png" />
            <BitmapImage x:Key="AlwaysPreparedSpellsIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_alwaysPrepared.png" />
            <BitmapImage x:Key="PreparedSpellsIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_preparedList.png" />
            <BitmapImage x:Key="WarlockSpellsIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_warlock.png" />
            <BitmapImage x:Key="SpellsLv1Icon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_knownSpells_lvl_01.png" />
            <BitmapImage x:Key="SpellsLv2Icon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_knownSpells_lvl_02.png" />
            <BitmapImage x:Key="SpellsLv3Icon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_knownSpells_lvl_03.png" />
            <BitmapImage x:Key="SpellsLv4Icon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_knownSpells_lvl_04.png" />
            <BitmapImage x:Key="SpellsLv5Icon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_knownSpells_lvl_05.png" />
            <BitmapImage x:Key="SpellsLv6Icon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_knownSpells_lvl_06.png" />
            <BitmapImage x:Key="SpellsLv7Icon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_knownSpells_lvl_07.png" />
            <BitmapImage x:Key="SpellsLv8Icon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_knownSpells_lvl_08.png" />
            <BitmapImage x:Key="SpellsLv9Icon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_knownSpells_lvl_09.png" />
            <BitmapImage x:Key="CastSavingIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_cast_saving.png" />
            <BitmapImage x:Key="CastRollIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_cast_roll.png" />
            <BitmapImage x:Key="ProficientIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/ico_proficient.png" />
            <BitmapImage x:Key="LongRestIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/BottomBar/ico_camp_d.png" />

            <BitmapImage x:Key="KnownSpellsBg" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/knownSpells_bgStrip.png" />

            <BitmapImage x:Key="MainIconBg" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/spellbook_classFrame.png" />
            <BitmapImage x:Key="HeaderEntryBg" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/spellbook_headerBox.png" />

            <!-- MOD_ACS: ClassBorderEdges not used / Use directly ClassBorder -->
            <BitmapImage x:Key="ClassBorder" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/spellbookTop_frame.png" />
            <ImageBrush x:Key="ClassBorderEdges" ImageSource="{StaticResource ClassBorder}" Stretch="None" ViewboxUnits="Absolute" Viewbox="0,0,1124,23"/>
            <ImageBrush x:Key="ClassBorderCenter" ImageSource="{StaticResource ClassBorder}" Stretch="Fill" TileMode="Tile" AlignmentY="Top" ViewboxUnits="Absolute" Viewbox="0,23,1124,29" ViewportUnits="Absolute" Viewport="0,23,1124,29"/>

            <BitmapImage x:Key="SpellsBorder" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/knownSpells_frame.png" />
            <BitmapImage x:Key="SpellsBorderHalf" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/dashedBox_full.png" />

            <BitmapImage x:Key="PreparedSpellsTop" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/preparedBoxTile_top.png" />
            <BitmapImage x:Key="PreparedSpellsCenter" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/preparedBoxTile_middle.png" />
            <BitmapImage x:Key="PreparedSpellsBottom" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/preparedBoxTile_bottom.png" />
            <BitmapImage x:Key="FreeSlotBg" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/preparedBox_OpenSlot.png" />

            <BitmapImage x:Key="SearchBarBg_d" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/btn_body_d.png" />
            <BitmapImage x:Key="SearchBarBg_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/btn_body_h.png" />
            <BitmapImage x:Key="SearchIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/ico_search.png" />
            <BitmapImage x:Key="SearchSortingBg" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/sorting_bg.png" />
            <BitmapImage x:Key="SearchFilterIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/ico_filter.png" />
            <BitmapImage x:Key="SearchSelector_d" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/selector_listitem_d.png" />
            <BitmapImage x:Key="SearchSelector_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/selector_listitem_h.png" />

            <!-- MOD_ACS: Fix tabs artefacts // BG3: .../Assets/CharacterPanel/... --> 
            <BitmapImage x:Key="Tab_d" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/ACS/CharacterPanel/tab_body_inactive_d.png" />
            <BitmapImage x:Key="Tab_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/ACS/CharacterPanel/tab_body_inactive_h.png" />
            <BitmapImage x:Key="Tab_p" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/ACS/CharacterPanel/tab_body_inactive_p.png" />
            <BitmapImage x:Key="TabSelected_d" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/ACS/CharacterPanel/tab_body_active_d.png" />
            <BitmapImage x:Key="TabSelected_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/ACS/CharacterPanel/tab_body_active_h.png" />
            <BitmapImage x:Key="TabSelected_p" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/ACS/CharacterPanel/tab_body_active_p.png" />

            <BitmapImage x:Key="RemoveSpellIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterCreation/remover_spellslot.png" />
            <BitmapImage x:Key="PreparedSpellIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_prepared.png" />
            <BitmapImage x:Key="PreparedSpellBorder" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/frame_perpared.png" />

            <Style TargetType="TextBlock">
                <Setter Property="Foreground" Value="{StaticResource LS_tint100}"/>
                <Setter Property="FontFamily" Value="{StaticResource DefaultFont}"/>
                <Setter Property="FontSize" Value="{DynamicResource ScaledMediumFontSize}"/>
                <Setter Property="TextWrapping" Value="Wrap"/>
            </Style>

            <Style x:Key="ActionGroupTitleStyle" TargetType="TextBlock">
                <Setter Property="Foreground" Value="{StaticResource LS_extraspecialTxtColor}"/>
                <Setter Property="FontSize" Value="{DynamicResource ScaledSmallFontSize}"/>
                <Setter Property="Visibility" Value="{Binding (ls:TextBlockFormatter.SourceText), RelativeSource={RelativeSource Self}, Converter={StaticResource NullToCollapsedConverter}, ConverterParameter='EmptyString'}"/>
                <Setter Property="Margin" Value="0,22,0,0"/>
            </Style>

            <Style x:Key="CastInfoControlStyle" TargetType="ContentControl">
                <Setter Property="MinWidth" Value="150"/>
                <Setter Property="Margin" Value="2,0"/>
                <Setter Property="VerticalAlignment" Value="Center"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate>
                            <ls:LSNineSliceImage ImageSource="{StaticResource HeaderEntryBg}" Slices="16" Padding="20,10" Height="60" MinWidth="128" >
                                <ContentPresenter HorizontalAlignment="Center"/>
                            </ls:LSNineSliceImage>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>

                <Style.Triggers>
                    <DataTrigger Binding="{Binding ParentState, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel">
                        <Setter Property="MinWidth" Value="136"/>
                    </DataTrigger>
                </Style.Triggers>
            </Style>

            <ItemsPanelTemplate x:Key="SpellbookItemsPanelTemplate">
                <WrapPanel HorizontalAlignment="Left"/>
            </ItemsPanelTemplate>

            <!-- MOD_ACS: Update Template Spells // BG3: x:Name="Column2" Width="120"-->
            <ControlTemplate x:Key="SpellbookActionGroup">
                <Grid x:Name="ActionGroupRoot">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition x:Name="Column0" Width="120"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition x:Name="Column2" Width="102"/>
                    </Grid.ColumnDefinitions>

                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock x:Name="GroupName" Grid.Column="1" Grid.Row="0" ls:TextBlockFormatter.SourceText="" Style="{StaticResource ActionGroupTitleStyle}"/>

                    <!-- MOD_ACS: Update Margin // BG3: Margin="0,12,0,0" -->
                    <Border x:Name="IconContainer" Grid.Column="0" Grid.Row="1" Height="48" VerticalAlignment="Top" Margin="8,12,-8,0">
                        <Image x:Name="Icon" VerticalAlignment="Center" HorizontalAlignment="Center" Stretch="None" />
                    </Border>

                    <!-- MOD_ACS: Add switcher spy mirror LearnSpells visibility -->
                    <Border x:Name="LearnSpellsSpy" Visibility="Collapsed" />

                    <!-- MOD_ACS: Add LearnBtnContainer -->
                    <Border x:Name="LearnBtnContainer" Grid.Column="0" Grid.Row="1" Height="72" VerticalAlignment="Top" Margin="12,0,-12,0" Visibility="Collapsed">
                        <!-- MOD_ACS: Add LearnSpellsButton // BG3: HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,26,0" MinWidth="150" -->
                        <ls:LSButton x:Name="LearnSpellsButton" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,0,0,0" Command="{Binding DataContext.OpenLearnSpellsCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" MinWidth="0">
                            <ls:LSButton.Template>
                                <ControlTemplate TargetType="ls:LSButton">
                                    <ControlTemplate.Resources>
                                        <BitmapImage x:Key="Icon_d" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_learnSpells_d.png" />
                                        <BitmapImage x:Key="Icon_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_learnSpells_h.png" />
                                        <BitmapImage x:Key="Icon_p" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_learnSpells_p.png" />
                                        <BitmapImage x:Key="Icon_disabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_learnSpells_disabled.png" />
                                    </ControlTemplate.Resources>

                                    <!-- BG3: Slices="36,34" Padding="20,10" Height="72" -->
                                    <ls:LSNineSliceImage x:Name="SearchBarContainer" ImageSource="{StaticResource SearchBarBg_d}" Slices="36,34" Padding="16,8,16,12" Height="72">
                                        <Image x:Name="Icon" Source="{StaticResource Icon_d}" Stretch="None" VerticalAlignment="Center"/>
                                    </ls:LSNineSliceImage>

                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="SearchBarContainer" Property="ImageSource" Value="{StaticResource SearchBarBg_h}"/>
                                            <Setter TargetName="Icon" Property="Source" Value="{StaticResource Icon_h}"/>
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter TargetName="SearchBarContainer" Property="ImageSource" Value="{StaticResource SearchBarBg_h}"/>
                                            <Setter TargetName="Icon" Property="Source" Value="{StaticResource Icon_p}"/>
                                            <Setter TargetName="Icon" Property="Margin" Value="0,4,0,-4"/>
                                        </Trigger>
                                        <Trigger Property="IsEnabled" Value="False">
                                            <Setter TargetName="SearchBarContainer" Property="ImageSource" Value="{StaticResource SearchBarBg_d}"/>
                                            <Setter TargetName="Icon" Property="Source" Value="{StaticResource Icon_disabled}"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </ls:LSButton.Template>
                            <ls:LSButton.CommandParameter>
                                <MultiBinding Converter="{StaticResource PassThroughConverter}">
                                    <Binding Path="DataContext" ElementName="ClassPanelRoot"/>
                                    <Binding ElementName="ClassPanelRoot"/>
                                    <Binding Path="ActualWidth" ElementName="ClassPanelRoot" Converter="{StaticResource MultiplierConverter}" ConverterParameter="0.8"/>
                                </MultiBinding>
                            </ls:LSButton.CommandParameter>
                            
                            <b:Interaction.Triggers>
                                <!-- MOD_ACS: Btn Switcher -->
                                <b:EventTrigger EventName="Click">
                                    <b:ChangePropertyAction TargetName="LearnSpellsSpy" PropertyName="Visibility" Value="Visible"/>
                                </b:EventTrigger>
                            </b:Interaction.Triggers>
                            
                            <ls:LSButton.ToolTip>
                                <ls:LSTooltip DataContext="{Binding Path=DataContext, RelativeSource={RelativeSource TemplatedParent}}">
                                    <ls:LSTooltip.ContentTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Vertical" MaxWidth="{StaticResource MaxTooltipContentWidth}">
                                                <StackPanel.Resources>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="TextWrapping" Value="Wrap"/>
                                                        <Setter Property="FontSize" Value="{DynamicResource ScaledMediumFontSize}"/>
                                                        <Setter Property="Foreground" Value="{StaticResource LS_baseTxtColor}"/>
                                                    </Style>
                                                </StackPanel.Resources>

                                                <TextBlock ls:TextBlockFormatter.SourceText="{Binding Source='h9784a948g9d80g41d8gbb18ga9c838b90edd',Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource TooltipTitleStyle}"/>

                                                <TextBlock ls:TextBlockFormatter.SourceText="{Binding Source='h1be7e965gcf8dg4a81gb85dga1fbc01a9f08',Converter={StaticResource TranslatedStringConverter}}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ls:LSTooltip.ContentTemplate>
                                </ls:LSTooltip>
                            </ls:LSButton.ToolTip>
                        </ls:LSButton>
                    </Border>
                    
                    
                    <!-- MOD_ACS: Add LearnBtnContainerCloser -->
                    <Border x:Name="LearnBtnContainerCloser" Grid.Column="0" Grid.Row="1" Height="72" VerticalAlignment="Top" Margin="12,0,-12,0" Visibility="Collapsed">
                        <!-- MOD_ACS: Add LearnSpellsButton // BG3: HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,26,0" MinWidth="150" -->
                        <ls:LSButton x:Name="LearnSpellsButtonCloser" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,0,0,0" Command="{Binding DataContext.CustomEvent, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="CloseLearnSpells" MinWidth="0">
                            <ls:LSButton.Template>
                                <ControlTemplate TargetType="ls:LSButton">
                                    <ControlTemplate.Resources>
                                        <BitmapImage x:Key="Icon_d" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_learnSpells_d.png" />
                                        <BitmapImage x:Key="Icon_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_learnSpells_h.png" />
                                        <BitmapImage x:Key="Icon_p" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_learnSpells_p.png" />
                                        <BitmapImage x:Key="Icon_disabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_learnSpells_disabled.png" />
                                    </ControlTemplate.Resources>

                                    <!-- BG3: Slices="36,34" Padding="20,10" Height="72" -->
                                    <ls:LSNineSliceImage x:Name="SearchBarContainer" ImageSource="{StaticResource SearchBarBg_d}" Slices="36,34" Padding="16,8,16,12" Height="72">
                                        <Image x:Name="Icon" Source="{StaticResource Icon_d}" Stretch="None" VerticalAlignment="Center"/>
                                    </ls:LSNineSliceImage>

                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="SearchBarContainer" Property="ImageSource" Value="{StaticResource SearchBarBg_h}"/>
                                            <Setter TargetName="Icon" Property="Source" Value="{StaticResource Icon_h}"/>
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter TargetName="SearchBarContainer" Property="ImageSource" Value="{StaticResource SearchBarBg_h}"/>
                                            <Setter TargetName="Icon" Property="Source" Value="{StaticResource Icon_p}"/>
                                            <Setter TargetName="Icon" Property="Margin" Value="0,4,0,-4"/>
                                        </Trigger>
                                        <Trigger Property="IsEnabled" Value="False">
                                            <Setter TargetName="SearchBarContainer" Property="ImageSource" Value="{StaticResource SearchBarBg_d}"/>
                                            <Setter TargetName="Icon" Property="Source" Value="{StaticResource Icon_disabled}"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </ls:LSButton.Template>
                            
                            <b:Interaction.Triggers>
                                <!-- MOD_ACS: Btn Switcher -->
                                <b:EventTrigger EventName="Click">
                                    <b:ChangePropertyAction TargetName="LearnSpellsSpy" PropertyName="Visibility" Value="Collapsed"/>
                                </b:EventTrigger>
                            </b:Interaction.Triggers>
                            
                            <ls:LSButton.ToolTip>
                                <ls:LSTooltip DataContext="{Binding Path=DataContext, RelativeSource={RelativeSource TemplatedParent}}">
                                    <ls:LSTooltip.ContentTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Vertical" MaxWidth="{StaticResource MaxTooltipContentWidth}">
                                                <StackPanel.Resources>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="TextWrapping" Value="Wrap"/>
                                                        <Setter Property="FontSize" Value="{DynamicResource ScaledMediumFontSize}"/>
                                                        <Setter Property="Foreground" Value="{StaticResource LS_baseTxtColor}"/>
                                                    </Style>
                                                </StackPanel.Resources>

                                                <TextBlock ls:TextBlockFormatter.SourceText="{Binding Source='h9784a948g9d80g41d8gbb18ga9c838b90edd',Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource TooltipTitleStyle}"/>

                                                <TextBlock ls:TextBlockFormatter.SourceText="{Binding Source='h1be7e965gcf8dg4a81gb85dga1fbc01a9f08',Converter={StaticResource TranslatedStringConverter}}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ls:LSTooltip.ContentTemplate>
                                </ls:LSTooltip>
                            </ls:LSButton.ToolTip>
                        </ls:LSButton>
                    </Border>
                    

                    <Border x:Name="Actions" Grid.Column="1" Grid.Row="1">
                        <ItemsPresenter x:Name="Presenter" Margin="0,0,0,0" VerticalAlignment="Center" HorizontalAlignment="Left">
                            <ItemsPresenter.Width>
                                <MultiBinding Converter="{StaticResource RoundDownMultiConverter}">
                                    <Binding Path="ActualWidth" ElementName="Actions"/>
                                    <Binding Source="{StaticResource SpellCellSize}"/>
                                </MultiBinding>
                            </ItemsPresenter.Width>
                        </ItemsPresenter>
                    </Border>

                    <!-- MOD_ACS: Update align & margin // BG3: HorizontalAlignment="Right" Margin="0,0,48,0" -->
                    <ItemsControl x:Name="Resources" Grid.Column="2" Grid.Row="1"
                                                      ItemsSource="{Binding GroupResources}" 
                                                      VerticalAlignment="Top" HorizontalAlignment="Center" Margin="0,0,18,0" 
                                                      Visibility="{Binding GroupResources.Count, Converter={StaticResource CountToVisibilityConverter}}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>

                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="ls:VMGroupResource">
                                <Grid x:Name="GroupResourceRoot" Visibility="{Binding MaxValue, Converter={StaticResource CountToVisibilityConverter}}">
                                    <ls:LSActionPointResources x:Name="ResourcePoints" 
                                                                               ToolTipService.Placement="Top" ToolTip="{StaticResource ManagedTooltip}" 
                                                                               VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0,18,0,-18"
                                                                               MaxActionPoints="{Binding MaxValue}" 
                                                                               AvailableActionPoints="{Binding Value}"
                                                                               ActionPointSize="48" SmallActionPointSize="25" ActionPointGroupSize="50" 
                                                                               HighlightedActionPoints="0" 
                                                                               Style="{DynamicResource ActionResourcesTemplateSelector}"
                                                                               ls:AttachedProperties.InheritedTag="NoAnimation"/>

                                    <TextBlock x:Name="SpellSlotLevel" 
                                                               Text="{Binding Level, Converter={StaticResource DecimalToRomanConverter}}" 
                                                               Foreground="{StaticResource LS_tint100}" 
                                                               VerticalAlignment="Top" HorizontalAlignment="Center"
                                                               IsHitTestVisible="False" 
                                                               FontSize="{StaticResource MiniFontSize}" 
                                                               FontWeight="Bold" noesis:Text.Stroke="{StaticResource LS_tint00}" noesis:Text.StrokeThickness="5"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!-- MOD_ACS: Add ClassSectionGridClose button -->
                    <ls:LSButton x:Name="ClassSectionGridClose" Grid.Column="2" Grid.Row="1" Template="{StaticResource ACS_IconButtonTemplate}"
                                 VerticalAlignment="Top" HorizontalAlignment="Left" Visibility="Collapsed" Margin="0,8,0,-8">
                        <ls:LSButton.Resources>
                            <BitmapImage x:Key="ButtonNormal" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Container/container_roundBtn_d.png"/>
                            <BitmapImage x:Key="ButtonHighlight" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Container/container_roundBtn_h.png"/>
                            <BitmapImage x:Key="ButtonPressed" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Container/container_roundBtn_p.png"/>
                            <BitmapImage x:Key="ButtonDisabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Container/container_roundBtn_disabled.png"/>
                            
                            <BitmapImage x:Key="IconNormal" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/ACS/Arrows/doubleArrow_up_d.png"/>
                            <BitmapImage x:Key="IconHighlight" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/ACS/Arrows/doubleArrow_up_h.png"/>
                            <BitmapImage x:Key="IconPressed" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/ACS/Arrows/doubleArrow_up_h.png"/>
                            <BitmapImage x:Key="IconDisabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/ACS/Arrows/doubleArrow_up_disabled.png.png"/>
                            
                            <System:Double x:Key="ImgWidth">54</System:Double>
                            <System:Double x:Key="ImgHeight">54</System:Double>
                            <System:Double x:Key="IconWidth">54</System:Double>
                            <System:Double x:Key="IconHeight">54</System:Double>
                            <Thickness x:Key="IconMargin">0,0,0,0</Thickness>
                            <Thickness x:Key="IconPressedMargin">0,2,0,0</Thickness>
                        </ls:LSButton.Resources>
                        
                        <b:Interaction.Triggers>
                            <b:EventTrigger EventName="Click">
                                <b:ChangePropertyAction TargetName="ClassSectionGridToggleSpy" PropertyName="Visibility" Value="Collapsed"/>
                            </b:EventTrigger>
                        </b:Interaction.Triggers>
                    </ls:LSButton>

                    <!-- MOD_ACS: Add ClassSectionGridOpen button -->
                    <ls:LSButton x:Name="ClassSectionGridOpen" Grid.Column="2" Grid.Row="1" Template="{StaticResource ACS_IconButtonTemplate}"
                                 VerticalAlignment="Top" HorizontalAlignment="Left" Visibility="Collapsed" Margin="0,8,0,-8">
                        <ls:LSButton.Resources>
                            <BitmapImage x:Key="ButtonNormal" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Container/container_roundBtn_d.png"/>
                            <BitmapImage x:Key="ButtonHighlight" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Container/container_roundBtn_h.png"/>
                            <BitmapImage x:Key="ButtonPressed" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Container/container_roundBtn_p.png"/>
                            <BitmapImage x:Key="ButtonDisabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Container/container_roundBtn_disabled.png"/>
                            
                            <BitmapImage x:Key="IconNormal" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/ACS/Arrows/doubleArrow_down_d.png"/>
                            <BitmapImage x:Key="IconHighlight" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/ACS/Arrows/doubleArrow_down_h.png"/>
                            <BitmapImage x:Key="IconPressed" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/ACS/Arrows/doubleArrow_down_h.png"/>
                            <BitmapImage x:Key="IconDisabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/ACS/Arrows/doubleArrow_down_disabled.png.png"/>
                            
                            <System:Double x:Key="ImgWidth">54</System:Double>
                            <System:Double x:Key="ImgHeight">54</System:Double>
                            <System:Double x:Key="IconWidth">54</System:Double>
                            <System:Double x:Key="IconHeight">54</System:Double>
                            <Thickness x:Key="IconMargin">0,0,0,0</Thickness>
                            <Thickness x:Key="IconPressedMargin">0,2,0,0</Thickness>
                        </ls:LSButton.Resources>
                        
                        <b:Interaction.Triggers>
                            <b:EventTrigger EventName="Click">
                                <b:ChangePropertyAction TargetName="ClassSectionGridToggleSpy" PropertyName="Visibility" Value="Visible"/>
                            </b:EventTrigger>
                        </b:Interaction.Triggers>
                    </ls:LSButton>

                </Grid>

                <ControlTemplate.Triggers>
                    <!-- MetaMagic -->
                    <DataTrigger Binding="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="MetaMagic">
                        <Setter TargetName="GroupName" Property="ls:TextBlockFormatter.SourceText" Value="{Binding Source='h007741f2ge0abg4842g99f1gcfa286352e4a', Converter={StaticResource TranslatedStringConverter}}"/>
                        <Setter TargetName="Icon" Property="Source" Value="{StaticResource MetamagicIcon}"/>
                        <Setter TargetName="GroupName" Property="Foreground" Value="{StaticResource Sorcerer.Metamagic}"/>
                    </DataTrigger>

                    <!-- Passives -->
                    <!-- MOD_ACS: Change txt from 'Passives' to 'Toggleable Passive Feature' // BG3: Source='hccb74959ga789g46f6g8cc2g73edf1536b6a'-->
                    <DataTrigger Binding="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="Passives">
                        <Setter TargetName="GroupName" Property="ls:TextBlockFormatter.SourceText" Value="{Binding Source='he8ad7cd6g0ffag472ega526g52c8ef0560f1', Converter={StaticResource TranslatedStringConverter}}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="TadpolePassives">
                        <Setter TargetName="GroupName" Property="ls:TextBlockFormatter.SourceText" Value="{Binding Source='hb34891acg5c1dg4c00gbdffg28f4611d661a', Converter={StaticResource TranslatedStringConverter}}"/>
                    </DataTrigger>

                    <!-- Always prepared -->
                    <DataTrigger Binding="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="AlwaysPrepared">
                        <Setter TargetName="Icon" Property="Source" Value="{StaticResource AlwaysPreparedSpellsIcon}"/>
                    </DataTrigger>

                    <!-- Prepared -->
                    <DataTrigger Binding="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="Prepared">
                        <Setter TargetName="Icon" Property="Source" Value="{StaticResource PreparedSpellsIcon}"/>
                    </DataTrigger>

                    <!-- MOD_ACS: Add switch for LearnBtnContainer/LearnBtnContainerCloser based on LearnSpellsSpy Visibility -->
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="Prepared"/>
                            <Condition Binding="{Binding SelectedItem.Class.CanLearnSpells, ElementName=Tabs}" Value="True"/>
                            <Condition Binding="{Binding Visibility, ElementName=LearnSpellsSpy}" Value="Collapsed"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="LearnBtnContainer" Property="Visibility" Value="Visible"/>
                        <Setter TargetName="LearnBtnContainerCloser" Property="Visibility" Value="Collapsed"/>
                    </MultiDataTrigger>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="Prepared"/>
                            <Condition Binding="{Binding SelectedItem.Class.CanLearnSpells, ElementName=Tabs}" Value="True"/>
                            <Condition Binding="{Binding Visibility, ElementName=LearnSpellsSpy}" Value="Visible"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="LearnBtnContainer" Property="Visibility" Value="Collapsed"/>
                        <Setter TargetName="LearnBtnContainerCloser" Property="Visibility" Value="Visible"/>
                    </MultiDataTrigger>

                    <!-- MOD_ACS: Add switch for btn ClassSectionGrid Close/Open based on ClassSectionGrid Visibility -->
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="Prepared"/>
                            <Condition Binding="{Binding Visibility, ElementName=ClassSectionGrid}" Value="Visible"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="ClassSectionGridClose" Property="Visibility" Value="Visible"/>
                        <Setter TargetName="ClassSectionGridOpen" Property="Visibility" Value="Collapsed"/>
                    </MultiDataTrigger>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="Prepared"/>
                            <Condition Binding="{Binding Visibility, ElementName=ClassSectionGrid}" Value="Collapsed"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="ClassSectionGridClose" Property="Visibility" Value="Collapsed"/>
                        <Setter TargetName="ClassSectionGridOpen" Property="Visibility" Value="Visible"/>
                    </MultiDataTrigger>
                    
                    <!-- <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding SelectedItem.Class.MustPrepareSpells, ElementName=Tabs, FallbackValue=False}" Value="True"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="ClassSectionGrid" Property="Visibility" Value="Collapsed"/>
                    </MultiDataTrigger>
                    
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding SelectedItem.Class.MustPrepareSpells, ElementName=Tabs, FallbackValue=False}" Value="False"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="ClassSectionGrid" Property="Visibility" Value="Visible"/>
                    </MultiDataTrigger> -->

                    <!-- Feats -->
                    <DataTrigger Binding="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="CharacterFeats">
                        <Setter TargetName="GroupName" Property="ls:TextBlockFormatter.SourceText" Value="{Binding Source=h0903b2a0g1e63g4553ga7e5gb60812ee4364, Converter={StaticResource TranslatedStringConverter}}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="ClassFeats">
                        <Setter TargetName="GroupName" Property="ls:TextBlockFormatter.SourceText" Value="{Binding Source=hf0ecb46dgcfb5g4979gbdf5g1c48ca834de8, Converter={StaticResource TranslatedStringConverter}}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="TadpoleFeats">
                        <Setter TargetName="GroupName" Property="ls:TextBlockFormatter.SourceText" Value="{Binding Source=h97b3e255g3188g4739g9e16ge08349058868, Converter={StaticResource TranslatedStringConverter}}"/>
                    </DataTrigger>

                    <!-- Cantrips -->
                    <DataTrigger Binding="{Binding GroupType}" Value="Cantrip">
                        <Setter TargetName="GroupName" Property="ls:TextBlockFormatter.SourceText" Value="{Binding Source='h85581f8bg866cg4da4g9d7agffb21a8cfade', Converter={StaticResource TranslatedStringConverter}}"/>
                        <Setter TargetName="Icon" Property="Source" Value="{StaticResource CantripsIcon}"/>
                        <Setter TargetName="Resources" Property="Visibility" Value="Collapsed"/>
                    </DataTrigger>

                    <!-- Spell levels -->
                    <DataTrigger Binding="{Binding GroupType}" Value="Level1">
                        <Setter TargetName="Icon" Property="Source" Value="{StaticResource SpellsLv1Icon}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding GroupType}" Value="Level2">
                        <Setter TargetName="Icon" Property="Source" Value="{StaticResource SpellsLv2Icon}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding GroupType}" Value="Level3">
                        <Setter TargetName="Icon" Property="Source" Value="{StaticResource SpellsLv3Icon}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding GroupType}" Value="Level4">
                        <Setter TargetName="Icon" Property="Source" Value="{StaticResource SpellsLv4Icon}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding GroupType}" Value="Level5">
                        <Setter TargetName="Icon" Property="Source" Value="{StaticResource SpellsLv5Icon}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding GroupType}" Value="Level6">
                        <Setter TargetName="Icon" Property="Source" Value="{StaticResource SpellsLv6Icon}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding GroupType}" Value="Level7">
                        <Setter TargetName="Icon" Property="Source" Value="{StaticResource SpellsLv7Icon}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding GroupType}" Value="Level8">
                        <Setter TargetName="Icon" Property="Source" Value="{StaticResource SpellsLv8Icon}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding GroupType}" Value="Level9">
                        <Setter TargetName="Icon" Property="Source" Value="{StaticResource SpellsLv9Icon}"/>
                    </DataTrigger>

                    <!-- Actions -->
                    <DataTrigger Binding="{Binding GroupType}" Value="SpecialActions">
                        <Setter TargetName="GroupName" Property="ls:TextBlockFormatter.SourceText" Value="{Binding Source='h66448586g6071g4b12g8e48g27cd0d5715ab', Converter={StaticResource TranslatedStringConverter}}"/>
                        <Setter TargetName="Icon" Property="Source" Value="{StaticResource ClassActionIcon}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding GroupType}" Value="WeaponActions">
                        <Setter TargetName="GroupName" Property="ls:TextBlockFormatter.SourceText" Value="{Binding Source='h37cf9a7bge200g4d99g8cf8gaf035b189c60', Converter={StaticResource TranslatedStringConverter}}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding GroupType}" Value="CommonActions">
                        <Setter TargetName="GroupName" Property="ls:TextBlockFormatter.SourceText" Value="{Binding Source='hb4d6c027ge6c2g4ebag8d04g6d5f7febd91d', Converter={StaticResource TranslatedStringConverter}}"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="TadpoleActions">
                        <Setter TargetName="GroupName" Property="ls:TextBlockFormatter.SourceText" Value="{Binding Source=hceaee723g15d8g47adg99edg436618d1e149, Converter={StaticResource TranslatedStringConverter}}"/>
                        <Setter TargetName="Icon" Property="Source" Value="{StaticResource TadpoleActionIcon}"/>
                    </DataTrigger>

                    <!-- Warlock spells -->
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding GroupResources[0].MaxValue, Converter={StaticResource GreaterThanConverter}, ConverterParameter='0'}" Value="False"/>
                            <Condition Binding="{Binding GroupResources[1].MaxValue, Converter={StaticResource GreaterThanConverter}, ConverterParameter='0'}" Value="True"/>
                            <Condition Binding="{Binding GroupResources[1].TypeId}" Value="WarlockSpellSlot"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="Icon" Property="Source" Value="{StaticResource WarlockSpellsIcon}"/>
                    </MultiDataTrigger>

                    <!-- Compact View -->
                    <DataTrigger Binding="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="HideResources">
                        <Setter TargetName="Column2" Property="Width" Value="0"/>
                        <Setter TargetName="Resources" Property="Visibility" Value="Collapsed"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="HideFeatsAndResources">
                        <Setter TargetName="Column2" Property="Width" Value="0"/>
                        <Setter TargetName="Resources" Property="Visibility" Value="Collapsed"/>
                    </DataTrigger>

                    <DataTrigger Binding="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="CompactView">
                        <Setter TargetName="Column2" Property="Width" Value="0"/>
                        <Setter TargetName="GroupName" Property="Margin" Value="0"/>
                    </DataTrigger>

                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="CompactView"/>
                            <Condition Binding="{Binding GroupType}" Value="Level1"/>
                        </MultiDataTrigger.Conditions>
                        <MultiDataTrigger.Setters>
                            <Setter TargetName="GroupName" Property="ls:TextBlockFormatter.SourceText" Value="{Binding Source='h062f5cf9gb2e5g4c0dgadc9g68898c250650', Converter={StaticResource TranslatedStringConverter}}"/>
                        </MultiDataTrigger.Setters>
                    </MultiDataTrigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>

            <ControlTemplate x:Key="SpellCellTemplate">
                <Grid x:Name="Container" Background="Transparent" Width="{StaticResource SpellCellContentSize}" Height="{StaticResource SpellCellContentSize}" >
                    <Rectangle x:Name="Icon" Fill="{Binding Icon}" Width="{StaticResource SpellCellContentSize}" Height="{StaticResource SpellCellContentSize}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    <Rectangle x:Name="hover" Fill="{StaticResource LS_HoverColor}" Visibility="Hidden"/>
                    <Image x:Name="hoverIcon" Source="{StaticResource RemoveSpellIcon}" Stretch="Fill" VerticalAlignment="Center" HorizontalAlignment="Center" Visibility="Hidden"/>
                    <Image x:Name="Border" Source="{StaticResource PreparedSpellBorder}" Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Hidden" Width="{StaticResource SpellCellContentSize}" Height="{StaticResource SpellCellContentSize}"/>
                    <Image x:Name="Checkmark" Source="{StaticResource PreparedSpellIcon}" Stretch="None" VerticalAlignment="Bottom" HorizontalAlignment="Right" Visibility="Collapsed" Margin="0,0,-6,-6"/>
                </Grid>

                <ControlTemplate.Triggers>
                    <DataTrigger Binding="{Binding Datacontext, RelativeSource={RelativeSource Mode=Self}, Converter={StaticResource NullToBoolTrueConverter}}" Value="True">
                        <Setter Property="IsEnabled" Value="False"/>
                    </DataTrigger>

                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding Path=IsMouseOver, RelativeSource={RelativeSource Mode=Self}}" Value="True"/>
                            <Condition Binding="{Binding Datacontext, RelativeSource={RelativeSource Mode=Self}, Converter={StaticResource NullToBoolTrueConverter}}" Value="False"/>
                        </MultiDataTrigger.Conditions>
                        <MultiDataTrigger.Setters>
                            <Setter TargetName="hover" Property="Visibility" Value="Visible"/>
                        </MultiDataTrigger.Setters>
                    </MultiDataTrigger>

                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding Path=IsMouseOver, RelativeSource={RelativeSource Mode=Self}}" Value="True"/>
                            <Condition Binding="{Binding Datacontext, RelativeSource={RelativeSource Mode=Self}, Converter={StaticResource NullToBoolTrueConverter}}" Value="False"/>
                            <Condition Binding="{Binding NeedsActivation}" Value="True"/>
                            <Condition Binding="{Binding Activated}" Value="True"/>
                            <Condition Binding="{Binding DataContext.CurrentPlayer.UIData.AllowInteraction, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="True"/>
                        </MultiDataTrigger.Conditions>
                        <MultiDataTrigger.Setters>
                            <Setter TargetName="hoverIcon" Property="Visibility" Value="Visible"/>
                        </MultiDataTrigger.Setters>
                    </MultiDataTrigger>

                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding SelectedItem.Class.MustPrepareSpells, ElementName=Tabs, FallbackValue=False}" Value="True"/>
                            <Condition Binding="{Binding SpellSlotLevel, Converter={StaticResource GreaterThanConverter}, ConverterParameter=0}" Value="True"/>
                            <Condition Binding="{Binding Activated}" Value="True"/>
                            <Condition Binding="{Binding NeedsActivation}" Value="True"/>
                        </MultiDataTrigger.Conditions>
                        <MultiDataTrigger.Setters>
                            <Setter TargetName="Checkmark" Property="Visibility" Value="Visible"/>
                            <Setter TargetName="Border" Property="Visibility" Value="Visible"/>
                        </MultiDataTrigger.Setters>
                    </MultiDataTrigger>

                    <DataTrigger Binding="{Binding (ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="PreparedSpell">
                        <Setter TargetName="Checkmark" Property="Visibility" Value="Collapsed"/>
                        <Setter TargetName="Border" Property="Visibility" Value="Collapsed"/>
                    </DataTrigger>

                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding (ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="PreparedSpell"/>
                            <Condition Binding="{Binding Datacontext, RelativeSource={RelativeSource Mode=Self}, Converter={StaticResource NullToBoolTrueConverter}}" Value="True"/>
                        </MultiDataTrigger.Conditions>
                        <MultiDataTrigger.Setters>
                            <Setter TargetName="Icon" Property="Fill">
                                <Setter.Value>
                                    <ImageBrush ImageSource="{StaticResource FreeSlotBg}" Stretch="None"/>
                                </Setter.Value>
                            </Setter>
                        </MultiDataTrigger.Setters>
                    </MultiDataTrigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>

            <DataTemplate x:Key="PreparedSpellCellTemplate" DataType="ls:VMCharacterAction"> 
                <ContentControl x:Name="Container" IsEnabled="{Binding DataContext.CurrentPlayer.UIData.AllowInteraction, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" ToolTipService.Placement="Right" ToolTipService.ShowOnDisabled="True" ls:DragAndDropProperties.DropTargetOwner="{Binding Path=(ls:TooltipExtender.Owner), RelativeSource={RelativeSource Mode=Self}}">
                    <ContentControl.ToolTip>
                        <ls:LSTooltip Content="{Binding DataContext, RelativeSource={RelativeSource TemplatedParent}}" IsHitTestVisible="False"/>
                    </ContentControl.ToolTip>

                    <b:Interaction.Behaviors>
                        <ls:DragGenericBehavior StartDragCommand="{Binding DataContext.DragCharacterActionCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                        <ls:DropOnGenericBehavior DropCommand="{Binding DataContext.DropPrepareCharacterAction, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                    </b:Interaction.Behaviors>

                    <b:Interaction.Triggers>
                        <b:DataTrigger Binding="{Binding DataContext, ElementName=Container, Converter={StaticResource NullToBoolTrueConverter}}" Value="False">
                            <b:ChangePropertyAction TargetName="SlotButton" PropertyName="IsEnabled" Value="True"/>
                        </b:DataTrigger>
                    </b:Interaction.Triggers>

                    <Grid Width="{StaticResource SpellCellSize}" Height="{StaticResource SpellCellSize}">
                        <ls:LSButton x:Name="SlotButton" HorizontalAlignment="Center" VerticalAlignment="Center" Template="{StaticResource SpellCellTemplate}" ls:AttachedProperties.InheritedTag="PreparedSpell" Command="{Binding DataContext.ToggleCharacterAction, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="{Binding}">
                            <Image Source="{StaticResource RemoveSpellIcon}" Stretch="None"/>

                            <b:Interaction.Triggers>
                                <b:EventTrigger EventName="Click">
                                    <b:ChangePropertyAction TargetName="SlotButton" PropertyName="IsEnabled" Value="False"/>
                                </b:EventTrigger>
                            </b:Interaction.Triggers>
                        </ls:LSButton>

                        <TextBlock x:Name="SpellSlotLevel" Text="{Binding SpellSlotLevel, Converter={StaticResource DecimalToRomanConverter}}" Foreground="{StaticResource LS_tint100}" VerticalAlignment="Bottom" HorizontalAlignment="Right" IsHitTestVisible="False" Margin="0,0,12,0" FontSize="{StaticResource SmallishFontSize}" FontWeight="Bold" noesis:Text.Stroke="{StaticResource LS_tint00}" noesis:Text.StrokeThickness="5"/>
                    </Grid>
                </ContentControl>

                <DataTemplate.Triggers>
                    <DataTrigger Binding="{Binding DataContext, RelativeSource={RelativeSource Mode=Self}, Converter={StaticResource NullToBoolTrueConverter}}" Value="True">
                        <Setter TargetName="Container" Property="ToolTip" Value="{x:Null}"/>
                    </DataTrigger>
                </DataTemplate.Triggers>
            </DataTemplate>

            <Style x:Key="SpellCellGridItemContainerStyle" TargetType="ContentPresenter">
                <Setter Property="Width" Value="{StaticResource SpellCellSize}"/>
                <Setter Property="Height" Value="{StaticResource SpellCellSize}"/>

                <Style.Triggers>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding DataContext.ComesFromFeat, RelativeSource={RelativeSource Mode=Self}}" Value="True"/>
                            <Condition Binding="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="HideFeats"/>
                        </MultiDataTrigger.Conditions>
                        <Setter Property="Visibility" Value="Collapsed"/>
                    </MultiDataTrigger>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding DataContext.ComesFromFeat, RelativeSource={RelativeSource Mode=Self}}" Value="True"/>
                            <Condition Binding="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="HideFeatsAndAlwaysPrepared"/>
                        </MultiDataTrigger.Conditions>
                        <Setter Property="Visibility" Value="Collapsed"/>
                    </MultiDataTrigger>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding DataContext.ComesFromFeat, RelativeSource={RelativeSource Mode=Self}}" Value="True"/>
                            <Condition Binding="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="HideFeatsAndResources"/>
                        </MultiDataTrigger.Conditions>
                        <Setter Property="Visibility" Value="Collapsed"/>
                    </MultiDataTrigger>

                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding DataContext.SpellSlotLevel, RelativeSource={RelativeSource Mode=Self}, Converter={StaticResource GreaterThanConverter}, ConverterParameter=0}" Value="True"/>
                            <Condition Binding="{Binding DataContext.Activated, RelativeSource={RelativeSource Mode=Self}}" Value="True"/>
                            <Condition Binding="{Binding DataContext.NeedsActivation, RelativeSource={RelativeSource Mode=Self}}" Value="False"/>
                            <Condition Binding="{Binding Path=(ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}" Value="HideFeatsAndAlwaysPrepared"/>
                        </MultiDataTrigger.Conditions>
                        <Setter Property="Visibility" Value="Collapsed"/>
                    </MultiDataTrigger>
                </Style.Triggers>
            </Style>

            <Style x:Key="PassiveCellItemsControlStyle" TargetType="ItemsControl">
                <Setter Property="Template" Value="{StaticResource SpellbookActionGroup}"/>
                <Setter Property="AlternationCount" Value="{Binding ItemsSource.Count, RelativeSource={RelativeSource Mode=Self}}"/>
                <Setter Property="ItemsPanel" Value="{StaticResource SpellbookItemsPanelTemplate}"/>
                <Setter Property="ItemContainerStyle" Value="{StaticResource SpellCellGridItemContainerStyle}"/>
                <Setter Property="ItemTemplate">
                    <Setter.Value>
                        <DataTemplate>
                            <ContentControl x:Name="Container" ToolTipService.Placement="Right" ToolTipService.ShowOnDisabled="True" Template="{StaticResource SpellCellTemplate}">
                                <ContentControl.ToolTip>
                                    <ls:LSTooltip Content="{TemplateBinding DataContext}" IsHitTestVisible="False"/>
                                </ContentControl.ToolTip>
                                <b:Interaction.Behaviors>
                                    <ls:DragGenericBehavior StartDragCommand="{Binding DataContext.DragPassiveCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                                </b:Interaction.Behaviors>

                                <b:Interaction.Triggers>
                                    <b:EventTrigger EventName="MouseEnter">
                                        <ls:LSPlaySound Sound="UI_Shared_Hover"/>
                                    </b:EventTrigger>
                                    <b:EventTrigger EventName="MouseDown">
                                        <ls:LSPlaySound Sound="UI_Shared_Press"/>
                                    </b:EventTrigger>
                                </b:Interaction.Triggers>

                                <ContentControl.Clip>
                                    <!-- MOD_ACS: Update circle geometry // BG3: Center="34,34" RadiusX="34" RadiusY="34" -->
                                    <EllipseGeometry Center="36,35" RadiusX="33" RadiusY="33" />
                                </ContentControl.Clip>
                            </ContentControl>
                        </DataTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <DataTemplate x:Key="ActionGroupItemTemplate">
                <ls:LSButton x:Name="Container" Command="{Binding DataContext.ToggleCharacterAction, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="{Binding}" HorizontalAlignment="Center" VerticalAlignment="Center" ToolTipService.Placement="Right" ToolTipService.ShowOnDisabled="True" Template="{StaticResource SpellCellTemplate}">
                    <ls:LSButton.ToolTip>
                        <ls:LSTooltip Content="{TemplateBinding DataContext}" IsHitTestVisible="False"/>
                    </ls:LSButton.ToolTip>
                    <b:Interaction.Behaviors>
                        <ls:DragGenericBehavior StartDragCommand="{Binding DataContext.DragCharacterActionCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                    </b:Interaction.Behaviors>
                </ls:LSButton>
            </DataTemplate>

            <Style x:Key="ActionCellItemsControlStyle" TargetType="ItemsControl">
                <Setter Property="Template" Value="{StaticResource SpellbookActionGroup}"/>
                <Setter Property="AlternationCount" Value="{Binding ItemsSource.Count, RelativeSource={RelativeSource Mode=Self}}"/>
                <Setter Property="ItemsPanel" Value="{StaticResource SpellbookItemsPanelTemplate}"/>
                <Setter Property="ItemContainerStyle" Value="{StaticResource SpellCellGridItemContainerStyle}"/>
                <Setter Property="ItemTemplate" Value="{StaticResource ActionGroupItemTemplate}"/>
            </Style>

            <DataTemplate DataType="{x:Type ls:VMActionGroup}">
                <Grid>
                    <!-- MOD_ACS: Update Margin // BG3: Margin="0,0,12,0" -->
                    <Image x:Name="AlternateBg" Source="{StaticResource KnownSpellsBg}" Stretch="Fill" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Visibility="Hidden" Margin="0,0,14,0"/>

                    <ItemsControl x:Name="ActionsControl" 
                                                  Style="{StaticResource ActionCellItemsControlStyle}" 
                                                  ItemsSource="{Binding Actions}" VerticalAlignment="Center"/>
                </Grid>

                <DataTemplate.Triggers>
                    <DataTrigger Binding="{Binding (ItemsControl.AlternationIndex), RelativeSource={RelativeSource Self}, Converter={StaticResource ModuloConverter}, ConverterParameter='2'}" Value="1">
                        <Setter TargetName="AlternateBg" Property="Visibility" Value="Visible"/>
                    </DataTrigger>
                </DataTemplate.Triggers>
            </DataTemplate>

            <!-- MOD_ACS: Spell Search Bar -->
            <ControlTemplate x:Key="SpellSearchBarTemplate" TargetType="ls:FilteringContainer">
                <Grid>
                    <ls:LSNineSliceImage x:Name="SearchBarContainer" ImageSource="{StaticResource SearchBarBg_d}" Slices="36,34" Padding="20,10" Height="72" Margin="0,-6">
                        <Grid VerticalAlignment="Center">
                            <TextBlock x:Name="CategoryName" Visibility="Collapsed" Text="{Binding Source=hf4c636b5g41beg4369ga0aegfe58a3ab7cd3, Converter={StaticResource TranslatedStringConverter}}"/>
                            <TextBlock x:Name="AdditionalFilters" Visibility="Collapsed" Text=""/>

                            <Image Source="{StaticResource SearchIcon}" Stretch="None" VerticalAlignment="Top" HorizontalAlignment="Left"/>

                            <ls:LSTextBox x:Name="PART_FilterSearchBox" HorizontalAlignment="Stretch" VerticalAlignment="Top" Margin="60,0,0,0" Height="56" TextAlignment="Left" FontSize="{DynamicResource ScaledMediumFontSize}" TextWrapping="NoWrap" Focusable="True" SelectTextOnFocus="True">
                                <noesis:Text.Placeholder>
                                    <MultiBinding StringFormat="{}{0}{1}{2}{3}">
                                        <Binding Path="Text" ElementName="CategoryName"/>
                                        <Binding Path="CurrentFilter" RelativeSource="{RelativeSource Mode=TemplatedParent}" FallbackValue=""/>
                                        <Binding Path="CurrentFilter.Name" RelativeSource="{RelativeSource Mode=TemplatedParent}" FallbackValue=""/>
                                        <Binding Path="Text" ElementName="AdditionalFilters"/>
                                    </MultiBinding>
                                </noesis:Text.Placeholder>
                            </ls:LSTextBox>
                        </Grid>
                    </ls:LSNineSliceImage>

                    <Popup x:Name="StringSuggestionPopup" IsOpen="False" >
                        <ls:LSNineSliceImage x:Name="FilterCategories" Margin="0,-12,0,0"  HorizontalAlignment="Left" ImageSource="{StaticResource SearchSortingBg}" Slices="60" Padding="10,40">
                            <StackPanel>
                                <TextBlock Foreground="{StaticResource LS_accent25TxtColor}" FontSize="{StaticResource SmallishFontSize}" Text="{Binding Source='hc0ed9c5ag8a2cg4167g8242g5076d73d695f',Converter={StaticResource TranslatedStringConverter}}" Margin="20,0" VerticalAlignment="Top"/>

                                <ListBox x:Name="FilterListHolder" ItemsSource="{TemplateBinding SuggestedFiltersList}" SelectedItem="{Binding CurrentFilterInternal,RelativeSource={RelativeSource TemplatedParent}}" ScrollViewer.HorizontalScrollBarVisibility="Disabled" ScrollViewer.VerticalScrollBarVisibility="Auto" Margin="20,0,0,0" VerticalAlignment="Top">
                                    <ListBox.Resources>
                                        <DataTemplate DataType="{x:Type ls:VMEnumFilter}">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <Image Grid.Column="0" Grid.ColumnSpan="3" x:Name="BtnBorder" Stretch="None" Source="{StaticResource SearchSelector_d}"/>
                                                <Image Grid.Column="0" Stretch="None" Source="{StaticResource SearchFilterIcon}" VerticalAlignment="Center" Margin="4,0,16,0"/>
                                                <TextBlock Grid.Column="1" x:Name="BtnText" Text="{Binding Name}" Foreground="{StaticResource LS_baseTxtColor}" FontSize="{StaticResource MediumFontSize}" HorizontalAlignment="Left" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                                <TextBlock Grid.Column="2" x:Name="CategoryText" Foreground="{StaticResource LS_baseTxtColor}" FontSize="{StaticResource MediumFontSize}" HorizontalAlignment="Left" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" Margin="0,0,20,0"/>
                                            </Grid>

                                            <DataTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="BtnBorder" Property="Source" Value="{StaticResource SearchSelector_h}"/>
                                                    <Setter TargetName="BtnText" Property="Foreground" Value="{StaticResource LS_accent100TxtColor}"/>
                                                    <Setter TargetName="CategoryText" Property="Foreground" Value="{StaticResource LS_accent100TxtColor}"/>
                                                </Trigger>

                                                <DataTrigger Value="True">
                                                    <DataTrigger.Binding>
                                                        <MultiBinding Converter="{StaticResource EqualConverter}">
                                                            <Binding Path="EnumName"/>
                                                            <Binding Source="ESpellSchool"/>
                                                        </MultiBinding>
                                                    </DataTrigger.Binding>
                                                    <Setter TargetName="CategoryText" Property="Text" Value="{Binding Source=he9daaf0fg24ecg49e2gaab5g36974104a8b6,Converter={StaticResource TranslatedStringConverter}, StringFormat=' ({0})'}"/>
                                                </DataTrigger>

                                                <DataTrigger Value="True">
                                                    <DataTrigger.Binding>
                                                        <MultiBinding Converter="{StaticResource EqualConverter}">
                                                            <Binding Path="EnumName"/>
                                                            <Binding Source="EDamageType"/>
                                                        </MultiBinding>
                                                    </DataTrigger.Binding>
                                                    <Setter TargetName="CategoryText" Property="Text" Value="{Binding Source=h476d8aabg45c5g4452ga4dbgf911f76351c7,Converter={StaticResource TranslatedStringConverter}, StringFormat=' ({0})'}"/>
                                                </DataTrigger>
                                            </DataTemplate.Triggers>
                                        </DataTemplate>
                                        <DataTemplate DataType="{x:Type ls:VMCharacterAction}">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <Image Grid.Column="0" Grid.ColumnSpan="2" x:Name="BtnBorder" Stretch="None" Source="{StaticResource SearchSelector_d}"/>
                                                <Rectangle Grid.Column="0" Width="28" Height="28" Fill="{Binding Icon}" VerticalAlignment="Center" Margin="4,0,16,0"/>
                                                <TextBlock Grid.Column="1" x:Name="BtnText" Text="{Binding Name}" Foreground="{StaticResource LS_baseTxtColor}" FontSize="{StaticResource MediumFontSize}" HorizontalAlignment="Left" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" Width="400"/>
                                            </Grid>

                                            <DataTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="BtnBorder" Property="Source" Value="{StaticResource SearchSelector_h}"/>
                                                    <Setter TargetName="BtnText" Property="Foreground" Value="{StaticResource LS_accent100TxtColor}"/>
                                                </Trigger>
                                            </DataTemplate.Triggers>
                                        </DataTemplate>
                                    </ListBox.Resources>

                                    <ListBox.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Vertical"/>
                                        </ItemsPanelTemplate>
                                    </ListBox.ItemsPanel>
                                </ListBox>
                            </StackPanel>
                        </ls:LSNineSliceImage>
                    </Popup>

                    <Popup x:Name="EnumPopup" IsOpen="{TemplateBinding IsPopupVisible}" >
                        <ls:LSNineSliceImage Margin="0,-12,0,0"  HorizontalAlignment="Stretch" ImageSource="{StaticResource SearchSortingBg}" Slices="60" Padding="10,40">
                            <StackPanel Margin="20,0,0,0">
                                <Control x:Name="SpellSchoolCategory" Template="{StaticResource SpellFilterCategoryTemplate}" DataContext="{Binding Path=(b:Interaction.Behaviors)[0].FilteredItems, RelativeSource={RelativeSource Mode=Self}}" ls:AttachedProperties.InheritedTag="he9daaf0fg24ecg49e2gaab5g36974104a8b6">
                                    <b:Interaction.Behaviors>
                                        <ls:CollectionFilterBehavior x:Name="SpellSchoolEnumFilter" ItemsSource="{Binding Path=GeneratedEnumFilters,RelativeSource={RelativeSource AncestorType={x:Type ls:FilteringContainer}}}" Predicate="{Binding DataContext.Data.SpellSchoolEnumPredicate, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                                    </b:Interaction.Behaviors>
                                </Control>

                                <Control x:Name="DamageTypeCategory" Template="{StaticResource SpellFilterCategoryTemplate}" DataContext="{Binding Path=(b:Interaction.Behaviors)[0].FilteredItems, RelativeSource={RelativeSource Mode=Self}}" ls:AttachedProperties.InheritedTag="h476d8aabg45c5g4452ga4dbgf911f76351c7">
                                    <b:Interaction.Behaviors>
                                        <ls:CollectionFilterBehavior x:Name="DamageTypeEnumFilter" ItemsSource="{Binding Path=GeneratedEnumFilters,RelativeSource={RelativeSource AncestorType={x:Type ls:FilteringContainer}}}" Predicate="{Binding DataContext.Data.DamageTypeEnumPredicate, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                                    </b:Interaction.Behaviors>
                                </Control>
                            </StackPanel>
                        </ls:LSNineSliceImage>
                    </Popup>

                    <b:Interaction.Triggers>
                        <b:EventTrigger EventName="Loaded">
                            <noesis:SetFocusAction TargetName="PART_FilterSearchBox" />
                            <b:ChangePropertyAction TargetName="PART_FilterSearchBox" PropertyName="Tag" Value="Loaded"/>
                        </b:EventTrigger>

                        <b:DataTrigger Binding="{Binding Path=IsVisible,ElementName=PART_FilterSearchBox}" Value="True">
                            <b:Interaction.Behaviors>
                                <b:ConditionBehavior>
                                    <b:ConditionalExpression>
                                        <b:ComparisonCondition LeftOperand="{Binding Path=Tag,ElementName=PART_FilterSearchBox}" Operator="LessThanOrEqual" RightOperand="Loaded"/>
                                    </b:ConditionalExpression>
                                </b:ConditionBehavior>
                            </b:Interaction.Behaviors>
                            <noesis:SetFocusAction TargetName="PART_FilterSearchBox" />
                        </b:DataTrigger>
                    </b:Interaction.Triggers>
                </Grid>

                <ControlTemplate.Triggers>
                    <DataTrigger Binding="{Binding CurrentFilter, RelativeSource={RelativeSource Self}, Converter={StaticResource NullToBoolTrueConverter}, ConverterParameter='EmptyString'}" Value="False">
                        <Setter TargetName="CategoryName" Property="Text" Value=""/>
                    </DataTrigger>

                    <DataTrigger Binding="{Binding CurrentFilter.AdditionalBoolProperty, RelativeSource={RelativeSource Self}}" Value="True">
                        <Setter TargetName="AdditionalFilters" Property="Text" Value="{Binding Source='h038b1421g2efeg4283g9b88gcdd3b6e46f80',Converter={StaticResource TranslatedStringConverter}}"/>
                    </DataTrigger>

                    <DataTrigger Binding="{Binding IsFocused, ElementName=PART_FilterSearchBox}" Value="True">
                        <Setter TargetName="CategoryName" Property="Text" Value="{Binding Source='hdd323f92g1283g4e22g8aacg3d2dcea4b945',Converter={StaticResource TranslatedStringConverter}}"/>
                        <Setter TargetName="AdditionalFilters" Property="Text" Value=""/>
                        <Setter TargetName="SearchBarContainer" Property="ImageSource" Value="{StaticResource SearchBarBg_h}"/>
                    </DataTrigger>

                    <DataTrigger Binding="{Binding Text, ElementName='PART_FilterSearchBox', Converter={StaticResource NullToBoolTrueConverter}, ConverterParameter='EmptyString'}" Value="False">
                        <Setter TargetName="EnumPopup" Property="IsOpen" Value="False"/>
                        <Setter TargetName="StringSuggestionPopup" Property="IsOpen" Value="True"/>
                    </DataTrigger>

                    <DataTrigger Binding="{Binding Path=IsPopupVisible, RelativeSource={RelativeSource Mode=Self}}" Value="False">
                        <Setter TargetName="EnumPopup" Property="IsOpen" Value="False"/>
                        <Setter TargetName="StringSuggestionPopup" Property="IsOpen" Value="False"/>
                    </DataTrigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>

        </ControlTemplate.Resources>

        <!-- MOD_ACS: Spell Book Container -->
        <Grid x:Name="MultiClassSpellbookContainer">

            <b:Interaction.Behaviors>
                <ls:CollectionSortBehavior x:Name="SpellbooksSortBehavior" ItemsSource="{Binding SpellBooks}" Comparer="{Binding SpellBookComparer}" />

                <ls:CollectionFilterBehavior x:Name="PassivesFilter" ItemsSource="{Binding SelectedItem.Passives, ElementName=Tabs}" Predicate="{Binding TogglablePassivePredicate}"/>
                <ls:CollectionFilterBehavior x:Name="MetaMagicFilter" ItemsSource="{Binding SelectedItem.Passives, ElementName=Tabs}" Predicate="{Binding TogglableMetaMagicPassivePredicate}"/>
                <ls:CollectionFilterBehavior x:Name="CantripGroupFilter" ItemsSource="{Binding SelectedItem.ActionGroups, ElementName=Tabs}" Predicate="{Binding CantripGroupPredicate}"/>
                <ls:CollectionFilterBehavior x:Name="SpellLevelsGroupFilter" ItemsSource="{Binding SelectedItem.ActionGroups, ElementName=Tabs}" Predicate="{Binding SpellLevelsGroupPredicate}" SortDirection="Descending"/>
                <ls:CollectionFilterBehavior x:Name="CharacterActionGroupFilter" ItemsSource="{Binding SelectedItem.ActionGroups, ElementName=Tabs}" Predicate="{Binding CharacterActionsGroupPredicate}"/>
                <ls:CollectionFilterBehavior x:Name="ClassActionGroupFilter" ItemsSource="{Binding SelectedItem.ActionGroups, ElementName=Tabs}" Predicate="{Binding ClassActionsGroupPredicate}"/>
                <ls:CollectionFilterBehavior x:Name="CharacterFeatsFilter" ItemsSource="{Binding SelectedItem.Passives, ElementName=Tabs}" Predicate="{Binding Stats.CharacterFeaturesPredicate}"/>
                <ls:CollectionFilterBehavior x:Name="ClassFeatsFilter" ItemsSource="{Binding SelectedItem.Passives, ElementName=Tabs}" Predicate="{Binding Stats.ClassFeaturesPredicate}"/>


                <ls:CollectionFilterBehavior x:Name="NonFeatCantripGroupFilter" ItemsSource="{Binding FilteredItems, ElementName=CantripGroupFilter}" Predicate="{Binding NonFeatActionsGroupPredicate}"/>
                <ls:CollectionFilterBehavior x:Name="NonNullAlwaysPreparedSpellsFilter" ItemsSource="{Binding SelectedItem.AlwaysPreparedActions, ElementName=Tabs}" Predicate="{Binding CharacterActionRemoveNullPredicate}"/>
                <ls:CollectionFilterBehavior x:Name="NonAlwaysPreparedSpellLevelsGroupFilter" ItemsSource="{Binding FilteredItems, ElementName=SpellLevelsGroupFilter}" Predicate="{Binding NonAlwaysPreparedActionsGroupPredicate}"/>
                <ls:CollectionFilterBehavior x:Name="NonFeatSpellLevelsGroupFilter" ItemsSource="{Binding FilteredItems, ElementName=SpellLevelsGroupFilter}" Predicate="{Binding NonFeatActionsGroupPredicate}"/>
                <ls:CollectionFilterBehavior x:Name="NonFeatOrAlwaysPreparedSpellLevelsGroupFilter" ItemsSource="{Binding FilteredItems, ElementName=SpellLevelsGroupFilter}" Predicate="{Binding NonFeatOrAlwaysPreparedActionsGroupPredicate}"/>

                <ls:CollectionFilterBehavior x:Name="TadpolePassivesFilter" ItemsSource="{Binding TadpoleSpellBook.Passives}" Predicate="{Binding TogglablePassivePredicate}"/>
                <ls:CollectionFilterBehavior x:Name="TadpoleFeatsFilter" ItemsSource="{Binding TadpoleSpellBook.Passives}" Predicate="{Binding Stats.TadpoleFeaturesPredicate}"/>
                <ls:CollectionFilterBehavior x:Name="TadpoleActionsFilter" ItemsSource="{Binding TadpoleSpellBook.ActionGroups}" Predicate="{Binding AllActionsGroupPredicate}"/>
            </b:Interaction.Behaviors>

            <b:Interaction.Triggers>
                <b:EventTrigger EventName="Unloaded">
                    <b:ChangePropertyAction TargetName="LearnSpellsButton" PropertyName="CommandParameter" Value="{x:Null}"/>
                </b:EventTrigger>
            </b:Interaction.Triggers>

            <!-- MOD_ACS: Update Background Stretch / Add Margin // BG3: Stretch="None" -->
            <Image x:Name="Background" Source="{StaticResource SpellbookBg}" Stretch="Fill" HorizontalAlignment="Center" VerticalAlignment="Top" Margin="254,14,254,0"/>

            <!-- Spellbook -->
            <!-- MOD_ACS: Add Margin -->
            <Grid x:Name="ClassPanelRoot" Margin="0,0,0,18">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <!-- Tabs -->
                <!-- MOD_ACS: Update Tabs Margin // BG3: Margin="0,4,0,0" -->
                <StackPanel Grid.Row="0" x:Name="TabsContainer" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Stretch" Margin="0,17,0,-9">
                    <ls:LSButton x:Name="NavigationLeftButton" Template="{StaticResource IconButtonTemplate}" VerticalAlignment="Center"
                                             Visibility="{Binding SpellBooks.Count, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter='5'}"
                                             SoundID="UI_Shared_Panel_Select">
                        <ls:LSButton.Resources>
                            <BitmapImage x:Key="ButtonNormal" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CC/btn_roundSmall_d.png"/>
                            <BitmapImage x:Key="ButtonHighlight" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CC/btn_roundSmall_h.png"/>
                            <BitmapImage x:Key="ButtonPressed" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CC/btn_roundSmall_d.png"/>
                            <BitmapImage x:Key="ButtonDisabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CC/btn_roundSmall_d.png"/>
                            <BitmapImage x:Key="IconNormal" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_browseSmall_d.png"/>
                            <BitmapImage x:Key="IconHighlight" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_browseSmall_h.png"/>
                            <BitmapImage x:Key="IconPressed" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_browseSmall_h.png"/>
                            <BitmapImage x:Key="IconDisabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_browseSmall_d.png"/>
                        </ls:LSButton.Resources>

                        <b:Interaction.Triggers>
                            <b:EventTrigger EventName="Loaded">
                                <b:Interaction.Behaviors>
                                    <b:ConditionBehavior>
                                        <b:ConditionalExpression>
                                            <b:ComparisonCondition LeftOperand="{Binding ElementName=CharacterPanel,Path=Metadata}" Operator="Equal" RightOperand="ToggleInterrupts"/>
                                        </b:ConditionalExpression>
                                    </b:ConditionBehavior>
                                </b:Interaction.Behaviors>

                                <b:ChangePropertyAction TargetName="Tabs" PropertyName="SelectedIndex" Value="{Binding SortedItems.Count, ElementName=SpellbooksSortBehavior, Converter={StaticResource AddConverter}, ConverterParameter=-1}"/>
                            </b:EventTrigger>

                            <b:DataTrigger Binding="{Binding ElementName=CharacterPanel,Path=Metadata}" Value="ToggleInterrupts">
                                <b:ChangePropertyAction TargetName="Tabs" PropertyName="SelectedIndex" Value="{Binding SortedItems.Count, ElementName=SpellbooksSortBehavior, Converter={StaticResource AddConverter}, ConverterParameter=-1}"/>
                            </b:DataTrigger>

                            <b:DataTrigger Binding="{Binding ElementName=CharacterPanel,Path=Metadata}" Value="ToggleSpells">
                                <b:Interaction.Behaviors>
                                    <b:ConditionBehavior>
                                        <b:ConditionalExpression>
                                            <b:ComparisonCondition LeftOperand="{Binding SelectedItem.SpellBookType, ElementName=Tabs}" Operator="Equal" RightOperand="TadPole"/>
                                        </b:ConditionalExpression>
                                    </b:ConditionBehavior>
                                </b:Interaction.Behaviors>
                                <b:ChangePropertyAction TargetName="Tabs" PropertyName="SelectedIndex" Value="0"/>
                            </b:DataTrigger>

                            <b:EventTrigger EventName="LSButtonPressed">
                                <b:Interaction.Behaviors>
                                    <b:ConditionBehavior>
                                        <b:ConditionalExpression>
                                            <b:ComparisonCondition LeftOperand="{Binding Path=SelectedIndex, ElementName=Tabs}" Operator="GreaterThan" RightOperand="0"/>
                                        </b:ConditionalExpression>
                                    </b:ConditionBehavior>
                                </b:Interaction.Behaviors>
                                <b:ChangePropertyAction TargetName="Tabs" PropertyName="SelectedIndex" Value="{Binding SelectedIndex, ElementName=Tabs, Converter={StaticResource AddConverter}, ConverterParameter=-1}"/>
                            </b:EventTrigger>
                            <b:EventTrigger EventName="MouseEnter">
                                <ls:LSPlaySound Sound="UI_Shared_Hover"/>
                            </b:EventTrigger>
                        </b:Interaction.Triggers>
                    </ls:LSButton>

                    <ListBox x:Name="Tabs" ItemsSource="{Binding SortedItems, ElementName=SpellbooksSortBehavior}" HorizontalAlignment="Center" SelectedIndex="{StaticResource InitialTab}" VerticalAlignment="Bottom" ScrollViewer.HorizontalScrollBarVisibility="Hidden">
                        <ListBox.MaxWidth>
                            <MultiBinding Converter="{StaticResource AddMultipleConverter}">
                                <!-- MOD_ACS: Update MaxWidth Tabs -->
                                <Binding Path="ActualWidth" ElementName="Background"/><!-- BG3: ElementName="MultiClassSpellbookContainer" -->
                                <Binding Source="-40"/><!-- MOD_ACS: Add to MaxWidth -->
                                <Binding Path="ActualWidth" ElementName="NavigationLeftButton" Converter="{StaticResource MultiplierConverter}" ConverterParameter="-1"/>
                                <Binding Path="ActualWidth" ElementName="NavigationRightButton" Converter="{StaticResource MultiplierConverter}" ConverterParameter="-1"/>
                            </MultiBinding>
                        </ListBox.MaxWidth>

                        <b:Interaction.Triggers>
                            <b:EventTrigger EventName="SelectionChanged">
                                <b:Interaction.Behaviors>
                                    <b:ConditionBehavior>
                                        <b:ConditionalExpression>
                                            <b:ComparisonCondition LeftOperand="{Binding SelectedIndex, ElementName=Tabs}" Operator="Equal" RightOperand="-1" />
                                        </b:ConditionalExpression>
                                    </b:ConditionBehavior>
                                </b:Interaction.Behaviors>
                                <b:ChangePropertyAction TargetName="Tabs" PropertyName="SelectedIndex" Value="{StaticResource InitialTab}"/>
                            </b:EventTrigger>

                            <b:PropertyChangedTrigger Binding="{Binding Path=DataContext.CurrentPlayer.SelectedCharacter, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}">
                                <b:ChangePropertyAction TargetName="Tabs" PropertyName="SelectedIndex" Value="{StaticResource InitialTab}"/>
                            </b:PropertyChangedTrigger>
                        </b:Interaction.Triggers>

                        <b:Interaction.Behaviors>
                            <ls:AutoScrollBehavior ScrollIntoView="{Binding SelectedIndex, ElementName=Tabs}" BringSelectionIntoView="True"/>
                        </b:Interaction.Behaviors>

                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem"  BasedOn="{StaticResource {x:Type ListBoxItem}}">
                                <Setter Property="IsEnabled" Value="{Binding IsSelected, RelativeSource={RelativeSource Mode=Self}, Converter={StaticResource InvertBoolConverter}}"/>
                            </Style>
                        </ListBox.ItemContainerStyle>
                        
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>

                        <ListBox.ItemTemplate>
                            <DataTemplate DataType="{x:Type ls:VMSpellBook}">
                                <Border x:Name="TabRoot" Background="Transparent">
                                    <ls:LSNineSliceImage x:Name="Container" ImageSource="{StaticResource Tab_d}" Slices="66,36,66, 52" IconWidth="16" Padding="66,10,66,0" Height="88" MinWidth="156">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                                            <TextBlock x:Name="Label" 
                                                                   Text="{Binding Source='h2d773583g5f0dg4737g93d5g324f4bcfe2ac', Converter={StaticResource TranslatedStringConverter}}"                                                            
                                                                   HorizontalAlignment="Center" 
                                                                   Foreground="{StaticResource LS_accent100TxtColor}"
                                                                   FontSize="{DynamicResource ScaledMediumFontSize}"/>

                                            <TextBlock x:Name="PreparableSpellsCount" Margin="8,0,0,0" 
                                                                   Foreground="{StaticResource LS_accent100TxtColor}"
                                                                   FontSize="{DynamicResource ScaledMediumFontSize}"
                                                                   Visibility="{Binding PreparedSpellsStat.Max, Converter={StaticResource CountToVisibilityConverter}}">
                                                <TextBlock.Text>
                                                    <MultiBinding StringFormat="{}({0}/{1})">
                                                        <Binding Path="PreparedSpellsStat.Value"/>
                                                        <Binding Path="PreparedSpellsStat.Max"/>
                                                    </MultiBinding>
                                                </TextBlock.Text>
                                            </TextBlock>
                                        </StackPanel>

                                        <b:Interaction.Triggers>
                                            <b:EventTrigger EventName="MouseLeftButtonUp">
                                                <ls:LSPlaySound Sound="UI_Shared_Click"/>
                                            </b:EventTrigger>
                                            <b:EventTrigger EventName="MouseLeftButtonUp">
                                                <b:Interaction.Behaviors>
                                                    <b:ConditionBehavior>
                                                        <b:ConditionalExpression>
                                                            <b:ComparisonCondition LeftOperand="{Binding SpellBookType}" Operator="NotEqual" RightOperand="TadPole"/>
                                                        </b:ConditionalExpression>
                                                    </b:ConditionBehavior>
                                                </b:Interaction.Behaviors>
                                                <b:InvokeCommandAction Command="{Binding DataContext.CustomEvent, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="ToggleSpells"/>
                                            </b:EventTrigger>
                                            <b:EventTrigger EventName="MouseLeftButtonUp">
                                                <b:Interaction.Behaviors>
                                                    <b:ConditionBehavior>
                                                        <b:ConditionalExpression>
                                                            <b:ComparisonCondition LeftOperand="{Binding SpellBookType}" Operator="Equal" RightOperand="TadPole"/>
                                                        </b:ConditionalExpression>
                                                    </b:ConditionBehavior>
                                                </b:Interaction.Behaviors>
                                                <b:InvokeCommandAction Command="{Binding DataContext.CustomEvent, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="ToggleInterrupts"/>
                                            </b:EventTrigger>
                                            <b:EventTrigger EventName="MouseLeftButtonDown">
                                                <ls:LSPlaySound Sound="UI_Shared_Press"/>
                                            </b:EventTrigger>
                                            <b:EventTrigger EventName="MouseEnter">
                                                <ls:LSPlaySound Sound="UI_Shared_Hover"/>
                                            </b:EventTrigger>

                                            <!-- Non-selected states -->
                                            <b:EventTrigger EventName="MouseLeftButtonUp">
                                                <b:Interaction.Behaviors>
                                                    <b:ConditionBehavior>
                                                        <b:ConditionalExpression>
                                                            <b:ComparisonCondition LeftOperand="{Binding IsSelected, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}}}" Operator="Equal" RightOperand="False"/>
                                                        </b:ConditionalExpression>
                                                    </b:ConditionBehavior>
                                                </b:Interaction.Behaviors>
                                                <b:ChangePropertyAction TargetName="Container" PropertyName="ImageSource" Value="{StaticResource Tab_h}"/>
                                            </b:EventTrigger>

                                            <b:EventTrigger EventName="MouseLeftButtonDown">
                                                <b:Interaction.Behaviors>
                                                    <b:ConditionBehavior>
                                                        <b:ConditionalExpression>
                                                            <b:ComparisonCondition LeftOperand="{Binding IsSelected, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}}}" Operator="Equal" RightOperand="False"/>
                                                        </b:ConditionalExpression>
                                                    </b:ConditionBehavior>
                                                </b:Interaction.Behaviors>
                                                <b:ChangePropertyAction TargetName="Container" PropertyName="ImageSource" Value="{StaticResource Tab_p}"/>
                                            </b:EventTrigger>

                                            <b:EventTrigger EventName="MouseEnter">
                                                <b:Interaction.Behaviors>
                                                    <b:ConditionBehavior>
                                                        <b:ConditionalExpression>
                                                            <b:ComparisonCondition LeftOperand="{Binding IsSelected, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}}}" Operator="Equal" RightOperand="False"/>
                                                        </b:ConditionalExpression>
                                                    </b:ConditionBehavior>
                                                </b:Interaction.Behaviors>
                                                <b:ChangePropertyAction TargetName="Container" PropertyName="ImageSource" Value="{StaticResource Tab_h}"/>
                                            </b:EventTrigger>

                                            <b:EventTrigger EventName="MouseLeave">
                                                <b:Interaction.Behaviors>
                                                    <b:ConditionBehavior>
                                                        <b:ConditionalExpression>
                                                            <b:ComparisonCondition LeftOperand="{Binding IsSelected, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}}}" Operator="Equal" RightOperand="False"/>
                                                        </b:ConditionalExpression>
                                                    </b:ConditionBehavior>
                                                </b:Interaction.Behaviors>
                                                <b:ChangePropertyAction TargetName="Container" PropertyName="ImageSource" Value="{StaticResource Tab_d}"/>
                                            </b:EventTrigger>

                                            <!-- Selected states -->
                                            <b:EventTrigger EventName="MouseLeftButtonUp">
                                                <b:Interaction.Behaviors>
                                                    <b:ConditionBehavior>
                                                        <b:ConditionalExpression>
                                                            <b:ComparisonCondition LeftOperand="{Binding IsSelected, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}}}" Operator="Equal" RightOperand="True"/>
                                                        </b:ConditionalExpression>
                                                    </b:ConditionBehavior>
                                                </b:Interaction.Behaviors>
                                                <b:ChangePropertyAction TargetName="Container" PropertyName="ImageSource" Value="{StaticResource TabSelected_h}"/>
                                            </b:EventTrigger>

                                            <b:EventTrigger EventName="MouseLeftButtonDown">
                                                <b:Interaction.Behaviors>
                                                    <b:ConditionBehavior>
                                                        <b:ConditionalExpression>
                                                            <b:ComparisonCondition LeftOperand="{Binding IsSelected, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}}}" Operator="Equal" RightOperand="True"/>
                                                        </b:ConditionalExpression>
                                                    </b:ConditionBehavior>
                                                </b:Interaction.Behaviors>
                                                <b:ChangePropertyAction TargetName="Container" PropertyName="ImageSource" Value="{StaticResource TabSelected_p}"/>
                                            </b:EventTrigger>

                                            <b:EventTrigger EventName="MouseEnter">
                                                <b:Interaction.Behaviors>
                                                    <b:ConditionBehavior>
                                                        <b:ConditionalExpression>
                                                            <b:ComparisonCondition LeftOperand="{Binding IsSelected, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}}}" Operator="Equal" RightOperand="True"/>
                                                        </b:ConditionalExpression>
                                                    </b:ConditionBehavior>
                                                </b:Interaction.Behaviors>
                                                <b:ChangePropertyAction TargetName="Container" PropertyName="ImageSource" Value="{StaticResource TabSelected_h}"/>
                                            </b:EventTrigger>

                                            <b:EventTrigger EventName="MouseLeave">
                                                <b:Interaction.Behaviors>
                                                    <b:ConditionBehavior>
                                                        <b:ConditionalExpression>
                                                            <b:ComparisonCondition LeftOperand="{Binding IsSelected, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}}}" Operator="Equal" RightOperand="True"/>
                                                        </b:ConditionalExpression>
                                                    </b:ConditionBehavior>
                                                </b:Interaction.Behaviors>
                                                <b:ChangePropertyAction TargetName="Container" PropertyName="ImageSource" Value="{StaticResource TabSelected_d}"/>
                                            </b:EventTrigger>

                                            <!-- State change -->
                                            <b:DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}}}" Value="True">
                                                <b:Interaction.Behaviors>
                                                    <b:ConditionBehavior>
                                                        <b:ConditionalExpression>
                                                            <b:ComparisonCondition LeftOperand="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}}}" Operator="Equal" RightOperand="True"/>
                                                        </b:ConditionalExpression>
                                                    </b:ConditionBehavior>
                                                </b:Interaction.Behaviors>
                                                <b:ChangePropertyAction TargetName="Container" PropertyName="ImageSource" Value="{StaticResource TabSelected_h}"/>
                                            </b:DataTrigger>

                                            <b:DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}}}" Value="True">
                                                <b:Interaction.Behaviors>
                                                    <b:ConditionBehavior>
                                                        <b:ConditionalExpression>
                                                            <b:ComparisonCondition LeftOperand="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}}}" Operator="Equal" RightOperand="False"/>
                                                        </b:ConditionalExpression>
                                                    </b:ConditionBehavior>
                                                </b:Interaction.Behaviors>
                                                <b:ChangePropertyAction TargetName="Container" PropertyName="ImageSource" Value="{StaticResource TabSelected_d}"/>
                                            </b:DataTrigger>

                                            <b:DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}}}" Value="False">
                                                <b:ChangePropertyAction TargetName="Container" PropertyName="ImageSource" Value="{StaticResource Tab_d}"/>
                                            </b:DataTrigger>
                                        </b:Interaction.Triggers>
                                    </ls:LSNineSliceImage>
                                </Border>

                                <DataTemplate.Triggers>
                                    <DataTrigger Binding="{Binding SpellBookType}" Value="Base">
                                        <Setter TargetName="Label" Property="Text" Value="{Binding Source=haf48b625gb2f0g449egb3aegfddfa1be81c2, Converter={StaticResource TranslatedStringConverter}}"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding SpellBookType}" Value="Tadpole">
                                        <!-- In KBM, tadpole info is part of the Base tab, so we're reusing this tab to act as the reactions' one, which doesn't exist -->
                                        <Setter TargetName="Label" Property="Text" Value="{Binding Source=h2fda2a98g24aeg4745ga96fg486c04590c4e, Converter={StaticResource TranslatedStringConverter}}"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding SpellBookType}" Value="Class">
                                        <Setter TargetName="Label" Property="Text" Value="{Binding Class.ClassDisplayName}"/>
                                    </DataTrigger>
                                </DataTemplate.Triggers>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <ls:LSButton x:Name="NavigationRightButton" Template="{StaticResource IconButtonTemplate}" VerticalAlignment="Center" RenderTransformOrigin="0.5, 0.5"
                                             Visibility="{Binding SpellBooks.Count, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter='5'}"
                                             SoundID="UI_Shared_Panel_Select">
                        <ls:LSButton.Resources>
                            <BitmapImage x:Key="ButtonNormal" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CC/btn_roundSmall_d.png"/>
                            <BitmapImage x:Key="ButtonHighlight" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CC/btn_roundSmall_h.png"/>
                            <BitmapImage x:Key="ButtonPressed" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CC/btn_roundSmall_d.png"/>
                            <BitmapImage x:Key="ButtonDisabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CC/btn_roundSmall_d.png"/>
                            <BitmapImage x:Key="IconNormal" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_browseSmall_d.png"/>
                            <BitmapImage x:Key="IconHighlight" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_browseSmall_h.png"/>
                            <BitmapImage x:Key="IconPressed" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_browseSmall_h.png"/>
                            <BitmapImage x:Key="IconDisabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_browseSmall_d.png"/>
                        </ls:LSButton.Resources>

                        <ls:LSButton.RenderTransform>
                            <ScaleTransform ScaleX="-1"/>
                        </ls:LSButton.RenderTransform>

                        <b:Interaction.Triggers>
                            <b:EventTrigger EventName="LSButtonPressed">
                                <b:ChangePropertyAction TargetName="Tabs" PropertyName="SelectedIndex" Value="{Binding SelectedIndex, ElementName=Tabs, Converter={StaticResource AddConverter}, ConverterParameter=1}"/>
                            </b:EventTrigger>
                            <b:EventTrigger EventName="MouseEnter">
                                <ls:LSPlaySound Sound="UI_Shared_Hover"/>
                            </b:EventTrigger>
                        </b:Interaction.Triggers>
                    </ls:LSButton>
                </StackPanel>

                <!-- Reactions --> 
                <!-- MOD_ACS: Add Margin -->
                <Control Grid.Row="1" x:Name="Reactions" Margin="0,0,0,16" Template="{StaticResource InterruptPanelTemplate}" Visibility="Collapsed" IsEnabled="{Binding DataContext.CurrentPlayer.UIData.AllowInteraction, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>

                <!-- Panel -->
                <!-- MOD_ACS: Update Margin / Remove MaxHeight / Add Align // BG3: Margin="0,10,0,0" MaxHeight="1290" -->
                <Grid Grid.Row="1" x:Name="ClassPanel" Margin="0,16,0,0" HorizontalAlignment="Center">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition x:Name="ClassPanelLeftColumn" Width="*"/>
                        <ColumnDefinition x:Name="ClassPanelCentralColumn" Width="1124"/>
                        <ColumnDefinition x:Name="ClassPanelRightColumn" Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Class image and info -->
                    <!-- MOD_ACS: Update margin // BG3: Margin="0,20,0,0" -->
                    <Grid x:Name="InfoPanel" Grid.Column="0" VerticalAlignment="Stretch" HorizontalAlignment="Right" Margin="26,20,0,0">

                        <Image HorizontalAlignment="Center" VerticalAlignment="Top" Stretch="None" Source="{StaticResource MainIconBg}"/>

                        <!-- MOD_ACS: Update margin // BG3: Margin="0,-34,0,0" -->
                        <Image x:Name="PageIcon" HorizontalAlignment="Center" VerticalAlignment="Top" Stretch="Uniform" Width="{StaticResource PageIconSize}" Visibility="Collapsed" Margin="0,-36,0,0"/>

                        <!-- MOD_ACS: Update margin // BG3: Margin="-100,-24,-100,0" -->
                        <Rectangle x:Name="RaceIcon" HorizontalAlignment="Center" VerticalAlignment="Top" Fill="{StaticResource LS_tint100}" DataContext="{Binding Stats.Race}" Style="{DynamicResource RaceIconStyle}" Width="{StaticResource PageIconSize}" Height="{StaticResource PageIconSize}" Stretch="Uniform" Visibility="Collapsed" Margin="2,-34,-2,0"/>

                        <!-- MOD_ACS: Add Visibility="Collapsed" to hide LevelText to create a 2 rows one instead -->
                        <TextBlock x:Name="LevelText" HorizontalAlignment="Center" VerticalAlignment="Top" Margin="8,170,0,0" Visibility="Collapsed">
                            <TextBlock.Text>
                                <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                    <Binding Source="h5df00b79ga6acg4d9fgb8dag23340151fba7"/>
                                    <Binding Path="SelectedItem.Class.Level.Value" ElementName="Tabs"/>
                                    <Binding Source=""/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                        
                        <!-- MOD_ACS: Add 2 rows LevelText -->
                        <TextBlock x:Name="LevelText1" HorizontalAlignment="Center" VerticalAlignment="Top" Margin="4,144,0,0" Text="{Binding Source=h8e782babg516fg4d7cgbd57g335de64c94a3, Converter={StaticResource TranslatedStringConverter}}"/>
                        <TextBlock x:Name="LevelText2" HorizontalAlignment="Center" VerticalAlignment="Top" Margin="4,178,0,0" Text="{Binding SelectedItem.Class.Level.Value, ElementName=Tabs}"/>
                    </Grid>

                    <!-- Class panel -->
                    <Grid x:Name="ClassPanelContent" Grid.Column="1" VerticalAlignment="Top">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- MOD_ACS: TopBar definition-->
                        <!-- Top bar -->
                        <Grid x:Name="TopBar" Grid.Row="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <Grid.RowDefinitions>
                                <RowDefinition Height="{StaticResource TopBarHeightGridLength}"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Level -->
                            <!-- MOD_ACS: Update default visibility // BG3: Visibility="Collapsed" -->
                            <ContentControl x:Name="BarLevelContainer" Grid.Column="0" Grid.Row="0" Style="{StaticResource CastInfoControlStyle}"
                                            Visibility="Visible">
                                <TextBlock x:Name="BarLevelText" HorizontalAlignment="Center" VerticalAlignment="Center" Text="{Binding Text, ElementName=LevelText}"/>
                            </ContentControl>

                            <!-- Subclass/Subrace -->
                            <ContentControl x:Name="SubClassContainer" Grid.Column="1" Grid.Row="0" Style="{StaticResource CastInfoControlStyle}"
                                                            Visibility="{Binding Text, ElementName=SubClassName, Converter={StaticResource NullToCollapsedConverter}, ConverterParameter='EmptyString'}">
                                <TextBlock x:Name="SubClassName" Text="{Binding SelectedItem.Class.SubclassDisplayName, ElementName=Tabs}" 
                                                           HorizontalAlignment="Center"/>
                            </ContentControl>

                            <!-- Class Resources -->
                            <ContentControl x:Name="ClassResourcesContainer" Grid.Column="2" Grid.Row="0" Style="{StaticResource CastInfoControlStyle}"
                                                            Visibility="{Binding ItemsSource.Count, ElementName=ClassResources, Converter={StaticResource CountToVisibilityConverter}}">

                                <ItemsControl x:Name="ClassResources" ItemsSource="{Binding SelectedItem.ActionResources, ElementName=Tabs}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Horizontal"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>

                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate DataType="{x:Type ls:VMActionResource}">
                                            <StackPanel Orientation="Horizontal" ToolTip="{StaticResource ManagedTooltip}">
                                                <Image Stretch="Uniform" Style="{StaticResource SectionImageStyle}" VerticalAlignment="Center" Margin="0" MaxHeight="40"/>
                                                <TextBlock VerticalAlignment="Center" ls:TextBlockFormatter.SourceText="{Binding MaxValue, StringFormat='{}{0} '}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ContentControl>

                            <!-- Caster stuff -->
                            <ContentControl x:Name="CastAbilityContainer" Grid.Column="3" Grid.Row="0" Style="{StaticResource CastInfoControlStyle}" Visibility="{Binding DataContext, ElementName=CastAbility, Converter={StaticResource NullToCollapsedConverter}}">
                                <StackPanel Orientation="Horizontal">
                                    <StackPanel.ToolTip>
                                        <ls:LSTooltip>
                                            <StackPanel>
                                                <TextBlock ls:TextBlockFormatter.SourceText="{Binding Source=h3289692bg0388g4f68gad45g82b8fd0ffbf8, Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource TooltipTitleStyle}"/>
                                                <TextBlock ls:TextBlockFormatter.SourceText="{Binding Source=h91535f32g4f47g4d5bgbf59ge05726ecb96e, Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource TooltipDefaultTextStyle}"/>
                                            </StackPanel>
                                        </ls:LSTooltip>
                                    </StackPanel.ToolTip>
                                    <Image x:Name="CastAbilityIcon" Source="{StaticResource ProficientIcon}" Stretch="None" VerticalAlignment="Center" Margin="-12,0,0,0"/>
                                    <Control x:Name="CastAbility" Template="{StaticResource AbilityShortDisplayName}" DataContext="{Binding SelectedItem.Class.SpellCastAbility, ElementName=Tabs}" VerticalAlignment="Center" Foreground="{StaticResource LS_tint100}" />
                                </StackPanel>
                            </ContentControl>

                            <ContentControl x:Name="SpellDCContainer" Grid.Column="4" Grid.Row="0" Style="{StaticResource CastInfoControlStyle}"
                                                            Visibility="{Binding Text, ElementName=SpellDC, Converter={StaticResource NullToCollapsedConverter}, ConverterParameter='EmptyString'}">
                                <ContentControl.ToolTip>
                                    <ls:LSTooltip Content="{Binding Path=SelectedItem.Class.SpellDifficultyCheck, ElementName=Tabs}"/>
                                </ContentControl.ToolTip>
                                <StackPanel Orientation="Horizontal">
                                    <Image x:Name="SpellDCIcon" 
                                                           Source="{StaticResource CastSavingIcon}" 
                                                           Stretch="None" 
                                                           VerticalAlignment="Center" 
                                                           Margin="-8,0,0,0"/>
                                    <TextBlock x:Name="SpellDC" 
                                                               Text="{Binding SelectedItem.Class.SpellDifficultyCheck.Value, ElementName=Tabs}" 
                                                               VerticalAlignment="Center"/>
                                </StackPanel>
                            </ContentControl>

                            <ContentControl x:Name="SpellAttackContainer" Grid.Column="5" Grid.Row="0" Style="{StaticResource CastInfoControlStyle}"
                                                            Visibility="{Binding Text, ElementName=SpellAttackBonus, Converter={StaticResource NullToCollapsedConverter}, ConverterParameter='EmptyString'}">
                                <ContentControl.ToolTip>
                                    <ls:LSTooltip Content="{Binding Path=(ls:TooltipExtender.Owner).Stats.SpellAttackBonus, RelativeSource={RelativeSource Mode=Self}}"/>
                                </ContentControl.ToolTip>
                                <StackPanel Orientation="Horizontal">
                                    <Image x:Name="SpellAttackIcon"
                                                           Source="{StaticResource CastRollIcon}" 
                                                           Stretch="None" 
                                                           VerticalAlignment="Center" 
                                                           Margin="-10,0,0,0"/>
                                    <TextBlock x:Name="SpellAttackBonus" 
                                                               Text="{Binding SelectedItem.Class.SpellAttackBonus.Value, ElementName=Tabs, StringFormat={}{0:+#;-#;0}}" 
                                                               VerticalAlignment="Center"/>
                                </StackPanel>
                            </ContentControl>

                            <!-- Search bar -->
                            <ls:FilteringContainer x:Name="FilteringContainerHolder" Grid.Column="0" Grid.ColumnSpan="6" Grid.Row="0" VerticalAlignment="Center" HorizontalAlignment="Stretch" 
                                                                   FilterPredicate="{Binding DataContext.Data.SpellBookPredicate, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" 
                                                                   Template="{StaticResource SpellSearchBarTemplate}" 
                                                                   ItemsList="{Binding SelectedItem.UngroupedSpellsAndActions, ElementName=Tabs}" 
                                                                   DefaultViewItemsList="{Binding SelectedItem.UngroupedSpellsAndActions, ElementName=Tabs}" 
                                                                   MaxDisplayedFilters="6" 
                                                                   Visibility="{Binding Path=IsChecked, ElementName=SearchToggle, Converter={StaticResource BoolToVisibleConverter}}">
                                <b:Interaction.Behaviors>
                                    <ls:CollectionFilterBehavior x:Name="ResultSpellsFilter" ItemsSource="{Binding Path=GeneratedItemsList, ElementName=FilteringContainerHolder}" Predicate="{Binding DataContext.Data.CharacterActionSpellsPredicate, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                                    <ls:CollectionFilterBehavior x:Name="ResultNoSpellsFilter" ItemsSource="{Binding Path=GeneratedItemsList, ElementName=FilteringContainerHolder}" Predicate="{Binding DataContext.Data.CharacterActionNoSpellsPredicate, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                                </b:Interaction.Behaviors>

                                <ls:FilteringContainer.EnumFiltersList>
                                    <ls:EnumFilterItem EnumId="ESpellSchool" Label="hec34e9b7g5b4ag4d58gb8f2gd1601a3f5b8b" AlwaysVisible="False" StartIndex="1" EndIndex="8"/>
                                    <ls:EnumFilterItem EnumId="EDamageType" Label="hc3cd9b4eg4ea4g4438gbfbbg493c0abb6dd7" AlwaysVisible="False" StartIndex="1" EndIndex="13"/>
                                </ls:FilteringContainer.EnumFiltersList>
                            </ls:FilteringContainer>

                            <!-- Search inner button -->
                            <!-- MOD_ACS: Move button search inside search bar // BG3: Grid.Column="6" HorizontalAlignment="Left" -->
                            <ls:LSToggleButton x:Name="InnerSearchToggle" Grid.Column="5" Grid.Row="0"
                                                   VerticalAlignment="Center" HorizontalAlignment="Right"
                                                   Template="{StaticResource ToggleIconButtonTemplate}" 
                                                   IsChecked="False" 
                                                   Command="ls:FilteringContainer.ClearFilterCommand" CommandTarget="{Binding ElementName=FilteringContainerHolder}"
                                                   Height="{StaticResource TopBarHeight}"
                                                   Visibility="Collapsed">
                                <ls:LSToggleButton.Resources>
                                    <ImageSource x:Key="ButtonUncheckedNormal">pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterSheet/btn_round_medium_d.png</ImageSource>
                                    <ImageSource x:Key="ButtonUncheckedHighlight">pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterSheet/btn_round_medium_h.png</ImageSource>
                                    <ImageSource x:Key="ButtonUncheckedPressed">pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterSheet/btn_round_medium_p.png</ImageSource>
                                    <ImageSource x:Key="ButtonUncheckedDisabled">pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterSheet/btn_round_medium_disabled.png</ImageSource>
                                    <ImageSource x:Key="ButtonCheckedNormal">pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterSheet/btn_round_medium_d.png</ImageSource>
                                    <ImageSource x:Key="ButtonCheckedHighlight">pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterSheet/btn_round_medium_h.png</ImageSource>
                                    <ImageSource x:Key="ButtonCheckedPressed">pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterSheet/btn_round_medium_p.png</ImageSource>
                                    <ImageSource x:Key="ButtonCheckedDisabled">pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterSheet/btn_round_medium_disabled.png</ImageSource>
                                    <ImageSource x:Key="IconUncheckedNormal">pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_magnifier_d.png</ImageSource>
                                    <ImageSource x:Key="IconUncheckedHighlight">pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_magnifier_h.png</ImageSource>
                                    <ImageSource x:Key="IconUncheckedPressed">pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_magnifier_h.png</ImageSource>
                                    <ImageSource x:Key="IconUncheckedDisabled">pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_magnifier_d.png</ImageSource>
                                    <ImageSource x:Key="IconCheckedNormal">pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_cancel.png</ImageSource>
                                    <ImageSource x:Key="IconCheckedHighlight">pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_cancel_h.png</ImageSource>
                                    <ImageSource x:Key="IconCheckedPressed">pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_cancel_h.png</ImageSource>
                                    <ImageSource x:Key="IconCheckedDisabled">pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_cancel.png</ImageSource>
                                    <System:Double x:Key="IconWidth">36</System:Double>
                                    <System:Double x:Key="IconHeight">36</System:Double>
                                </ls:LSToggleButton.Resources>
                            </ls:LSToggleButton>
                        </Grid>

                        <!-- Class panel content -->
                        <!-- MOD_ACS: Update ScrollBar position // BG3: Margin="50,0,-50,0" Padding="-50,0,50,0"  -->
                        <ScrollViewer x:Name="WholePanelScrollViewer" Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="20,0,-20,10" Padding="-20,0,20,-10">
                            
                            <!-- MOD_ACS: Margin must be changed in ScrollableContent instead to be correct in both scrollers -->
                            <Grid x:Name="WholePanelScrollViewerRoot">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <!-- MOD_ACS: Add Margin -->
                                <StackPanel x:Name="ClassPanelFixedContent" Grid.Row="0" VerticalAlignment="Top" Margin="0,10,0,0">
                                    <!-- Class section -->
                                    <!-- MOD_ACS: Rework ClassSection with dynamic bg -->
                                    <!-- MOD_ACS: Add Grid + Rectangle (bg) -->
                                    <Grid x:Name="ClassSectionGrid">
                                        <Rectangle x:Name="ClassSectionDecorativeStroke" Margin="16,0,17,-7" Width="Binding Width, ElementName=ClassSectionGrid" Height="Binding Height, ElementName=ClassSectionGrid" Visibility="{Binding Visibility, ElementName=ClassSection}"
                                            StrokeDashArray="5,3" StrokeThickness="2" Stroke="{StaticResource LS_PanelBorder}" RadiusX="{StaticResource CornerRadius}" RadiusY="{StaticResource CornerRadius}" Fill="{StaticResource ContentBGShade}"/>   
                             
                                        <!-- MOD_ACS: Add Collapse visibility ClassSectionOpening -->
                                        <Image x:Name="ClassSectionOpening" Source="{StaticResource ClassBorder}" Stretch="None" Margin="0,6,0,0" Visibility="Collapsed"/>
                                            
                                        <!-- MOD_ACS: Update Margin -->
                                        <StackPanel x:Name="ClassSection" Margin="5,20,5,10" Width="{Binding Fill.Viewbox.Width, RelativeSource={RelativeSource Self}}">                                      
                                            
                                            <!-- Cantrips and actions -->
                                            <Grid x:Name="CantripsAndActions" Margin="0,-22,0,0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>

                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                </Grid.RowDefinitions>

                                                <!-- Cantrips -->
                                                <ItemsControl x:Name="CantripList" Grid.Column="0" Grid.ColumnSpan="2" Grid.Row="0" VerticalAlignment="Top" HorizontalAlignment="Stretch" 
                                                            ItemsSource="{Binding FilteredItems, ElementName=CantripGroupFilter}" 
                                                            Visibility="{Binding Path=ItemsSource.Count, RelativeSource={RelativeSource Self}, Converter={StaticResource CountToVisibilityConverter}}" 
                                                            ls:AttachedProperties.InheritedTag="HideFeats"/>

                                                <!-- Class Actions -->
                                                <ItemsControl x:Name="ClassActionsList" Grid.Column="0" Grid.ColumnSpan="2" Grid.Row="1" HorizontalAlignment="Stretch" 
                                                            ItemsSource="{Binding FilteredItems, ElementName=ClassActionGroupFilter}" 
                                                            Visibility="{Binding Path=ItemsSource.Count, RelativeSource={RelativeSource Self}, Converter={StaticResource CountToVisibilityConverter}}"/>
                                            </Grid>

                                            <!-- Tadpole Actions -->
                                            <ItemsControl x:Name="TadpoleActionsList" VerticalAlignment="Top" HorizontalAlignment="Stretch"
                                                            ItemsSource="{Binding FilteredItems, ElementName=TadpoleActionsFilter}" 
                                                            Visibility="Collapsed"
                                                            ls:AttachedProperties.InheritedTag="TadpoleActions"/>

                                            <!-- Metamagic -->
                                            <ItemsControl x:Name="MetamagicList" VerticalAlignment="Top" HorizontalAlignment="Stretch"
                                                            Style="{StaticResource PassiveCellItemsControlStyle}"
                                                            ItemsSource="{Binding FilteredItems, ElementName=MetaMagicFilter}" 
                                                            ls:AttachedProperties.InheritedTag="MetaMagic" 
                                                            Visibility="{Binding Path=ItemsSource.Count, RelativeSource={RelativeSource Self}, Converter={StaticResource CountToVisibilityConverter}}"/>

                                            <!-- Spells -->
                                            <!-- MOD_ACS: Add margin -->
                                            <Grid x:Name="SpellsTitle" Visibility="Collapsed" HorizontalAlignment="Stretch" Margin="0,0,0,0">
                                                
                                                <!-- MOD_ACS: Add x:Name / Update margin // BG3 Margin="120,22,0,0" -->
                                                <TextBlock x:Name="SpellsTitleText" ls:TextBlockFormatter.SourceText="{Binding Source='h062f5cf9gb2e5g4c0dgadc9g68898c250650',Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource ActionGroupTitleStyle}" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="120,10,0,0"/>

                                                <!-- MOD_ACS: Update LearnSpellsButton - Moved to SpellbookActionGroup// BG3: HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,26,0" MinWidth="150" -->
                                                <ls:LSButton x:Name="LearnSpellsButton" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Collapsed" Margin="-1,10,1,-12" Command="{Binding DataContext.OpenLearnSpellsCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" MinWidth="150">
                                                    <ls:LSButton.Template>
                                                        <ControlTemplate TargetType="ls:LSButton">
                                                            <ControlTemplate.Resources>
                                                                <BitmapImage x:Key="Icon_d" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_learnSpells_d.png" />
                                                                <BitmapImage x:Key="Icon_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_learnSpells_h.png" />
                                                                <BitmapImage x:Key="Icon_p" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_learnSpells_p.png" />
                                                                <BitmapImage x:Key="Icon_disabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_learnSpells_disabled.png" />
                                                            </ControlTemplate.Resources>

                                                            <ls:LSNineSliceImage x:Name="SearchBarContainer" ImageSource="{StaticResource SearchBarBg_d}" Slices="36,34" Padding="20,10" Height="72">
                                                                <Image x:Name="Icon" Source="{StaticResource Icon_d}" Stretch="None" VerticalAlignment="Center"/>
                                                            </ls:LSNineSliceImage>

                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter TargetName="SearchBarContainer" Property="ImageSource" Value="{StaticResource SearchBarBg_h}"/>
                                                                    <Setter TargetName="Icon" Property="Source" Value="{StaticResource Icon_h}"/>
                                                                </Trigger>
                                                                <Trigger Property="IsPressed" Value="True">
                                                                    <Setter TargetName="SearchBarContainer" Property="ImageSource" Value="{StaticResource SearchBarBg_h}"/>
                                                                    <Setter TargetName="Icon" Property="Source" Value="{StaticResource Icon_p}"/>
                                                                    <Setter TargetName="Icon" Property="Margin" Value="0,4,0,-4"/>
                                                                </Trigger>
                                                                <Trigger Property="IsEnabled" Value="False">
                                                                    <Setter TargetName="SearchBarContainer" Property="ImageSource" Value="{StaticResource SearchBarBg_d}"/>
                                                                    <Setter TargetName="Icon" Property="Source" Value="{StaticResource Icon_disabled}"/>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </ls:LSButton.Template>
                                                    <ls:LSButton.CommandParameter>
                                                        <MultiBinding Converter="{StaticResource PassThroughConverter}">
                                                            <Binding Path="DataContext" ElementName="ClassPanelRoot"/>
                                                            <Binding ElementName="ClassPanelRoot"/>
                                                            <Binding Path="ActualWidth" ElementName="ClassPanelRoot" Converter="{StaticResource MultiplierConverter}" ConverterParameter="0.8"/>
                                                        </MultiBinding>
                                                    </ls:LSButton.CommandParameter>
                                                    <ls:LSButton.ToolTip>
                                                        <ls:LSTooltip DataContext="{Binding Path=DataContext, RelativeSource={RelativeSource TemplatedParent}}">
                                                            <ls:LSTooltip.ContentTemplate>
                                                                <DataTemplate>
                                                                    <StackPanel Orientation="Vertical" MaxWidth="{StaticResource MaxTooltipContentWidth}">
                                                                        <StackPanel.Resources>
                                                                            <Style TargetType="TextBlock">
                                                                                <Setter Property="TextWrapping" Value="Wrap"/>
                                                                                <Setter Property="FontSize" Value="{DynamicResource ScaledMediumFontSize}"/>
                                                                                <Setter Property="Foreground" Value="{StaticResource LS_baseTxtColor}"/>
                                                                            </Style>
                                                                        </StackPanel.Resources>

                                                                        <TextBlock ls:TextBlockFormatter.SourceText="{Binding Source='h9784a948g9d80g41d8gbb18ga9c838b90edd',Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource TooltipTitleStyle}"/>

                                                                        <TextBlock ls:TextBlockFormatter.SourceText="{Binding Source='h1be7e965gcf8dg4a81gb85dga1fbc01a9f08',Converter={StaticResource TranslatedStringConverter}}"/>
                                                                    </StackPanel>
                                                                </DataTemplate>
                                                            </ls:LSTooltip.ContentTemplate>
                                                        </ls:LSTooltip>
                                                    </ls:LSButton.ToolTip>
                                                </ls:LSButton>
                                            </Grid>

                                            <ItemsControl x:Name="AlwaysPreparedList" VerticalAlignment="Top" HorizontalAlignment="Stretch"
                                                            Style="{StaticResource ActionCellItemsControlStyle}"
                                                            ItemsSource="{Binding FilteredItems, ElementName=NonNullAlwaysPreparedSpellsFilter}"
                                                            Visibility="{Binding Path=ItemsSource.Count, RelativeSource={RelativeSource Self}, Converter={StaticResource CountToVisibilityConverter}}"
                                                            ls:AttachedProperties.InheritedTag="AlwaysPrepared" />

                                            <ItemsControl x:Name="NonPreparableSpellsCategories" VerticalAlignment="Top" HorizontalAlignment="Stretch"
                                                                    ItemsSource="{Binding FilteredItems, ElementName=SpellLevelsGroupFilter}" 
                                                                    AlternationCount="{Binding ItemsSource.Count, RelativeSource={RelativeSource Self}}"
                                                                    ls:AttachedProperties.InheritedTag="HideFeats"
                                                                    Visibility="Collapsed"/>

                                            <!-- MOD_ACS: Add text center & wrap / Update margin // BG3: Margin="0,-10,0,0 -->
                                            <TextBlock x:Name="NonPreparableReplaceableSpellsNote" Style="{StaticResource ActionGroupTitleStyle}" HorizontalAlignment="Center" Visibility="Collapsed" FontStyle="Italic" TextAlignment="Center" TextWrapping="Wrap" Margin="100,4,100,4" />
                                        </StackPanel>
                                        
                                        <!-- MOD_ACS: Update bottom section class unused decorator // BG3: Binding Visibility... -->
                                        <Rectangle x:Name="ClassSectionClosure" Fill="{StaticResource ClassBorderEdges}" RenderTransformOrigin="0.5, 0.5" Visibility="Collapsed" Margin="{Binding Margin, ElementName=ClassSectionOpening}"
                                                   Width="{Binding Fill.Viewbox.Width, RelativeSource={RelativeSource Self}}" Height="{Binding Fill.Viewbox.Height, RelativeSource={RelativeSource Self}}">
                                            <Rectangle.RenderTransform>
                                                <ScaleTransform ScaleY="-1"/>
                                            </Rectangle.RenderTransform>
                                        </Rectangle>
                                    </Grid>

                                    <!-- Prepared spells section -->
                                    <!-- MOD_ACS: Add switcher ToggleSpy to handle ClassSectionGrid Visibility btn -->
                                    <Border x:Name="ClassSectionGridToggleSpy" Visibility="Visible"/>
                                    <!-- MOD_ACS: Switch visibility binding to Collapsed / Update Strech & Margin / Add MaxWidth // BG3: Stretch="Fill" Visibility="{Binding Visibility, ElementName=PreparedSpellsSection}" Margin="0,6,0,0"-->
                                    <Image x:Name="PreparedSpellsSectionOpening" Source="{StaticResource PreparedSpellsTop}" MaxWidth="1112" Stretch="Fill" Visibility="Collapsed" Margin="0,4,0,0"/>

                                    <!-- MOD_ACS: Switch visibility binding to PreparedSpellsSectionOpening // BG3:  Visibility="Collapsed" Width="{Binding Source.Width, ElementName=PreparedSpellsSectionOpening}" -->
                                    <Border x:Name="PreparedSpellsSection" Visibility="{Binding Visibility, ElementName=PreparedSpellsSectionOpening}" Width="{Binding ActualWidth, ElementName=PreparedSpellsSectionOpening}">
                                        <Border.Background>
                                            <!-- MOD_ACS: Add visibility collapsed -->
                                            <ImageBrush ImageSource="{StaticResource PreparedSpellsCenter}" Stretch="Fill" TileMode="Tile" AlignmentY="Top" ViewportUnits="Absolute" Visibility="Collapsed">
                                                <ImageBrush.Viewport>
                                                    <MultiBinding Converter="{StaticResource CreateRectConverter}">
                                                        <Binding Source="0"/>
                                                        <Binding Source="0"/>
                                                        <!-- MOD_ACS: Update width to dynamic // BG3: Path="ImageSource.Width" RelativeSource="{RelativeSource Self}" -->
                                                        <Binding Path="ActualWidth" ElementName="PreparedSpellsSection"/>
                                                        <Binding Path="ImageSource.Height" RelativeSource="{RelativeSource Self}"/>
                                                    </MultiBinding>
                                                </ImageBrush.Viewport>
                                            </ImageBrush>
                                        </Border.Background>

                                        <!-- MOD_ACS: Add Margin -->
                                        <ItemsControl x:Name="ManuallyPreparedList" VerticalAlignment="Top" HorizontalAlignment="Stretch" 
                                                          Style="{StaticResource ActionCellItemsControlStyle}"
                                                          ItemsSource="{Binding SelectedItem.ManuallyPreparedActions, ElementName=Tabs}" 
                                                          ls:AttachedProperties.InheritedTag="Prepared"
                                                          ItemTemplate="{StaticResource PreparedSpellCellTemplate}"
                                                          Margin="-1,0,1,0"/>
                                    </Border>
                                    
                                    <!-- MOD_ACS: Add Smaller PreparedSpellsSection -->
                                    <Border x:Name="PreparedSpellsSectionSmall" Visibility="Collapsed" Width="{Binding ActualWidth, ElementName=PreparedSpellsSectionOpening}">
                                        <Border.Background>
                                            <ImageBrush ImageSource="{StaticResource PreparedSpellsCenter_Small_SquareLess}" Stretch="Fill" TileMode="Tile" AlignmentY="Top" ViewportUnits="Absolute" >
                                                <ImageBrush.Viewport>
                                                    <MultiBinding Converter="{StaticResource CreateRectConverter}">
                                                        <Binding Source="0"/>
                                                        <Binding Source="0"/>
                                                        <Binding Path="ActualWidth" ElementName="PreparedSpellsSectionSmall"/>
                                                        <Binding Path="ImageSource.Height" RelativeSource="{RelativeSource Self}"/>
                                                    </MultiBinding>
                                                </ImageBrush.Viewport>
                                            </ImageBrush>
                                        </Border.Background>
                                        
                                        <ItemsControl x:Name="ManuallyPreparedListSmall" VerticalAlignment="Top" HorizontalAlignment="Stretch" 
                                                          Style="{StaticResource ActionCellItemsControlStyle}"
                                                          ItemsSource="{Binding SelectedItem.ManuallyPreparedActions, ElementName=Tabs}" 
                                                          ls:AttachedProperties.InheritedTag="Prepared"
                                                          ItemTemplate="{StaticResource PreparedSpellCellTemplate}"
                                                          Margin="4,0,-4,0"/>
                                    </Border>

                                    <!-- MOD_ACS: Switch visibility binding to PreparedSpellsSectionOpening // BG3: Binding Visibility, ElementName=PreparedSpellsSection -->
                                    <Image x:Name="PreparedSpellsSectionClosure" Source="{StaticResource PreparedSpellsBottom}" Width="{Binding ActualWidth, ElementName=PreparedSpellsSectionOpening}" 
                                           Stretch="Fill" Visibility="{Binding Visibility, ElementName=PreparedSpellsSectionOpening}"/>
                                </StackPanel>

                                <!-- MOD_ACS: Footer ScrollBar // BG3: Margin="50,0,-50,0" Padding="-50,0,50,0" -->
                                <ls:LSScrollViewer x:Name="ClassPanelScrollableContent" Grid.Row="2" VerticalScrollBarVisibility="Auto" Margin="20,4,-20,10" Padding="-20,0,20,-11">
                                    <!-- MOD_ACS: Add margin between top bar and class panel & bottom for 2 scrolls -->
                                    <StackPanel x:Name="ScrollableContent" Margin="6,0,6,20">
                                        <!-- Known spells section -->
                                        <!-- MOD_ACS: Update padding // BG3: Padding="6,2,6,40" -->
                                        <ls:LSNineSliceImage x:Name="KnownSpellSection" ImageSource="{StaticResource SpellsBorder}" Slices="22,10,22,42" IconWidth="70" Padding="-1,4,0,40" Visibility="{Binding Path=ItemsSource.Count, ElementName=SpellsCategories, Converter={StaticResource CountToVisibilityConverter}}">
                                            <StackPanel>
                                                <TextBlock x:Name="InnerSpellsTitle" ls:TextBlockFormatter.SourceText="{Binding Source='h062f5cf9gb2e5g4c0dgadc9g68898c250650',Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource ActionGroupTitleStyle}" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="120,22,0,0" Visibility="Collapsed"/>

                                                <ItemsControl x:Name="SpellsCategories" VerticalAlignment="Top" HorizontalAlignment="Stretch"
                                                                      ItemsSource="{Binding FilteredItems, ElementName=NonAlwaysPreparedSpellLevelsGroupFilter}" 
                                                                      AlternationCount="{Binding ItemsSource.Count, RelativeSource={RelativeSource Self}}"
                                                                      ls:AttachedProperties.InheritedTag="HideFeatsAndAlwaysPrepared"/>

                                                <!-- Spells level up note -->
                                                <TextBlock x:Name="ReplaceableSpellsNote" ls:TextBlockFormatter.SourceText="{Binding Source=h6cbb2d29g46c1g4b0agb271gcb95f4e4b3f0, Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource ActionGroupTitleStyle}" HorizontalAlignment="Center" Visibility="Collapsed" FontStyle="Italic" Margin="0,-10,0,0"/>
                                            </StackPanel>
                                        </ls:LSNineSliceImage>

                                        <!-- Initiations -->
                                        <ItemsControl x:Name="InitiationsList" 
                                                              ItemsSource="{Binding Initiations}" 
                                                              Visibility="Collapsed"
                                                              AlternationCount="{Binding Path=ItemsSource.Count, RelativeSource={RelativeSource Self}}"
                                                              VerticalAlignment="Center" Margin="0,10,0,10">
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <WrapPanel Orientation="Horizontal"/>
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>

                                            <ItemsControl.ItemContainerStyle>
                                                <Style TargetType="ContentPresenter">
                                                    <Setter Property="Width" Value="{Binding ActualWidth, ElementName=ClassPanelContent, Converter={StaticResource MultiplierConverter}, ConverterParameter=0.5}"/>

                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding ParentState, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel">
                                                            <Setter Property="Width" Value="Auto"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </ItemsControl.ItemContainerStyle>

                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <StackPanel x:Name="InitiationRoot" Width="{Binding ActualWidth, ElementName=ClassPanelContent, Converter={StaticResource MultiplierConverter}, ConverterParameter=0.48}" HorizontalAlignment="Center">
                                                        <b:Interaction.Behaviors>
                                                            <ls:CollectionFilterBehavior x:Name="CantripGroupFilter" ItemsSource="{Binding ActionGroups}" Predicate="{Binding DataContext.CurrentPlayer.SelectedCharacter.CantripGroupPredicate, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                                                            <ls:CollectionFilterBehavior x:Name="SpellLevelsGroupFilter" ItemsSource="{Binding ActionGroups}" Predicate="{Binding DataContext.CurrentPlayer.SelectedCharacter.SpellLevelsGroupPredicate, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                                                        </b:Interaction.Behaviors>

                                                        <TextBlock Text="{Binding ClassName}" Margin="6,0,0,0" Foreground="{StaticResource LS_accent100TxtColor}"/>
                                                        <TextBlock Text="{Binding Source=h721ec81ag27c5g4744g8904g807a2248b782, Converter={StaticResource TranslatedStringConverter}}" FontSize="{DynamicResource ScaledSmallFontSize}" Margin="6,0,0,0" Foreground="{StaticResource LS_baseTxtColor}"/>

                                                        <Grid x:Name="InitiationCastInfo" Margin="0,10">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="*"/>
                                                            </Grid.ColumnDefinitions>

                                                            <ContentControl x:Name="CastAbilityContainer" Grid.Column="0" Style="{StaticResource CastInfoControlStyle}"
                                                            Visibility="{Binding DataContext, ElementName=CastAbility, Converter={StaticResource NullToCollapsedConverter}}">
                                                                <ContentControl.ToolTip>
                                                                    <ls:LSTooltip>
                                                                        <StackPanel>
                                                                            <TextBlock ls:TextBlockFormatter.SourceText="{Binding Source=h3289692bg0388g4f68gad45g82b8fd0ffbf8, Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource TooltipTitleStyle}"/>
                                                                            <TextBlock ls:TextBlockFormatter.SourceText="{Binding Source=h91535f32g4f47g4d5bgbf59ge05726ecb96e, Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource TooltipDefaultTextStyle}"/>
                                                                        </StackPanel>
                                                                    </ls:LSTooltip>
                                                                </ContentControl.ToolTip>
                                                                <StackPanel Orientation="Horizontal">
                                                                    <Image x:Name="CastAbilityIcon" 
                                                                                   Source="{StaticResource ProficientIcon}" 
                                                                                   Stretch="None" 
                                                                                   VerticalAlignment="Center" 
                                                                                   Margin="-12,0,0,0"/>
                                                                    <Control x:Name="CastAbility" Template="{StaticResource AbilityShortDisplayName}" DataContext="{Binding Stats.SpellCastAbility}" VerticalAlignment="Center" Foreground="{StaticResource LS_tint100}" />
                                                                </StackPanel>
                                                            </ContentControl>

                                                            <ContentControl x:Name="SpellDCContainer" Grid.Column="1" Style="{StaticResource CastInfoControlStyle}"
                                                            Visibility="{Binding Text, ElementName=SpellDC, Converter={StaticResource NullToCollapsedConverter}, ConverterParameter='EmptyString'}">
                                                                <ContentControl.ToolTip>
                                                                    <ls:LSTooltip Content="{Binding Path=(ls:TooltipExtender.Owner).Stats.SpellDifficultyCheck, RelativeSource={RelativeSource Mode=Self}}"/>
                                                                </ContentControl.ToolTip>
                                                                <StackPanel Orientation="Horizontal">
                                                                    <Image x:Name="SpellDCIcon" 
                                                                                   Source="{StaticResource CastSavingIcon}" 
                                                                                   Stretch="None" 
                                                                                   VerticalAlignment="Center" 
                                                                                   Margin="-8,0,0,0"/>
                                                                    <TextBlock x:Name="SpellDC" 
                                                                                       Text="{Binding SpellDifficultyCheck.Value}" 
                                                                                       VerticalAlignment="Center"/>
                                                                </StackPanel>
                                                            </ContentControl>

                                                            <ContentControl x:Name="SpellAttackContainer" Grid.Column="2" Style="{StaticResource CastInfoControlStyle}"
                                                            Visibility="{Binding Text, ElementName=SpellAttackBonus, Converter={StaticResource NullToCollapsedConverter}, ConverterParameter='EmptyString'}">
                                                                <ContentControl.ToolTip>
                                                                    <ls:LSTooltip Content="{Binding Path=(ls:TooltipExtender.Owner).Stats.SpellAttackBonus, RelativeSource={RelativeSource Mode=Self}}"/>
                                                                </ContentControl.ToolTip>
                                                                <StackPanel Orientation="Horizontal">
                                                                    <Image x:Name="SpellAttackIcon"
                                                                                   Source="{StaticResource CastRollIcon}" 
                                                                                   Stretch="None" 
                                                                                   VerticalAlignment="Center" 
                                                                                   Margin="-10,0,0,0"/>
                                                                    <TextBlock x:Name="SpellAttackBonus" 
                                                                                       Text="{Binding SpellAttackBonus.Value, StringFormat={}{0:+#;-#;0}}" 
                                                                                       VerticalAlignment="Center"/>
                                                                </StackPanel>
                                                            </ContentControl>
                                                        </Grid>

                                                        <Grid x:Name="CantripsAndSpells" HorizontalAlignment="Center" VerticalAlignment="Center">
                                                            <Image Source="{StaticResource SpellsBorderHalf}" Stretch="None" HorizontalAlignment="Center" VerticalAlignment="Top"/>

                                                            <StackPanel Orientation="Horizontal">
                                                                <ItemsControl x:Name="CantripList" VerticalAlignment="Center" Margin="-12,-8,0,8"
                                                                                      ItemsSource="{Binding FilteredItems, ElementName=CantripGroupFilter}" 
                                                                                      Visibility="{Binding Path=ItemsSource.Count, RelativeSource={RelativeSource Self}, Converter={StaticResource CountToVisibilityConverter}}" 
                                                                                      ls:AttachedProperties.InheritedTag="CompactView"
                                                                                      MaxWidth="264"/>

                                                                <ItemsControl x:Name="SpellsList" VerticalAlignment="Center" Margin="0,-8,0,8"
                                                                                      ItemsSource="{Binding FilteredItems, ElementName=SpellLevelsGroupFilter}" 
                                                                                      Visibility="{Binding Path=ItemsSource.Count, RelativeSource={RelativeSource Self}, Converter={StaticResource CountToVisibilityConverter}}"
                                                                                      ls:AttachedProperties.InheritedTag="CompactView"
                                                                                      MaxWidth="200"/>

                                                                <Image x:Name="LongRestImage" Source="{StaticResource LongRestIcon}" Stretch="None" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Collapsed" Margin="0,12,0,-12"/>
                                                            </StackPanel>
                                                        </Grid>
                                                    </StackPanel>

                                                    <DataTemplate.Triggers>
                                                        <DataTrigger Binding="{Binding FilteredItems[0].Actions[0].CooldownType, ElementName=SpellLevelsGroupFilter}" Value="UntilRest">
                                                            <Setter TargetName="LongRestImage" Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>

                                                        <DataTrigger Binding="{Binding ParentState, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel">
                                                            <Setter TargetName="InitiationRoot" Property="Width" Value="Auto"/>
                                                        </DataTrigger>
                                                    </DataTemplate.Triggers>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>

                                        <!-- Actions -->
                                        <ItemsControl x:Name="ActionsList" HorizontalAlignment="Stretch" 
                                                              ItemsSource="{Binding FilteredItems, ElementName=CharacterActionGroupFilter}" 
                                                              Visibility="{Binding Path=ItemsSource.Count, RelativeSource={RelativeSource Self}, Converter={StaticResource CountToVisibilityConverter}}"/>

                                        <!-- Class passives -->
                                        <ItemsControl x:Name="PassivesList" VerticalAlignment="Top" HorizontalAlignment="Stretch"
                                                      Style="{StaticResource PassiveCellItemsControlStyle}"
                                                      ItemsSource="{Binding FilteredItems, ElementName=PassivesFilter}" 
                                                      ls:AttachedProperties.InheritedTag="Passives" 
                                                      Visibility="{Binding Path=ItemsSource.Count, RelativeSource={RelativeSource Self}, Converter={StaticResource CountToVisibilityConverter}}"/>

                                        <ItemsControl x:Name="TadpolePassivesList" VerticalAlignment="Top" HorizontalAlignment="Stretch"
                                                      Style="{StaticResource PassiveCellItemsControlStyle}"
                                                      ItemsSource="{Binding FilteredItems, ElementName=TadpolePassivesFilter}" 
                                                      ls:AttachedProperties.InheritedTag="TadpolePassives" 
                                                      Visibility="Collapsed"/>
                                        
                                        <!-- ============================================================ -->
                                        <!-- === MOD_ACS: Move from before "InitiationsList" - START === -->
                                        <!-- MOD_ACS: Add title for passive feats -->
                                        <ContentControl x:Name="PassivesFeatsTitle" Style="{StaticResource ACS_SB_BaseTitleStyle}" Visibility="{Binding Visibility, ElementName=FeatsList}">
                                            <TextBlock Text="{Binding Source='h74d1322ag4c4dg42eag9272g066b84d0d374', Converter={StaticResource TranslatedStringConverter}}"/>
                                        </ContentControl>
                                        
                                        <!-- MOD_ACS: Switch order with "FeatsList" / Enable tadpole feats only in base tab, see trigger "TadpoleFeatsList"-->
                                        <!-- MOD_BCPP: Visibility="{Binding Path=ItemsSource.Count, RelativeSource={RelativeSource Self}, Converter={StaticResource CountToVisibilityConverter}}" -->
                                        <!-- BG3: Visibility="Collapsed" -->
                                        <ItemsControl x:Name="TadpoleFeatsList" VerticalAlignment="Top" HorizontalAlignment="Stretch"
                                                          Style="{StaticResource PassiveCellItemsControlStyle}"
                                                          ItemsSource="{Binding FilteredItems, ElementName=TadpoleFeatsFilter}" 
                                                          ls:AttachedProperties.InheritedTag="TadpoleFeats" 
                                                          Visibility="Collapsed"/>
                                                          
                                        <!-- Feats -->
                                        <ItemsControl x:Name="FeatsList" VerticalAlignment="Top" HorizontalAlignment="Stretch"
                                                          Style="{StaticResource PassiveCellItemsControlStyle}"
                                                          ItemsSource="{Binding FilteredItems, ElementName=ClassFeatsFilter}" 
                                                          ls:AttachedProperties.InheritedTag="ClassFeats" 
                                                          Visibility="{Binding Path=ItemsSource.Count, RelativeSource={RelativeSource Self}, Converter={StaticResource CountToVisibilityConverter}}"/>
                                        <!-- === MOD_ACS: Move from before "InitiationsList" - END === -->
                                        <!-- ========================================================== -->

                                        <!-- Search results -->
                                        <Rectangle x:Name="SearchResultsSectionOpening" Fill="{StaticResource ClassBorderEdges}" Visibility="Collapsed" Margin="6,0,0,0" Width="{Binding Fill.Viewbox.Width, RelativeSource={RelativeSource Self}}" Height="{Binding Fill.Viewbox.Height, RelativeSource={RelativeSource Self}}"/>

                                        <!-- MOD_ACS: Disable old BG3 Search Results Section -->
                                        <!-- <Border x:Name="SearchResultsSection" Visibility="Collapsed" Margin="{Binding Margin, ElementName=SearchResultsSectionOpening}" Width="{Binding Width, ElementName=SearchResultsSectionOpening}" Background="{StaticResource ClassBorderCenter}"> -->
                                        
                                        <!-- MOD_ACS: Rework Search -->
                                        <ls:LSNineSliceImage x:Name="SearchResultsSection" ImageSource="{StaticResource SpellsBorder}" Slices="22,10,22,42" IconWidth="70" Margin="0,0,0,0" Padding="0,0,0,-9" Visibility="Collapsed">

                                            <StackPanel x:Name="SearchResults">
                                                <TextBlock x:Name="ResultsTitle" 
                                                               ls:TextBlockFormatter.SourceText="{Binding Source=hd3ed8394g34a6g4e76g9a43gcaf52ddb2dd4, Converter={StaticResource TranslatedStringConverter}}" 
                                                               Style="{StaticResource ActionGroupTitleStyle}" 
                                                               HorizontalAlignment="Left" VerticalAlignment="Center"
                                                               Visibility="{Binding Visibility, ElementName=Results}"
                                                               Margin="120,22,0,0"/>

                                                <ItemsControl x:Name="Results" VerticalAlignment="Top" HorizontalAlignment="Stretch" 
                                                                  Template="{StaticResource SpellbookActionGroup}" 
                                                                  ItemsSource="{Binding GeneratedItemsList, ElementName=FilteringContainerHolder}" 
                                                                  AlternationCount="{Binding ItemsSource.Count, RelativeSource={RelativeSource Self}}"
                                                                  ItemsPanel="{StaticResource SpellbookItemsPanelTemplate}" 
                                                                  ItemContainerStyle="{StaticResource SpellCellGridItemContainerStyle}" 
                                                                  ItemTemplate="{StaticResource ActionGroupItemTemplate}"
                                                                  Visibility="{Binding Path=ItemsSource.Count, RelativeSource={RelativeSource Self}, Converter={StaticResource CountToVisibilityConverter}}"/>

                                                <!-- MOD_ACS: Change template & Add H-align // BG3: Template="{StaticResource NoResultsFoundTemplate}" -->
                                                <Control x:Name="NoItemsFoundOverlay" Template="{StaticResource NoResultsFoundSearchTemplate}" HorizontalAlignment="Center" Visibility="Collapsed" Margin="0,40,0,0"/>

                                                <ls:LSButton x:Name="ClearFilter" HorizontalAlignment="Center" BoundEvent="UICancel" Command="ls:FilteringContainer.ClearFilterCommand" CommandTarget="{Binding ElementName=FilteringContainerHolder}" Margin="0,40,0,0">
                                                    <Button.Template>
                                                        <ControlTemplate TargetType="{x:Type ls:LSButton}">
                                                            <ControlTemplate.Resources>
                                                                <BitmapImage x:Key="ButtonBg" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/Btn_small_brown_d.png" />
                                                                <BitmapImage x:Key="ButtonPressedBg" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/Btn_small_brown_p.png" />
                                                                <BitmapImage x:Key="ButtonHoveredBg" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/Btn_small_brown_h.png" />
                                                            </ControlTemplate.Resources>
                                                            <Grid Background="Transparent">
                                                                <Image x:Name="bg" Source="{StaticResource ButtonBg}" Stretch="None"/>
                                                                <TextBlock ls:TextBlockFormatter.SourceText="{Binding Source=h9b2ac696gf0c7g4cddg968bg364c67af8757, Converter={StaticResource TranslatedStringConverter}}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                            </Grid>
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter Property="Source" Value="{StaticResource ButtonHoveredBg}" TargetName="bg"/>
                                                                </Trigger>
                                                                <Trigger Property="IsPressed" Value="True">
                                                                    <Setter Property="Source" Value="{StaticResource ButtonPressedBg}" TargetName="bg"/>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Button.Template>
                                                </ls:LSButton>
                                            </StackPanel>
                                        </ls:LSNineSliceImage>
                                        <!-- MOD_ACS: Disable old BG3 Search Results Section -->
                                        <!-- </Border> -->

                                        <Rectangle x:Name="SearchResultsSectionClosure" Fill="{StaticResource ClassBorderEdges}" RenderTransformOrigin="0.5, 0.5" Visibility="Collapsed" Margin="{Binding Margin, ElementName=SearchResultsSectionOpening}"
                                                   Width="{Binding Fill.Viewbox.Width, RelativeSource={RelativeSource Self}}" Height="{Binding Fill.Viewbox.Height, RelativeSource={RelativeSource Self}}">
                                            <Rectangle.RenderTransform>
                                                <ScaleTransform ScaleY="-1"/>
                                            </Rectangle.RenderTransform>
                                        </Rectangle>
                                    </StackPanel>
                                </ls:LSScrollViewer>
                            </Grid>
                        </ScrollViewer>
                    </Grid>

                    <!-- Search button -->
                    <ls:LSToggleButton x:Name="SearchToggle" Grid.Column="2" 
                                                   VerticalAlignment="Top" HorizontalAlignment="Left"
                                                   Template="{StaticResource ToggleIconButtonTemplate}" 
                                                   IsChecked="False" 
                                                   Margin="0,0,30,0"
                                                   Command="ls:FilteringContainer.ClearFilterCommand" CommandTarget="{Binding ElementName=FilteringContainerHolder}"
                                                   Height="{StaticResource TopBarHeight}">
                        <ls:LSToggleButton.Resources>
                            <ImageSource x:Key="ButtonUncheckedNormal">pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterSheet/btn_round_medium_d.png</ImageSource>
                            <ImageSource x:Key="ButtonUncheckedHighlight">pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterSheet/btn_round_medium_h.png</ImageSource>
                            <ImageSource x:Key="ButtonUncheckedPressed">pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterSheet/btn_round_medium_p.png</ImageSource>
                            <ImageSource x:Key="ButtonUncheckedDisabled">pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterSheet/btn_round_medium_disabled.png</ImageSource>
                            <ImageSource x:Key="ButtonCheckedNormal">pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterSheet/btn_round_medium_d.png</ImageSource>
                            <ImageSource x:Key="ButtonCheckedHighlight">pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterSheet/btn_round_medium_h.png</ImageSource>
                            <ImageSource x:Key="ButtonCheckedPressed">pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterSheet/btn_round_medium_p.png</ImageSource>
                            <ImageSource x:Key="ButtonCheckedDisabled">pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterSheet/btn_round_medium_disabled.png</ImageSource>
                            <ImageSource x:Key="IconUncheckedNormal">pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_magnifier_d.png</ImageSource>
                            <ImageSource x:Key="IconUncheckedHighlight">pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_magnifier_h.png</ImageSource>
                            <ImageSource x:Key="IconUncheckedPressed">pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_magnifier_h.png</ImageSource>
                            <ImageSource x:Key="IconUncheckedDisabled">pack://application:,,,/GustavNoesisGUI;component/Assets/SpellBook/ico_magnifier_d.png</ImageSource>
                            <ImageSource x:Key="IconCheckedNormal">pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_cancel.png</ImageSource>
                            <ImageSource x:Key="IconCheckedHighlight">pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_cancel_h.png</ImageSource>
                            <ImageSource x:Key="IconCheckedPressed">pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_cancel_h.png</ImageSource>
                            <ImageSource x:Key="IconCheckedDisabled">pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_cancel.png</ImageSource>
                            <System:Double x:Key="IconWidth">36</System:Double>
                            <System:Double x:Key="IconHeight">36</System:Double>
                        </ls:LSToggleButton.Resources>
                    </ls:LSToggleButton>
                </Grid>
            </Grid>
        </Grid>

        <ControlTemplate.Triggers>
            <DataTrigger Binding="{Binding SelectedItem.SpellBookType, ElementName=Tabs}" Value="Base">
                <Setter TargetName="RaceIcon" Property="Visibility" Value="Visible"/>
                <Setter TargetName="LevelText" Property="Text">
                    <Setter.Value>
                        <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                            <Binding Source="h5df00b79ga6acg4d9fgb8dag23340151fba7"/>
                            <Binding Path="Stats.Level.Value" />
                            <Binding Source=""/>
                        </MultiBinding>
                    </Setter.Value>
                </Setter>
                
                <!-- MOD_ACS: Add 2 rows style LevelText -->
                <Setter TargetName="LevelText1" Property="Text" Value="{Binding Source=h8e782babg516fg4d7cgbd57g335de64c94a3, Converter={StaticResource TranslatedStringConverter}}"/>
                <Setter TargetName="LevelText2" Property="Text" Value="{Binding Stats.Level.Value}"/>

                <Setter TargetName="SubClassName" Property="Text" Value="{Binding DataContext.CurrentPlayer.SelectedCharacter.Stats.Race.DisplayName, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}"/>

                <Setter TargetName="FeatsList" Property="ItemsSource" Value="{Binding FilteredItems, ElementName=CharacterFeatsFilter}"/>
                <Setter TargetName="FeatsList" Property="ls:AttachedProperties.InheritedTag" Value="CharacterFeats"/>

                <Setter TargetName="InitiationsList" Property="Visibility" Value="{Binding Path=ItemsSource.Count, ElementName=InitiationsList, Converter={StaticResource CountToVisibilityConverter}}"/>
                <Setter TargetName="TadpoleActionsList" Property="Visibility" Value="{Binding Path=ItemsSource.Count, ElementName=TadpoleActionsList, Converter={StaticResource CountToVisibilityConverter}}"/>
                <Setter TargetName="TadpoleFeatsList" Property="Visibility" Value="{Binding Path=ItemsSource.Count, ElementName=TadpoleFeatsList, Converter={StaticResource CountToVisibilityConverter}}"/>
                <Setter TargetName="TadpolePassivesList" Property="Visibility" Value="{Binding Path=ItemsSource.Count, ElementName=TadpolePassivesList, Converter={StaticResource CountToVisibilityConverter}}"/>

                <Setter TargetName="CantripList" Property="ItemsSource" Value="{Binding FilteredItems, ElementName=NonFeatCantripGroupFilter}"/>
                <Setter TargetName="SpellsCategories" Property="ItemsSource" Value="{Binding FilteredItems, ElementName=NonFeatOrAlwaysPreparedSpellLevelsGroupFilter}"/>
                <Setter TargetName="NonPreparableSpellsCategories" Property="ItemsSource" Value="{Binding FilteredItems, ElementName=NonFeatSpellLevelsGroupFilter}"/>
            </DataTrigger>
            
            <!-- MOD_ACS: Add trigger for PassivesFeatsTitle disable in class tab -->
            <DataTrigger Binding="{Binding SelectedItem.SpellBookType, ElementName=Tabs}" Value="Class">
                <Setter TargetName="PassivesFeatsTitle" Property="Visibility" Value="Collapsed"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding SelectedItem.Class, ElementName=Tabs, Converter={StaticResource NullToBoolTrueConverter}}" Value="False">
                <Setter TargetName="PageIcon" Property="DataContext" Value="{Binding SelectedItem.Class, ElementName=Tabs}"/>
                <Setter TargetName="PageIcon" Property="Style" Value="{DynamicResource ClassIconStyle}"/>
                <Setter TargetName="PageIcon" Property="Visibility" Value="Visible"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding SelectedItem.SpellBookType, ElementName=Tabs}" Value="Tadpole">
                <!-- In KBM, tadpole info is part of the Base tab, so we're reusing this tab to act as the reactions' one, which doesn't exist -->
                <Setter TargetName="Reactions" Property="Visibility" Value="Visible"/>
                <Setter TargetName="ClassPanel" Property="Visibility" Value="Collapsed"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding IsChecked, ElementName=SearchToggle}" Value="True">
                <!-- MOD_ACS: FIX_SEARCH - Add BarLevelContainer visibility collapsed -->
                <Setter TargetName="BarLevelContainer" Property="Visibility" Value="Collapsed"/>
                
                <Setter TargetName="SubClassContainer" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="CastAbilityContainer" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="SpellDCContainer" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="SpellAttackContainer" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="ClassResourcesContainer" Property="Visibility" Value="Collapsed"/>

                <Setter TargetName="ClassSectionOpening" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="ClassSection" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="ClassSectionClosure" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="KnownSpellSection" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="FeatsList" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="TadpoleFeatsList" Property="Visibility" Value="Collapsed"/>
                <!-- MOD_ACS: Add Collapse TadpolePassivesList -->
                <Setter TargetName="TadpolePassivesList" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="PassivesList" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="InitiationsList" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="ActionsList" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="TadpoleActionsList" Property="Visibility" Value="Collapsed"/>
            </DataTrigger>

            <!-- MOD_ACS: Disable old BG3 search decorators -->
            <DataTrigger Binding="{Binding CurrentFilter, ElementName=FilteringContainerHolder, Converter={StaticResource NullToBoolFalseConverter}}" Value="True">
                <!-- BG3: <Setter TargetName="SearchResultsSectionOpening" Property="Visibility" Value="Visible"/> -->
                <Setter TargetName="SearchResultsSection" Property="Visibility" Value="Visible"/>
                <!-- BG3: <Setter TargetName="SearchResultsSectionClosure" Property="Visibility" Value="Visible"/> -->
            </DataTrigger>

            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding CurrentFilter, ElementName=FilteringContainerHolder, Converter={StaticResource NullToBoolTrueConverter}}" Value="False"/>
                    <Condition Binding="{Binding GeneratedItemsList.Count, ElementName=FilteringContainerHolder}" Value="0"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="NoItemsFoundOverlay" Property="Visibility" Value="Visible"/>
            </MultiDataTrigger>

            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding ParentState, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}" Value="CharacterPanel"/>
                    <Condition Binding="{Binding Visibility, ElementName=ClassActionsList}" Value="Visible"/>
                    <Condition Binding="{Binding Visibility, ElementName=CantripList}" Value="Visible"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="CantripList" Property="Grid.ColumnSpan" Value="1"/>
                <Setter TargetName="ClassActionsList" Property="Grid.ColumnSpan" Value="1"/>
                <Setter TargetName="ClassActionsList" Property="Grid.Column" Value="1"/>
                <Setter TargetName="ClassActionsList" Property="Grid.Row" Value="0"/>

                <Setter TargetName="CantripList" Property="ls:AttachedProperties.InheritedTag" Value="HideFeatsAndResources"/>
                <Setter TargetName="ClassActionsList" Property="ls:AttachedProperties.InheritedTag" Value="HideResources"/>
            </MultiDataTrigger>

            <!-- MOD_ACS: Disable LearnSpellsButton here - Btn moved to SpellbookActionGroup -->
            <DataTrigger Binding="{Binding SelectedItem.Class.CanLearnSpells, ElementName=Tabs}" Value="True">
                <!-- MOD_ACS: Disable // BG3: Value="Visible" -->
                <Setter TargetName="LearnSpellsButton" Property="Visibility" Value="Collapsed"/>
                <!-- MOD_ACS: Disable // BG3: Value="Visible" -->
                <Setter TargetName="SpellsTitle" Property="Visibility" Value="Collapsed"/>
                <!-- MOD_ACS: Add SpellsTitleText for learn btn / Disable for now -->
                <!-- <Setter TargetName="SpellsTitleText" Property="ls:TextBlockFormatter.SourceText" Value="{Binding Source=h82b57884g9542g4415gac97g16a53810d331, Converter={StaticResource TranslatedStringConverter}}"/> -->
                <!-- MOD_ACS: Disable // BG3: Value="Visible" -->
                <Setter TargetName="SpellsTitleText" Property="Visibility" Value="Collapsed"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding SelectedItem.Class.MustPrepareSpells, ElementName=Tabs, FallbackValue=False}" Value="False">
                <Setter TargetName="KnownSpellSection" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="NonPreparableSpellsCategories" Property="Visibility" Value="{Binding Path=ItemsSource.Count, ElementName=NonPreparableSpellsCategories, Converter={StaticResource CountToVisibilityConverter}, FallbackValue=Collapsed}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding Visibility, ElementName=AlwaysPreparedList}" Value="Visible">
                <Setter TargetName="SpellsTitle" Property="Visibility" Value="Visible"/>
            </DataTrigger>
            <!-- MOD_ACS: Rebind to PreparedSpellsSectionOpening // BG3: ElementName=PreparedSpellsSection -->
            <DataTrigger Binding="{Binding Visibility, ElementName=PreparedSpellsSectionOpening}" Value="Visible">
                <!-- MOD_ACS: Disable SpellsTitle // BG3: <Setter TargetName="SpellsTitle" Property="Visibility" Value="Visible"/> -->
                <!-- MOD_ACS: Add ClassSection Decorative Stroke margin to hide bottom part -->
                <Setter TargetName="ClassSectionDecorativeStroke" Property="Margin" Value="16,0,17,-50"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding Visibility, ElementName=NonPreparableSpellsCategories}" Value="Visible">
                <Setter TargetName="SpellsTitle" Property="Visibility" Value="Visible"/>
            </DataTrigger>
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <!-- MOD_ACS: Rebind to PreparedSpellsSectionOpening // BG3: ElementName=PreparedSpellsSection -->
                    <Condition Binding="{Binding Visibility, ElementName=PreparedSpellsSectionOpening}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=KnownSpellSection}" Value="Visible"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="InnerSpellsTitle" Property="Visibility" Value="Visible"/>
            </MultiDataTrigger>

            <DataTrigger Binding="{Binding Visibility, ElementName=KnownSpellSection}" Value="Visible">
                <Setter TargetName="ClassSectionClosure" Property="Visibility" Value="Collapsed"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding Visibility, ElementName=PreparedSpellsSectionClosure}" Value="Visible">
                <Setter TargetName="SearchResultsSectionOpening" Property="Visibility" Value="Collapsed"/>
            </DataTrigger>

            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding Visibility, ElementName=CantripList}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=ClassActionsList}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=TadpoleActionsList}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=MetamagicList}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=SpellsTitle}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=AlwaysPreparedList}" Value="Collapsed"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="ClassSectionOpening" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="ClassSection" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="ClassSectionClosure" Property="Visibility" Value="Collapsed"/>
            </MultiDataTrigger>

            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding Path=ItemsSource.Count, ElementName=SpellsCategories, Converter={StaticResource GreaterThanConverter},ConverterParameter=0}" Value="True"/>
                    <Condition Binding="{Binding Path=ItemsSource.Count, ElementName=ManuallyPreparedList, Converter={StaticResource GreaterThanConverter},ConverterParameter=0}" Value="True"/>
                </MultiDataTrigger.Conditions>
                <!-- MOD_ACS: Switch visibility to PreparedSpellsSectionOpening // BG3: TargetName="PreparedSpellsSection" -->
                <Setter TargetName="PreparedSpellsSectionOpening" Property="Visibility" Value="Visible"/>
            </MultiDataTrigger>

            <!-- In case cantrips and actions section is collapsed, we need to propagate the margin to make sure elements will be set in the proper position -->
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding Visibility, ElementName=ClassActionsList}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=CantripList}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=TadpoleActionsList}" Value="Visible"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="TadpoleActionsList" Property="Margin" Value="{Binding Margin, ElementName=CantripsAndActions}"/>
            </MultiDataTrigger>
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding Visibility, ElementName=ClassActionsList}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=CantripList}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=TadpoleActionsList}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=MetamagicList}" Value="Visible"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="MetamagicList" Property="Margin" Value="{Binding Margin, ElementName=CantripsAndActions}"/>
            </MultiDataTrigger>
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding Visibility, ElementName=ClassActionsList}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=CantripList}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=TadpoleActionsList}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=MetamagicList}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=SpellsTitle}" Value="Visible"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="SpellsTitle" Property="Margin" Value="{Binding Margin, ElementName=CantripsAndActions}"/>
            </MultiDataTrigger>
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding Visibility, ElementName=ClassActionsList}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=CantripList}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=TadpoleActionsList}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=MetamagicList}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=SpellsTitle}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=AlwaysPreparedList}" Value="Visible"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="AlwaysPreparedList" Property="Margin" Value="{Binding Margin, ElementName=CantripsAndActions}"/>
            </MultiDataTrigger>

            <!-- Scrolling: If there're spells to prepare, scroll only from the prepared spells section -->
            <DataTrigger Binding="{Binding SelectedItem.Class.MustPrepareSpells, ElementName=Tabs, FallbackValue=False}" Value="True">
                <!-- MOD_ACS: Update MaxHeight 1300 // BG3: MaxHeight="1200"/> -->
                <Setter TargetName="WholePanelScrollViewerRoot" Property="MaxHeight" Value="1300"/>
                <!-- MOD_ACS: Disabled for now until I find a fix see TODOs -->
                <Setter TargetName="WholePanelScrollViewer" Property="VerticalScrollBarVisibility" Value="Disabled"/>
            </DataTrigger>
            
            <!-- MOD_ACS: Add offset to inner scrollBar when outter is visible /> -->
            <DataTrigger Binding="{Binding ComputedVerticalScrollBarVisibility, ElementName=WholePanelScrollViewer}" Value="Visible">
                <Setter TargetName="ClassPanelScrollableContent" Property="Margin" Value="-7,0,7,10"/>
                <Setter TargetName="ClassPanelScrollableContent" Property="Padding" Value="7,0,-7,-10"/>
            </DataTrigger>

            <!-- Scrolling: If there's no spell to prepare, scroll the whole content instead -->
            <DataTrigger Binding="{Binding SelectedItem.Class.MustPrepareSpells, ElementName=Tabs, FallbackValue=False}" Value="False">
                <Setter TargetName="ClassPanelScrollableContent" Property="Grid.Row" Value="1"/>
                <Setter TargetName="ClassPanelScrollableContent" Property="ScrollWheelEnabled" Value="False"/>
            </DataTrigger>

            <!-- MOD_ACS: Add trigger to collapse on ToggleSpy ClassSectionGrid only when PreparedSpellsSection is visible -->
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding Visibility, ElementName=PreparedSpellsSectionOpening}" Value="Visible"/>
                    <Condition Binding="{Binding Visibility, ElementName=ClassSectionGridToggleSpy}" Value="Collapsed"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="ClassSectionGrid" Property="Visibility" Value="Collapsed"/>
            </MultiDataTrigger>

            <!-- Don't allow drag & drop for summons and followers -->
            <DataTrigger Binding="{Binding CharacterType}" Value="Summon">
                <Setter TargetName="ClassSection" Property="IsEnabled" Value="False"/>
                <Setter TargetName="ScrollableContent" Property="IsEnabled" Value="False"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding CharacterType}" Value="Follower">
                <Setter TargetName="ClassSection" Property="IsEnabled" Value="False"/>
                <Setter TargetName="ScrollableContent" Property="IsEnabled" Value="False"/>
            </DataTrigger>

            <!-- Replaceable spells message -->
            <DataTrigger Binding="{Binding SelectedItem.Class.IDString, ElementName=Tabs}" Value="Bard">
                <Setter TargetName="ReplaceableSpellsNote" Property="Visibility" Value="Visible"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding SelectedItem.Class.IDString, ElementName=Tabs}" Value="Warlock">
                <Setter TargetName="ReplaceableSpellsNote" Property="Visibility" Value="Visible"/>
                <Setter TargetName="ReplaceableSpellsNote" Property="ls:TextBlockFormatter.SourceText" Value="{Binding Source=h4e8ccd4cgd056g41e3g95a5g29b78126e9a2, Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding SelectedItem.Class.IDString, ElementName=Tabs}" Value="Ranger">
                <Setter TargetName="ReplaceableSpellsNote" Property="Visibility" Value="Visible"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding SelectedItem.Class.IDString, ElementName=Tabs}" Value="Sorcerer">
                <Setter TargetName="ReplaceableSpellsNote" Property="Visibility" Value="Visible"/>
            </DataTrigger>

            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding Visibility, ElementName=KnownSpellSection}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=ReplaceableSpellsNote}" Value="Visible"/>
                    <Condition Binding="{Binding Visibility, ElementName=NonPreparableSpellsCategories}" Value="Visible"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="NonPreparableReplaceableSpellsNote" Property="Visibility" Value="Visible"/>
                <Setter TargetName="NonPreparableReplaceableSpellsNote" Property="ls:TextBlockFormatter.SourceText" Value="{Binding (ls:TextBlockFormatter.SourceText), ElementName=ReplaceableSpellsNote}"/>
            </MultiDataTrigger>

            <!-- Non-caster classes -->
            <DataTrigger Binding="{Binding SelectedItem.Class.IDString, ElementName=Tabs}" Value="Monk">
                <Setter TargetName="CastAbilityContainer" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="SpellDCContainer" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="SpellAttackContainer" Property="Visibility" Value="Collapsed"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding SelectedItem.Class.IDString, ElementName=Tabs}" Value="Barbarian">
                <Setter TargetName="CastAbilityContainer" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="SpellDCContainer" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="SpellAttackContainer" Property="Visibility" Value="Collapsed"/>
            </DataTrigger>

            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding SelectedItem.Class.IDString, ElementName=Tabs}" Value="Rogue"/>
                    <Condition Binding="{Binding SelectedItem.Class.SubclassIDString, ElementName=Tabs}" Value=""/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="CastAbilityContainer" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="SpellDCContainer" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="SpellAttackContainer" Property="Visibility" Value="Collapsed"/>
            </MultiDataTrigger>
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding SelectedItem.Class.IDString, ElementName=Tabs}" Value="Rogue"/>
                    <Condition Binding="{Binding SelectedItem.Class.SubclassIDString, ElementName=Tabs}" Value="Thief"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="CastAbilityContainer" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="SpellDCContainer" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="SpellAttackContainer" Property="Visibility" Value="Collapsed"/>
            </MultiDataTrigger>
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding SelectedItem.Class.IDString, ElementName=Tabs}" Value="Rogue"/>
                    <Condition Binding="{Binding SelectedItem.Class.SubclassIDString, ElementName=Tabs}" Value="Assassin"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="CastAbilityContainer" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="SpellDCContainer" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="SpellAttackContainer" Property="Visibility" Value="Collapsed"/>
            </MultiDataTrigger>

            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding SelectedItem.Class.IDString, ElementName=Tabs}" Value="Fighter"/>
                    <Condition Binding="{Binding SelectedItem.Class.SubclassIDString, ElementName=Tabs}" Value=""/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="CastAbilityContainer" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="SpellDCContainer" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="SpellAttackContainer" Property="Visibility" Value="Collapsed"/>
            </MultiDataTrigger>
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding SelectedItem.Class.IDString, ElementName=Tabs}" Value="Fighter"/>
                    <Condition Binding="{Binding SelectedItem.Class.SubclassIDString, ElementName=Tabs}" Value="BattleMaster"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="CastAbilityContainer" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="SpellDCContainer" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="SpellAttackContainer" Property="Visibility" Value="Collapsed"/>
            </MultiDataTrigger>
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding SelectedItem.Class.IDString, ElementName=Tabs}" Value="Fighter"/>
                    <Condition Binding="{Binding SelectedItem.Class.SubclassIDString, ElementName=Tabs}" Value="Champion"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="CastAbilityContainer" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="SpellDCContainer" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="SpellAttackContainer" Property="Visibility" Value="Collapsed"/>
            </MultiDataTrigger>

            <!-- Party Panel view -->
            <!-- MOD_ACS: Party Panel specific changes -->
            <DataTrigger Binding="{Binding ParentState, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel"> 
                                                
                <!-- MOD_ACS: Add margin to view content when 4 rows spells -->
                <Setter TargetName="ClassPanelRoot" Property="Margin" Value="0,0,0,55"/>

                <Setter TargetName="NavigationLeftButton" Property="Visibility" Value="Visible"/>
                <Setter TargetName="NavigationRightButton" Property="Visibility" Value="Visible"/>
                
                <!-- MOD_ACS: Tabs -->
                <Setter TargetName="TabsContainer" Property="Margin" Value="0,-6,0,0"/>
                <Setter TargetName="Tabs" Property="MaxWidth">
                    <Setter.Value>
                        <MultiBinding Converter="{StaticResource AddMultipleConverter}">
                            <Binding Path="ActualWidth" ElementName="MultiClassSpellbookContainer"/>
                            <Binding Path="ActualWidth" ElementName="NavigationLeftButton" Converter="{StaticResource MultiplierConverter}" ConverterParameter="-1"/>
                            <Binding Path="ActualWidth" ElementName="NavigationRightButton" Converter="{StaticResource MultiplierConverter}" ConverterParameter="-1"/>
                        </MultiBinding>
                    </Setter.Value>
                </Setter>

                <!-- MOD_ACS: Update Margin // BG3: Value="0,0,0,20" -->
                <Setter TargetName="TopBar" Property="Margin" Value="0,-6,0,10"/>
                
                <!-- MOD_ACS: Update ClassPanel to dynamic MaxHeight // BG3: Value="1476"/> -->
                <Setter TargetName="ClassPanel" Property="MaxHeight" Value="{Binding ActualHeight, ElementName=MultiClassSpellbookContainer}"/>
                
                <!-- MOD_ACS: Add FixedContent for WholePanel scroll -->                
                <Setter TargetName="WholePanelScrollViewer" Property="Margin" Value="13,0,-13,0"/>
                <Setter TargetName="WholePanelScrollViewer" Property="Padding" Value="-13,0,13,0"/>
                <Setter TargetName="ClassPanelFixedContent" Property="Margin" Value="0,0,0,0"/>
                <Setter TargetName="ClassPanelFixedContent" Property="Padding" Value="0,0,0,0"/>
                
                <!-- MOD_ACS: Add ScrollableContent for ClassPanel scroll -->
                <Setter TargetName="ClassPanelScrollableContent" Property="Margin" Value="14,8,-14,-2"/>
                <Setter TargetName="ClassPanelScrollableContent" Property="Padding" Value="-14,-8,14,-20"/>
                <Setter TargetName="ScrollableContent" Property="Margin" Value="0,0,0,20"/>
                <Setter TargetName="ScrollableContent" Property="Padding" Value="0,0,0,0"/>
                
                <!-- MOD_ACS: Add Reactions margin -->
                <Setter TargetName="Reactions" Property="Margin" Value="0,0,0,0"/>

                <!-- MOD_ACS: Disable as it is dynamic now // MOD_BCPP: 6chars Value="634" // BG3: "684"  -->
                <!-- <Setter TargetName="ClassPanelCentralColumn" Property="Width" Value="684"/> -->
                
                <!-- MOD_ACS: Trick to get right width for central column -->
                <Setter TargetName="ClassPanel" Property="Width" Value="{Binding ActualWidth, ElementName=CharacterRoot}"/>
                <Setter TargetName="ClassPanelCentralColumn" Property="MaxWidth">
                    <Setter.Value>
                        <MultiBinding Converter="{StaticResource AddMultipleConverter}">
                            <Binding Path="ActualWidth" ElementName="ClassPanel"/>
                            <!-- MOD_ACS: max remove for 5 spells "-74" // BG3: max remove for 7 spells "-72" -->
                            <Binding Source="-72"/>
                        </MultiBinding>
                    </Setter.Value>
                </Setter>                
                
                <Setter TargetName="SubClassContainer" Property="Grid.ColumnSpan" Value="5"/>
                <!-- MOD_ACS: Add right margin for TopBar search btn -->
                <Setter TargetName="SubClassContainer" Property="Margin" Value="0,0,77,0"/>
                <!-- MOD_ACS: FIX_SEARCH - Disable Bar Level Container Visibility -->
                <!-- BG3: <Setter TargetName="BarLevelContainer" Property="Visibility" Value="Visible"/> -->
                
                <Setter TargetName="ClassResourcesContainer" Property="Grid.Row" Value="1"/>
                <Setter TargetName="ClassResourcesContainer" Property="Grid.Column" Value="0"/>
                <Setter TargetName="ClassResourcesContainer" Property="Grid.ColumnSpan" Value="1"/><!-- MOD_ACS: // BG3: Value="3" -->
                <Setter TargetName="CastAbilityContainer" Property="Grid.Row" Value="1"/>
                <Setter TargetName="CastAbilityContainer" Property="Grid.Column" Value="1"/><!-- MOD_ACS: Add CastAbility as filler in top bar -->
                <Setter TargetName="SpellDCContainer" Property="Grid.Row" Value="1"/>
                <Setter TargetName="SpellAttackContainer" Property="Grid.Row" Value="1"/>

                <Setter TargetName="InfoPanel" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="SearchToggle" Property="Visibility" Value="Collapsed"/>

                <Setter TargetName="InnerSearchToggle" Property="Visibility" Value="Visible"/>
                <Setter TargetName="SearchToggle" Property="IsChecked" Value="{Binding IsChecked, ElementName=InnerSearchToggle}"/>

                <Setter TargetName="InitiationsList" Property="HorizontalAlignment" Value="Center"/>

                <Setter TargetName="Background" Property="Source" Value="{StaticResource SpellbookBg_Small}"/>
                <Setter TargetName="Background" Property="Stretch" Value="Fill"/>
                <!-- MOD_ACS: Update margin bg // BG3: Value="-8,-94,-8,-8" -->
                <Setter TargetName="Background" Property="Margin" Value="-6,-94,-6,-6"/>

                <!-- MOD_ACS: Add ClassSection DecorativeStroke -->
                <Setter TargetName="ClassSectionDecorativeStroke" Property="Margin" Value="15,4,15,-10"/>
                <Setter TargetName="ClassSectionDecorativeStroke" Property="Padding" Value="0,-6,0,0"/>
                <Setter TargetName="ClassSectionDecorativeStroke" Property="StrokeDashArray" Value="5,3"/>
                <Setter TargetName="ClassSectionDecorativeStroke" Property="StrokeThickness" Value="2"/>

                <!-- MOD_ACS: Disable/unused Setters for ClassSection -->
                <Setter TargetName="ClassSectionOpening" Property="Fill" Value="{StaticResource ClassBorderEdges_Small}"/>
                <!-- BG3: <Setter TargetName="ClassSectionOpening" Property="Margin" Value="-6 ,0,6,0"/> -->
                <!-- BG3: <Setter TargetName="ClassSection" Property="Background" Value="{StaticResource ClassBorderCenter_Small}"/> -->
                <Setter TargetName="ClassSectionClosure" Property="Fill" Value="{StaticResource ClassBorderEdges_Small}"/>

                <Setter TargetName="PreparedSpellsSectionOpening" Property="Source" Value="{StaticResource PreparedSpellsTop_Small}"/>
                
                <!-- MOD_ACS: PreparedSpellsSection switch visibility -->
                <Setter TargetName="PreparedSpellsSection" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="PreparedSpellsSectionSmall" Property="Visibility" Value="{Binding Visibility, ElementName=PreparedSpellsSectionOpening}"/>              
                
                <!-- MOD_ACS: Disable unused Setters for PreparedSpellsSection background -->
                <!-- BG3: 
                <Setter TargetName="PreparedSpellsSection" Property="Background">
                    <Setter.Value>
                        <ImageBrush ImageSource="{StaticResource PreparedSpellsCenter_Small}" Stretch="Fill" TileMode="Tile" AlignmentY="Top" ViewportUnits="Absolute">
                            <ImageBrush.Viewport>
                                <MultiBinding Converter="{StaticResource CreateRectConverter}">
                                    <Binding Source="0"/>
                                    <Binding Source="0"/>
                                    <Binding Path="ImageSource.Width" RelativeSource="{RelativeSource Self}"/>
                                    <Binding Path="ImageSource.Height" RelativeSource="{RelativeSource Self}"/>
                                </MultiBinding>
                            </ImageBrush.Viewport>
                        </ImageBrush>
                    </Setter.Value>
                </Setter>
                -->                
                <Setter TargetName="PreparedSpellsSectionClosure" Property="Source" Value="{StaticResource PreparedSpellsBottom_Small}"/>

                <!-- MOD_ACS: Add Margin to Prepared Spells -->
                <Setter TargetName="PreparedSpellsSectionOpening" Property="Margin" Value="1,6,-1,0"/>
                <Setter TargetName="PreparedSpellsSectionSmall" Property="Margin" Value="1,0,-1,0"/>
                <Setter TargetName="PreparedSpellsSectionClosure" Property="Margin" Value="1,0,-1,0"/>

                <Setter TargetName="KnownSpellSection" Property="ImageSource" Value="{StaticResource SpellsBorder_Small}"/>
                <Setter TargetName="KnownSpellSection" Property="Slices" Value="24,20,44,44"/>
                
                <!-- MOD_ACS: Disable as its dynamic now // MOD_BCPP: 6chars value="640" // BG3: Value="690" -->
                <!-- <Setter TargetName="KnownSpellSection" Property="Width" Value="690"/> -->
                
                <!-- MOD_ACS: Update know spells margin // BG3: Value="-6,0,6,0" -->
                <Setter TargetName="KnownSpellSection" Property="Margin" Value="0,0,0,0"/>
                <!-- MOD_ACS: Add footer spells margin -->
                <Setter TargetName="SpellsCategories" Property="Margin" Value="6,0,0,0"/>
                

                <Setter TargetName="SearchResultsSectionOpening" Property="Fill" Value="{StaticResource ClassBorderEdges_Small}"/>
                <Setter TargetName="SearchResultsSectionOpening" Property="Margin" Value="0"/>
                <Setter TargetName="SearchResultsSection" Property="Background" Value="{x:Null}"/>
                <Setter TargetName="SearchResultsSection" Property="Background" Value="{StaticResource ClassBorderCenter_Small}"/>
                <Setter TargetName="SearchResultsSectionClosure" Property="Fill" Value="{StaticResource ClassBorderEdges_Small}"/>
            </DataTrigger>

            <!-- MOD_ACS: Detect if BCPP is active for party panel -->
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding ParentState, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel"/>
                    <Condition Binding="{Binding VerticalAlignment, ElementName=CharacterRoot}" Value="Top"/>
                </MultiDataTrigger.Conditions>
                <!-- MOD_ACS: Update margin for tabs align on bg -->   
                <Setter TargetName="ClassPanelRoot" Property="Margin" Value="0,9,0,0"/>
                <!-- MOD_ACS: WholePanel scroll -->                
                <Setter TargetName="WholePanelScrollViewer" Property="Margin" Value="13,0,-13,20"/>
                <Setter TargetName="WholePanelScrollViewer" Property="Padding" Value="-13,0,13,-20"/>
                <Setter TargetName="ClassPanelScrollableContent" Property="Margin" Value="14,8,-14,18"/>
                <Setter TargetName="ClassPanelScrollableContent" Property="Padding" Value="-14,-8,14,-40"/>
                <!-- MOD_ACS: Footer margin -->
                <Setter TargetName="KnownSpellSection" Property="Margin" Value="0,0,0,10"/>
                <Setter TargetName="SpellsCategories" Property="Margin" Value="6,0,0,10"/>
                <Setter TargetName="ScrollableContent" Property="Margin" Value="0,0,0,50"/>
                <!-- MOD_ACS: Text replaceable on lvl up -->
                <Setter TargetName="NonPreparableReplaceableSpellsNote" Property="Margin" Value="40,4,40,4"/>
            </MultiDataTrigger> 

            <!-- MOD_ACS: Add scroll handler specific to PartyPanel // BG3: Scrolling: If there're spells to prepare, scroll only from the prepared spells section -->
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding ParentState, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel"/>
                    <Condition Binding="{Binding SelectedItem.Class.MustPrepareSpells, ElementName=Tabs, FallbackValue=False}" Value="True"/>
                </MultiDataTrigger.Conditions>
                <!-- MOD_ACS: Disable dual scroll // BG3: <Setter TargetName="WholePanelScrollViewerRoot" Property="MaxHeight" Value="1800"/> -->
                <Setter TargetName="WholePanelScrollViewer" Property="VerticalScrollBarVisibility" Value="Disabled"/>
            </MultiDataTrigger> 

            <!-- MOD_ACS: Add offset to both scrollBars when both are visible /> --> 
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding ParentState, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel"/>
                    <Condition Binding="{Binding ComputedVerticalScrollBarVisibility, ElementName=WholePanelScrollViewer}" Value="Visible"/>
                    <Condition Binding="{Binding ComputedVerticalScrollBarVisibility, ElementName=ClassPanelScrollableContent}" Value="Visible"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="WholePanelScrollViewer" Property="Margin" Value="15,0,-15,10"/>
                <Setter TargetName="WholePanelScrollViewer" Property="Padding" Value="-15,0,15,-10"/>
                <Setter TargetName="ClassPanelScrollableContent" Property="Margin" Value="-1,0,1,10"/>
                <Setter TargetName="ClassPanelScrollableContent" Property="Padding" Value="1,0,-1,-10"/>
            </MultiDataTrigger>
            
            <!-- MOD_ACS: Add margin to Decorative Stroke to hide bottom stroke line when PreparedSpellsSection is visible -->
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding ParentState, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel"/>
                    <Condition Binding="{Binding Visibility, ElementName=PreparedSpellsSectionOpening}" Value="Visible"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="ClassSectionDecorativeStroke" Property="Margin" Value="15,4,15,-50"/>
            </MultiDataTrigger>

            <!-- MOD_ACS: One line top bar when no subclass or classResources // Disable row switch cause there is not enough width space-->
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding ParentState, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel"/>
                    <Condition Binding="{Binding Visibility, ElementName=SubClassContainer}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=ClassResourcesContainer}" Value="Collapsed"/>
                </MultiDataTrigger.Conditions>
                <!-- BG3: <Setter TargetName="CastAbilityContainer" Property="Grid.Row" Value="0"/> -->
                <!-- BG3: <Setter TargetName="SpellDCContainer" Property="Grid.Row" Value="0"/> -->
                <!-- BG3: <Setter TargetName="SpellAttackContainer" Property="Grid.Row" Value="0"/> -->
            </MultiDataTrigger>            
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding ParentState, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel"/>
                    <Condition Binding="{Binding Visibility, ElementName=SubClassContainer}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=CastAbilityContainer}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=SpellDCContainer}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=SpellAttackContainer}" Value="Collapsed"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="ClassResourcesContainer" Property="Grid.Row" Value="0"/>
                <Setter TargetName="ClassResourcesContainer" Property="Grid.Column" Value="1"/>
            </MultiDataTrigger>

            <!-- MOD_ACS: Extends CastAbility when no ClassResources -->
            <MultiDataTrigger>
            <MultiDataTrigger.Conditions>
                <Condition Binding="{Binding ParentState, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel"/>
                <Condition Binding="{Binding Visibility, ElementName=ClassResourcesContainer}" Value="Collapsed"/>
            </MultiDataTrigger.Conditions>
            <Setter TargetName="CastAbilityContainer" Property="Grid.Column" Value="0"/>
            <Setter TargetName="CastAbilityContainer" Property="Grid.ColumnSpan" Value="2"/>
            </MultiDataTrigger>
            
            <!-- MOD_ACS: Extends ClassResources when no spells -->
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding ParentState, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel"/>
                    <Condition Binding="{Binding Visibility, ElementName=CastAbilityContainer}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=SpellDCContainer}" Value="Collapsed"/>
                    <Condition Binding="{Binding Visibility, ElementName=SpellAttackContainer}" Value="Collapsed"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="ClassResourcesContainer" Property="Grid.ColumnSpan" Value="6"/>
            </MultiDataTrigger>

            <!-- MOD_ACS: RE-ENABLING class and tadpole feats-->
            <!-- JMoya: We still don't know if feats will make it or not, so design asked to hide them for now while they decide -->
            <!-- BG3:
            <DataTrigger Binding="{Binding Source='True'}" Value="True">
                <Setter TargetName="FeatsList" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="TadpoleFeatsList" Property="Visibility" Value="Collapsed"/>
            </DataTrigger>
            -->
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <!-- ============================================================================ -->
    <!-- ===================== CHARACTER INFORMATION TEMPLATES ====================== -->
    <!-- ============================================================================ -->



    <!--HEADER LABEL STYLES-->
    <ControlTemplate x:Key="decoratedHeader">
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
            <StackPanel.Resources>
                <BitmapImage x:Key="decor_header">pack://application:,,,/GustavNoesisGUI;component/Assets/CC/decor_header.png</BitmapImage>
            </StackPanel.Resources>
            <Image Source="{StaticResource decor_header}" Stretch="None"/>
            <ContentPresenter Margin="30,0,30,0"/>
            <Image Source="{StaticResource decor_header}" Stretch="None">
                <Image.RenderTransform>
                    <ScaleTransform ScaleX="-1" CenterX="42"/>
                </Image.RenderTransform>
            </Image>
        </StackPanel>
    </ControlTemplate>

    <Style x:Key="BaseTitleStyle" TargetType="ContentControl">
        <Style.Resources>
            <Style TargetType="TextBlock" >
                <Setter Property="FontSize" Value="{DynamicResource ScaledMediumFontSize}"/>
                <Setter Property="Foreground" Value="{StaticResource LS_accent100TxtColor}"/>
            </Style>
        </Style.Resources>
        <Setter Property="Margin" Value="0,20,0,10"/>
        <Setter Property="Template" Value="{StaticResource decoratedHeader}"/>
    </Style>
    
    <!-- MOD_ACS: Add Style BaseTitleStyle for CS -->
    <Style x:Key="ACS_CS_BaseTitleStyle" TargetType="ContentControl">
        <Style.Resources>
            <Style TargetType="TextBlock" >
                <Setter Property="FontSize" Value="{DynamicResource ScaledMediumFontSize}"/>
                <Setter Property="Foreground" Value="{StaticResource LS_accent100TxtColor}"/>
            </Style>
        </Style.Resources>
        <Setter Property="Margin" Value="0,-1,0,-1"/>
        <Setter Property="Template" Value="{StaticResource decoratedHeader}"/>
    </Style>

    <!--=== ABILITIES TEMPLATE ===-->
    <Style x:Key="AbilitiesGridStyle" TargetType="ItemsControl">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate>
                    <ItemsPresenter/>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="ItemsPanel">
            <Setter.Value>
                <ItemsPanelTemplate>
                    <StackPanel HorizontalAlignment="Center" Orientation="Horizontal"/>
                </ItemsPanelTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="ItemTemplate">
            <Setter.Value>
                <DataTemplate DataType="ls:VMAbility">
                    <Grid x:Name="base" MinWidth="84" MaxWidth="98">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <!-- MOD_ACS: Add CornerRadius / Update type to Border // BG3: Grid -->
                        <Border x:Name="PrimaryAbillity" Visibility="Hidden" Grid.Row="0" Background="Transparent" CornerRadius="12,12,0,0">
                            <Image Source="{StaticResource ProficientAbility}" Stretch="None"/>
                            <Grid.ToolTip>
                                <ls:LSTooltip IsHitTestVisible="False" ContentTemplate="{StaticResource PrimaryAbilityTooltipContentTemplate}" Style="{StaticResource ManagedTooltipStyle}"/>
                            </Grid.ToolTip>
                        </Border>
                        <!-- MOD_ACS: Add Border type container for CornerRadius -->
                        <Border x:Name="AbilityBlockBorder" Grid.Row="1" ToolTip="{StaticResource ManagedTooltip}" Background="Transparent" CornerRadius="12">
                            <!-- MOD_ACS: Move attributs to AbilityBlockBorder // BG3: Grid.Row="1" ToolTip="{StaticResource ManagedTooltip}" Background="Transparent" -->
                            <StackPanel x:Name="AbilityBlock">
                                <Control x:Name="attrName" Template="{StaticResource AbilityShortDisplayName}"  FontSize="{StaticResource ScaledSmallishFontSize}" Foreground="{StaticResource LS_baseTxtColor}" HorizontalAlignment="Center" Margin="4,0,4,-6"/>
                                <Grid Height="80">
                                    <Image x:Name="SavingThrowIcon" Visibility="{Binding HasSavingThrowProficiency, Converter={StaticResource BoolToVisibleConverter}}" HorizontalAlignment="Center" VerticalAlignment="Center" Source="{StaticResource SavingThrowDice}">
                                        <Image.Effect>
                                            <DropShadowEffect BlurRadius="10" ShadowDepth="0" Opacity="1" Color="{StaticResource tint00}"/>
                                        </Image.Effect>
                                    </Image>
                                    <TextBlock x:Name="value" Text="{Binding Value}" FontSize="{StaticResource ScaledDefaultFontSize}" HorizontalAlignment="Center" Foreground="{StaticResource LS_tint100}" VerticalAlignment="Center"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <DataTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True" SourceName="PrimaryAbillity">
                            <Setter TargetName="PrimaryAbillity" Property="Background" Value="{StaticResource RowBG_h}"/>
                            <!-- MOD_ACS: Update TargetName // BG3: TargetName="AbilityBlock" -->
                            <Setter TargetName="AbilityBlockBorder" Property="Background" Value="{StaticResource RowBG_h}"/>
                            <!-- MOD_ACS: Add Setter AbilityBlockBorder to match CornerRadius of bottom PrimaryAbillity -->
                            <Setter TargetName="AbilityBlockBorder" Property="CornerRadius" Value="0,0,12,12"/>
                        </Trigger>
                        <!-- MOD_ACS: Update SourceName // BG3: SourceName="AbilityBlock" -->
                        <Trigger Property="IsMouseOver" Value="True" SourceName="AbilityBlockBorder">
                            <!-- MOD_ACS: Update TargetName // BG3: TargetName="AbilityBlock" -->
                            <Setter TargetName="AbilityBlockBorder" Property="Background" Value="{StaticResource RowBG_h}"/>
                        </Trigger>
                        <DataTrigger Binding="{Binding IsPrimary}" Value="True">
                            <Setter TargetName="PrimaryAbillity" Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                    </DataTemplate.Triggers>
                </DataTemplate>
            </Setter.Value>
        </Setter>
    </Style>
    <!-- ===== INFOTIP TEMPLATE=====-->

    <ControlTemplate x:Key="CharacterSheetInfotipTemplate" TargetType="Control">
        <Grid>
            <Grid.ToolTip>
                <ls:LSTooltip ToolTipService.Placement="Top">
                    <StackPanel>
                        <TextBlock Text="{Binding Source='h9dc90f1cgd81ag487cgad09g6cdba91a98ab',Converter={StaticResource TranslatedStringConverter}}"/>

                        <!--multiselct-->
                        <TextBlock Foreground="{StaticResource LS_accent25TxtColor}" FontSize="{StaticResource MediumFontSize}">
                            <TextBlock.Text>
                                <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}" ConverterParameter="hfc7dbdafg84a6g4d45g966eg7657b2b6a3d8">
                                    <Binding Source="h4abf48b8ga4d5g49bdga7adgc3f59d1b679b" Converter="{StaticResource TranslatedStringConverter}" ConverterParameter="ToUpper"/>
                                    <Binding Source="hacf1fe53g094dg4410ga0cagd7fc54bcfb0e" Converter="{StaticResource TranslatedStringConverter}"/>
                                    <Binding Source="h1ca1b236g5282g4349gabc4g96639808464f" Converter="{StaticResource TranslatedStringConverter}"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>

                        <!--select range-->
                        <TextBlock Foreground="{StaticResource LS_accent25TxtColor}" FontSize="{StaticResource MediumFontSize}">
                            <TextBlock.Text>
                                <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}" ConverterParameter="hfc7dbdafg84a6g4d45g966eg7657b2b6a3d8">
                                    <Binding Source="hbb74f5fag4e95g4e8fgb2b8g2a761e814bd5" Converter="{StaticResource TranslatedStringConverter}" ConverterParameter="ToUpper"/>
                                    <Binding Source="hacf1fe53g094dg4410ga0cagd7fc54bcfb0e" Converter="{StaticResource TranslatedStringConverter}"/>
                                    <Binding Source="hf5138081g15f4g476ega739gb5c7e4a7c7eb" Converter="{StaticResource TranslatedStringConverter}"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>

                        <!--split stack-->
                        <TextBlock Foreground="{StaticResource LS_accent25TxtColor}" FontSize="{StaticResource MediumFontSize}">
                            <TextBlock.Text>
                                <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}" ConverterParameter="hfc7dbdafg84a6g4d45g966eg7657b2b6a3d8">
                                    <Binding Source="hbb74f5fag4e95g4e8fgb2b8g2a761e814bd5" Converter="{StaticResource TranslatedStringConverter}" ConverterParameter="ToUpper"/>
                                    <Binding Source="hbe6a4a12gcdaag4e8cga426g4cb03e0270b5" Converter="{StaticResource TranslatedStringConverter}"/>
                                    <Binding Source="h6a5ad02dg7561g4713g81dcga9d7e9949b3f" Converter="{StaticResource TranslatedStringConverter}"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>

                    </StackPanel>
                </ls:LSTooltip>
            </Grid.ToolTip>
            <Image x:Name="bg" Stretch="None" Source="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/btn_diamond_d.png"/>
            <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="i" FontSize="{StaticResource SmallFontSize}" FontStyle="Italic" Foreground="{StaticResource LS_tint100}" IsHitTestVisible="False"/>
        </Grid>
        <ControlTemplate.Triggers>
            <Trigger Property="IsMouseOver" Value="True">
                <Setter TargetName="bg" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/btn_diamond_h.png"/>
            </Trigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>



    <!-- ===== ACHOLDER TEMPLATE=====-->
    <ControlTemplate x:Key="ACHolder">
        <Grid Name="root" DataContext="{Binding Stats.ArmorClass}" Background="Transparent">
            <Grid.Resources>
                <BitmapImage x:Key="ACShield">pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EQSlots_AC.png</BitmapImage>
                <!-- MOD_ACS: Add BitmapImage silver shield -->
                <BitmapImage x:Key="ACShieldSilver">pack://application:,,,/GustavNoesisGUI;component/Assets/Tooltips/ico_AC_primary.png</BitmapImage>
            </Grid.Resources>
            <Grid.ToolTip>
                <ls:LSTooltip Content="{Binding Path=DataContext, ElementName=root}" ls:TooltipExtender.Owner="{Binding (ls:TooltipExtender.Owner), ElementName=root}"/>
            </Grid.ToolTip>
            <!-- MOD_ACS: Add Width & Height / Update Stretch / Remove Effect // BG3: Stretch="None" -->
            <Image Stretch="Uniform" Source="{StaticResource ACShield}" Width="112" Height="108">
                <!-- BG3: 
                <Image.Effect>
                    <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="1" Color="{StaticResource tint00}"/>
                </Image.Effect> -->
            </Image>
            <!-- MOD_ACS: Add Image silver shield -->
            <Image Stretch="None" Source="{StaticResource ACShieldSilver}">
                <Image.Effect>
                    <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="1" Color="{StaticResource tint00}"/>
                </Image.Effect>
            </Image>
            <!-- MOD_ACS: Update Margin // BG3: Margin="0,-18,0,0" -->
            <StackPanel VerticalAlignment="Center" Margin="0,-10,0,0">
                <!-- MOD_ACS: Disable TextBlock title 'CA' -->
                <!-- <TextBlock Text="{Binding Source='hc2ca2d88gc99cg4361g801fgd34ecdb85f19',Converter={StaticResource TranslatedStringConverter}}" Foreground="{StaticResource LS_tint100}" FontSize="{StaticResource SmallFontSize}" HorizontalAlignment="Center"/> -->
                <TextBlock Foreground="{StaticResource LS_tint100}" FontSize="{StaticResource ScaledTitleFontSize}" Text="{Binding Value}" HorizontalAlignment="Center" Margin="0,-16"/>
            </StackPanel>
        </Grid>
    </ControlTemplate>

    <!-- ===== CONDITIONS LIST TEMPLATE =====--> 
    <DataTemplate x:Key="StatusListItemTemplate" DataType="{x:Type ls:VMStatus}">
        <DataTemplate.Resources>
            <BitmapImage x:Key="statusBG" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/TargetInfo/statusBG.png"/>
            <BitmapImage x:Key="statusBG_fill" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/TargetInfo/statusBG_fill.png"/>
        </DataTemplate.Resources>
        <Border Name="root" Style="{StaticResource RowBG_d}" ToolTip="{StaticResource ManagedTooltip}">
            <!-- MOD_ACS: Add Name / Update Height // BG3: Height="56" -->
            <Grid x:Name="StatusGrid" Height="50">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <!-- MOD_ACS: Add Name / Update Margin // BG3: Margin="8,4,8,4" -->
                <Grid x:Name="StatusIconGrid" Margin="8,2,8,2">
                    <Image Source="{StaticResource statusBG}" Stretch="Uniform" VerticalAlignment="Center"/>

                    <ls:LSPie Value="{Binding RemainingPercentage}" SweepDirection="Clockwise">
                        <Image Source="{StaticResource statusBG_fill}" Stretch="Uniform"/>
                    </ls:LSPie>

                    <!-- MOD_ACS: Add Name / Update Style // BG3: SummaryRoundIcons -->
                    <Rectangle x:Name="IconRectangle" Style="{StaticResource SummaryRoundIconsConditionsAndFeats}" Fill="{Binding Icon}"/>

                    <!-- MOD_ACS: Update FontSize // BG3: FontSize="{DynamicResource ScaledSmallFontSize}" -->
                    <TextBlock Text="{Binding Duration}" VerticalAlignment="Bottom" HorizontalAlignment="Center" Margin="0,0,0,-12" Foreground="{StaticResource LS_PrimaryColor}"
                               noesis:Text.Stroke="{StaticResource LS_PrimaryColorOutlineColor}" noesis:Text.StrokeThickness="6" Style="{StaticResource NarrowTooltipModifierText}"
                               Visibility="{Binding Duration, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=0}" FontSize="{DynamicResource ScaledMiniFontSize}"/>
                </Grid>
                <!-- MOD_ACS: Update Style // BG3: SummaryListText -->
                <TextBlock x:Name="NameLabel" Grid.Column="1" Text="{Binding Name}" Style="{StaticResource SummaryListTextConditionsAndFeats}" TextTrimming="CharacterEllipsis"/>
            </Grid>
        </Border>
        <DataTemplate.Triggers>
            <Trigger Property="IsMouseOver" SourceName="root" Value="True">
                <Setter TargetName="root" Property="Background" Value="{StaticResource RowBG_h}"/>
                <Setter TargetName="NameLabel" Property="Foreground" Value="{StaticResource LS_tint100}"/>
            </Trigger>
        </DataTemplate.Triggers>

    </DataTemplate>

    <!-- ===== RESISTANCES ICONS =====-->
    <ControlTemplate x:Key="ResistanceIcon" TargetType="Control">
        <Image x:Name="Icon" Stretch="None" Source="{x:Null}"/>
        <ControlTemplate.Triggers>
            <DataTrigger Binding="{Binding DamageType}" Value="Slashing">
                <Setter TargetName="Icon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ico_resistance_slashing.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding DamageType}" Value="Piercing">
                <Setter TargetName="Icon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ico_resistance_piercing.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding DamageType}" Value="Bludgeoning">
                <Setter TargetName="Icon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ico_resistance_blunt.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding DamageType}" Value="Acid">
                <Setter TargetName="Icon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ico_resistance_acid.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding DamageType}" Value="Thunder">
                <Setter TargetName="Icon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ico_resistance_thunder.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding DamageType}" Value="Necrotic">
                <Setter TargetName="Icon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ico_resistance_necrotic.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding DamageType}" Value="Fire">
                <Setter TargetName="Icon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ico_resistance_fire.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding DamageType}" Value="Lightning">
                <Setter TargetName="Icon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ico_resistance_lightning.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding DamageType}" Value="Cold">
                <Setter TargetName="Icon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ico_resistance_cold.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding DamageType}" Value="Psychic">
                <Setter TargetName="Icon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ico_resistance_psychic.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding DamageType}" Value="Poison">
                <Setter TargetName="Icon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ico_resistance_poison.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding DamageType}" Value="Radiant">
                <Setter TargetName="Icon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ico_resistance_radiant.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding DamageType}" Value="Force">
                <Setter TargetName="Icon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ico_resistance_force.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding DamageType}" Value="Spell">
                <Setter TargetName="Icon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ico_resistance_spell.png"/>
            </DataTrigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <!-- ========================================= -->
    <!-- ===== MOD_ACS: Resistances - START ===== -->
        
    <!-- === MOD_ACS: Control Templates === -->
    
    <!-- MOD_ACS: ImmuneShield -->
    <ControlTemplate x:Key="CtrlImmuneShield" TargetType="Control">
        <Image x:Name="ImmuneShield" Source="{StaticResource ImmuneShield}" Stretch="None" Visibility="Hidden"/>
        <ControlTemplate.Triggers>
            <DataTrigger Binding="{Binding NonMagical}" Value="Immune">
                <Setter TargetName="ImmuneShield" Property="Visibility" Value="Visible"/>
                <Setter TargetName="ImmuneShield" Property="Source" Value="{StaticResource ImmuneNonMagicalShield}"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding Magical}" Value="Immune">
                <Setter TargetName="ImmuneShield" Property="Visibility" Value="Visible"/>
                <Setter TargetName="ImmuneShield" Property="Source" Value="{StaticResource ImmuneMagicalShield}"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding Full}" Value="Immune">
                <Setter TargetName="ImmuneShield" Property="Visibility" Value="Visible"/>
                <Setter TargetName="ImmuneShield" Property="Source" Value="{StaticResource ImmuneShield}"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding Full}" Value="Vulnerable">
                <Setter TargetName="ImmuneShield" Property="Visibility" Value="Visible"/>
                <Setter TargetName="ImmuneShield" Property="Source" Value="{StaticResource Vulnerable}"/>
            </DataTrigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>
    
        <!-- MOD_ACS: Resistant NonMagical -->
        <ControlTemplate x:Key="CtrlNonMagicalArrow" TargetType="Control">
            <Image x:Name="NonMagicalArrow" HorizontalAlignment="Center" VerticalAlignment="center" Source="{StaticResource ResistantNonMagical}" Stretch="None" Margin="0,8,0,0" Visibility="Collapsed"/>
            <ControlTemplate.Triggers>
                <DataTrigger Binding="{Binding NonMagical}" Value="Resistant">
                    <Setter TargetName="NonMagicalArrow" Property="Visibility" Value="Visible"/>
                </DataTrigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>
        
        <!-- MOD_ACS: Resistant Magical -->
        <ControlTemplate x:Key="CtrlMagicalArrow" TargetType="Control">
            <Image x:Name="MagicalArrow" HorizontalAlignment="Center" VerticalAlignment="center" Source="{StaticResource ResistantMagical}" Stretch="None" Margin="0,10,0,0" Visibility="Collapsed"/>
            <ControlTemplate.Triggers>
                <DataTrigger Binding="{Binding Magical}" Value="Resistant">
                    <Setter TargetName="MagicalArrow" Property="Visibility" Value="Visible"/>
                    <Setter TargetName="MagicalArrow" Property="Margin" Value="0,10,0,0"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Full}" Value="Resistant">
                    <Setter TargetName="MagicalArrow" Property="Source" Value="{StaticResource ResistantMagicalShieldShort}"/>
                    <Setter TargetName="MagicalArrow" Property="Margin" Value="0,-4,0,0"/>
                </DataTrigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>
        
        <!-- MOD_ACS: NoShield -->
        <ControlTemplate x:Key="CtrlNoShield" TargetType="Control">
            <Image x:Name="NoShield" Source="{StaticResource ResistanceNone}" Stretch="None" Visibility="Hidden"/>
            <ControlTemplate.Triggers>
                <MultiDataTrigger>
                    <MultiDataTrigger.Conditions>
                        <Condition Binding="{Binding Full}" Value="None"/>
                        <Condition Binding="{Binding NonMagical}" Value="None"/>
                        <Condition Binding="{Binding Magical}" Value="None"/>
                    </MultiDataTrigger.Conditions>
                    <Setter TargetName="NoShield" Property="Visibility" Value="Visible"/>
                </MultiDataTrigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>
        
        <!-- MOD_ACS: Hourglass -->
        <ControlTemplate x:Key="CtrlHourglass" TargetType="Control">
            <ControlTemplate.Resources>
                <BitmapImage x:Key="hourglass" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/ico_resistance_hourglass.png"/>
            </ControlTemplate.Resources>
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Bottom" Orientation="Horizontal" Visibility="{Binding Duration, Converter={StaticResource CountToVisibilityConverter}}" Margin="0,0,0,-8" IsHitTestVisible="False">
                <Image Stretch="None" Source="{StaticResource hourglass}" VerticalAlignment="Center" Margin="0,0,-4,0"/>
                <TextBlock Text="{Binding Duration}" Foreground="{StaticResource LS_tint100}" FontFamily="{StaticResource DefaultFont}" FontSize="{StaticResource SmallishFontSize}" VerticalAlignment="Center"/>
            </StackPanel>
        </ControlTemplate>
        

    
    <!-- ===== RESISTANCES GRID TEMPLATE=====-->
    <ControlTemplate x:Key="ResistancesGridTemplate">
        
        <ControlTemplate.Resources>
            <!-- MOD_ACS: StatusEndingStoryboard -->
            <Storyboard x:Key="ResourceStatusEndingStoryboard">
                <DoubleAnimationUsingKeyFrames Storyboard.TargetName="Object" Storyboard.TargetProperty="Opacity" AutoReverse="True" RepeatBehavior="Forever">
                    <EasingDoubleKeyFrame KeyTime="0" Value="1"/>

                    <EasingDoubleKeyFrame KeyTime="0:0:.5" Value="1"/>

                    <EasingDoubleKeyFrame KeyTime="0:0:1.25" Value="0.6">
                        <EasingDoubleKeyFrame.EasingFunction>
                            <CubicEase EasingMode="EaseOut"/>
                        </EasingDoubleKeyFrame.EasingFunction>
                    </EasingDoubleKeyFrame>

                    <EasingDoubleKeyFrame KeyTime="0:0:1.75" Value="0.6"/>

                    <EasingDoubleKeyFrame KeyTime="0:0:2.25" Value="1">
                        <EasingDoubleKeyFrame.EasingFunction>
                            <CubicEase EasingMode="EaseOut"/>
                        </EasingDoubleKeyFrame.EasingFunction>
                    </EasingDoubleKeyFrame>

                    <EasingDoubleKeyFrame KeyTime="0:0:2.75" Value="1"/>
                </DoubleAnimationUsingKeyFrames>
            </Storyboard>
        </ControlTemplate.Resources>
        
        <StackPanel Orientation="Vertical" HorizontalAlignment="Center">
            
            <Grid Name="ResistanceEmpty" Visibility="{Binding Visibility, ElementName=ResistancesSlashing, Converter={StaticResource InvertVisibilityConverter}}">
                <Image HorizontalAlignment="Center" Stretch="None" Source="{StaticResource NoResistanceIcon}"/>
                <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="{StaticResource LS_accent100TxtColor}" Text="{Binding Source='h529efdfdgda98g4ed3g8d1eg46cbf1d0a5e3', Converter={StaticResource TranslatedStringConverter}}"/>
            </Grid>
            
            <!-- MOD_ACS: Row 1 => Slashing / Bludgeoning / Piercing -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,-4">
                
                <!-- MOD_ACS: Slashing -->
                <ItemsControl x:Name="ResistancesSlashing" ItemsSource="{Binding Stats.Resistances}" Visibility="{Binding Stats.NumActiveResistances, Converter={StaticResource CountToVisibilityConverter}}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                                
                            <Grid x:Name="Object" Tag="Immune" ToolTip="{StaticResource ManagedTooltip}" Background="Transparent" Visibility="Collapsed" Margin="-2,0">
                                <Grid HorizontalAlignment="Center" Margin="0,10,0,0">
                                    <Control x:Name="ImmuneShield" Template="{StaticResource CtrlImmuneShield}" />
                                    <Control x:Name="TypIcon" HorizontalAlignment="Center" VerticalAlignment="Center" Template="{StaticResource ResistanceIcon}" />
                                    <Control x:Name="NoShield" Template="{StaticResource CtrlNoShield}" />
                                </Grid>
                                <Control x:Name="NonMagicalArrow" Template="{StaticResource CtrlNonMagicalArrow}" />
                                <Control x:Name="MagicalArrow" Template="{StaticResource CtrlMagicalArrow}" />
                                <Control x:Name="Hourglass" Template="{StaticResource CtrlHourglass}" />
                            </Grid>

                            <DataTemplate.Triggers>
                                
                                <!-- MOD_ACS: Control physical slashing visibility -->
                                <DataTrigger Binding="{Binding DamageType}" Value="Slashing">
                                    <Setter TargetName="Object" Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                                
                                <DataTrigger Binding="{Binding Duration}" Value="1">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard x:Name="StatusEndingStoryboard" Storyboard="{StaticResource ResourceStatusEndingStoryboard}" />
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <StopStoryboard BeginStoryboardName="StatusEndingStoryboard" />
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                                
                            </DataTemplate.Triggers>
                            
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                
                <!-- MOD_ACS: Bludgeoning -->
                <ItemsControl x:Name="ResistanceBludgeoning" ItemsSource="{Binding Stats.Resistances}" Visibility="{Binding Stats.NumActiveResistances, Converter={StaticResource CountToVisibilityConverter}}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                                
                            <Grid x:Name="Object" Tag="Immune" ToolTip="{StaticResource ManagedTooltip}" Background="Transparent" Visibility="Collapsed" Margin="-2,0">
                                <Grid HorizontalAlignment="Center" Margin="0,10,0,0">
                                    <Control x:Name="ImmuneShield" Template="{StaticResource CtrlImmuneShield}" />
                                    <Control x:Name="TypIcon" HorizontalAlignment="Center" VerticalAlignment="Center" Template="{StaticResource ResistanceIcon}" />
                                    <Control x:Name="NoShield" Template="{StaticResource CtrlNoShield}" />
                                </Grid>
                                <Control x:Name="NonMagicalArrow" Template="{StaticResource CtrlNonMagicalArrow}" />
                                <Control x:Name="MagicalArrow" Template="{StaticResource CtrlMagicalArrow}" />
                                <Control x:Name="Hourglass" Template="{StaticResource CtrlHourglass}" />
                            </Grid>

                            <DataTemplate.Triggers>
                                
                                <!-- MOD_ACS: Control physical bludgeoning visibility -->
                                <DataTrigger Binding="{Binding DamageType}" Value="Bludgeoning">
                                    <Setter TargetName="Object" Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                                
                                <DataTrigger Binding="{Binding Duration}" Value="1">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard x:Name="StatusEndingStoryboard" Storyboard="{StaticResource ResourceStatusEndingStoryboard}" />
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <StopStoryboard BeginStoryboardName="StatusEndingStoryboard" />
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                                
                            </DataTemplate.Triggers>
                            
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                
                <!-- MOD_ACS: Piercing -->
                <ItemsControl x:Name="ResistancePiercing" ItemsSource="{Binding Stats.Resistances}" Visibility="{Binding Stats.NumActiveResistances, Converter={StaticResource CountToVisibilityConverter}}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                                
                            <Grid x:Name="Object" Tag="Immune" ToolTip="{StaticResource ManagedTooltip}" Background="Transparent" Visibility="Collapsed" Margin="-2,0">
                                <Grid HorizontalAlignment="Center" Margin="0,10,0,0">
                                    <Control x:Name="ImmuneShield" Template="{StaticResource CtrlImmuneShield}" />
                                    <Control x:Name="TypIcon" HorizontalAlignment="Center" VerticalAlignment="Center" Template="{StaticResource ResistanceIcon}" />
                                    <Control x:Name="NoShield" Template="{StaticResource CtrlNoShield}" />
                                </Grid>
                                <Control x:Name="NonMagicalArrow" Template="{StaticResource CtrlNonMagicalArrow}" />
                                <Control x:Name="MagicalArrow" Template="{StaticResource CtrlMagicalArrow}" />
                                <Control x:Name="Hourglass" Template="{StaticResource CtrlHourglass}" />
                            </Grid>

                            <DataTemplate.Triggers>
                                
                                <!-- MOD_ACS: Control physical piercing visibility -->
                                <DataTrigger Binding="{Binding DamageType}" Value="Piercing">
                                    <Setter TargetName="Object" Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                                
                                <DataTrigger Binding="{Binding Duration}" Value="1">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard x:Name="StatusEndingStoryboard" Storyboard="{StaticResource ResourceStatusEndingStoryboard}" />
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <StopStoryboard BeginStoryboardName="StatusEndingStoryboard" />
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                                
                            </DataTemplate.Triggers>
                            
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                
            </StackPanel>

            <!-- MOD_ACS: Row 2 => Fire / Cold / Lightning / Thunder / Force -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,-4">
                
                <!-- MOD_ACS: Fire -->
                <ItemsControl x:Name="ResistanceFire" ItemsSource="{Binding Stats.Resistances}" Visibility="{Binding Stats.NumActiveResistances, Converter={StaticResource CountToVisibilityConverter}}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                                
                            <Grid x:Name="Object" Tag="Immune" ToolTip="{StaticResource ManagedTooltip}" Background="Transparent" Visibility="Collapsed" Margin="-2,0">
                                <Grid HorizontalAlignment="Center" Margin="0,10,0,0">
                                    <Control x:Name="ImmuneShield" Template="{StaticResource CtrlImmuneShield}" />
                                    <Control x:Name="TypIcon" HorizontalAlignment="Center" VerticalAlignment="Center" Template="{StaticResource ResistanceIcon}" />
                                    <Control x:Name="NoShield" Template="{StaticResource CtrlNoShield}" />
                                </Grid>
                                <Control x:Name="NonMagicalArrow" Template="{StaticResource CtrlNonMagicalArrow}" />
                                <Control x:Name="MagicalArrow" Template="{StaticResource CtrlMagicalArrow}" />
                                <Control x:Name="Hourglass" Template="{StaticResource CtrlHourglass}" />
                            </Grid>

                            <DataTemplate.Triggers>
                                
                                <!-- MOD_ACS: Control fire visibility -->
                                <DataTrigger Binding="{Binding DamageType}" Value="Fire">
                                    <Setter TargetName="Object" Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                                
                                <DataTrigger Binding="{Binding Duration}" Value="1">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard x:Name="StatusEndingStoryboard" Storyboard="{StaticResource ResourceStatusEndingStoryboard}" />
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <StopStoryboard BeginStoryboardName="StatusEndingStoryboard" />
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                                
                            </DataTemplate.Triggers>
                            
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                
                <!-- MOD_ACS: Cold -->
                <ItemsControl x:Name="ResistanceCold" ItemsSource="{Binding Stats.Resistances}" Visibility="{Binding Stats.NumActiveResistances, Converter={StaticResource CountToVisibilityConverter}}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                                
                            <Grid x:Name="Object" Tag="Immune" ToolTip="{StaticResource ManagedTooltip}" Background="Transparent" Visibility="Collapsed" Margin="-2,0">
                                <Grid HorizontalAlignment="Center" Margin="0,10,0,0">
                                    <Control x:Name="ImmuneShield" Template="{StaticResource CtrlImmuneShield}" />
                                    <Control x:Name="TypIcon" HorizontalAlignment="Center" VerticalAlignment="Center" Template="{StaticResource ResistanceIcon}" />
                                    <Control x:Name="NoShield" Template="{StaticResource CtrlNoShield}" />
                                </Grid>
                                <Control x:Name="NonMagicalArrow" Template="{StaticResource CtrlNonMagicalArrow}" />
                                <Control x:Name="MagicalArrow" Template="{StaticResource CtrlMagicalArrow}" />
                                <Control x:Name="Hourglass" Template="{StaticResource CtrlHourglass}" />
                            </Grid>

                            <DataTemplate.Triggers>
                                
                                <!-- MOD_ACS: Control cold visibility -->
                                <DataTrigger Binding="{Binding DamageType}" Value="Cold">
                                    <Setter TargetName="Object" Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                                
                                <DataTrigger Binding="{Binding Duration}" Value="1">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard x:Name="StatusEndingStoryboard" Storyboard="{StaticResource ResourceStatusEndingStoryboard}" />
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <StopStoryboard BeginStoryboardName="StatusEndingStoryboard" />
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                                
                            </DataTemplate.Triggers>
                            
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                
                <!-- MOD_ACS: Lightning -->
                <ItemsControl x:Name="ResistanceLightning" ItemsSource="{Binding Stats.Resistances}" Visibility="{Binding Stats.NumActiveResistances, Converter={StaticResource CountToVisibilityConverter}}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                                
                            <Grid x:Name="Object" Tag="Immune" ToolTip="{StaticResource ManagedTooltip}" Background="Transparent" Visibility="Collapsed" Margin="-2,0">
                                <Grid HorizontalAlignment="Center" Margin="0,10,0,0">
                                    <Control x:Name="ImmuneShield" Template="{StaticResource CtrlImmuneShield}" />
                                    <Control x:Name="TypIcon" HorizontalAlignment="Center" VerticalAlignment="Center" Template="{StaticResource ResistanceIcon}" />
                                    <Control x:Name="NoShield" Template="{StaticResource CtrlNoShield}" />
                                </Grid>
                                <Control x:Name="NonMagicalArrow" Template="{StaticResource CtrlNonMagicalArrow}" />
                                <Control x:Name="MagicalArrow" Template="{StaticResource CtrlMagicalArrow}" />
                                <Control x:Name="Hourglass" Template="{StaticResource CtrlHourglass}" />
                            </Grid>

                            <DataTemplate.Triggers>
                                
                                <!-- MOD_ACS: Control lightning visibility -->
                                <DataTrigger Binding="{Binding DamageType}" Value="Lightning">
                                    <Setter TargetName="Object" Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                                
                                <DataTrigger Binding="{Binding Duration}" Value="1">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard x:Name="StatusEndingStoryboard" Storyboard="{StaticResource ResourceStatusEndingStoryboard}" />
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <StopStoryboard BeginStoryboardName="StatusEndingStoryboard" />
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                                
                            </DataTemplate.Triggers>
                            
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                
                <!-- MOD_ACS: Thunder -->
                <ItemsControl x:Name="ResistanceThunder" ItemsSource="{Binding Stats.Resistances}" Visibility="{Binding Stats.NumActiveResistances, Converter={StaticResource CountToVisibilityConverter}}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                                
                            <Grid x:Name="Object" Tag="Immune" ToolTip="{StaticResource ManagedTooltip}" Background="Transparent" Visibility="Collapsed" Margin="-2,0">
                                <Grid HorizontalAlignment="Center" Margin="0,10,0,0">
                                    <Control x:Name="ImmuneShield" Template="{StaticResource CtrlImmuneShield}" />
                                    <Control x:Name="TypIcon" HorizontalAlignment="Center" VerticalAlignment="Center" Template="{StaticResource ResistanceIcon}" />
                                    <Control x:Name="NoShield" Template="{StaticResource CtrlNoShield}" />
                                </Grid>
                                <Control x:Name="NonMagicalArrow" Template="{StaticResource CtrlNonMagicalArrow}" />
                                <Control x:Name="MagicalArrow" Template="{StaticResource CtrlMagicalArrow}" />
                                <Control x:Name="Hourglass" Template="{StaticResource CtrlHourglass}" />
                            </Grid>

                            <DataTemplate.Triggers>
                                
                                <!-- MOD_ACS: Control thunder visibility -->
                                <DataTrigger Binding="{Binding DamageType}" Value="Thunder">
                                    <Setter TargetName="Object" Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                                
                                <DataTrigger Binding="{Binding Duration}" Value="1">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard x:Name="StatusEndingStoryboard" Storyboard="{StaticResource ResourceStatusEndingStoryboard}" />
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <StopStoryboard BeginStoryboardName="StatusEndingStoryboard" />
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                                
                            </DataTemplate.Triggers>
                            
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                
                <!-- MOD_ACS: Force -->
                <ItemsControl x:Name="ResistanceForce" ItemsSource="{Binding Stats.Resistances}" Visibility="{Binding Stats.NumActiveResistances, Converter={StaticResource CountToVisibilityConverter}}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                                
                            <Grid x:Name="Object" Tag="Immune" ToolTip="{StaticResource ManagedTooltip}" Background="Transparent" Visibility="Collapsed" Margin="-2,0">
                                <Grid HorizontalAlignment="Center" Margin="0,10,0,0">
                                    <Control x:Name="ImmuneShield" Template="{StaticResource CtrlImmuneShield}" />
                                    <Control x:Name="TypIcon" HorizontalAlignment="Center" VerticalAlignment="Center" Template="{StaticResource ResistanceIcon}" />
                                    <Control x:Name="NoShield" Template="{StaticResource CtrlNoShield}" />
                                </Grid>
                                <Control x:Name="NonMagicalArrow" Template="{StaticResource CtrlNonMagicalArrow}" />
                                <Control x:Name="MagicalArrow" Template="{StaticResource CtrlMagicalArrow}" />
                                <Control x:Name="Hourglass" Template="{StaticResource CtrlHourglass}" />
                            </Grid>

                            <DataTemplate.Triggers>
                                
                                <!-- MOD_ACS: Control force visibility -->
                                <DataTrigger Binding="{Binding DamageType}" Value="Force">
                                    <Setter TargetName="Object" Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                                
                                <DataTrigger Binding="{Binding Duration}" Value="1">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard x:Name="StatusEndingStoryboard" Storyboard="{StaticResource ResourceStatusEndingStoryboard}" />
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <StopStoryboard BeginStoryboardName="StatusEndingStoryboard" />
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                                
                            </DataTemplate.Triggers>
                            
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                
            </StackPanel>
            
            
            <!-- MOD_ACS: Row 3 => Poison / Acid / Necrotic / Radiant / Psychic -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,-4">
                
                <!-- MOD_ACS: Poison -->
                <ItemsControl x:Name="ResistancePoison" ItemsSource="{Binding Stats.Resistances}" Visibility="{Binding Stats.NumActiveResistances, Converter={StaticResource CountToVisibilityConverter}}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                                
                            <Grid x:Name="Object" Tag="Immune" ToolTip="{StaticResource ManagedTooltip}" Background="Transparent" Visibility="Collapsed" Margin="-2,0">
                                <Grid HorizontalAlignment="Center" Margin="0,10,0,0">
                                    <Control x:Name="ImmuneShield" Template="{StaticResource CtrlImmuneShield}" />
                                    <Control x:Name="TypIcon" HorizontalAlignment="Center" VerticalAlignment="Center" Template="{StaticResource ResistanceIcon}" />
                                    <Control x:Name="NoShield" Template="{StaticResource CtrlNoShield}" />
                                </Grid>
                                <Control x:Name="NonMagicalArrow" Template="{StaticResource CtrlNonMagicalArrow}" />
                                <Control x:Name="MagicalArrow" Template="{StaticResource CtrlMagicalArrow}" />
                                <Control x:Name="Hourglass" Template="{StaticResource CtrlHourglass}" />
                            </Grid>

                            <DataTemplate.Triggers>
                                
                                <!-- MOD_ACS: Control poison visibility -->
                                <DataTrigger Binding="{Binding DamageType}" Value="Poison">
                                    <Setter TargetName="Object" Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                                
                                <DataTrigger Binding="{Binding Duration}" Value="1">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard x:Name="StatusEndingStoryboard" Storyboard="{StaticResource ResourceStatusEndingStoryboard}" />
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <StopStoryboard BeginStoryboardName="StatusEndingStoryboard" />
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                                
                            </DataTemplate.Triggers>
                            
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                
                <!-- MOD_ACS: Acid -->
                <ItemsControl x:Name="ResistanceAcid" ItemsSource="{Binding Stats.Resistances}" Visibility="{Binding Stats.NumActiveResistances, Converter={StaticResource CountToVisibilityConverter}}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                                
                            <Grid x:Name="Object" Tag="Immune" ToolTip="{StaticResource ManagedTooltip}" Background="Transparent" Visibility="Collapsed" Margin="-2,0">
                                <Grid HorizontalAlignment="Center" Margin="0,10,0,0">
                                    <Control x:Name="ImmuneShield" Template="{StaticResource CtrlImmuneShield}" />
                                    <Control x:Name="TypIcon" HorizontalAlignment="Center" VerticalAlignment="Center" Template="{StaticResource ResistanceIcon}" />
                                    <Control x:Name="NoShield" Template="{StaticResource CtrlNoShield}" />
                                </Grid>
                                <Control x:Name="NonMagicalArrow" Template="{StaticResource CtrlNonMagicalArrow}" />
                                <Control x:Name="MagicalArrow" Template="{StaticResource CtrlMagicalArrow}" />
                                <Control x:Name="Hourglass" Template="{StaticResource CtrlHourglass}" />
                            </Grid>

                            <DataTemplate.Triggers>
                                
                                <!-- MOD_ACS: Control acid visibility -->
                                <DataTrigger Binding="{Binding DamageType}" Value="Acid">
                                    <Setter TargetName="Object" Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                                
                                <DataTrigger Binding="{Binding Duration}" Value="1">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard x:Name="StatusEndingStoryboard" Storyboard="{StaticResource ResourceStatusEndingStoryboard}" />
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <StopStoryboard BeginStoryboardName="StatusEndingStoryboard" />
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                                
                            </DataTemplate.Triggers>
                            
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                
                <!-- MOD_ACS: Necrotic -->
                <ItemsControl x:Name="ResistanceNecrotic" ItemsSource="{Binding Stats.Resistances}" Visibility="{Binding Stats.NumActiveResistances, Converter={StaticResource CountToVisibilityConverter}}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                                
                            <Grid x:Name="Object" Tag="Immune" ToolTip="{StaticResource ManagedTooltip}" Background="Transparent" Visibility="Collapsed" Margin="-2,0">
                                <Grid HorizontalAlignment="Center" Margin="0,10,0,0">
                                    <Control x:Name="ImmuneShield" Template="{StaticResource CtrlImmuneShield}" />
                                    <Control x:Name="TypIcon" HorizontalAlignment="Center" VerticalAlignment="Center" Template="{StaticResource ResistanceIcon}" />
                                    <Control x:Name="NoShield" Template="{StaticResource CtrlNoShield}" />
                                </Grid>
                                <Control x:Name="NonMagicalArrow" Template="{StaticResource CtrlNonMagicalArrow}" />
                                <Control x:Name="MagicalArrow" Template="{StaticResource CtrlMagicalArrow}" />
                                <Control x:Name="Hourglass" Template="{StaticResource CtrlHourglass}" />
                            </Grid>

                            <DataTemplate.Triggers>
                                
                                <!-- MOD_ACS: Control necrotic visibility -->
                                <DataTrigger Binding="{Binding DamageType}" Value="Necrotic">
                                    <Setter TargetName="Object" Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                                
                                <DataTrigger Binding="{Binding Duration}" Value="1">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard x:Name="StatusEndingStoryboard" Storyboard="{StaticResource ResourceStatusEndingStoryboard}" />
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <StopStoryboard BeginStoryboardName="StatusEndingStoryboard" />
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                                
                            </DataTemplate.Triggers>
                            
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                
                <!-- MOD_ACS: Radiant -->
                <ItemsControl x:Name="ResistanceRadiant" ItemsSource="{Binding Stats.Resistances}" Visibility="{Binding Stats.NumActiveResistances, Converter={StaticResource CountToVisibilityConverter}}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                                
                            <Grid x:Name="Object" Tag="Immune" ToolTip="{StaticResource ManagedTooltip}" Background="Transparent" Visibility="Collapsed" Margin="-2,0">
                                <Grid HorizontalAlignment="Center" Margin="0,10,0,0">
                                    <Control x:Name="ImmuneShield" Template="{StaticResource CtrlImmuneShield}" />
                                    <Control x:Name="TypIcon" HorizontalAlignment="Center" VerticalAlignment="Center" Template="{StaticResource ResistanceIcon}" />
                                    <Control x:Name="NoShield" Template="{StaticResource CtrlNoShield}" />
                                </Grid>
                                <Control x:Name="NonMagicalArrow" Template="{StaticResource CtrlNonMagicalArrow}" />
                                <Control x:Name="MagicalArrow" Template="{StaticResource CtrlMagicalArrow}" />
                                <Control x:Name="Hourglass" Template="{StaticResource CtrlHourglass}" />
                            </Grid>

                            <DataTemplate.Triggers>
                                
                                <!-- MOD_ACS: Control radiant visibility -->
                                <DataTrigger Binding="{Binding DamageType}" Value="Radiant">
                                    <Setter TargetName="Object" Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                                
                                <DataTrigger Binding="{Binding Duration}" Value="1">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard x:Name="StatusEndingStoryboard" Storyboard="{StaticResource ResourceStatusEndingStoryboard}" />
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <StopStoryboard BeginStoryboardName="StatusEndingStoryboard" />
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                                
                            </DataTemplate.Triggers>
                            
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                
                <!-- MOD_ACS: Psychic -->
                <ItemsControl x:Name="ResistancePsychic" ItemsSource="{Binding Stats.Resistances}" Visibility="{Binding Stats.NumActiveResistances, Converter={StaticResource CountToVisibilityConverter}}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                                
                            <Grid x:Name="Object" Tag="Immune" ToolTip="{StaticResource ManagedTooltip}" Background="Transparent" Visibility="Collapsed" Margin="-2,0">
                                <Grid HorizontalAlignment="Center" Margin="0,10,0,0">
                                    <Control x:Name="ImmuneShield" Template="{StaticResource CtrlImmuneShield}" />
                                    <Control x:Name="TypIcon" HorizontalAlignment="Center" VerticalAlignment="Center" Template="{StaticResource ResistanceIcon}" />
                                    <Control x:Name="NoShield" Template="{StaticResource CtrlNoShield}" />
                                </Grid>
                                <Control x:Name="NonMagicalArrow" Template="{StaticResource CtrlNonMagicalArrow}" />
                                <Control x:Name="MagicalArrow" Template="{StaticResource CtrlMagicalArrow}" />
                                <Control x:Name="Hourglass" Template="{StaticResource CtrlHourglass}" />
                            </Grid>

                            <DataTemplate.Triggers>
                                
                                <!-- MOD_ACS: Control psychic visibility -->
                                <DataTrigger Binding="{Binding DamageType}" Value="Psychic">
                                    <Setter TargetName="Object" Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                                
                                <DataTrigger Binding="{Binding Duration}" Value="1">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard x:Name="StatusEndingStoryboard" Storyboard="{StaticResource ResourceStatusEndingStoryboard}" />
                                    </DataTrigger.EnterActions>
                                    <DataTrigger.ExitActions>
                                        <StopStoryboard BeginStoryboardName="StatusEndingStoryboard" />
                                    </DataTrigger.ExitActions>
                                </DataTrigger>
                                
                            </DataTemplate.Triggers>
                            
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                
            </StackPanel>
            
        </StackPanel>
    </ControlTemplate>
    <!-- ===== MOD_ACS: Resistances - END ===== -->
    <!-- ======================================= -->

    <!-- ===== RESISTANCES LIST TEMPLATE=====-->
    <ControlTemplate x:Key="ResistanceListTemplate">
        <Grid>
            <Grid Name="ResistanceIcoList"  Visibility="{Binding Stats.NumActiveResistances, Converter={StaticResource CountToVisibilityConverter}}">
                <ItemsControl ItemsSource="{Binding Stats.Resistances}" Margin="0,0">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Grid x:Name="ResistanceRow" Visibility="Collapsed" ToolTip="{StaticResource ManagedTooltip}" Height="58">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <Image Grid.Column="0" Style="{DynamicResource ResistanceImage}"/>

                                <TextBlock x:Name="ResistanceName" Foreground="{StaticResource LS_baseTxtColor}" Style="{DynamicResource DamageTypeNameStyle}" Grid.Column="1" VerticalAlignment="Center" TextAlignment="Left" Margin="8,0,0,0" FontSize="{DynamicResource ScaledSmallFontSize}" TextTrimming="CharacterEllipsis"/>

                                <TextBlock x:Name="ResistanceType" Foreground="{StaticResource LS_baseTxtColor}" Text="- -" Grid.Column="2" VerticalAlignment="Center" TextAlignment="Right" Margin="0,0,8,0" FontSize="{DynamicResource ScaledSmallFontSize}" TextTrimming="CharacterEllipsis"/>
                            </Grid>
                            <DataTemplate.Triggers>
                                <DataTrigger Binding="{Binding Full}" Value="Immune">
                                    <Setter TargetName="ResistanceRow" Property="Visibility" Value="Visible"/>
                                    <Setter TargetName="ResistanceType" Property="Text" Value="{Binding Source='h1198786dg4063g4010g83d9g8cbd36553077',Converter={StaticResource TranslatedStringConverter}}"/>
                                    <Setter TargetName="ResistanceType" Property="Foreground" Value="{StaticResource LS_tint100}"/>
                                    <Setter TargetName="ResistanceName" Property="Foreground" Value="{StaticResource LS_tint100}"/>
                                </DataTrigger>

                                <DataTrigger Binding="{Binding NonMagical}" Value="Immune">
                                    <Setter TargetName="ResistanceRow" Property="Visibility" Value="Visible"/>
                                    <Setter TargetName="ResistanceType" Property="Text" Value="{Binding Source='h1198786dg4063g4010g83d9g8cbd36553077',Converter={StaticResource TranslatedStringConverter}}"/>
                                    <Setter TargetName="ResistanceType" Property="Foreground" Value="{StaticResource LS_tint100}"/>
                                    <Setter TargetName="ResistanceName" Property="Foreground" Value="{StaticResource LS_tint100}"/>
                                </DataTrigger>

                                <DataTrigger Binding="{Binding Magical}" Value="Immune">
                                    <Setter TargetName="ResistanceRow" Property="Visibility" Value="Visible"/>
                                    <Setter TargetName="ResistanceType" Property="Text" Value="{Binding Source='h1198786dg4063g4010g83d9g8cbd36553077',Converter={StaticResource TranslatedStringConverter}}"/>
                                    <Setter TargetName="ResistanceType" Property="Foreground" Value="{StaticResource LS_tint100}"/>
                                    <Setter TargetName="ResistanceName" Property="Foreground" Value="{StaticResource LS_tint100}"/>
                                </DataTrigger>

                                <DataTrigger Binding="{Binding Full}" Value="Resistant">
                                    <Setter TargetName="ResistanceRow" Property="Visibility" Value="Visible"/>
                                    <Setter TargetName="ResistanceType" Property="Text" Value="{Binding Source='h27558299g1099g485eg95f0g4a319139f8f2',Converter={StaticResource TranslatedStringConverter}}"/>
                                    <Setter TargetName="ResistanceType" Property="Foreground" Value="{StaticResource LS_bonusTxtColor}"/>
                                </DataTrigger>

                                <DataTrigger Binding="{Binding NonMagical}" Value="Resistant">
                                    <Setter TargetName="ResistanceRow" Property="Visibility" Value="Visible"/>
                                    <Setter TargetName="ResistanceType" Property="Text" Value="{Binding Source='h27558299g1099g485eg95f0g4a319139f8f2',Converter={StaticResource TranslatedStringConverter}}"/>
                                    <Setter TargetName="ResistanceType" Property="Foreground" Value="{StaticResource LS_bonusTxtColor}"/>
                                </DataTrigger>

                                <DataTrigger Binding="{Binding Magical}" Value="Resistant">
                                    <Setter TargetName="ResistanceRow" Property="Visibility" Value="Visible"/>
                                    <Setter TargetName="ResistanceType" Property="Text" Value="{Binding Source='h27558299g1099g485eg95f0g4a319139f8f2',Converter={StaticResource TranslatedStringConverter}}"/>
                                    <Setter TargetName="ResistanceType" Property="Foreground" Value="{StaticResource LS_bonusTxtColor}"/>
                                </DataTrigger>

                                <DataTrigger Binding="{Binding Full}" Value="Vulnerable">
                                    <Setter TargetName="ResistanceRow" Property="Visibility" Value="Visible"/>
                                    <Setter TargetName="ResistanceType" Property="Text" Value="{Binding Source='hb710bce5g9017g4c1bg9330g20a891ce14f6',Converter={StaticResource TranslatedStringConverter}}"/>
                                    <Setter TargetName="ResistanceType" Property="Foreground" Value="{StaticResource LS_alertTxtColor}"/>
                                </DataTrigger>

                                <DataTrigger Binding="{Binding NonMagical}" Value="Vulnerable">
                                    <Setter TargetName="ResistanceRow" Property="Visibility" Value="Visible"/>
                                    <Setter TargetName="ResistanceType" Property="Text" Value="{Binding Source='hb710bce5g9017g4c1bg9330g20a891ce14f6',Converter={StaticResource TranslatedStringConverter}}"/>
                                    <Setter TargetName="ResistanceType" Property="Foreground" Value="{StaticResource LS_alertTxtColor}"/>
                                </DataTrigger>

                                <DataTrigger Binding="{Binding Magical}" Value="Vulnerable">
                                    <Setter TargetName="ResistanceRow" Property="Visibility" Value="Visible"/>
                                    <Setter TargetName="ResistanceType" Property="Text" Value="{Binding Source='hb710bce5g9017g4c1bg9330g20a891ce14f6',Converter={StaticResource TranslatedStringConverter}}"/>
                                    <Setter TargetName="ResistanceType" Property="Foreground" Value="{StaticResource LS_alertTxtColor}"/>
                                </DataTrigger>
                            </DataTemplate.Triggers>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>

                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Vertical"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>
            </Grid>
            <Grid Name="ResistanceEmpty" Visibility="{Binding Visibility, ElementName=ResistanceIcoList, Converter={StaticResource InvertVisibilityConverter}}">
                <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="{Binding Source='h529efdfdgda98g4ed3g8d1eg46cbf1d0a5e3', Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource DetailedListText}"/>
            </Grid>
        </Grid>
    </ControlTemplate>

    <!-- ===== PASSIVE FEATURES TEMPLATE=====--> 
    <DataTemplate x:Key="FeaturesListItemTemplate" DataType="{x:Type ls:VMPassive}">
        <Border Name="root" Style="{StaticResource RowBG_d}" ToolTip="{StaticResource ManagedTooltip}" ToolTipService.Placement="Right">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <!-- MOD_ACS: Update Style // BG3: SummaryRoundIcons -->
                <Rectangle x:Name="Icon" Grid.Column="0" Fill="{Binding Icon}" Style="{StaticResource SummaryRoundIconsConditionsAndFeats}" Margin="8,4,8,4"/>
                <!-- MOD_ACS: Update Style // BG3: SummaryListText -->
                <TextBlock x:Name="NameLabel" Grid.Column="1" Text="{Binding Name}" Style="{StaticResource SummaryListTextConditionsAndFeats}" TextTrimming="CharacterEllipsis"/>
            </Grid>
        </Border>
        <DataTemplate.Triggers>
            <Trigger Property="IsMouseOver" SourceName="root" Value="True">
                <Setter TargetName="root" Property="Background" Value="{StaticResource RowBG_h}"/>
                <Setter TargetName="NameLabel" Property="Foreground" Value="{StaticResource LS_tint100}"/>
            </Trigger>
        </DataTemplate.Triggers>
    </DataTemplate>

    <!--===== PLAYER MULTICLASS TEMPLATE =====-->
    <ControlTemplate x:Key="PlayerMultiClass">
        <ItemsControl ItemsSource="{Binding Stats.ClassList}" AlternationCount="{Binding Stats.ClassList.Count}" HorizontalAlignment="Center">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <ls:AlignableWrapPanel HorizontalContentAlignment="Center" IsItemsHost="True" MaxWidth="{StaticResource ExaminePanelWidth}"/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate DataType="ls:VMClass">
                    <StackPanel x:Name="class" Orientation="Horizontal" >
                        <StackPanel.Resources>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontSize" Value="{DynamicResource ScaledDefaultFontSize}"/>
                            </Style>
                        </StackPanel.Resources>
                        <StackPanel.Tag>
                            <MultiBinding Converter="{StaticResource EqualConverter}">
                                <Binding Path="(ItemsControl.AlternationIndex)" RelativeSource="{RelativeSource FindAncestor, AncestorType={x:Type ContentPresenter}}" Converter="{StaticResource AddConverter}" ConverterParameter="1"/>
                                <Binding Path="AlternationCount" RelativeSource="{RelativeSource FindAncestor, AncestorType={x:Type ItemsControl}}"/>
                            </MultiBinding>
                        </StackPanel.Tag>

                        <TextBlock x:Name="classInfo">
                            <TextBlock.ToolTip>
                                <ls:LSTooltip IsHitTestVisible="False" Content="{Binding Path=DataContext.ClassDescription, RelativeSource={RelativeSource TemplatedParent}}" ls:AttachedProperties.InheritedTag="{Binding Path=DataContext.ClassDisplayName, RelativeSource={RelativeSource TemplatedParent}}" ContentTemplate="{StaticResource HeaderBodyLocaStringTemplate}"/>
                            </TextBlock.ToolTip>
                            <TextBlock.Text>
                                <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                    <Binding Source="hd678d4eeg181fg499dg9e81g2146ab24e03a"/>
                                    <Binding Path="DataContext.Level.Value" RelativeSource="{RelativeSource Mode=Self}"/>
                                    <Binding Path="DataContext.ClassDisplayName" RelativeSource="{RelativeSource Mode=Self}"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                        <!-- MOD_ACS: Add space & change separator / Add StringFormat / Update Source // BG3: Source='hd64bfe4cgadadg4468g8b0ag70330ffc717c' -->
                        <TextBlock x:Name="separator" Text="{Binding Source='hb3046cd8g05b3g4e6ag9396gd17b80fa6737', StringFormat=' {0} ', Converter={StaticResource TranslatedStringConverter}}"/> 
                    </StackPanel>
                    <DataTemplate.Triggers>
                        <DataTrigger Binding="{Binding Tag, ElementName=class}" Value="True">
                            <Setter TargetName="separator" Property="Visibility" Value="Collapsed"/>
                        </DataTrigger>
                    </DataTemplate.Triggers>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
    </ControlTemplate>

    <!--===== WEAPON PROFICIENCY ICONS =====-->
    <Style x:Key="EquipmentProficiencyIconStyle" TargetType="Image">
        <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_shortSword.png"/>
        <Style.Triggers>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Battleaxes">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_battleAxe.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Clubs">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_club.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Daggers">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_dagger.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Darts">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_dart.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Flails">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_flail.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Glaives">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_glaive.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Greataxes">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_greatAxe.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Greatclubs">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_greatClub.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Greatswords">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_greatSword.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Halberds">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_halbard.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Handaxes">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_handAxe.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="HandCrossbows">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_handCrossbow.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="HeavyArmor">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_heavyArmour.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="HeavyCrossbows">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_heavyCrossbow.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Javelins">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_javelin.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="LightArmor">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_lightArmour.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="LightCrossbows">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_lightCrossbow.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="LightHammers">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_lightHammer.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Longbows">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_longBow.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Longswords">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_longSword.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Maces">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_mace.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Mauls">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_maul.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="MediumArmor">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_mediumArmour.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Morningstars">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_morningStar.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Pikes">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_pike.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Quarterstaffs">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_quarterstaff.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Rapiers">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_rapier.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Scimitars">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_scimitar.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Shields">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_shield.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Shortbows">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_shortBow.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Shortswords">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_shortSword.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Sickles">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_sickle.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Slings">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_sling.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Spears">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_spear.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Tridents">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_trident.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Warhammers">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_warhammer.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Warpicks">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ProficiencyIcons/ico_proficiency_warPick.png"/>
            </DataTrigger>
        </Style.Triggers>
    </Style>

    <!--===== WEAPON PROFICIENCY TEXT BLOCK =====-->
    <Style x:Key="EquipmentProficiencyNameStyle" TargetType="TextBlock">
        <Setter Property="Text" Value="{Binding Source='h0715431fge95eg434dga34eg313e58a76bee',Converter={StaticResource TranslatedStringConverter}}"/>
        <Style.Triggers>
            <DataTrigger Binding="{Binding ProficiencyType}" Value="Battleaxes">
                <Setter Property="Text" Value="{Binding Source='h0987de21g7f18g46bdg96b6g251f0d886fd8',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Clubs">
                <Setter Property="Text" Value="{Binding Source='hf7ee4cf2g8054g4cecgaf42g00e26e4c6301',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Daggers">
                <Setter Property="Text" Value="{Binding Source='ha9bc5c71gf7fdg4f77gad7eg14da6c8ecfc2',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Darts">
                <Setter Property="Text" Value="{Binding Source='hf8205efdgf1f5g4581g8391g829af9b98138',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Flails">
                <Setter Property="Text" Value="{Binding Source='hf61bb53cg6987g4c34gbaf3g008e491dd1bd',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Glaives">
                <Setter Property="Text" Value="{Binding Source='h899d4afbgabdag433ag924ag1aa328117d8a',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Greataxes">
                <Setter Property="Text" Value="{Binding Source='h9430a867gd49ag48c8g9900gc945e3326765',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Greatclubs">
                <Setter Property="Text" Value="{Binding Source='hec8a15degd33fg4fdagaf70gf0f1c9dd53e9',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Greatswords">
                <Setter Property="Text" Value="{Binding Source='h8d8817a2gf20dg4eb8gbcd0gfd1bc5428004',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Halberds">
                <Setter Property="Text" Value="{Binding Source='ha9d067e1g28dfg4fa3gbdabg0c3fa133279d',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="HandCrossbows">
                <Setter Property="Text" Value="{Binding Source='h23613b92g02b0g4b9cg9b7fg937f0d83f7d8',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Handaxes">
                <Setter Property="Text" Value="{Binding Source='h35568a26gee03g4dfagb3d0g35db1faec364',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="HeavyArmor">
                <Setter Property="Text" Value="{Binding Source='h71d00b00g56dcg4e21g8662g060ced42c3dc',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="HeavyCrossbows">
                <Setter Property="Text" Value="{Binding Source='h5b736f1eg9895g4263gb76dg76c06c1038ae',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Javelins">
                <Setter Property="Text" Value="{Binding Source='hbfcb8bcbg561ag473bga1a0g4e184d2b2692',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="LightArmor">
                <Setter Property="Text" Value="{Binding Source='h2eebdf9ag6c29g43d2g80d8g3371b7d65cdf',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="LightCrossbows">
                <Setter Property="Text" Value="{Binding Source='h210d748egfceeg4e76gabe5g9080c902693f',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="LightHammers">
                <Setter Property="Text" Value="{Binding Source='ha0df64f6gae3cg4dd4gaee6g8aa988bfde8f',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Longbows">
                <Setter Property="Text" Value="{Binding Source='h68720f95gd2c6g4b0ega150geece5a885719',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Longswords">
                <Setter Property="Text" Value="{Binding Source='h23d056e9g6d0cg47d1g9603g873752123142',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Maces">
                <Setter Property="Text" Value="{Binding Source='h6718875ag0e2eg46eag98f0gb8d626d5ec13',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="MartialWeapons">
                <Setter Property="Text" Value="{Binding Source='h93cf8a7dgf14dg4f68g816fgdbf4de0dae41',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Mauls">
                <Setter Property="Text" Value="{Binding Source='h1332cd56g203fg4919gac2dg2d2443302a31',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="MediumArmor">
                <Setter Property="Text" Value="{Binding Source='hbd44c0e2g6a6eg4c8ag8ef4gbe1b95e4bf49',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Morningstars">
                <Setter Property="Text" Value="{Binding Source='hc622f5a9gf7cag4b6ag8e99g792d3831fdfc',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Pikes">
                <Setter Property="Text" Value="{Binding Source='he28bbadcgf4fdg48f8gb59bg89d5895d1267',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Quarterstaffs">
                <Setter Property="Text" Value="{Binding Source='h3fcd9f76g0dcfg4038g9a56g06353c1c0cea',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Rapiers">
                <Setter Property="Text" Value="{Binding Source='h3c574faagd3dbg4b38gbca9g2a71750dfcf0',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Scimitars">
                <Setter Property="Text" Value="{Binding Source='h4caa96c2g100fg4292ga543g740f93ad59ca',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Shields">
                <Setter Property="Text" Value="{Binding Source='h7a819a15g5129g48bagafc1g1c73cc6634ab',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Shortbows">
                <Setter Property="Text" Value="{Binding Source='h931161d1ge54ag480agb3d1gdaf3ed47004c',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Shortswords">
                <Setter Property="Text" Value="{Binding Source='h2529ddf4gb846g4940g9b1dg9969718fe87d',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Sickles">
                <Setter Property="Text" Value="{Binding Source='h28d04d64ge35dg4469g956bg27d715d6e9b1',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="SimpleWeapons">
                <Setter Property="Text" Value="{Binding Source='hd0ea839ag4be2g455bgbff6g71446c4f1355',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Slings">
                <Setter Property="Text" Value="{Binding Source='hc5bd4565g187cg49e2ga99eg43b33c5b8142',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Spears">
                <Setter Property="Text" Value="{Binding Source='h45a6183ag755ag4fdagb147gae8c86ceec57',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Tridents">
                <Setter Property="Text" Value="{Binding Source='hf2542d79gdedfg4a37gb9d2g2238be0f9f4c',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Warhammers">
                <Setter Property="Text" Value="{Binding Source='h4e50a96bg2c2bg41daga27eg623eeae44daf',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Warpicks">
                <Setter Property="Text" Value="{Binding Source='h2914d6ecg0f4ag4452ga88cg59a2f075a69f',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="MusicalInstrument">
                <Setter Property="Text" Value="{Binding Source='hd29bbe68g0a7fg4861g8e94gf6e9ee63804d',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ProficiencyType}" Value="Armors">
                <Setter Property="Text" Value="{Binding Source='h9ac79039g668bg4b3cg9a34g3688c34d084b',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>
        </Style.Triggers>
    </Style>

    <!--===== WEAPON PROFICIENCY TOOLTIP =====-->
    <DataTemplate x:Key="ExtendedEquipmentProficiencyTemplate">
        <StackPanel x:Name="Object" Background="Transparent" Orientation="Horizontal" VerticalAlignment="Top" Margin="0,0,0,2">
            <Image Style="{StaticResource EquipmentProficiencyIconStyle}" VerticalAlignment="Center" Stretch="Fill" Width="48" Height="48"/>
            <TextBlock Style="{StaticResource EquipmentProficiencyNameStyle}" FontSize="{StaticResource MediumFontSize}" Foreground="{StaticResource TooltipColor.Primary}" Margin="8,0,0,0" TextAlignment="Left" TextWrapping="Wrap" VerticalAlignment="Center"/>
        </StackPanel>
    </DataTemplate>

    <!--===== WEAPON PROFICIENCY TEMPLATE =====-->
    <ControlTemplate x:Key="WeaponProficienciesTemplate">
        <Grid x:Name="Proficiencies" HorizontalAlignment="Stretch" >
            <Grid.Resources>

                <DataTemplate x:Key="ProficiencyTooltipTemplate">
                    <StackPanel MaxWidth="800" Margin="12">
                        <StackPanel.Resources>
                            <Style TargetType="ls:LSSpan" BasedOn="{StaticResource {x:Type ls:LSSpan}}">
                                <Style.Triggers>
                                    <Trigger Property="TagType" Value="hl">
                                        <Setter Property="Foreground" Value="{StaticResource LS_accent100TxtColor}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Resources>

                        <TextBlock x:Name="title" Style="{StaticResource TooltipTitleStyle}"/>
                        <TextBlock x:Name="desc" Style="{StaticResource TooltipBaseTextStyle}"/>
                        <ItemsControl x:Name="list" ItemTemplate="{StaticResource ExtendedEquipmentProficiencyTemplate}"/>
                    </StackPanel>

                    <DataTemplate.Triggers>
                        <DataTrigger Binding="{Binding (ls:TooltipExtender.Context), RelativeSource={RelativeSource Self}}" Value="Armour">
                            <Setter TargetName="title" Property="ls:TextBlockFormatter.SourceText" Value="{Binding Source='hb677b3f7g5cf6g49c3g84fag2f773ef50dd6',Converter={StaticResource TranslatedStringConverter}}"/>
                            <Setter TargetName="desc" Property="ls:TextBlockFormatter.SourceText">
                                <Setter.Value>
                                    <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                        <Binding Source="h6352fd8fg07b1g4c3agab89g4ec0a2b479e6"/>
                                        <Binding Path="(ls:TooltipExtender.Owner).Name" RelativeSource="{RelativeSource Mode=Self}"/>
                                    </MultiBinding>
                                </Setter.Value>
                            </Setter>
                            <Setter TargetName="list" Property="ItemsSource" Value="{Binding (ls:TooltipExtender.Owner).Stats.ProtectionProficiencies, RelativeSource={RelativeSource Self}}"/>
                        </DataTrigger>


                        <!-- Armour part -->
                        <DataTrigger Binding="{Binding (ls:TooltipExtender.Context), RelativeSource={RelativeSource TemplatedParent}}" Value="Armour">
                            <Setter TargetName="title" Property="ls:TextBlockFormatter.SourceText" Value="{Binding Source='hb677b3f7g5cf6g49c3g84fag2f773ef50dd6',Converter={StaticResource TranslatedStringConverter}}"/>
                            <Setter TargetName="desc" Property="ls:TextBlockFormatter.SourceText">
                                <Setter.Value>
                                    <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                        <Binding Source="h6352fd8fg07b1g4c3agab89g4ec0a2b479e6"/>
                                        <Binding Path="(ls:TooltipExtender.Owner).Name" RelativeSource="{RelativeSource Mode=Self}"/>
                                    </MultiBinding>
                                </Setter.Value>
                            </Setter>
                            <Setter TargetName="list" Property="ItemsSource" Value="{Binding (ls:TooltipExtender.Owner).Stats.ProtectionProficiencies, RelativeSource={RelativeSource Self}}"/>
                        </DataTrigger>

                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding (ls:TooltipExtender.Context), RelativeSource={RelativeSource Mode=TemplatedParent}}" Value="Armour"/>
                                <Condition Binding="{Binding (ls:TooltipExtender.Owner).Stats.ProtectionProficiencies.Count, RelativeSource={RelativeSource Self}}" Value="0"/>
                            </MultiDataTrigger.Conditions>

                            <Setter TargetName="desc" Property="ls:TextBlockFormatter.SourceText">
                                <Setter.Value>
                                    <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                        <Binding Source="h3f2a13d0g43dfg45c3g9054gac4435262f3b"/>
                                        <Binding Path="(ls:TooltipExtender.Owner).Name" RelativeSource="{RelativeSource Mode=Self}"/>
                                    </MultiBinding>
                                </Setter.Value>
                            </Setter>
                        </MultiDataTrigger>

                        <!-- Simple weapons part -->
                        <DataTrigger Binding="{Binding (ls:TooltipExtender.Context), RelativeSource={RelativeSource TemplatedParent}}" Value="SimpleWeapons">
                            <Setter TargetName="title" Property="ls:TextBlockFormatter.SourceText" Value="{Binding Source='hd0ea839ag4be2g455bgbff6g71446c4f1355',Converter={StaticResource TranslatedStringConverter}}"/>
                            <Setter TargetName="desc" Property="ls:TextBlockFormatter.SourceText">
                                <Setter.Value>
                                    <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                        <Binding Source="haa84e19cg142fg4128g97b3g4bbed0390545"/>
                                        <Binding Path="(ls:TooltipExtender.Owner).Name" RelativeSource="{RelativeSource Mode=Self}"/>
                                    </MultiBinding>
                                </Setter.Value>
                            </Setter>
                            <Setter TargetName="list" Property="ItemsSource" Value="{Binding (ls:TooltipExtender.Owner).Stats.SimpleWeaponProficiencies, RelativeSource={RelativeSource Self}}"/>
                        </DataTrigger>

                        <!-- Martial weapons part -->
                        <DataTrigger Binding="{Binding (ls:TooltipExtender.Context), RelativeSource={RelativeSource TemplatedParent}}" Value="MartialWeapons">
                            <Setter TargetName="title" Property="ls:TextBlockFormatter.SourceText" Value="{Binding Source='h93cf8a7dgf14dg4f68g816fgdbf4de0dae41',Converter={StaticResource TranslatedStringConverter}}"/>
                            <Setter TargetName="desc" Property="ls:TextBlockFormatter.SourceText">
                                <Setter.Value>
                                    <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                        <Binding Source="haa84e19cg142fg4128g97b3g4bbed0390545"/>
                                        <Binding Path="(ls:TooltipExtender.Owner).Name" RelativeSource="{RelativeSource Mode=Self}"/>
                                    </MultiBinding>
                                </Setter.Value>
                            </Setter>
                            <Setter TargetName="list" Property="ItemsSource" Value="{Binding (ls:TooltipExtender.Owner).Stats.MartialWeaponProficiencies, RelativeSource={RelativeSource Self}}"/>
                        </DataTrigger>

                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding (ls:TooltipExtender.Context), RelativeSource={RelativeSource TemplatedParent}}" Value="MartialWeapons"/>
                                <Condition Binding="{Binding (ls:TooltipExtender.Owner).Stats.MartialWeaponProficiencies.Count, RelativeSource={RelativeSource Self}}" Value="0"/>
                            </MultiDataTrigger.Conditions>

                            <Setter TargetName="desc" Property="ls:TextBlockFormatter.SourceText">
                                <Setter.Value>
                                    <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                        <Binding Source="h8ad022f5g5e8eg409eg8577gb83095463181"/>
                                        <Binding Path="(ls:TooltipExtender.Owner).Name" RelativeSource="{RelativeSource Mode=Self}"/>
                                    </MultiBinding>
                                </Setter.Value>
                            </Setter>
                        </MultiDataTrigger>

                        <!-- Musical instruments part -->
                        <DataTrigger Binding="{Binding (ls:TooltipExtender.Context), RelativeSource={RelativeSource TemplatedParent}}" Value="MusicalInstrument">
                            <Setter TargetName="title" Property="ls:TextBlockFormatter.SourceText" Value="{Binding Source='hd29bbe68g0a7fg4861g8e94gf6e9ee63804d',Converter={StaticResource TranslatedStringConverter}}"/>
                            <Setter TargetName="desc" Property="ls:TextBlockFormatter.SourceText">
                                <Setter.Value>
                                    <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                        <Binding Source="h8f9f545dg237eg49fcg9f12g84f1cff2218d"/>
                                        <Binding Path="(ls:TooltipExtender.Owner).Name" RelativeSource="{RelativeSource Mode=Self}"/>
                                    </MultiBinding>
                                </Setter.Value>
                            </Setter>
                        </DataTrigger>

                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding (ls:TooltipExtender.Context), RelativeSource={RelativeSource Self}}" Value="MusicalInstrument"/>
                                <Condition Binding="{Binding (ls:TooltipExtender.Owner).Stats.MusicalInstrumentProficiency, RelativeSource={RelativeSource Self}}" Value="False"/>
                            </MultiDataTrigger.Conditions>

                            <Setter TargetName="desc" Property="ls:TextBlockFormatter.SourceText">
                                <Setter.Value>
                                    <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                        <Binding Source="hb9eb8424gbd5eg483bg9ce6g783cad20513d"/>
                                        <Binding Path="(ls:TooltipExtender.Owner).Name" RelativeSource="{RelativeSource Mode=Self}"/>
                                    </MultiBinding>
                                </Setter.Value>
                            </Setter>
                        </MultiDataTrigger>
                    </DataTemplate.Triggers>
                </DataTemplate>

                <ControlTemplate x:Key="ProficiencyBox" TargetType="ContentControl">
                    <Border Name="ProficiencyBoxBorder" Style="{StaticResource RowBG_d}">
                        <Border.ToolTip>
                            <ls:LSTooltip x:Name="ProficiencyTooltip" Content="{Binding Path=DataContext,ElementName=ProficiencyBoxBorder}" ContentTemplate="{StaticResource ProficiencyTooltipTemplate}" ls:TooltipExtender.Context="Armour" ToolTipService.Placement="Right"/>
                        </Border.ToolTip>
                        <Grid Height="52">
                            <Grid.Resources>
                                <BitmapImage x:Key="check">pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_btn_check.png</BitmapImage>
                                <BitmapImage x:Key="prof_armour">pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/ico_prof_armour.png</BitmapImage>

                            </Grid.Resources>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="60"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Image x:Name="BooleanIcon" Grid.Column="0" Source="{StaticResource check}" VerticalAlignment="Center" Height="36" HorizontalAlignment="Right" Visibility="Collapsed"/>
                            <TextBlock x:Name="Count" Style="{StaticResource DetailedListValue}" Grid.Column="0" Text="{Binding Stats.ProtectionProficiencies.Count, StringFormat='x{0}'}"  HorizontalAlignment="Right" VerticalAlignment="Center"/>
                            <Image x:Name="Icon" Grid.Column="1" Source="{StaticResource prof_armour}" VerticalAlignment="Center" Height="36" Margin="12,0"/>
                            <TextBlock x:Name="Label" Style="{StaticResource DetailedListText}" Grid.Column="2" Text="{Binding Source='hb677b3f7g5cf6g49c3g84fag2f773ef50dd6',Converter={StaticResource TranslatedStringConverter}}" VerticalAlignment="Center"/>
                        </Grid>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="ProficiencyBoxBorder" Property="Background" Value="{StaticResource RowBG_h}"/>
                        </Trigger>
                        <Trigger Property="Content" Value="SimpleWeapons">
                            <Setter TargetName="Count" Property="Text" Value="{Binding Stats.SimpleWeaponProficiencies.Count, StringFormat='x{0}'}"/>
                            <Setter TargetName="Icon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/ico_prof_simple.png"/>
                            <Setter TargetName="Label" Property="Text" Value="{Binding Source='hd0ea839ag4be2g455bgbff6g71446c4f1355',Converter={StaticResource TranslatedStringConverter}}"/>
                            <Setter TargetName="ProficiencyTooltip" Property="ls:TooltipExtender.Context" Value="SimpleWeapons"/>
                        </Trigger>
                        <Trigger Property="Content" Value="MartialWeapons">
                            <Setter TargetName="Count" Property="Text" Value="{Binding Stats.MartialWeaponProficiencies.Count, StringFormat='x{0}'}"/>
                            <Setter TargetName="Icon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/ico_prof_martial.png"/>
                            <Setter TargetName="Label" Property="Text" Value="{Binding Source='h93cf8a7dgf14dg4f68g816fgdbf4de0dae41',Converter={StaticResource TranslatedStringConverter}}"/>
                            <Setter TargetName="ProficiencyTooltip" Property="ls:TooltipExtender.Context" Value="MartialWeapons"/>
                        </Trigger>
                        <Trigger Property="Content" Value="MusicalInstrument">
                            <Setter TargetName="BooleanIcon" Property="Visibility" Value="Visible"/>
                            <Setter TargetName="Count" Property="Visibility" Value="Collapsed"/>
                            <Setter TargetName="Icon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/ico_prof_music.png"/>
                            <Setter TargetName="Label" Property="Text" Value="{Binding Source='hd29bbe68g0a7fg4861g8e94gf6e9ee63804d',Converter={StaticResource TranslatedStringConverter}}"/>
                            <Setter TargetName="ProficiencyTooltip" Property="ls:TooltipExtender.Context" Value="MusicalInstrument"/>
                        </Trigger>
                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding Content, RelativeSource={RelativeSource Mode=Self}}" Value="MusicalInstrument"/>
                                <Condition Binding="{Binding Stats.MusicalInstrumentProficiency}" Value="False"/>
                            </MultiDataTrigger.Conditions>
                            <Setter TargetName="BooleanIcon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_btn_cross_d.png"/>
                            <Setter TargetName="BooleanIcon" Property="Opacity" Value="0.4"/>
                            <Setter TargetName="ProficiencyBoxBorder" Property="BorderBrush" Value="{StaticResource LS_accent00TxtColor}"/>
                            <Setter TargetName="Label" Property="Foreground" Value="{StaticResource LS_accent00TxtColor}"/>
                            <Setter TargetName="Icon" Property="Opacity" Value="0.4"/>
                        </MultiDataTrigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Grid.Resources>

            <Border Style="{StaticResource ListSectionBackground}">
                <StackPanel >
                    <ContentControl Template="{StaticResource ProficiencyBox}" Content="Armour"/>
                    <ContentControl Template="{StaticResource ProficiencyBox}" Content="SimpleWeapons"/>
                    <ContentControl Template="{StaticResource ProficiencyBox}" Content="MartialWeapons"/>
                    <ContentControl Template="{StaticResource ProficiencyBox}" Content="MusicalInstrument"/>
                </StackPanel>
            </Border>
        </Grid>


    </ControlTemplate>

    <!--===== SAVING THROW PROFICIENCY TEMPLATE =====-->
    <Style x:Key="SavingThrowGridStyle" TargetType="ItemsControl">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate>
                    <ItemsPresenter/>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="ItemsPanel">
            <Setter.Value>
                <ItemsPanelTemplate>
                    <StackPanel HorizontalAlignment="Center" Orientation="Horizontal"/>
                </ItemsPanelTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="ItemTemplate">
            <Setter.Value>
                <DataTemplate DataType="ls:VMAbility">
                    <!-- MOD_ACS: Add Border type to Add CornerRadius -->
                    <Border x:Name="baseBorder" Background="Transparent" Height="88" Width="88" CornerRadius="12" ToolTip="{StaticResource ManagedTooltip}" ToolTipService.Placement="Right" ToolTipService.HorizontalOffset="50">
                        <!-- MOD_ACS: Move attributs to baseBorder // BG3: Background="Transparent" Height="88" Width="88" CornerRadius="12" ToolTip="{StaticResource ManagedTooltip}" ToolTipService.Placement="Right" ToolTipService.HorizontalOffset="50" -->
                        <Grid x:Name="base">
                            
                            <Image x:Name="SavingThrowIcon" HorizontalAlignment="Center" VerticalAlignment="Bottom" Source="{StaticResource SavingThrowDice}" Opacity="0.6">
                            </Image>
                            <StackPanel>
                                <Control x:Name="attrName" Template="{StaticResource AbilityShortDisplayName}"  HorizontalAlignment="Center" Margin="0,16,0,0">
                                    <Control.Resources>
                                        <Style TargetType="TextBlock"  BasedOn="{StaticResource DetailedListText}"></Style>
                                    </Control.Resources>
                                </Control>
                                <!-- MOD_ACS: Update StringFormat - remove space // BG3: StringFormat={}{0: +#; -#; 0}} -->
                                <TextBlock x:Name="value" Text="{Binding SavingThrow.AdditionalValue, StringFormat={}{0:+#;-#;0}}" Style="{StaticResource DetailedListValue}" HorizontalAlignment="Center" Margin="0,-12,0,0"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                    <DataTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True" SourceName="base">
                            <!-- MOD_ACS: Update TargetName // BG3: TargetName="base" -->
                            <Setter TargetName="baseBorder" Property="Background" Value="{StaticResource RowBG_h}"/>
                        </Trigger>
                        
                        <!-- MOD_ACS: Add if positive color green -->
                        <DataTrigger Binding="{Binding SavingThrow.AdditionalValue, Converter={StaticResource GreaterThanConverter}, ConverterParameter=0}" Value="True">
                            <Setter TargetName="value" Property="Foreground" Value="{StaticResource ACS_LS_bonusTxtColor}"/>
                        </DataTrigger>

                        <!-- MOD_ACS: Add if negative color red -->
                        <DataTrigger Binding="{Binding SavingThrow.AdditionalValue, Converter={StaticResource LessThanConverter}, ConverterParameter=0}" Value="True">
                            <Setter TargetName="value" Property="Foreground" Value="{StaticResource ACS_LS_alertTxtColor}"/>
                        </DataTrigger>
                        
                    </DataTemplate.Triggers>
                </DataTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!--===== SKILLS VIEW TEMPLATE =====-->
    <ControlTemplate x:Key="SkillsTemplate">
        <Grid x:Name="SkillsPanelContent" Margin="-22,0,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Proficiency Bonus-->
            <Border Name="ProficiencyBonusLegend" Grid.Row="0" Background="Transparent" ToolTip="{StaticResource PlacementParentDCTooltip}" DataContext="{Binding Stats.ProficiencyBonus}" ToolTipService.Placement="Right" ToolTipService.VerticalOffset="-40">
                <!-- MOD_ACS: Add name / Update margin // BG3:  Margin="0,0,0,12" -->
                <StackPanel x:Name="ProficiencyBonusLegendPanel" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,-22,0,11">
                    <!-- MOD_ACS: Update margin // BG3:  Margin="0,0,6,0" -->
                    <Image Source="{StaticResource ProficientDice}" Stretch="None" Margin="0,-2,6,2" VerticalAlignment="Center"/>
                    <TextBlock Name="ProficiencyBonusLabel" Foreground="{StaticResource LS_accent75TxtColor}" FontSize="{StaticResource ScaledSmallFontSize}" VerticalAlignment="Center">
                                <Run Text="{Binding Source='h65b46ad4g2eacg47d5gb4b4g124ca3b8aaef', Converter={StaticResource TranslatedStringConverter}}"/>
                                <Run Text="{Binding Value, StringFormat='(+{0})'}"/>
                    </TextBlock>
                </StackPanel>
            </Border>


            <!--SkillsList-->
            <!-- MOD_ACS: Add margin -->
            <ScrollViewer Template="{StaticResource NoForcedStyleScrollViewerTemplate}" Grid.Row="1" Padding="{StaticResource ScrollOffset}" Margin="11,0,-10,0">
                <Grid x:Name="CharacterSkills">
                    <Grid.Resources>
                        <Style x:Key="SkillTextStyle" TargetType="TextBlock">
                            <Setter Property="FontSize" Value="{DynamicResource ScaledSmallFontSize}"/>
                            <Setter Property="Foreground" Value="{StaticResource LS_baseTxtColor}"/>
                        </Style>

                        <Style x:Key="SkillTitleTextStyle" TargetType="TextBlock" BasedOn="{StaticResource SkillTextStyle}">
                            <Setter Property="Foreground" Value="{StaticResource LS_accent100TxtColor}"/>
                            <Setter Property="ToolTipService.Placement" Value="Right"/>
                            <Setter Property="ToolTipService.HorizontalOffset" Value="188"/>
                        </Style>
                    </Grid.Resources>

                    <ItemsControl ItemsSource="{Binding Stats.Abilities}" >
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border x:Name="AbillitySkillSection" Visibility="{Binding Skills.Count, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=0}" Style="{StaticResource RowBG_d}" BorderBrush="{StaticResource LS_accent00TxtColor}" BorderThickness="2" Margin="0,4">
                                    <StackPanel Orientation="Vertical" Margin="0,8,0,0">
                                        <Border x:Name="SkillTitle" Background="Transparent" ToolTip="{StaticResource ManagedTooltip}" ToolTipService.Placement="Right">
                                            <StackPanel Orientation="Horizontal"  HorizontalAlignment="Center">
                                                <TextBlock x:Name="TitleName" Text="{Binding AbilityValue, Converter={StaticResource EnumTranslatedStringConverter}, ConverterParameter='hec30ce0dgb76bg45cagaf40gad771ff7902b'}" Style="{StaticResource SkillTitleTextStyle}"/>
                                                <!-- MOD_ACS: Add prepend -->
                                                <TextBlock x:Name="TitleValuePrepend" Style="{StaticResource SkillTitleTextStyle}" Text=" ("/>
                                                <!-- MOD_ACS: Update StringFormat // BG3: StringFormat=' ({0:+#;-#;0})' -->
                                                <TextBlock x:Name="TitleValue" Style="{StaticResource SkillTitleTextStyle}" Text="{Binding Modifier, StringFormat={}{0:+#;-#;0}}"/>
                                                <!-- MOD_ACS: Add append -->
                                                <TextBlock x:Name="TitleValueAppend" Style="{StaticResource SkillTitleTextStyle}" Text=")"/>
                                            </StackPanel>
                                        </Border>
                                        
                                        <!-- MOD_ACS: Update margin // BG3: Margin="12,4,12,12" -->
                                        <ItemsControl ItemsSource="{Binding Skills}" Margin="12,0,12,8">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate DataType="ls:VMSkill">
                                                    <Border Name="GridRow" Style="{StaticResource RowBG_d}" ToolTip="{StaticResource ManagedTooltip}" ToolTipService.Placement="Right">
                                                        <!-- MOD_ACS: Add Name / Update Height // BG3: Height="56" -->
                                                        <Grid x:Name="SkillGrid" HorizontalAlignment="Stretch" Height="52" >
                                                        <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto"/>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="44"/>
                                                                <ColumnDefinition Width="66"/>
                                                            </Grid.ColumnDefinitions>

                                                            <Image x:Name="SkillIcon" Grid.Column="0" Source="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared_c/c_SkillsIcons/skills_athletics.png" Margin="8,4,8,4" Stretch="UniformToFill" Height="44"/>

                                                            <TextBlock x:Name="SkillName" Text="{Binding SkillValue, Converter={StaticResource EnumTranslatedStringConverter}, ConverterParameter='h65e11968gf9b6g4c47g9efcg03fb60fb923c'}" Style="{StaticResource SkillTextStyle}" Grid.Column="1" VerticalAlignment="Center" TextAlignment="Left" Margin="8,0,0,0"/>

                                                            <Grid x:Name="ExpertiseIcon" Grid.Column="2" Visibility="Collapsed" Background="Transparent" ToolTipService.PlacementTarget="{Binding ElementName=GridRow}" ToolTipService.Placement="Right" VerticalAlignment="Center">
                                                                <Grid.ToolTip>
                                                                    <ls:LSTooltip IsHitTestVisible="False" Content="hfa5d1a58ged7dg40c8g8783g14f58399525d" ls:AttachedProperties.InheritedTag="h314e6b7ege3a1g4333g8798g461554dfda30" Style="{StaticResource InlineTagTooltip}"/>
                                                                </Grid.ToolTip>
                                                                <Image Source="{StaticResource ProficientDice}" Stretch="None" Margin="-18,0,0,0"/>
                                                                <Image Source="{StaticResource ProficientDice}" Stretch="None" Margin="8,0,0,0"/>
                                                            </Grid>

                                                            <Border x:Name="ProficiencyIcon" Grid.Column="2" Visibility="Collapsed" Background="Transparent" ToolTipService.PlacementTarget="{Binding ElementName=GridRow}" ToolTipService.Placement="Right" VerticalAlignment="Center">
                                                                <Border.ToolTip>
                                                                    <ls:LSTooltip x:Name="ProficiencyTooltip" IsHitTestVisible="False" Content="{Binding Source='h1a87477cge794g43eag8f06ge44364db9f39',Converter={StaticResource TranslatedStringConverter}}" ls:AttachedProperties.InheritedTag="hc36a544fg6ae1g45f0gb74aga36d2961a9b1" Style="{StaticResource InlineTagTooltip}"/>
                                                                </Border.ToolTip>
                                                                <Image Source="{StaticResource ProficientDice}" Stretch="None"/>
                                                            </Border>

                                                            <TextBlock x:Name="SkillModifier" Style="{StaticResource SkillTextStyle}" Text="{Binding Value, StringFormat={}{0:+#;-#;0}}" Grid.Column="3" VerticalAlignment="Center" TextAlignment="Right" Margin="0,0,18,0" Foreground="{StaticResource LS_accent100TxtColor}"/>
                                                            <b:Interaction.Triggers>
                                                                <b:EventTrigger EventName="MouseEnter">
                                                                    <ls:LSPlaySound Sound="UI_Shared_Hover"/>
                                                                </b:EventTrigger>
                                                            </b:Interaction.Triggers>
                                                        </Grid>
                                                    </Border>
                                                    <DataTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="GridRow" Property="Background" Value="{StaticResource RowBG_h}"/>
                                                            <Setter TargetName="SkillName" Property="Foreground" Value="{StaticResource LS_accent100TxtColor}"/>
                                                            <Setter TargetName="SkillModifier" Property="Foreground" Value="{StaticResource LS_tint100}"/>
                                                        </Trigger>
                                                        <DataTrigger Binding="{Binding IsProficient}" Value="True">
                                                            <Setter TargetName="ProficiencyIcon" Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding IsExpert}" Value="True">
                                                            <Setter TargetName="ExpertiseIcon" Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>

                                                        <!--Proficiency TT Variants-->
                                                        <DataTrigger Binding="{Binding Skill}" Value="Athletics">
                                                            <Setter TargetName="ProficiencyTooltip" Property="Content" Value="h3bad03f6gbd5bg41dfg851fg20ef293804a7"/>
                                                            <Setter TargetName="SkillIcon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared_c/c_SkillsIcons/skills_athletics.png"/>
                                                        </DataTrigger>

                                                        <DataTrigger Binding="{Binding Skill}" Value="Acrobatics">
                                                            <Setter TargetName="ProficiencyTooltip" Property="Content" Value="h98fde208g8d95g4832g80e3g09076bb94095"/>
                                                            <Setter TargetName="SkillIcon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared_c/c_SkillsIcons/skills_acrobatics.png"/>

                                                        </DataTrigger>

                                                        <DataTrigger Binding="{Binding Skill}" Value="SleightOfHand">
                                                            <Setter TargetName="ProficiencyTooltip" Property="Content" Value="h49679d28ga32fg4073gb86bgb5c5af905140"/>
                                                            <Setter TargetName="SkillIcon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared_c/c_SkillsIcons/skills_sleightOfHand.png"/>

                                                        </DataTrigger>

                                                        <DataTrigger Binding="{Binding Skill}" Value="Stealth">
                                                            <Setter TargetName="ProficiencyTooltip" Property="Content" Value="hebaa0c62gdcecg4493g98f2g4b9d4bd09c8a"/>
                                                            <Setter TargetName="SkillIcon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared_c/c_SkillsIcons/skills_stealth.png"/>

                                                        </DataTrigger>

                                                        <DataTrigger Binding="{Binding Skill}" Value="Arcana">
                                                            <Setter TargetName="ProficiencyTooltip" Property="Content" Value="h6f02c973gced3g4f0bg824egd8a9e908673e"/>
                                                            <Setter TargetName="SkillIcon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared_c/c_SkillsIcons/skills_arcana.png"/>

                                                        </DataTrigger>

                                                        <DataTrigger Binding="{Binding Skill}" Value="History">
                                                            <Setter TargetName="ProficiencyTooltip" Property="Content" Value="heaf1d1ebg749eg4c72g8660g10a7f86c96bb"/>
                                                            <Setter TargetName="SkillIcon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared_c/c_SkillsIcons/skills_history.png"/>

                                                        </DataTrigger>

                                                        <DataTrigger Binding="{Binding Skill}" Value="Investigation">
                                                            <Setter TargetName="ProficiencyTooltip" Property="Content" Value="h48b6b30bg488eg45e3gb488g9e7ccd6d99db"/>
                                                            <Setter TargetName="SkillIcon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared_c/c_SkillsIcons/skills_investigation.png"/>

                                                        </DataTrigger>

                                                        <DataTrigger Binding="{Binding Skill}" Value="Nature">
                                                            <Setter TargetName="ProficiencyTooltip" Property="Content" Value="h53d646f7g0a96g4399g830eg5bbd0525e421"/>
                                                            <Setter TargetName="SkillIcon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared_c/c_SkillsIcons/skills_nature.png"/>

                                                        </DataTrigger>

                                                        <DataTrigger Binding="{Binding Skill}" Value="Religion">
                                                            <Setter TargetName="ProficiencyTooltip" Property="Content" Value="h37367995g46d6g473bg9a2bgcb3f9f3fccaa"/>
                                                            <Setter TargetName="SkillIcon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared_c/c_SkillsIcons/skills_religion.png"/>
                                                        </DataTrigger>

                                                        <DataTrigger Binding="{Binding Skill}" Value="AnimalHandling">
                                                            <Setter TargetName="ProficiencyTooltip" Property="Content" Value="h1a87477cge794g43eag8f06ge44364db9f39"/>
                                                            <Setter TargetName="SkillIcon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared_c/c_SkillsIcons/skills_animalHandling.png"/>

                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Skill}" Value="Insight">
                                                            <Setter TargetName="ProficiencyTooltip" Property="Content" Value="h33f3ebfdg817cg480cg9dccg22c4bbceefd0"/>
                                                            <Setter TargetName="SkillIcon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared_c/c_SkillsIcons/skills_insight.png"/>

                                                        </DataTrigger>

                                                        <DataTrigger Binding="{Binding Skill}" Value="Medicine">
                                                            <Setter TargetName="ProficiencyTooltip" Property="Content" Value="h2ebacb87g7bf2g482ag8f79gfc747bb6b00b"/>
                                                            <Setter TargetName="SkillIcon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared_c/c_SkillsIcons/skills_medicine.png"/>
                                                        </DataTrigger>
                                                        
                                                        <DataTrigger Binding="{Binding Skill}" Value="Perception">
                                                            <Setter TargetName="ProficiencyTooltip" Property="Content" Value="h27c02de4g0f49g4788ga01fgca43a6f7fb13"/>
                                                            <Setter TargetName="SkillIcon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared_c/c_SkillsIcons/skills_perception.png"/>
                                                        </DataTrigger>

                                                        <DataTrigger Binding="{Binding Skill}" Value="Survival">
                                                            <Setter TargetName="ProficiencyTooltip" Property="Content" Value="ha37dde39g3bd1g410eg84e5g672e713d3445"/>
                                                            <Setter TargetName="SkillIcon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared_c/c_SkillsIcons/skills_survival.png"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Skill}" Value="Deception">
                                                            <Setter TargetName="ProficiencyTooltip" Property="Content" Value="he56b4fb7g8194g4d5fg93f9g0737ccb7875a"/>
                                                            <Setter TargetName="SkillIcon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared_c/c_SkillsIcons/skills_deception.png"/>

                                                        </DataTrigger>

                                                        <DataTrigger Binding="{Binding Skill}" Value="Intimidation">
                                                            <Setter TargetName="ProficiencyTooltip" Property="Content" Value="h1863263agc7e4g4ca0g8080g20bc6405bc5e"/>
                                                            <Setter TargetName="SkillIcon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared_c/c_SkillsIcons/skills_intimidation.png"/>

                                                        </DataTrigger>

                                                        <DataTrigger Binding="{Binding Skill}" Value="Performance">
                                                            <Setter TargetName="ProficiencyTooltip" Property="Content" Value="hebc5cb52gc046g47b5ga9bfgd0151eaa60c9"/>
                                                            <Setter TargetName="SkillIcon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared_c/c_SkillsIcons/skills_performance.png"/>

                                                        </DataTrigger>

                                                        <DataTrigger Binding="{Binding Skill}" Value="Persuasion">
                                                            <Setter TargetName="ProficiencyTooltip" Property="Content" Value="hd14e778dgecd6g45a2gb292g0361a5eb047c"/>
                                                            <Setter TargetName="SkillIcon" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared_c/c_SkillsIcons/skills_persuasion.png"/>

                                                        </DataTrigger>
                                                        
                                                        <!-- MOD_ACS: Add if positive color green -->
                                                        <DataTrigger Binding="{Binding Value, Converter={StaticResource GreaterThanConverter}, ConverterParameter=0}" Value="True">
                                                            <Setter TargetName="SkillModifier" Property="Foreground" Value="{StaticResource ACS_LS_bonusTxtColor}"/>
                                                        </DataTrigger>

                                                        <!-- MOD_ACS: Add if negative color red -->
                                                        <DataTrigger Binding="{Binding Value, Converter={StaticResource LessThanConverter}, ConverterParameter=0}" Value="True">
                                                            <Setter TargetName="SkillModifier" Property="Foreground" Value="{StaticResource ACS_LS_alertTxtColor}"/>
                                                        </DataTrigger>
                                                        
                                                        <!-- MOD_ACS: Detect if BCPP is active for party panel -->
                                                        <MultiDataTrigger>
                                                            <MultiDataTrigger.Conditions>
                                                                <Condition Binding="{Binding ParentState, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel"/>
                                                                <Condition Binding="{Binding VerticalAlignment, ElementName=CharacterRoot}" Value="Top"/>
                                                            </MultiDataTrigger.Conditions>
                                                            <Setter TargetName="SkillGrid" Property="Height" Value="56"/>
                                                        </MultiDataTrigger> 

                                                    </DataTemplate.Triggers>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <StackPanel Orientation="Vertical"/>
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                        </ItemsControl>
                                    </StackPanel>
                                </Border>
                                <DataTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="AbillitySkillSection" Property="Background" Value="{StaticResource RowBG_h}"/>
                                        <Setter TargetName="TitleName" Property="Foreground" Value="{StaticResource LS_accent100TxtColor}"/>
                                        <Setter TargetName="TitleValue" Property="Foreground" Value="{StaticResource LS_accent100TxtColor}"/>
                                        <!-- MOD_ACS: Add prepend -->
                                        <Setter TargetName="TitleValuePrepend" Property="Foreground" Value="{StaticResource LS_accent100TxtColor}"/>
                                        <!-- MOD_ACS: Add Append -->
                                        <Setter TargetName="TitleValueAppend" Property="Foreground" Value="{StaticResource LS_accent100TxtColor}"/>
                                        
                                    </Trigger>
                                    <Trigger Property="IsMouseOver" Value="True" SourceName="SkillTitle">
                                        <Setter TargetName="TitleName" Property="Foreground" Value="{StaticResource LS_tint100}"/>
                                        <Setter TargetName="TitleValue" Property="Foreground" Value="{StaticResource LS_tint100}"/>
                                        <!-- MOD_ACS: Add prepend -->
                                        <Setter TargetName="TitleValuePrepend" Property="Foreground" Value="{StaticResource LS_tint100}"/>
                                        <!-- MOD_ACS: Add Append -->
                                        <Setter TargetName="TitleValueAppend" Property="Foreground" Value="{StaticResource LS_tint100}"/>
                                    </Trigger>

                                    <!-- MOD_ACS: Add if positive color green -->
                                    <DataTrigger Binding="{Binding Modifier, Converter={StaticResource GreaterThanConverter}, ConverterParameter=0}" Value="True">
                                        <Setter TargetName="TitleValue" Property="Foreground" Value="{StaticResource ACS_LS_bonusTxtColor}"/>
                                    </DataTrigger>

                                    <!-- MOD_ACS: Add if negative color red -->
                                    <DataTrigger Binding="{Binding Modifier, Converter={StaticResource LessThanConverter}, ConverterParameter=0}" Value="True">
                                        <Setter TargetName="TitleValue" Property="Foreground" Value="{StaticResource ACS_LS_alertTxtColor}"/>
                                    </DataTrigger>

                                </DataTemplate.Triggers>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>

                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Vertical"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                    </ItemsControl>
                </Grid>
            </ScrollViewer>
        </Grid>
        <ControlTemplate.Triggers>
            <Trigger Property="IsMouseOver" Value="True" SourceName="ProficiencyBonusLegend">
                <Setter TargetName="ProficiencyBonusLabel" Property="Foreground" Value="{StaticResource LS_tint100}"/>
            </Trigger>
            
            <!-- MOD_ACS: Detect if BCPP is active for party panel -->
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding ParentState, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel"/>
                    <Condition Binding="{Binding VerticalAlignment, ElementName=CharacterRoot}" Value="Top"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="ProficiencyBonusLegendPanel" Property="Margin" Value="0,-9,0,18"/>
            </MultiDataTrigger> 
            
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <!--===== DETAILSVIEW TEMPLATE =====--> 
    <DataTemplate x:Key="CharacterSheetDetailedTemplate" DataType="{x:Type ls:Character}">
        <DataTemplate.Resources>
            <ControlTemplate x:Key="DetailedEntry">
                <ControlTemplate.Resources>
                    <Style TargetType="DockPanel">
                        <Setter Property="Margin" Value="8,0"/>
                    </Style>
                </ControlTemplate.Resources>
                <!-- MOD_ACS: Update minHeight // BG3: MinHeight="48" -->
                <Border x:Name="Entry" Style="{StaticResource RowBG_d}" MinHeight="0">
                    <ContentPresenter/>
                </Border>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter TargetName="Entry" Property="Background" Value="{StaticResource RowBG_h}"/>
                    </Trigger>
                    <!-- MOD_ACS: Detect if BCPP is active for party panel -->
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding ParentState, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel"/>
                            <Condition Binding="{Binding VerticalAlignment, ElementName=CharacterRoot}" Value="Top"/>
                        </MultiDataTrigger.Conditions>
                        <!-- MOD_ACS: Update MinHeight -->   
                        <Setter TargetName="Entry" Property="MinHeight" Value="46"/>
                    </MultiDataTrigger> 
                </ControlTemplate.Triggers>
            </ControlTemplate>

            <!--APPROVAL LIST TEMPLATE-->
            <DataTemplate x:Key="ApprovalDataTemplate" DataType="{x:Type ls:VMApprovalRating}">
                <ContentControl x:Name="entry" ToolTip="{StaticResource ManagedTooltip}" Template="{StaticResource DetailedEntry}" >
                    <Grid Margin="16,0">
                        <TextBlock HorizontalAlignment="Left" VerticalAlignment="Center" Style="{StaticResource DetailedListText}" Text="{Binding Character.Name}"/>
                        <TextBlock HorizontalAlignment="Right" VerticalAlignment="Center" Style="{StaticResource DetailedListValue}">
                                <Run Text="{Binding Rating, Converter={StaticResource ApprovalRatingToStringConverter}}"/>
                                <!-- MOD_ACS: Update StringFormat // BG3: StringFormat='({0})' -->
                                <Run Text="{Binding Rating, StringFormat='({0}/100)'}"/>
                        </TextBlock>
                    </Grid>
                </ContentControl>
            </DataTemplate>

            <ControlTemplate x:Key="ApprovalRatingTemplate" TargetType="ContentControl">
                <StackPanel x:Name="ApprovalHolder">
                    <!-- MOD_ACS: Update Style // BG3: BaseTitleStyle -->
                    <ContentControl Name="ApprovalTitle" Style="{StaticResource ACS_CS_BaseTitleStyle}" Grid.Row="0">
                        <TextBlock Text="{Binding Source='hab8d8423g3797g4f2ega601g18f13af5add6', Converter={StaticResource TranslatedStringConverter}}"/>
                    </ContentControl>
                    <ItemsControl x:Name="RatingsList" ItemsSource="{Binding ApprovalRatings}" ItemTemplate="{StaticResource ApprovalDataTemplate}"/>
                </StackPanel>
                <ControlTemplate.Triggers>
                    <DataTrigger Binding="{Binding ApprovalRatings.Count, FallbackValue=0}" Value="0">
                        <Setter TargetName="ApprovalHolder" Property="Visibility" Value="Collapsed" />
                    </DataTrigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>
        </DataTemplate.Resources>
        <Grid x:Name="DetailedPanelContent">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <ScrollViewer Grid.Row="1" Template="{StaticResource NoForcedStyleScrollViewerTemplate}" Padding="{StaticResource ScrollOffset}">
                <StackPanel>
                    <!--Health-->
                    <ContentControl Name="Health" Template="{StaticResource DetailedEntry}" DataContext="{Binding Stats.Health}" ToolTip="{StaticResource PlacementParentDCTooltip}">
                        <DockPanel>
                            <Control Template="{StaticResource StatsDisplayName}" Style="{StaticResource StatsNameStyle}"/>
                            <TextBlock Text="{Binding Max, StringFormat='/{0}'}" Style="{StaticResource SkillTitleTextStyle}"/>
                            <TextBlock Text="{Binding Value}" Style="{StaticResource SkillTitleTextStyle}"/>
                        </DockPanel>
                    </ContentControl>
                    <!--TempHealth-->
                    <ContentControl Name="TempHealth" Template="{StaticResource DetailedEntry}" DataContext="{Binding Stats.TemporaryHealth}" ToolTip="{StaticResource PlacementParentDCTooltip}" Visibility="{Binding Value, Converter={StaticResource CountToVisibilityConverter}}">
                        <DockPanel>
                            <Control Template="{StaticResource StatsDisplayName}" Style="{StaticResource StatsNameStyle}"/>
                            <TextBlock Text="{Binding Max, StringFormat='/{0}'}" Style="{StaticResource SkillTitleTextStyle}"/>
                            <TextBlock Text="{Binding Value}" Style="{StaticResource SkillTitleTextStyle}"/>
                        </DockPanel>
                    </ContentControl>
                    <!--Armour Class-->
                    <ContentControl Template="{StaticResource DetailedEntry}" DataContext="{Binding Stats.ArmorClass}" ToolTip="{StaticResource PlacementParentDCTooltip}">
                        <DockPanel>
                            <Control Template="{StaticResource StatsDisplayName}" Style="{StaticResource StatsNameStyle}"/>
                            <TextBlock Style="{StaticResource SkillTitleTextStyle}">
                                                <Run Text="{Binding Value}"/><Run Text="{Binding Max, StringFormat='/{0}'}"/>
                            </TextBlock>
                        </DockPanel>
                    </ContentControl>
                    <!--Class-->
                    <ItemsControl ItemsSource="{Binding Stats.ClassList}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <ContentControl Template="{StaticResource DetailedEntry}">
                                    <ContentControl.ToolTip>
                                        <ls:LSTooltip IsHitTestVisible="False" Content="{Binding Path=DataContext.ClassDescription, RelativeSource={RelativeSource TemplatedParent}}" ls:AttachedProperties.InheritedTag="{Binding Path=DataContext.ClassDisplayName, RelativeSource={RelativeSource TemplatedParent}}" ContentTemplate="{StaticResource HeaderBodyLocaStringTemplate}"/>
                                    </ContentControl.ToolTip>
                                    <DockPanel>
                                        <TextBlock Text="{Binding Source='h3f540c7ag325cg447egadbdgb30b8c580fa4', Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource SkillTextStyle}"/>
                                        <StackPanel DockPanel.Dock="Right">
                                            <TextBlock Style="{StaticResource SkillTitleTextStyle}" TextAlignment="Right">
                                                <TextBlock.Text>
                                                    <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                                        <Binding Source="h5df00b79ga6acg4d9fgb8dag23340151fba7"/>
                                                        <Binding Path="DataContext.Level.Value" RelativeSource="{RelativeSource Mode=Self}"/>
                                                        <Binding Path="DataContext.ClassDisplayName" RelativeSource="{RelativeSource Mode=Self}"/>
                                                    </MultiBinding>
                                                </TextBlock.Text>
                                            </TextBlock>
                                            <TextBlock Text="{Binding SubclassDisplayName}" Visibility="{Binding SubclassDisplayName, Converter={StaticResource StringToVisibilityConverter}}" Style="{StaticResource SkillTitleTextStyle}"/>
                                        </StackPanel>
                                    </DockPanel>
                                </ContentControl>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!--Race-->
                    <ContentControl Template="{StaticResource DetailedEntry}">
                        <ContentControl.ToolTip>
                            <ls:LSTooltip IsHitTestVisible="False" Content="{Binding DataContext.Stats.Race.Description, ElementName=DetailedView}" ls:AttachedProperties.InheritedTag="{Binding DataContext.Stats.Race.DisplayName, ElementName=DetailedView}" ContentTemplate="{StaticResource HeaderBodyLocaStringTemplate}"/>
                        </ContentControl.ToolTip>
                        <DockPanel>
                            <TextBlock Text="{Binding Source='h4810b5bag5482g4b47ga5b7ge7c1156969d9', Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource SkillTextStyle}"/>
                            <TextBlock Text="{Binding Stats.Race.DisplayName}" Style="{StaticResource SkillTitleTextStyle}"/>
                        </DockPanel>
                    </ContentControl>

                    <!--Background-->
                    <ContentControl Template="{StaticResource DetailedEntry}" Visibility="{Binding Stats.Background, Converter={StaticResource NullToCollapsedConverter}, ConverterParameter='EmptyString'}">
                        <ContentControl.ToolTip>
                            <ls:LSTooltip IsHitTestVisible="False" Content="{Binding DataContext.Stats.BackgroundDescription, ElementName=DetailedView}" ls:AttachedProperties.InheritedTag="{Binding DataContext.Stats.Background, ElementName=DetailedView}" ContentTemplate="{StaticResource HeaderBodyLocaStringTemplate}"/>
                        </ContentControl.ToolTip>
                        <DockPanel>
                            <TextBlock Text="{Binding Source='hd020153fg6a95g4ebegb6c3g043bb05c7bba', Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource SkillTextStyle}"/>
                            <TextBlock Text="{Binding Stats.Background}" Style="{StaticResource SkillTitleTextStyle}"/>
                        </DockPanel>
                    </ContentControl>

                    <!--Diety-->
                    <ContentControl Name="DietyRowHolder" Template="{StaticResource DetailedEntry}" Visibility="{Binding DataContext.Stats.God, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}, Converter={StaticResource StringToVisibilityConverter}}">
                        <DockPanel>
                            <TextBlock Text="{Binding Source='h5238a9c6gb90fg40bbg9335gfb37d6e91b94', Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource SkillTextStyle}"/>
                            <TextBlock Text="{Binding Stats.God}" Style="{StaticResource SkillTitleTextStyle}"/>
                        </DockPanel>
                    </ContentControl>

                    <!--Attributes-->
                    <!-- MOD_ACS: Update Style // BG3: BaseTitleStyle -->
                    <ContentControl Name="AttributesTitle" Style="{StaticResource ACS_CS_BaseTitleStyle}" Grid.Row="0">
                        <TextBlock Text="{Binding Source='h6f7a7018gd5f6g4c32g9386g6df0744d7ecd', Converter={StaticResource TranslatedStringConverter}}"/>
                    </ContentControl>

                    <ContentControl Template="{StaticResource DetailedEntry}" DataContext="{Binding Stats.Initiative}" ToolTip="{StaticResource PlacementParentDCTooltip}">
                        <DockPanel>
                            <Control Template="{StaticResource StatsDisplayName}" Style="{StaticResource StatsNameStyle}"/>
                            <TextBlock Text="{Binding Value, StringFormat={}{0:+#;-#;+0}}" Style="{StaticResource SkillTitleTextStyle}"/>
                        </DockPanel>
                    </ContentControl>

                    <ContentControl Template="{StaticResource DetailedEntry}" DataContext="{Binding Stats.MovementResource}" ToolTip="{StaticResource PlacementParentDCTooltip}">
                        <DockPanel>
                            <TextBlock Text="{Binding Name}" Style="{StaticResource SkillTextStyle}"/>
                            <TextBlock Text="{Binding MaxValue, Converter={StaticResource UnitConverter}, ConverterParameter='Distance Short'}" Style="{StaticResource SkillTitleTextStyle}"/>
                        </DockPanel>
                    </ContentControl>

                    <ContentControl x:Name="darkVisionStat" Template="{StaticResource DetailedEntry}" Visibility="{Binding DataContext.IsPlayableCharacter, ElementName=DetailedPanelContent, Converter={StaticResource BoolToVisibleConverter}}" DataContext="{Binding Stats.DarkVisionRange}">
                        <ContentControl.ToolTip>
                            <ls:LSTooltip Content="{Binding ElementName=darkVisionStat,Path=DataContext}"/>
                        </ContentControl.ToolTip>
                        <DockPanel>
                            <Control x:Name="DarkVisionRangeName" Template="{StaticResource StatsDisplayName}" Style="{StaticResource StatsNameStyle}"/>
                            <TextBlock Text="{Binding Value, Converter={StaticResource UnitConverter}, ConverterParameter='Distance Short'}" Style="{StaticResource SkillTitleTextStyle}"/>
                        </DockPanel>
                    </ContentControl>

                    <ContentControl x:Name="BodyType" Template="{StaticResource DetailedEntry}">
                        <DockPanel>
                            <TextBlock Text="{Binding Source='h83fee0c7g1777g4fddga60dg6a31e2320de2', Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource SkillTextStyle}"/>
                            <TextBlock Text="{Binding Stats.Race.Type}" Style="{StaticResource SkillTitleTextStyle}"/>
                        </DockPanel>
                    </ContentControl>

                    <ContentControl Template="{StaticResource DetailedEntry}">
                        <ContentControl.ToolTip>
                            <ls:LSTooltip Content="{Binding Source='h219ed287gbc86g4f87g93a6gb930860114e6',Converter={StaticResource TranslatedStringConverter}}"/>
                        </ContentControl.ToolTip>
                        <DockPanel>
                            <TextBlock Text="{Binding Source='hfc7ce51bga5d6g4711g8e19g3fcebf236de0', Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource SkillTextStyle}"/>
                            <Control Template="{StaticResource ObjectSizeTextTemplate}">
                                <Control.Resources>
                                    <Style TargetType="TextBlock" BasedOn="{StaticResource SkillTitleTextStyle}"/>
                                </Control.Resources>
                            </Control>
                        </DockPanel>
                    </ContentControl>

                    <ContentControl x:Name="weightStat" Template="{StaticResource DetailedEntry}" DataContext="{Binding Stats.Weight}" >
                        <ContentControl.ToolTip>
                            <ls:LSTooltip Content="{Binding ElementName=weightStat,Path=DataContext}"/>
                        </ContentControl.ToolTip>
                        <DockPanel>
                            <Control Template="{StaticResource StatsDisplayName}" Style="{StaticResource StatsNameStyle}"/>
                            <TextBlock Text="{Binding Value, Converter={StaticResource UnitConverter}, ConverterParameter='Weight Short'}" Style="{StaticResource SkillTitleTextStyle}"/>
                        </DockPanel>
                    </ContentControl>

                    <ContentControl Template="{StaticResource DetailedEntry}" Visibility="{Binding IsPlayableCharacter, Converter={StaticResource BoolToVisibleConverter}}">
                        <ContentControl.ToolTip>
                            <ls:LSTooltip Content="{Binding Source='h97226633g565ag44c0gbd64g89e70c886cba',Converter={StaticResource TranslatedStringConverter}}"/>
                        </ContentControl.ToolTip>
                        <DockPanel>
                            <TextBlock Text="{Binding Source='h3faf5e3cg719dg4b1cgb21egf2afeafb0eea', Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource SkillTextStyle}"/>
                            <TextBlock Text="{Binding EncumbranceStats.WeightMaximum, Converter={StaticResource UnitConverter}, ConverterParameter='Weight Short'}" Style="{StaticResource SkillTitleTextStyle}"/>
                        </DockPanel>
                    </ContentControl>

                    <StackPanel Visibility="{Binding IsPlayableCharacter, Converter={StaticResource BoolToVisibleConverter}}">
                        <!-- Proficiency Bonus-->
                        <!-- MOD_ACS: Update Style // BG3: BaseTitleStyle -->
                        <ContentControl Style="{StaticResource ACS_CS_BaseTitleStyle}" ToolTip="{StaticResource PlacementParentDCTooltip}" DataContext="{Binding Stats.ProficiencyBonus}" Margin="0,12">
                            <TextBlock>
                                <Run Text="{Binding Source='h65b46ad4g2eacg47d5gb4b4g124ca3b8aaef', Converter={StaticResource TranslatedStringConverter}}"/>
                                <Run Text="{Binding Value, StringFormat='(+{0})'}"/>
                            </TextBlock>
                        </ContentControl>
                        <!--Equipment Proficiency-->
                        <Control x:Name="EquipmentProficienciesBody" Template="{StaticResource WeaponProficienciesTemplate}"/>

                        <!-- SavingThrow Bonus-->
                        <!-- MOD_ACS: Update Style // BG3: BaseTitleStyle -->
                        <ContentControl Style="{StaticResource ACS_CS_BaseTitleStyle}">
                            <TextBlock Text="{Binding Source='ha1262989ge5e8g47aegb0begd830dd1a946f', Converter={StaticResource TranslatedStringConverter}}">
                                <TextBlock.ToolTip>
                                    <ls:LSTooltip IsHitTestVisible="False" Content="hb4ebc93egdb2dg4489g9386ga0b39c71b536" ls:AttachedProperties.InheritedTag="h20f2c1b6g2815g402ag8549gd6042c56c6db" Style="{StaticResource InlineTagTooltip}"/>
                                </TextBlock.ToolTip>
                            </TextBlock>
                        </ContentControl>
                        <Border Style="{StaticResource ListSectionBackground}">
                            <ItemsControl x:Name="SavingThrow" ItemsSource="{Binding Stats.Abilities}" VerticalAlignment="Center" Style="{StaticResource SavingThrowGridStyle}" Margin="0,8"/>
                        </Border>

                    </StackPanel>


                    <!--Approval-->
                    <ContentControl x:Name="approvalRatings" Template="{StaticResource ApprovalRatingTemplate}"/>

                    <!--TAGS-->
                    <StackPanel Visibility="{Binding Tags.Count, Converter={StaticResource CountToVisibilityConverter}}">
                        <!-- MOD_ACS: Update Style // BG3: BaseTitleStyle -->
                        <ContentControl Name="TagTitle" Style="{StaticResource ACS_CS_BaseTitleStyle}">
                            <TextBlock Text="{Binding Source='hd0bb8a34g4e48g4816g8ca0g234f3f99c934', Converter={StaticResource TranslatedStringConverter}}"/>
                        </ContentControl>

                        <ContentControl Template="{StaticResource DetailedEntry}">
                            <b:Interaction.Behaviors>
                                <ls:ConcatenateListBehavior x:Name="TagList" ItemsSource="{Binding Tags}" Separator="h2519408dg5fd7g4cbcg840cg14370239edf8"/>
                            </b:Interaction.Behaviors>
                            <TextBlock Style="{StaticResource DetailedListText}" Text="{Binding Result, ElementName=TagList}" TextWrapping="Wrap" HorizontalAlignment="Center" TextAlignment="Center"/>
                        </ContentControl>
                    </StackPanel>



                </StackPanel>
            </ScrollViewer>
        </Grid>
        
       
        <DataTemplate.Triggers>
            <!--Hide Diety on Examine Panel-->
            <DataTrigger Binding="{Binding Name, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="Examine" >
                <Setter TargetName="DietyRowHolder" Property="Visibility" Value="Collapsed"/>
            </DataTrigger>

            <!--Hide HP if ruleset enabled-->
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding IsPlayableCharacter}" Value="False"/>
                    <Condition Binding="{Binding DataContext.Data.CurrentRuleSetModifiers, Converter={StaticResource RuleSetModifierValueConverter}, ConverterParameter='HIDE_NPC_HP', RelativeSource={RelativeSource AncestorType=ls:UIWidget}}" Value="True"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="Health" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="Health" Property="Visibility" Value="Collapsed"/>
            </MultiDataTrigger>
        </DataTemplate.Triggers>
        

    </DataTemplate>

    <!--===== TABINATION =====-->
    <Style TargetType="TabItem" BasedOn="{StaticResource {x:Type HeaderedContentControl}}">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="TabItem">
                    <ControlTemplate.Resources>
                        <!-- MOD_ACS: Fix tabs artefacts // BG3: .../Assets/CharacterPanel/... --> 
                        <BitmapImage x:Key="TabBG_d" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/ACS/CharacterPanel/tab_body_inactive_d.png"/>
                        <BitmapImage x:Key="TabBG_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/ACS/CharacterPanel/tab_body_inactive_h.png"/>
                        <BitmapImage x:Key="TabBGSelected_d" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/ACS/CharacterPanel/tab_body_active_d.png"/>
                    </ControlTemplate.Resources>

                    <Grid x:Name="TabRoot" ToolTipService.Placement="Left" >
                        <ls:LSNineSliceImage x:Name="tab" ImageSource="{StaticResource TabBG_d}" Slices="66,36,66, 52" IconWidth="16" Padding="66,10,66,0" Height="88" Width="{Binding ActualWidth, ElementName=SummaryPanelContent, Converter={StaticResource DivideConverter}, ConverterParameter=3}"/>
                        <!-- MOD_ACS: Update Margin // BG3: Margin="40,12" -->
                        <ContentPresenter ContentSource="Header" Margin="40,16,40,8"  VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        <b:Interaction.Triggers>
                            <b:EventTrigger EventName="MouseEnter">
                                <b:Interaction.Behaviors>
                                    <b:ConditionBehavior>
                                        <b:ConditionalExpression>
                                            <b:ComparisonCondition LeftOperand="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type TabItem}}, Path=IsSelected}" Operator="NotEqual" RightOperand="True"/>
                                        </b:ConditionalExpression>
                                    </b:ConditionBehavior>
                                </b:Interaction.Behaviors>
                                <ls:LSPlaySound Sound="UI_Shared_Hover"/>
                            </b:EventTrigger>
                            <b:EventTrigger EventName="MouseDown">
                                <b:Interaction.Behaviors>
                                    <b:ConditionBehavior>
                                        <b:ConditionalExpression>
                                            <b:ComparisonCondition LeftOperand="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type TabItem}}, Path=IsSelected}" Operator="NotEqual" RightOperand="True"/>
                                        </b:ConditionalExpression>
                                    </b:ConditionBehavior>
                                </b:Interaction.Behaviors>
                                <ls:LSPlaySound Sound="UI_Shared_Panel_Select"/>
                            </b:EventTrigger>
                        </b:Interaction.Triggers>
                    </Grid>

                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="tab" Property="ImageSource" Value="{StaticResource TabBG_h}"/>
                        </Trigger>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter TargetName="tab" Property="ImageSource" Value="{StaticResource TabBGSelected_d}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="FocusVisualStyle" Value="{StaticResource Style.Focus.Inner.Uniform}"/>
    </Style>

    <Style x:Name="ColumnTemplate" TargetType="TabControl" BasedOn="{StaticResource {x:Type ItemsControl}}">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <TabPanel x:Name="HeaderPanel" IsItemsHost="True" KeyboardNavigation.TabIndex="1" Panel.ZIndex="1" Grid.Row="0" HorizontalAlignment="Center" Margin="0,0,0,-16" />
                        <Grid Grid.Row="1">
                            <ls:LSNineSliceImage x:Name="InfoBGpanel" Style="{StaticResource InnerPanelWithDecor}"/>
                            <ContentPresenter ContentSource="SelectedContent" Margin="{StaticResource CSInfoMargin}"/>
                        </Grid>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>


    <!--TAB CONTENT-->
    <ControlTemplate x:Key="CharSheetTabController" TargetType="Control">
        <Grid VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
            <TabControl>

                <!-- ====== SUMMARY TAB =======-->
                <TabItem IsSelected="True" >
                    <TabItem.Header>
                        <Border>
                            <Border.ToolTip>
                                <ls:LSTooltip Content="{Binding Source='h890f4cddg2bdcg4bb2gb73eg43fe16b11b08',Converter={StaticResource TranslatedStringConverter}}"/>
                            </Border.ToolTip>
                            <Image Width="60" Height="60" Source="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterCreation/ico_class.png" Stretch="Uniform"/>
                            
                        </Border>
                    </TabItem.Header>

                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <ScrollViewer Grid.Row="0" Template="{StaticResource NoForcedStyleScrollViewerTemplate}" Padding="{StaticResource ScrollOffset}">

                            <Grid x:Name="SummaryPanelContent">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <StackPanel Grid.Row="0">
                                    <!-- ======== NAME Stack For NPC ======== -->
                                    <Grid x:Name="NamePanelNPC" Visibility="{Binding IsPlayableCharacter, Converter={StaticResource BoolToCollapsedConverter}}">
                                        <StackPanel Grid.Row="0">
                                            <TextBlock x:Name="NPCType" Text="{Binding Stats.Race.Type}" HorizontalAlignment="Center" Style="{StaticResource DetailedListText}" TextAlignment="Center" TextWrapping="Wrap"/>
                                            <TextBlock x:Name="NPCRace" HorizontalAlignment="Center" FontSize="{DynamicResource ScaledSmallishFontSize}" TextAlignment="Center" TextWrapping="Wrap">
                                                <TextBlock.Text>
                                                    <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                                        <Binding Source="hd678d4eeg181fg499dg9e81g2146ab24e03a"/>
                                                        <Binding Path="Stats.Level.Value"/>
                                                        <Binding Path="Stats.Race.DisplayName"/>
                                                    </MultiBinding>
                                                </TextBlock.Text>
                                                <TextBlock.ToolTip>
                                                    <ls:LSTooltip IsHitTestVisible="False" Content="{Binding DataContext.Stats.Race.Description, ElementName=NPCRace}" ls:AttachedProperties.InheritedTag="{Binding DataContext.Stats.Race.DisplayName, ElementName=NPCRace}" ContentTemplate="{StaticResource HeaderBodyLocaStringTemplate}"/>
                                                </TextBlock.ToolTip>
                                            </TextBlock>

                                            <Grid x:Name="HealthbarPortrait">
                                                <Grid x:Name="HealthbarPortraiterh" Height="220" Width="152">
                                                    <ContentPresenter x:Name="portrait" ContentTemplate="{StaticResource CharacterPortraitTemplate}" Content="{Binding}"/>
                                                    <Image x:Name="Frame" Source="{StaticResource FrameImg_d}" Stretch="Uniform" IsHitTestVisible="False"/>
                                                </Grid>
                                                <Control Template="{StaticResource ACHolder}" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,0,36,0"/>

                                            </Grid>
                                            <TextBlock Text="{Binding Name}" HorizontalAlignment="Center" FontSize="{DynamicResource ScaledBigFontSize}" TextAlignment="Center" TextWrapping="Wrap"/>
                                            <TextBlock Text="{Binding Title}" Style="{StaticResource DetailedListText}" HorizontalAlignment="Center" TextWrapping="Wrap" TextAlignment="Center" Visibility="{Binding Title, Converter={StaticResource NullToCollapsedConverter}, ConverterParameter='EmptyString'}"/>
                                        </StackPanel>
                                    </Grid>

                                    <!-- ======== NAME Stack For Party ======== -->
                                    <Grid x:Name="NamePanelParty" Grid.Row="0" Visibility="{Binding IsPlayableCharacter, Converter={StaticResource BoolToVisibleConverter}}" DataContext="{Binding}">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="{Binding Stats.Race.DisplayName}" Style="{StaticResource SummaryListText}" TextWrapping="Wrap" TextAlignment="Center">
                                                <TextBlock.ToolTip>
                                                    <ls:LSTooltip IsHitTestVisible="False" Content="{Binding DataContext.Stats.Race.Description, ElementName=DetailedView}" ls:AttachedProperties.InheritedTag="{Binding DataContext.Stats.Race.DisplayName, ElementName=DetailedView}" ContentTemplate="{StaticResource HeaderBodyLocaStringTemplate}"/>
                                                </TextBlock.ToolTip>
                                            </TextBlock>
                                            <Image DataContext="{Binding Stats.ClassList[0]}" Style="{DynamicResource MainClassIconStyle}" Stretch="UniformToFill" Width="200" Margin="0,-6,0,-6">
                                                <Image.Effect>
                                                    <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="1" Color="{StaticResource tint00}"/>
                                                </Image.Effect>
                                            </Image>
                                            <TextBlock x:Name="SubclassLabel" HorizontalAlignment="Center" TextWrapping="Wrap" TextAlignment="Center" Text="{Binding Stats.ClassList[0].SubclassDisplayName}" Style="{StaticResource SummaryListText}" Visibility="{Binding Text, RelativeSource={RelativeSource Self}, Converter={StaticResource NullToCollapsedConverter}, ConverterParameter='EmptyString'}">
                                                <TextBlock.ToolTip>
                                                    <ls:LSTooltip IsHitTestVisible="False" Content="{Binding Path=DataContext.Stats.ClassList[0].SubclassDescription, ElementName=SubclassLabel}" ls:AttachedProperties.InheritedTag="{Binding DataContext.Stats.ClassList[0].SubclassDisplayName, ElementName=SubclassLabel}" ContentTemplate="{StaticResource HeaderBodyLocaStringTemplate}"/>

                                                </TextBlock.ToolTip>
                                            </TextBlock>

                                            <Control Template="{StaticResource PlayerMultiClass}" DataContext="{Binding}" />
                                        </StackPanel>
                                    </Grid>

                                    <!-- ======== ABILITIES INFO ======== -->
                                    <ItemsControl x:Name="Abilities" ItemsSource="{Binding Stats.Abilities}" VerticalAlignment="Center" Style="{StaticResource AbilitiesGridStyle}"/>

                                    <!-- MOD_ACS: Switch resistances & conditions order -->
                                    <!-- ======== RESISTANCES ======== -->
                                    <StackPanel Name="ResistancesSection">
                                        <Grid>
                                            <!-- MOD_ACS: Update Style // BG3: BaseTitleStyle -->
                                            <ContentControl Style="{StaticResource ACS_CS_BaseTitleStyle}">
                                                <!-- MOD_ACS: Add Margin -->
                                                <TextBlock Text="{Binding Source='h98a4ccfbg20f4g4294g9bf7g624c95711539', Converter={StaticResource TranslatedStringConverter}}" Margin="0,8,0,8"/>
                                            </ContentControl>
                                        </Grid>
                                        <Control x:Name="ResistanceContainer" HorizontalAlignment="Center" Template="{StaticResource ResistancesGridTemplate}"/>
                                    </StackPanel>

                                    <!-- MOD_ACS: Switch resistances & conditions order -->
                                    <!-- ======== CONDITIONS ======== -->
                                    <StackPanel Visibility="{Binding StatusEffects.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                        <!-- MOD_ACS: Update Style // BG3: BaseTitleStyle -->
                                        <ContentControl Style="{StaticResource ACS_CS_BaseTitleStyle}">
                                            <!-- MOD_ACS: Add Margin -->
                                            <TextBlock Text="{Binding Source='h3baf1fe2g7d16g4d77gbc35gc17a90fb27d6', Converter={StaticResource TranslatedStringConverter}}" Margin="0,8,0,8"/>
                                        </ContentControl>
                                        <Border Style="{StaticResource ListSectionBackground}" Visibility="{Binding StatusEffects.Count, Converter={StaticResource CountToVisibilityConverter}}">
                                            <ItemsControl x:Name="StatusHolder" ItemsSource="{Binding StatusEffects}" ItemTemplate="{StaticResource StatusListItemTemplate}" Background="Transparent" Margin="12"/>
                                        </Border>
                                    </StackPanel>

                                    <!-- ======== FEATURES ======== -->

                                    <!-- MOD_ACS: Update Style // BG3: BaseTitleStyle -->
                                    <ContentControl Style="{StaticResource ACS_CS_BaseTitleStyle}">
                                        <!-- MOD_ACS: Add Margin -->
                                        <TextBlock Text="{Binding Source='h9f9bfc7dgf4cdg4198g83e3gcb974dd2e949', Converter={StaticResource TranslatedStringConverter}}" Margin="0,8,0,8"/>
                                    </ContentControl>

                                </StackPanel>
                                <Grid Name="FeaturesList" Grid.Row="1">
                                    <Border Style="{StaticResource ListSectionBackground}">
                                        <Grid VerticalAlignment="stretch">
                                            <b:Interaction.Behaviors>
                                                <ls:CollectionFilterBehavior x:Name="AllCharacterFeaturesPredicate" ItemsSource="{Binding Stats.Passives}" Predicate="{Binding Stats.AllCharacterFeaturesPredicate}"/>
                                                <ls:CollectionFilterBehavior x:Name="FullList" ItemsSource="{Binding Stats.Passives}"/>
                                                <ls:CollectionSortBehavior x:Name="AllCharacterFeaturesSorted" ItemsSource="{Binding FilteredItems, ElementName=AllCharacterFeaturesPredicate}" Comparer="{Binding Stats.PassivesSortComparer}"/>
                                                <ls:CollectionSortBehavior x:Name="FullListSorted" ItemsSource="{Binding FilteredItems, ElementName=FullList}" Comparer="{Binding Stats.PassivesSortComparer}"/>
                                            </b:Interaction.Behaviors>
                                            <ItemsControl x:Name="FeaturesHolder" ItemsSource="{Binding SortedItems, ElementName=AllCharacterFeaturesSorted}" ItemTemplate="{StaticResource FeaturesListItemTemplate}" Margin="12" Visibility="Visible"/>
                                        </Grid>
                                    </Border>
                                </Grid>

                            </Grid>
                        </ScrollViewer>
                        
                        <!-- ======== APPROVAL BAR ======== -->

                        <Grid Grid.Row="1" x:Name="ApprovalHolder" Margin="0,8,0,0" Visibility="{Binding ApprovalRatings.Count, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=0, FallbackValue={x:Static Visibility.Collapsed}}">
                            <StackPanel Orientation="Vertical">
                                <TextBlock Style="{StaticResource DetailedListText}" HorizontalAlignment="Center" Text="{Binding Source='hab8d8423g3797g4f2ega601g18f13af5add6',Converter={StaticResource TranslatedStringConverter}}"/>
                                <Grid HorizontalAlignment="Center">
                                    <Image VerticalAlignment="Center" Source="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/bar_mainFooter.png" Stretch="None"/>
                                    <Rectangle Width="448" Height="14" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,0,0,16">
                                        <Rectangle.Fill>
                                            <LinearGradientBrush>
                                                <GradientStop Color="{StaticResource AP_Negative}" Offset="0"/>
                                                <GradientStop Color="{StaticResource AP_Neutral}" Offset="0.33"/>
                                                <GradientStop Color="{StaticResource AP_Positive}" Offset="1"/>
                                            </LinearGradientBrush>
                                        </Rectangle.Fill>
                                    </Rectangle>
                                    <Image HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,0,0,16" Source="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/bar_mainFooter_overlay.png" Stretch="None"/>

                                    <ItemsControl Width="448" Margin="0,0,0,16" ItemsSource="{Binding ApprovalRatings}" HorizontalAlignment="Center" VerticalAlignment="Center">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <Grid/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Grid x:Name="BarRoot">
                                                    <Grid.Tag>
                                                        <Binding Path="Rating" Converter="{StaticResource AddConverter}" ConverterParameter="50"/>
                                                    </Grid.Tag>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <Rectangle Grid.Column="0" Fill="Transparent" Width="{Binding Tag, ElementName=Icon, Converter={StaticResource MultiplierConverter}, ConverterParameter=388}" MaxWidth="388"/>

                                                    <Ellipse x:Name="Icon" Grid.Column="1" Stroke="{StaticResource LS_disabledPadTxtColor}" StrokeThickness="3" Fill="{Binding Character.Icon}" Width="60" Height="60" VerticalAlignment="Center" Margin="0,0,-30,0" ToolTipService.Placement="Top" ToolTip="{StaticResource ManagedTooltip}">
                                                        <Ellipse.Tag>
                                                            <Binding Path="Tag" ElementName="BarRoot" Converter="{StaticResource DivideConverter}" ConverterParameter="150"/>
                                                        </Ellipse.Tag>
                                                        <Ellipse.Effect>
                                                            <DropShadowEffect BlurRadius="10" ShadowDepth="0" Opacity="1" Color="{StaticResource tint00}"/>
                                                        </Ellipse.Effect>
                                                    </Ellipse>
                                                </Grid>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </Grid>
                            </StackPanel>
                        </Grid>
                    </Grid>
              
                </TabItem>

                <!-- ====== SKILLS TAB =======-->
                <TabItem x:Name="SkillsTab" Visibility="{Binding IsPlayableCharacter, Converter={StaticResource BoolToVisibleConverter}}">
                    <TabItem.Header>
                        <Border>
                            <Border.ToolTip>
                                <ls:LSTooltip Content="{Binding Source='h12abe296ga0fbg44feg9451gb10a0bf92acb',Converter={StaticResource TranslatedStringConverter}}"/>
                            </Border.ToolTip>
                            <Image Width="60" Height="60" Source="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterCreation/ico_skills.png" Stretch="Uniform"/>
                        </Border>
                    </TabItem.Header>
                    <Control x:Name="SkillsList" Template="{StaticResource SkillsTemplate}"/>
                </TabItem>

                <!-- ====== DETAILS TAB ======-->
                <TabItem >
                    <TabItem.Header>
                        <Border>
                            <Border.ToolTip>
                                <ls:LSTooltip Content="{Binding Source='he8e3236cgbf7eg4975gb5d8g3f4e3c0663f5',Converter={StaticResource TranslatedStringConverter}}"/>
                            </Border.ToolTip>
                            <Image Width="60" Height="60" Source="pack://application:,,,/GustavNoesisGUI;component/Assets/BottomBar/ico_identity_d.png" Stretch="Uniform"/>
                        </Border>
                    </TabItem.Header>
                    <ContentControl x:Name="DetailedView" Content="{Binding .}" ContentTemplate="{StaticResource CharacterSheetDetailedTemplate}" />
                </TabItem>

            </TabControl>
        </Grid>
        
        <ControlTemplate.Triggers>

            <!--Use NPC view for Summons-->
            <DataTrigger Binding="{Binding CharacterType}" Value="Summon">
                <Setter TargetName="NamePanelNPC" Property="Visibility" Value="Visible"/>
                <Setter TargetName="NamePanelParty" Property="Visibility" Value="Collapsed"/>
            </DataTrigger>

            <!--Use NPC view for Followers-->
            <DataTrigger Binding="{Binding CharacterType}" Value="Follower">
                <Setter TargetName="NamePanelNPC" Property="Visibility" Value="Visible"/>
                <Setter TargetName="NamePanelParty" Property="Visibility" Value="Collapsed"/>
            </DataTrigger>

            <!--Use Charactersheet in Companions Panel-->
            <DataTrigger Binding="{Binding Name, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="CompanionsPanel">
                <Setter TargetName="NamePanelNPC" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="NamePanelParty" Property="Visibility" Value="Visible"/>
                <Setter TargetName="SkillsTab" Property="Visibility" Value="Visible"/>
            </DataTrigger>

            <!--Use unfiltered Features list for Examine Panel-->
            <DataTrigger Binding="{Binding Name, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="Examine" >
                <Setter TargetName="FeaturesHolder" Property="ItemsSource" Value="{Binding SortedItems, ElementName=FullListSorted}"/>
            </DataTrigger>

            <!--show subclass when not multiclassing-->
            <DataTrigger Binding="{Binding stats.ClassList.Count, Converter={StaticResource GreaterThanConverter}, ConverterParameter=1}" Value="True" >
                <Setter TargetName="SubclassLabel" Property="Visibility" Value="Collapsed"/>
            </DataTrigger>

        </ControlTemplate.Triggers>
    </ControlTemplate>


    <!-- ===== ALCHEMY PAGE TEMPLATE ===== -->
    <ControlTemplate x:Key="AlchemyPanelTemplate">
        <ControlTemplate.Resources>
            <System:Double x:Key="IconSize">88</System:Double>
            <System:Double x:Key="ListIconSize">60</System:Double>


            <BitmapImage x:Key="NewRecipeIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/ico_exclamation.png"/>

            <BitmapImage x:Key="ExtractBg" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/crafting_bg_circle_extract.png"/>
            <BitmapImage x:Key="CombineBg" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/crafting_bg_circle_combine.png"/>
            <BitmapImage x:Key="PopUpBg" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Container/container_background.png"/>

            <BitmapImage x:Key="ExtractFlowPartialActive" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/extract_flowLines_partial.png"/>

            <BitmapImage x:Key="OrbDisabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/crafting_bg_circle_button_disabled.png"/>
            <BitmapImage x:Key="OrbEnabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/crafting_bg_circle_button_d.png"/>
            <BitmapImage x:Key="OrbEnabled_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/crafting_bg_circle_button_h.png"/>
            <BitmapImage x:Key="OrbActive" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/crafting_bg_circle_button_working_d.png"/>
            <BitmapImage x:Key="OrbActive_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/crafting_bg_circle_button_working_h.png"/>
            <BitmapImage x:Key="OrbButtonIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/crafting_bg_circle_button_ico_d.png"/>
            <BitmapImage x:Key="OrbButtonIcon_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/crafting_bg_circle_button_ico_h.png"/>

            <BitmapImage x:Key="SortBg" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/sorting_bg.png"/>

            <BitmapImage x:Key="AmountInputBg" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/btnHalf_input_d.png"/>
            <BitmapImage x:Key="AmountInputBg_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/btnHalf_input_h.png"/>

            <Style TargetType="TextBlock">
                <Setter Property="FontSize" Value="{StaticResource ScaledDefaultFontSize}"/>
            </Style>

            <Style x:Key="AlchemyAnimationStyle" TargetType="ls:AnimatedImage">
                <Setter Property="Template" Value="{StaticResource BaseAnimatedImage}"/>
                <Setter Property="Time" Value="0:0:0.033"/>
                <Setter Property="ClipSize" Value="216,240"/>
                <Setter Property="RepeatBehavior" Value="1x"/>
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/BottomBar/VFX/popExplosion.png"/>
                <Setter Property="HorizontalAlignment" Value="Center"/>
                <Setter Property="VerticalAlignment" Value="Center"/>
                <Setter Property="Visibility" Value="Hidden"/>
            </Style>

            <DataTemplate x:Key="AlchemySlotTemplate" DataType="{x:Type ls:VMItem}">
                <Grid x:Name="AlchemySlotRoot" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Image x:Name="SlotBg" Source="{DynamicResource SlotEnabled}" Stretch="None" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    <ContentPresenter x:Name="Icon" Content="{Binding .}" Width="{StaticResource IconSize}" Height="{StaticResource IconSize}" HorizontalAlignment="Center" VerticalAlignment="Center" ContentTemplate="{StaticResource Template.ItemNoCount}"/>
                    <Rectangle x:Name="GrayedIcon" Width="{StaticResource IconSize}" Height="{StaticResource IconSize}" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="{Binding Visibility, ElementName=Icon, Converter={StaticResource InvertVisibilityConverter}}" Opacity="0.5">
                        <Rectangle.Fill>
                            <ImageBrush ImageSource="{Binding Icon.ImageSource}" Viewbox="{Binding Icon.Viewbox}" ViewboxUnits="{Binding Icon.ViewboxUnits}">
                                <noesis:Brush.Shader>
                                    <ls:MonochromeBrushShader/>
                                </noesis:Brush.Shader>
                            </ImageBrush>
                        </Rectangle.Fill>
                    </Rectangle>

                    <ls:AnimatedImage x:Name="VFX" Style="{StaticResource AlchemyAnimationStyle}" Margin="-64,-76" RenderTransformOrigin="0.5,0.5" ls:AttachedProperties.InheritedNumber="{Binding Source=0, Converter={StaticResource RandomConverter}, ConverterParameter=10}">
                        <ls:AnimatedImage.RenderTransform>
                            <TransformGroup>
                                <RotateTransform>
                                    <RotateTransform.Angle>
                                        <MultiBinding Converter="{StaticResource MultiplierMultiConverter}">
                                            <Binding Path="(ls:AttachedProperties.InheritedNumber)" ElementName="VFX"/>
                                            <Binding Source="134"/>
                                        </MultiBinding>
                                    </RotateTransform.Angle>
                                </RotateTransform>
                            </TransformGroup>
                        </ls:AnimatedImage.RenderTransform>
                    </ls:AnimatedImage>

                    <b:Interaction.Triggers>
                        <b:EventTrigger EventName="MouseEnter">
                            <ls:LSPlaySound Sound="UI_Shared_Hover"/>
                        </b:EventTrigger>

                        <b:DataTrigger Binding="{Binding (ls:AnimatedImage.AnimationEnded), ElementName=VFX}" Value="True">
                            <b:InvokeCommandAction Command="{Binding DataContext.EndCreationProcess, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                        </b:DataTrigger>
                    </b:Interaction.Triggers>
                </Grid>

                <DataTemplate.Triggers>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding DataContext.IsCreatingItems, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="True"/>
                            <Condition Binding="{Binding IsVisible, ElementName=ExtractAndCrafting}" Value="True"/>
                            <Condition Binding="{Binding IsVisible, ElementName=AlchemySlotRoot}" Value="True"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="VFX" Property="Visibility" Value="Visible"/>
                    </MultiDataTrigger>

                    <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource TemplatedParent}}" Value="True">
                        <Setter TargetName="SlotBg" Property="Source" Value="{DynamicResource SlotEnabled_h}"/>
                    </DataTrigger>

                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding DataContext.IsCreatingItems, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="False"/>
                            <Condition Binding="{Binding Count}" Value="0"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="SlotBg" Property="Source" Value="{DynamicResource SlotDisabled}"/>
                        <Setter TargetName="Icon" Property="Visibility" Value="Collapsed"/>
                    </MultiDataTrigger>

                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding DataContext.IsCreatingItems, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="False"/>
                            <Condition Binding="{Binding Count}" Value="0"/>
                            <Condition Binding="{Binding IsMouseOver, RelativeSource={RelativeSource TemplatedParent}}" Value="True"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="SlotBg" Property="Source" Value="{DynamicResource SlotDisabled_h}"/>
                        <Setter TargetName="Icon" Property="Visibility" Value="Collapsed"/>
                    </MultiDataTrigger>

                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding DataContext.IsCreatingItems, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="False"/>
                            <Condition Binding="{Binding (ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Self}}" Value="CustomCount"/>
                            <Condition Value="False">
                                <Condition.Binding>
                                    <MultiBinding Converter="{StaticResource LessThanOrEqualMultiConverter}">
                                        <Binding Path="(ls:AttachedProperties.InheritedNumber)" RelativeSource="{RelativeSource Self}"/>
                                        <Binding Path="Count"/>
                                    </MultiBinding>
                                </Condition.Binding>
                            </Condition>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="SlotBg" Property="Source" Value="{DynamicResource SlotDisabled}"/>
                        <Setter TargetName="Icon" Property="Visibility" Value="Collapsed"/>
                    </MultiDataTrigger>

                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding DataContext.IsCreatingItems, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="False"/>
                            <Condition Binding="{Binding (ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Self}}" Value="CustomCount"/>
                            <Condition Value="False">
                                <Condition.Binding>
                                    <MultiBinding Converter="{StaticResource LessThanOrEqualMultiConverter}">
                                        <Binding Path="(ls:AttachedProperties.InheritedNumber)" RelativeSource="{RelativeSource Self}"/>
                                        <Binding Path="Count"/>
                                    </MultiBinding>
                                </Condition.Binding>
                            </Condition>
                            <Condition Binding="{Binding IsMouseOver, RelativeSource={RelativeSource TemplatedParent}}" Value="True"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="SlotBg" Property="Source" Value="{DynamicResource SlotDisabled_h}"/>
                        <Setter TargetName="Icon" Property="Visibility" Value="Collapsed"/>
                    </MultiDataTrigger>
                </DataTemplate.Triggers>
            </DataTemplate>

            <!-- RECIPES -->
            <ControlTemplate x:Key="ListEntryTemplate" TargetType="ContentControl">
                <Grid x:Name="RecipeEntryRoot">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Border x:Name="Background" Grid.Column="0" Grid.ColumnSpan="2" Background="{StaticResource LS_accent100TxtColor}" Opacity="0" CornerRadius="12" />
                    <ContentPresenter x:Name="Content" Grid.Column="0" Content="{TemplateBinding Content}" ContentTemplate="{TemplateBinding ContentTemplate}"/>
                    <Image x:Name="IsNewIcon" Grid.Column="1" Source="{StaticResource NewRecipeIcon}" Stretch="None" VerticalAlignment="Center" Visibility="{Binding IsNew, Converter={StaticResource BoolToVisibleConverter}, ConverterParameter={StaticResource TrueValue}}"/>

                    <b:Interaction.Triggers>
                        <b:EventTrigger EventName="MouseEnter">
                            <ls:LSPlaySound Sound="UI_Shared_Hover"/>
                        </b:EventTrigger>
                    </b:Interaction.Triggers>
                </Grid>

                <ControlTemplate.Triggers>
                    <Trigger Property="Tag" Value="Disabled">
                        <Setter TargetName="Background" Property="Background" Value="{StaticResource LS_disabledPadTxtColor}"/>
                    </Trigger>
                    <Trigger Property="Tag" Value="Selected">
                        <Setter TargetName="Background" Property="Opacity" Value="0.4"/>
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>

            <Style x:Key="ListEntryStyle" TargetType="ContentControl">
                <Setter Property="Template" Value="{StaticResource ListEntryTemplate}" />
                <Setter Property="ToolTipService.Placement" Value="Right"/>
                <Setter Property="noesis:StyleInteraction.Triggers">
                    <Setter.Value>
                        <noesis:StyleTriggerCollection>
                            <b:EventTrigger EventName="PreviewMouseLeftButtonUp">
                                <ls:LSPlaySound Sound="UI_Shared_Click"/>
                            </b:EventTrigger>
                            <b:EventTrigger EventName="PreviewMouseLeftButtonDown">
                                <ls:LSPlaySound Sound="UI_Shared_Secondary_Press"/>
                            </b:EventTrigger>
                            <b:EventTrigger EventName="MouseEnter">
                                <ls:LSPlaySound Sound="UI_Shared_Hover"/>
                            </b:EventTrigger>
                        </noesis:StyleTriggerCollection>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="ListEntryTextStyle" TargetType="TextBlock">
                <Setter Property="Foreground" Value="{StaticResource LS_accent75TxtColor}"/>
                <Setter Property="VerticalAlignment" Value="Center"/>
                <Setter Property="TextWrapping" Value="Wrap"/>
                <Setter Property="LineStackingStrategy" Value="BlockLineHeight"/>
                <Setter Property="LineHeight" Value="{StaticResource ScaledDefaultFontSizeLineHeight}"/>
            </Style>

            <Style x:Key="AlchemyWrappingText" TargetType="TextBlock">
                <Setter Property="HorizontalAlignment" Value="Center"/>
                <Setter Property="VerticalAlignment" Value="Top"/>
                <Setter Property="TextWrapping" Value="Wrap"/>
                <Setter Property="LineStackingStrategy" Value="BlockLineHeight"/>
                <Setter Property="TextAlignment" Value="Center"/>
            </Style>

            <DataTemplate x:Key="RecipesListTemplate" DataType="{x:Type ls:VMRecipesCollection}">
                <StackPanel>
                    <b:Interaction.Behaviors>
                        <ls:CollectionSortBehavior x:Name="RecipesSortBehavior" ItemsSource="{Binding Recipes}" Comparer="{Binding DataContext.AlchemyRecipesComparer, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" />
                    </b:Interaction.Behaviors>

                    <ls:LSToggleButton x:Name="ExpandToggle" IsChecked="False" Height="64">
                        <ls:LSToggleButton.Template>
                            <ControlTemplate TargetType="{x:Type ls:LSToggleButton}">
                                <ControlTemplate.Resources>
                                    <BitmapImage x:Key="Arrow_d" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/listItem_expandToggle_default.png"/>
                                    <BitmapImage x:Key="Arrow_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/listItem_expandToggle_active.png"/>

                                    <Style TargetType="TextBlock">
                                        <Setter Property="FontSize" Value="{StaticResource ScaledDefaultFontSize}"/>
                                    </Style>
                                </ControlTemplate.Resources>

                                <StackPanel Orientation="Horizontal" Background="Transparent">
                                    <Image x:Name="ToggleIcon" Source="{StaticResource Arrow_d}" Stretch="None" Margin="10,0" RenderTransformOrigin="0.5,0.5"/>

                                    <ContentPresenter x:Name="content" HorizontalAlignment="Left" VerticalAlignment="Center"/>
                                </StackPanel>

                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="ToggleIcon" Property="Source" Value="{StaticResource Arrow_h}"/>
                                    </Trigger>
                                    <Trigger Property="IsChecked" Value="True">
                                        <Setter TargetName="ToggleIcon" Property="RenderTransform">
                                            <Setter.Value>
                                                <TransformGroup>
                                                    <RotateTransform Angle="90"/>
                                                </TransformGroup>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </ls:LSToggleButton.Template>

                        <StackPanel Orientation="Horizontal">
                            <Image x:Name="GroupIcon" Source="{DynamicResource GroupIcon}" Stretch="Uniform" Width="{StaticResource ListIconSize}" Height="{StaticResource ListIconSize}" VerticalAlignment="Center" HorizontalAlignment="Center"  Margin="8,0"/>
                            <TextBlock x:Name="GroupName" VerticalAlignment="Center" Foreground="{StaticResource LS_accent75TxtColor}">
                                <Run Text="{Binding (ls:AttachedProperties.InheritedTag), RelativeSource={RelativeSource Mode=Self}}"/><Run 
                                    x:Name="CraftableCount" Text="{Binding TotalCraftableRecipes, StringFormat='{} ({0}/'}"/><Run 
                                    x:Name="GroupCount" Text="{Binding ItemsSource.Count, ElementName=RecipesList, StringFormat='{}{0})'}"/>
                            </TextBlock>
                        </StackPanel>
                    </ls:LSToggleButton>

                    <ItemsControl x:Name="RecipesList" AlternationCount="{Binding ItemsSource.Count, RelativeSource={RelativeSource Self}}"
                                      ItemsSource="{Binding SortedItems, ElementName=RecipesSortBehavior}"
                                      Visibility="{Binding Path=IsChecked, ElementName=ExpandToggle, Converter={StaticResource BoolToVisibleConverter}}">
                        <ItemsControl.ItemContainerStyle>
                            <Style TargetType="ContentPresenter">
                                <Style.Triggers>
                                    <MultiDataTrigger>
                                        <MultiDataTrigger.Conditions>
                                            <Condition Binding="{Binding DataContext.HideAvailableRecipes, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="True"/>
                                            <Condition Binding="{Binding DataContext.CanBeCrafted, RelativeSource={RelativeSource Self}}" Value="False"/>
                                        </MultiDataTrigger.Conditions>
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </MultiDataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ItemsControl.ItemContainerStyle>

                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="{x:Type ls:VMRecipe}">
                                <ContentControl x:Name="EntryRoot" Style="{StaticResource ListEntryStyle}">
                                    <ContentControl.ToolTip>
                                        <ls:LSTooltip Content="{Binding DataContext.Result, ElementName=EntryRoot}"/>
                                    </ContentControl.ToolTip>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <ContentPresenter x:Name="Icon" Grid.Column="0" Content="{Binding Result.Item}" Width="72" Height="72" VerticalAlignment="Center" ClipToBounds="False" Margin="8,0,0,0" ContentTemplate="{StaticResource Template.ItemNoCount}"/>
                                        <TextBlock x:Name="Name" Grid.Column="1" Text="{Binding Result.Item.NameAlchemy}" Style="{StaticResource ListEntryTextStyle}" Margin="12,12"/>
                                        <Button Grid.Column="0" Grid.ColumnSpan="2" Command="{Binding DataContext.ChangeSelectedRecipe, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="{Binding .}" Background="Transparent"/>
                                    </Grid>
                                </ContentControl>

                                <DataTemplate.Triggers>
                                    <DataTrigger Binding="{Binding CanBeCrafted}" Value="False">
                                        <Setter TargetName="Icon" Property="Opacity" Value="0.8"/>
                                        <Setter TargetName="Name" Property="Foreground" Value="{StaticResource LS_accent00TxtColor}"/>
                                        <Setter TargetName="EntryRoot" Property="Tag" Value="Disabled"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding IsMouseOver, ElementName=EntryRoot}" Value="True">
                                        <Setter TargetName="Icon" Property="Opacity" Value="1"/>
                                        <Setter TargetName="Name" Property="Foreground" Value="{StaticResource LS_tint100}"/>
                                    </DataTrigger>
                                    <DataTrigger Value="True">
                                        <DataTrigger.Binding>
                                            <MultiBinding Converter="{StaticResource EqualConverter}">
                                                <Binding Path="DataContext.SelectedRecipe" RelativeSource="{RelativeSource AncestorType={x:Type ls:UIWidget}}"/>
                                                <Binding Path="."/>
                                            </MultiBinding>
                                        </DataTrigger.Binding>
                                        <Setter TargetName="EntryRoot" Property="Tag" Value="Selected"/>
                                        <Setter TargetName="Name" Property="Opacity" Value="1"/>
                                        <Setter TargetName="Icon" Property="Opacity" Value="1"/>
                                        <Setter TargetName="Name" Property="Foreground" Value="{StaticResource LS_tint100}"/>
                                    </DataTrigger>
                                </DataTemplate.Triggers>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>

                <DataTemplate.Triggers>
                    <DataTrigger Binding="{Binding IsMouseOver, ElementName=ExpandToggle}" Value="True">
                        <Setter TargetName="GroupIcon" Property="Source" Value="{DynamicResource GroupIcon_h}"/>
                        <Setter TargetName="GroupName" Property="Foreground" Value="{StaticResource LS_accent100TxtColor}"/>
                    </DataTrigger>
                </DataTemplate.Triggers>
            </DataTemplate>

            <!-- CRAFTING -->
            <DataTemplate x:Key="CraftingSlot" DataType="{x:Type ls:VMItem}">
                <StackPanel x:Name="EntryRoot" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <StackPanel.Resources>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="{StaticResource LS_accent100TxtColor}"/>
                            <Setter Property="Width" Value="600"/>
                            <Setter Property="TextAlignment" Value="Center"/>
                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                        </Style>
                    </StackPanel.Resources>
                    <b:Interaction.Triggers>
                        <b:EventTrigger EventName="MouseLeftButtonUp">
                            <b:Interaction.Behaviors>
                                <b:ConditionBehavior>
                                    <b:ConditionalExpression>
                                        <b:ComparisonCondition LeftOperand="{Binding Path=Tag, RelativeSource={RelativeSource TemplatedParent}}" Operator="Equal" RightOperand="Extra"/>
                                    </b:ConditionalExpression>
                                </b:ConditionBehavior>
                            </b:Interaction.Behaviors>
                            <ls:LSPlaySound Sound="UI_Shared_Click"/>
                            <b:ChangePropertyAction TargetName="ExtractSelectionControl" PropertyName="Visibility" Value="Visible"/>
                        </b:EventTrigger>
                    </b:Interaction.Triggers>

                    <TextBlock x:Name="Title" Foreground="{StaticResource LS_accent75TxtColor}" Visibility="{Binding Text, RelativeSource={RelativeSource Self}, Converter={StaticResource NullToHiddenConverter}, ConverterParameter='EmptyString'}"/>

                    <TextBlock x:Name="Name">
                        <Run x:Name="NamePrefix" Foreground="{StaticResource LS_accent75TxtColor}"/><Run x:Name="NameText" Text="{Binding NameAlchemy}" Foreground="{StaticResource LS_extraspecialTxtColor}"/>
                    </TextBlock>

                    <ContentControl x:Name="Slot" HorizontalAlignment="Center" VerticalAlignment="Center" ContentTemplate="{StaticResource AlchemySlotTemplate}" Content="{Binding .}" Tag="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}}">
                        <ContentControl.Resources>
                            <BitmapImage x:Key="SlotEnabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/crafting_itemFrame_default.png"/>
                            <BitmapImage x:Key="SlotEnabled_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/crafting_itemFrame_default_h.png"/>
                            <BitmapImage x:Key="SlotDisabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/crafting_itemFrame_error.png"/>
                            <BitmapImage x:Key="SlotDisabled_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/crafting_itemFrame_error_h.png"/>
                        </ContentControl.Resources>
                    </ContentControl>

                    <TextBlock x:Name="Count" Text="{Binding Count, StringFormat='{}{0}/1'}" Foreground="{StaticResource LS_tint100}"/>
                </StackPanel>

                <DataTemplate.Triggers>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding DataContext.IsCreatingItems, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="False"/>
                            <Condition Binding="{Binding Count}" Value="0"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="Count" Property="Foreground" Value="{StaticResource LS_alertTxtColor}"/>
                    </MultiDataTrigger>

                    <DataTrigger Binding="{Binding Tag, RelativeSource={RelativeSource Self}}" Value="Extra">
                        <Setter TargetName="Count" Property="Text" Value="{Binding DataContext.TotalAvailableExtraExtracts, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}, StringFormat='{}{0}/1'}"/>
                    </DataTrigger>

                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding DataContext.IsCreatingItems, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="False"/>
                            <Condition Binding="{Binding Tag, RelativeSource={RelativeSource Self}}" Value="False"/>
                            <Condition Binding="{Binding Count}" Value="0"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="Name" Property="Foreground" Value="{StaticResource LS_alertTxtColor}"/>
                    </MultiDataTrigger>

                    <!-- Main extract titles based on the extract type -->
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding Tag, RelativeSource={RelativeSource Self}}" Value="Main"/>
                            <Condition Binding="{Binding AlchemyExtractType}" Value="Air"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="Title" Property="Text" Value="{Binding Source='hb918ad87gcdc2g4809g922dg0f6c34595e6b',Converter={StaticResource TranslatedStringConverter}}"/>
                    </MultiDataTrigger>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding Tag, RelativeSource={RelativeSource Self}}" Value="Main"/>
                            <Condition Binding="{Binding AlchemyExtractType}" Value="Earth"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="Title" Property="Text" Value="{Binding Source='h9cfa94d3g61b5g4bdcg91fag64d138bad8a2',Converter={StaticResource TranslatedStringConverter}}"/>
                    </MultiDataTrigger>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding Tag, RelativeSource={RelativeSource Self}}" Value="Main"/>
                            <Condition Binding="{Binding AlchemyExtractType}" Value="Fey"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="Title" Property="Text" Value="{Binding Source='hbd8f16fbgcc72g489egb97eg3b6c414331a1',Converter={StaticResource TranslatedStringConverter}}"/>
                    </MultiDataTrigger>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding Tag, RelativeSource={RelativeSource Self}}" Value="Main"/>
                            <Condition Binding="{Binding AlchemyExtractType}" Value="Fire"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="Title" Property="Text" Value="{Binding Source='h85ae0acdg4ddeg4f26g8bd6g3350c47e10d7',Converter={StaticResource TranslatedStringConverter}}"/>
                    </MultiDataTrigger>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding Tag, RelativeSource={RelativeSource Self}}" Value="Main"/>
                            <Condition Binding="{Binding AlchemyExtractType}" Value="Shadow"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="Title" Property="Text" Value="{Binding Source='h6882b06eg7116g4d13ga04cg40936915be3c',Converter={StaticResource TranslatedStringConverter}}"/>
                    </MultiDataTrigger>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding Tag, RelativeSource={RelativeSource Self}}" Value="Main"/>
                            <Condition Binding="{Binding AlchemyExtractType}" Value="Water"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="Title" Property="Text" Value="{Binding Source='hc73e4e3ag44c0g49b7g96f8g732f01f8270a',Converter={StaticResource TranslatedStringConverter}}"/>
                    </MultiDataTrigger>

                    <!-- Extra extract names based on the extract type -->
                    <DataTrigger Binding="{Binding Tag, RelativeSource={RelativeSource Self}}" Value="Extra">
                        <Setter TargetName="NamePrefix" Property="Text" Value="{Binding Source='h7bf9cc90gb598g426egb932g150189db5be7',Converter={StaticResource TranslatedStringConverter}, StringFormat='{}{0} '}"/>
                    </DataTrigger>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding Tag, RelativeSource={RelativeSource Self}}" Value="Extra"/>
                            <Condition Binding="{Binding AlchemyExtractType}" Value="Air"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="NameText" Property="Text" Value="{Binding Source='h2c1af163gda89g4142g8670g492407614241',Converter={StaticResource TranslatedStringConverter}}"/>
                    </MultiDataTrigger>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding Tag, RelativeSource={RelativeSource Self}}" Value="Extra"/>
                            <Condition Binding="{Binding AlchemyExtractType}" Value="Earth"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="NameText" Property="Text" Value="{Binding Source='h53369a2cgd283g467cg924cg3938e9bbdc30',Converter={StaticResource TranslatedStringConverter}}"/>
                    </MultiDataTrigger>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding Tag, RelativeSource={RelativeSource Self}}" Value="Extra"/>
                            <Condition Binding="{Binding AlchemyExtractType}" Value="Fey"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="NameText" Property="Text" Value="{Binding Source='h17759c79g9c66g4cf4ga71bg82b7914319a1',Converter={StaticResource TranslatedStringConverter}}"/>
                    </MultiDataTrigger>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding Tag, RelativeSource={RelativeSource Self}}" Value="Extra"/>
                            <Condition Binding="{Binding AlchemyExtractType}" Value="Fire"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="NameText" Property="Text" Value="{Binding Source='hd7d538e9gd122g4216g9b2aga1c7aaa5c7ef',Converter={StaticResource TranslatedStringConverter}}"/>
                    </MultiDataTrigger>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding Tag, RelativeSource={RelativeSource Self}}" Value="Extra"/>
                            <Condition Binding="{Binding AlchemyExtractType}" Value="Shadow"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="NameText" Property="Text" Value="{Binding Source='hee19fd7fg6d6fg4f9fg83d7ge350d0ea4a8d',Converter={StaticResource TranslatedStringConverter}}"/>
                    </MultiDataTrigger>
                    <MultiDataTrigger>
                        <MultiDataTrigger.Conditions>
                            <Condition Binding="{Binding Tag, RelativeSource={RelativeSource Self}}" Value="Extra"/>
                            <Condition Binding="{Binding AlchemyExtractType}" Value="Water"/>
                        </MultiDataTrigger.Conditions>
                        <Setter TargetName="NameText" Property="Text" Value="{Binding Source='h7f02c548g5195g434egb3edg30c0a31130e1',Converter={StaticResource TranslatedStringConverter}}"/>
                    </MultiDataTrigger>
                </DataTemplate.Triggers>
            </DataTemplate>

            <!-- EXTRACT CRAFTING -->
            <DataTemplate x:Key="ExtractCraftingSlot" DataType="{x:Type ls:VMTooltipItemSectionDetail}">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" >
                    <ContentControl x:Name="Slot" ContentTemplate="{StaticResource AlchemySlotTemplate}" Content="{Binding Item}" ToolTip="{StaticResource ManagedTooltip}" ToolTipService.Placement="Left" ls:AttachedProperties.InheritedTag="CustomCount" >
                        <ContentControl.Resources>
                            <BitmapImage x:Key="SlotEnabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/extract_itemSlot_active.png"/>
                            <BitmapImage x:Key="SlotEnabled_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/extract_itemSlot_active_h.png"/>
                            <BitmapImage x:Key="SlotDisabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/extract_itemSlot_inactive.png"/>
                            <BitmapImage x:Key="SlotDisabled_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/extract_itemSlot_inactive_h.png"/>
                        </ContentControl.Resources>
                    </ContentControl>

                    <Image x:Name="ActiveLine" Source="{StaticResource ExtractFlowPartialActive}" Visibility="Hidden" HorizontalAlignment="Center" Stretch="None" Margin="0,-10,0,10"/>
                </StackPanel>

                <DataTemplate.Triggers>
                    <DataTrigger Value="True">
                        <DataTrigger.Binding>
                            <MultiBinding Converter="{StaticResource LessThanOrEqualMultiConverter}">
                                <Binding Path="(ls:AttachedProperties.InheritedNumber)" RelativeSource="{RelativeSource Self}"/>
                                <Binding Path="Item.Count"/>
                            </MultiBinding>
                        </DataTrigger.Binding>
                        <Setter TargetName="ActiveLine" Property="Visibility" Value="Visible"/>
                    </DataTrigger>
                </DataTemplate.Triggers>
            </DataTemplate>

            <!-- SORTING -->
            <ControlTemplate x:Key="SortButtonTemplate" TargetType="ls:LSButton">
                <ControlTemplate.Resources>
                    <BitmapImage x:Key="EntryBg" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/selector_listitem_d.png"/>
                    <BitmapImage x:Key="EntryBg_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/selector_listitem_h.png"/>
                    <BitmapImage x:Key="BulletIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/ico_bullet_d.png"/>
                    <BitmapImage x:Key="BulletIcon_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/ico_bullet_h.png"/>
                </ControlTemplate.Resources>
                <Grid x:Name="Entry">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Image x:Name="bg" Grid.Column="0" Grid.ColumnSpan="2" Source="{StaticResource EntryBg}" Stretch="None"/>
                    <Image x:Name="icon" Grid.Column="0" Source="{StaticResource BulletIcon}" Stretch="None" Margin="20,0,0,0"/>
                    <TextBlock x:Name="text" Grid.Column="1" Text="{Binding Tag, RelativeSource={RelativeSource TemplatedParent}}" Foreground="{StaticResource LS_accent25TxtColor}" Margin="20,0,0,0" HorizontalAlignment="Left" VerticalAlignment="Center"/>
                </Grid>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter TargetName="bg" Property="Source" Value="{StaticResource EntryBg_h}"/>
                        <Setter TargetName="icon" Property="Source" Value="{StaticResource BulletIcon_h}"/>
                        <Setter TargetName="text" Property="Foreground" Value="{StaticResource LS_accent100TxtColor}"/>
                    </Trigger>
                    <Trigger Property="IsEnabled" Value="False">
                        <Setter TargetName="Entry" Property="Opacity" Value="0.85"/>
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>

            <!-- PROCESS -->
            <Storyboard x:Key="ResultMessageStoryboard">
                <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="Opacity" Storyboard.TargetName="ExtractCraftingMessage">
                    <EasingDoubleKeyFrame KeyTime="0:0:0.0" Value="0"/>
                    <EasingDoubleKeyFrame KeyTime="0:0:0.2" Value="1"/>
                    <EasingDoubleKeyFrame KeyTime="0:0:2.8" Value="1"/>
                    <EasingDoubleKeyFrame KeyTime="0:0:3" Value="0"/>
                </DoubleAnimationUsingKeyFrames>
            </Storyboard>

            <!--===== POP OUT ALCHEMY TEMPLATE =====-->

            <ControlTemplate x:Key="PopOutAlchemyTemplate" TargetType="Control">
                <ls:LSNineSliceImage x:Name="PopOutAlchemyRoot" Slices="48 40 48 100" Height="600" Width="700" ImageSource="{StaticResource PopUpBg}">
                    <b:Interaction.Triggers>
                        <!--if popup menu opened and its NewRecipe -> update selected slot to the first one (this will always be selected extract, because of ExtraExtractComparer sort)-->
                        <b:DataTrigger Binding="{Binding ElementName=ExtractSelectionControl, Path=Visibility}" Value="Visible">
                            <b:Interaction.Behaviors>
                                <b:ConditionBehavior >
                                    <b:ConditionalExpression>
                                        <b:ComparisonCondition LeftOperand="{Binding ElementName=ExtractSelectionControl, Path=Tag}" Operator="Equal" RightOperand="NewRecipe"/>
                                    </b:ConditionalExpression>
                                </b:ConditionBehavior>
                            </b:Interaction.Behaviors>
                            <b:ChangePropertyAction TargetName="IngredientsListBox" PropertyName="SelectedIndex" Value="0"/>
                        </b:DataTrigger>
                    </b:Interaction.Triggers>

                    <Grid x:Name="IngredientPanelHolder" Margin="0,24,0,36" Background="Transparent" VerticalAlignment="Top" HorizontalAlignment="Center">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <StackPanel x:Name="IngredientPanel" Grid.Row="0">
                            <b:Interaction.Behaviors>
                                <ls:InventoriesMergerBehavior x:Name="PlayerInventoriesMerged" Inventories="{Binding DataContext.CurrentPlayer.PartyInventory, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                                <ls:CollectionFilterBehavior x:Name="AlchemyInventoryFiltered" ItemsSource="{Binding InventoriesSlots, ElementName=PlayerInventoriesMerged}"
                                                             Predicate="{Binding DataContext.ExtraExtractPredicate, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                                <ls:CollectionSortBehavior x:Name="AlchemyInventorySorted" ItemsSource="{Binding FilteredItems, ElementName=AlchemyInventoryFiltered}"
                                                           Comparer="{Binding DataContext.ExtraExtractComparer, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                            </b:Interaction.Behaviors>
                            <TextBlock x:Name="AlchemyFilterHeader" FontSize="{StaticResource ScaledBigFontSize}" Margin="0,20,0,-10" HorizontalAlignment="Center">
                                <TextBlock.Text>
                                    <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                        <Binding Source="h326832c1gfe11g4b60g9165g26d05fcd0919"/>
                                        <Binding Path="DataContext.SelectedExtraExtract.NameAlchemy" RelativeSource="{RelativeSource AncestorType={x:Type ls:UIWidget}}"/>
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>
                            <ListBox Name="IngredientsListBox" Grid.Row="0" ItemsSource="{Binding SortedItems, ElementName=AlchemyInventorySorted}" SelectionMode="Single" HorizontalAlignment="Left" Grid.ColumnSpan="2" 
                                     Margin="50,20,50,10" MinWidth="598" Background="Transparent" ItemTemplate="{StaticResource Template.InventorySlot}" Height="342">
                                <ListBox.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <ls:LSGrid x:Name="ContainerGrid" Columns="5" Rows="3" Style="{StaticResource ContainerGridStyle}" AutoIndex="True"/>
                                    </ItemsPanelTemplate>
                                </ListBox.ItemsPanel>
                                <ListBox.ItemContainerStyle>
                                    <Style TargetType="ListBoxItem" BasedOn="{StaticResource BaseInvContainerItemStyle}">
                                        <Setter Property="noesis:StyleInteraction.Triggers">
                                            <Setter.Value>
                                                <noesis:StyleTriggerCollection>
                                                    <b:EventTrigger EventName="MouseDoubleClick">
                                                        <b:InvokeCommandAction Command="{Binding DataContext.SelectExtraExtractCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"
                                                                               CommandParameter="{Binding .}"/>
                                                        <b:ChangePropertyAction TargetObject="{Binding ElementName=ExtractSelectionControl}" PropertyName="Visibility" Value="Collapsed"/>
                                                        <b:ChangePropertyAction TargetObject="{Binding ElementName=ExtractSelectionControl}" PropertyName="Tag" Value="ExtractChanged"/>
                                                    </b:EventTrigger>
                                                </noesis:StyleTriggerCollection>
                                            </Setter.Value>
                                        </Setter>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ListBoxItem">
                                                    <ls:LSEntityObject x:Name="CellRoot" Context="{x:Null}" ls:ContextMenuService.GenerateEnabled="False"
                                                                       DataContext="{Binding Object}" EntityRef="{Binding EntityHandle}" Background="Transparent" ToolTipService.Placement="Right">
                                                        <ls:LSEntityObject.ToolTip>
                                                            <ls:LSTooltip Content="{Binding DataContext.Object,RelativeSource={RelativeSource Mode=TemplatedParent}}"/>
                                                        </ls:LSEntityObject.ToolTip>
                                                        <b:Interaction.Triggers>
                                                            <b:EventTrigger EventName="MouseEnter">
                                                                <ls:LSPlaySound Sound="UI_Shared_Hover"/>
                                                            </b:EventTrigger>
                                                        </b:Interaction.Triggers>
                                                        <ContentPresenter  IsHitTestVisible="False"/>
                                                        <Image x:Name="SelectedImg" Source="{StaticResource InvSlot_Selector}" IsHitTestVisible="False" Visibility="Hidden" Opacity="1.0" />
                                                    </ls:LSEntityObject>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsSelected" Value="True">
                                                            <Setter TargetName="SelectedImg" Property="Visibility" Value="Visible" />
                                                            <Setter TargetName="SelectedImg" Property="Opacity" Value="0.8"/>
                                                        </Trigger>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="SelectedImg" Property="Visibility" Value="Visible" />
                                                            <Setter TargetName="SelectedImg" Property="Opacity" Value="1.0"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </ListBox.ItemContainerStyle>
                            </ListBox>
                        </StackPanel>

                        <ls:LSButton Style="{StaticResource PopUpCloseButton}" x:Name="CloseBtn" Grid.Row="0" VerticalAlignment="Top"
                                     HorizontalAlignment="Right" Margin="0,-14,8,0">
                            <b:Interaction.Triggers>
                                <b:EventTrigger EventName="LSButtonReleased">
                                    <b:ChangePropertyAction TargetName="ExtractSelectionControl" PropertyName="Visibility" Value="Collapsed"/>
                                </b:EventTrigger>
                            </b:Interaction.Triggers>
                        </ls:LSButton>

                        <ls:LSButton Grid.Row="1" FontFamily="{StaticResource DefaultFont}" HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,10" Style="{StaticResource BigBlueButtonStyle}"
                                     IsEnabled="{Binding ElementName=IngredientsListBox, Path=SelectedItem, Converter={StaticResource NullToBoolFalseConverter}, FallbackValue=False}"
                                     Command="{Binding DataContext.SelectExtraExtractCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"
                                     CommandParameter="{Binding SelectedItem, ElementName=IngredientsListBox}"
                                     Content="{Binding Source='h04f38549g65b8g4b72g834eg87ee8863fdc5', Converter={StaticResource TranslatedStringConverter}}">
                            <b:Interaction.Triggers>
                                <b:EventTrigger EventName="LSButtonReleased">
                                    <!--Close popup menu and set tag ExtractChanged that default selection changed, so selected slot won't change, when re-opening menu-->
                                    <b:ChangePropertyAction TargetName="ExtractSelectionControl" PropertyName="Visibility" Value="Collapsed"/>
                                    <b:ChangePropertyAction TargetName="ExtractSelectionControl" PropertyName="Tag" Value="ExtractChanged"/>
                                </b:EventTrigger>
                            </b:Interaction.Triggers>
                        </ls:LSButton>
                    </Grid>
                </ls:LSNineSliceImage>
                <ControlTemplate.Triggers>
                    <DataTrigger Binding="{Binding DataContext.SelectedExtraExtract.AlchemyExtractType, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="Air">
                        <Setter TargetName="AlchemyFilterHeader" Property="Text">
                            <Setter.Value>
                                <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                    <Binding Source="h326832c1gfe11g4b60g9165g26d05fcd0919"/>
                                    <Binding Source="h2c1af163gda89g4142g8670g492407614241" Converter="{StaticResource TranslatedStringConverter}"/>
                                </MultiBinding>
                            </Setter.Value>
                        </Setter>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding DataContext.SelectedExtraExtract.AlchemyExtractType, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="Earth">
                        <Setter TargetName="AlchemyFilterHeader" Property="Text">
                            <Setter.Value>
                                <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                    <Binding Source="h326832c1gfe11g4b60g9165g26d05fcd0919"/>
                                    <Binding Source="h53369a2cgd283g467cg924cg3938e9bbdc30" Converter="{StaticResource TranslatedStringConverter}"/>
                                </MultiBinding>
                            </Setter.Value>
                        </Setter>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding DataContext.SelectedExtraExtract.AlchemyExtractType, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="Fey">
                        <Setter TargetName="AlchemyFilterHeader" Property="Text">
                            <Setter.Value>
                                <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                    <Binding Source="h326832c1gfe11g4b60g9165g26d05fcd0919"/>
                                    <Binding Source="h17759c79g9c66g4cf4ga71bg82b7914319a1" Converter="{StaticResource TranslatedStringConverter}"/>
                                </MultiBinding>
                            </Setter.Value>
                        </Setter>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding DataContext.SelectedExtraExtract.AlchemyExtractType, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="Fire">
                        <Setter TargetName="AlchemyFilterHeader" Property="Text">
                            <Setter.Value>
                                <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                    <Binding Source="h326832c1gfe11g4b60g9165g26d05fcd0919"/>
                                    <Binding Source="hd7d538e9gd122g4216g9b2aga1c7aaa5c7ef" Converter="{StaticResource TranslatedStringConverter}"/>
                                </MultiBinding>
                            </Setter.Value>
                        </Setter>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding DataContext.SelectedExtraExtract.AlchemyExtractType, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="Shadow">
                        <Setter TargetName="AlchemyFilterHeader" Property="Text">
                            <Setter.Value>
                                <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                    <Binding Source="h326832c1gfe11g4b60g9165g26d05fcd0919"/>
                                    <Binding Source="hee19fd7fg6d6fg4f9fg83d7ge350d0ea4a8d" Converter="{StaticResource TranslatedStringConverter}"/>
                                </MultiBinding>
                            </Setter.Value>
                        </Setter>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding DataContext.SelectedExtraExtract.AlchemyExtractType, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="Water">
                        <Setter TargetName="AlchemyFilterHeader" Property="Text">
                            <Setter.Value>
                                <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                    <Binding Source="h326832c1gfe11g4b60g9165g26d05fcd0919"/>
                                    <Binding Source="h7f02c548g5195g434egb3edg30c0a31130e1" Converter="{StaticResource TranslatedStringConverter}"/>
                                </MultiBinding>
                            </Setter.Value>
                        </Setter>
                    </DataTrigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>
        </ControlTemplate.Resources>

        <Grid x:Name="AlchemyRoot" ls:TooltipExtender.Owner="{Binding CurrentPlayer.SelectedCharacter}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- RECIPES -->
            <Grid x:Name="RecipesList" Grid.Column="0" HorizontalAlignment="Center" Width="852"  Margin="0,44,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Sorting and filtering -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Left" >

                    <ls:LSToggleButton x:Name="SortToggleButton" 
                                           Template="{StaticResource SortToggleButtonTemplate}" 
                                           VerticalAlignment="Center" 
                                           Margin="60,0,0,0"/>

                    <ls:LSCheckBox x:Name="AvailableRecipesButton" 
                                       IsChecked="{Binding HideAvailableRecipes, Mode=OneWay}" 
                                       Command="{Binding ToggleHideAvailableRecipes}"
                                       Margin="20,0,0,0">
                        <ls:LSCheckBox.Template>
                            <ControlTemplate TargetType="ls:LSCheckBox">
                                <ControlTemplate.Resources>
                                    <BitmapImage x:Key="Bg" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Reactions/checkbox_d.png"/>
                                    <BitmapImage x:Key="Bg_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Reactions/checkbox_h.png"/>
                                    <BitmapImage x:Key="Bg_disabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Reactions/checkbox_disabled.png"/>

                                    <BitmapImage x:Key="Check" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Reactions/ico_check_d.png"/>
                                    <BitmapImage x:Key="Check_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Reactions/ico_check_h.png"/>
                                    <BitmapImage x:Key="Check_disabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Reactions/ico_check_disabled.png"/>
                                </ControlTemplate.Resources>

                                <StackPanel Orientation="Horizontal" Background="Transparent">
                                    <Grid VerticalAlignment="Center" Margin="0,0,8,0">
                                        <Image x:Name="MarkerBg" HorizontalAlignment="Center" VerticalAlignment="Center" Source="{StaticResource Bg}" Stretch="None"/>
                                        <Image x:Name="MarkerCheck" HorizontalAlignment="Center" VerticalAlignment="Center" Source="{StaticResource Check}" Stretch="None" Visibility="{Binding IsChecked, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BoolToVisibleConverter}, ConverterParameter={StaticResource TrueValue}}"/>
                                    </Grid>

                                    <TextBlock x:Name="Text" Text="{Binding Source='hd79639b7gebffg4016ga0bfg7615cc3ca89c',Converter={StaticResource TranslatedStringConverter}}" VerticalAlignment="Center" Style="{StaticResource DetailedListText}"/>
                                </StackPanel>

                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="Text" Property="Foreground" Value="{StaticResource LS_extraspecialTxtColor}"/>
                                        <Setter TargetName="MarkerBg" Property="Source" Value="{StaticResource Bg_h}"/>
                                        <Setter TargetName="MarkerCheck" Property="Source" Value="{StaticResource Check_h}"/>
                                    </Trigger>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter TargetName="MarkerBg" Property="Source" Value="{DynamicResource Bg_disabled}"/>
                                        <Setter TargetName="MarkerCheck" Property="Source" Value="{DynamicResource Check_disabled}"/>
                                        <Setter Property="Opacity" Value="0.75"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </ls:LSCheckBox.Template>

                        <b:Interaction.Triggers>
                            <b:EventTrigger EventName="Checked">
                                <b:Interaction.Behaviors>
                                    <b:ConditionBehavior>
                                        <b:ConditionalExpression>
                                            <b:ComparisonCondition LeftOperand="{Binding SelectedRecipe.IsSolutionRecipe}" Operator="Equal" RightOperand="False"/>
                                        </b:ConditionalExpression>
                                    </b:ConditionBehavior>
                                </b:Interaction.Behaviors>

                                <b:InvokeCommandAction Command="{Binding ChangeSelectedRecipe}" CommandParameter="{x:Null}"/>
                            </b:EventTrigger>
                            <b:EventTrigger EventName="Checked">
                                <b:Interaction.Behaviors>
                                    <b:ConditionBehavior>
                                        <b:ConditionalExpression>
                                            <b:ComparisonCondition LeftOperand="{Binding SelectedRecipe.CanBeCrafted}" Operator="Equal" RightOperand="False"/>
                                        </b:ConditionalExpression>
                                    </b:ConditionBehavior>
                                </b:Interaction.Behaviors>

                                <b:InvokeCommandAction Command="{Binding ChangeSelectedRecipe}" CommandParameter="{x:Null}"/>
                            </b:EventTrigger>
                        </b:Interaction.Triggers>
                    </ls:LSCheckBox>
                </StackPanel>

                <!-- List -->
                <ScrollViewer x:Name="RecipesScrollList" Grid.Row="1" Padding="44,0,0,0" Margin="18" Template="{StaticResource FlippedSimpleScrollViewerTemplate}" VerticalAlignment="Top" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <ContentPresenter x:Name="PotionsList" ContentTemplate="{StaticResource RecipesListTemplate}" 
                                    Content="{Binding Data.PotionRecipes}"
                                    ls:AttachedProperties.InheritedTag="{Binding Source='h2a90fdabg4131g46cag994agc41868d38697', Converter={StaticResource TranslatedStringConverter}}">
                            <ContentPresenter.Resources>
                                <BitmapImage x:Key="GroupIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/ico_category01_d.png"/>
                                <BitmapImage x:Key="GroupIcon_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/ico_category01_h.png"/>
                            </ContentPresenter.Resources>
                        </ContentPresenter>

                        <ContentPresenter x:Name="ElixirsList" ContentTemplate="{StaticResource RecipesListTemplate}" 
                                              Content="{Binding Data.ElixirRecipes}"
                                              ls:AttachedProperties.InheritedTag="{Binding Source='h0d4195b4g618ag445fgaa9eg168f6fba5c36', Converter={StaticResource TranslatedStringConverter}}">
                            <ContentPresenter.Resources>
                                <BitmapImage x:Key="GroupIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/ico_category01_d.png"/>
                                <BitmapImage x:Key="GroupIcon_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/ico_category01_h.png"/>
                            </ContentPresenter.Resources>
                        </ContentPresenter>

                        <ContentPresenter x:Name="GrenadesList" ContentTemplate="{StaticResource RecipesListTemplate}" 
                                              Content="{Binding Data.GrenadeRecipes}"
                                              ls:AttachedProperties.InheritedTag="{Binding Source='hff6fc62agd6edg463aga06ag505e235db962', Converter={StaticResource TranslatedStringConverter}}">
                            <ContentPresenter.Resources>
                                <BitmapImage x:Key="GroupIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/ico_category01_d.png"/>
                                <BitmapImage x:Key="GroupIcon_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/ico_category01_h.png"/>
                            </ContentPresenter.Resources>
                        </ContentPresenter>

                        <ContentPresenter x:Name="CoatingsList" ContentTemplate="{StaticResource RecipesListTemplate}" 
                                              Content="{Binding Data.CoatingRecipes}"
                                              ls:AttachedProperties.InheritedTag="{Binding Source='h231c7ac3g48ecg49f4ga675gb6f16e824c54', Converter={StaticResource TranslatedStringConverter}}">
                            <ContentPresenter.Resources>
                                <BitmapImage x:Key="GroupIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/ico_category01_d.png"/>
                                <BitmapImage x:Key="GroupIcon_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/ico_category01_h.png"/>
                            </ContentPresenter.Resources>
                        </ContentPresenter>

                        <ContentPresenter x:Name="ExtractAirList" ContentTemplate="{StaticResource RecipesListTemplate}" 
                                              Content="{Binding Data.ExtractAirRecipes}"
                                              ls:AttachedProperties.InheritedTag="{Binding Source='h2553158bgad4dg4f2bgb289g73021df996b2', Converter={StaticResource TranslatedStringConverter}}">
                            <ContentPresenter.Resources>
                                <BitmapImage x:Key="GroupIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Tooltips/ItemIcons/Item_BASE_ALCH_Extract_Air.png"/>
                                <BitmapImage x:Key="GroupIcon_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Tooltips/ItemIcons/Item_BASE_ALCH_Extract_Air.png"/>
                            </ContentPresenter.Resources>
                        </ContentPresenter>

                        <ContentPresenter x:Name="ExtractEarthList" ContentTemplate="{StaticResource RecipesListTemplate}" 
                                          Content="{Binding Data.ExtractEarthRecipes}"
                                          ls:AttachedProperties.InheritedTag="{Binding Source='h51d33125g11e0g474ag98a0gb9f4a406f593', Converter={StaticResource TranslatedStringConverter}}">
                            <ContentPresenter.Resources>
                                <BitmapImage x:Key="GroupIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Tooltips/ItemIcons/Item_BASE_ALCH_Extract_Earth.png"/>
                                <BitmapImage x:Key="GroupIcon_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Tooltips/ItemIcons/Item_BASE_ALCH_Extract_Earth.png"/>
                            </ContentPresenter.Resources>
                        </ContentPresenter>

                        <ContentPresenter x:Name="ExtractFeyList" ContentTemplate="{StaticResource RecipesListTemplate}" 
                                          Content="{Binding Data.ExtractFeyRecipes}"
                                          ls:AttachedProperties.InheritedTag="{Binding Source='h36ced4c2g84ecg4e17g9790gd5abcc520543', Converter={StaticResource TranslatedStringConverter}}">
                            <ContentPresenter.Resources>
                                <BitmapImage x:Key="GroupIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Tooltips/ItemIcons/Item_BASE_ALCH_Extract_Shadow_2.png"/>
                                <BitmapImage x:Key="GroupIcon_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Tooltips/ItemIcons/Item_BASE_ALCH_Extract_Shadow_2.png"/>
                            </ContentPresenter.Resources>
                        </ContentPresenter>

                        <ContentPresenter x:Name="ExtractFireList" ContentTemplate="{StaticResource RecipesListTemplate}" 
                                          Content="{Binding Data.ExtractFireRecipes}"
                                          ls:AttachedProperties.InheritedTag="{Binding Source='h3f0368d9g82b4g47fdg90b8ge1b7a026a43d', Converter={StaticResource TranslatedStringConverter}}">
                            <ContentPresenter.Resources>
                                <BitmapImage x:Key="GroupIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Tooltips/ItemIcons/Item_BASE_ALCH_Extract_Fire.png"/>
                                <BitmapImage x:Key="GroupIcon_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Tooltips/ItemIcons/Item_BASE_ALCH_Extract_Fire.png"/>
                            </ContentPresenter.Resources>
                        </ContentPresenter>

                        <ContentPresenter x:Name="ExtractShadowList" ContentTemplate="{StaticResource RecipesListTemplate}" 
                                          Content="{Binding Data.ExtractShadowRecipes}"
                                          ls:AttachedProperties.InheritedTag="{Binding Source='h3be6ebc2g50e7g4e8fg99edg499bdbaf356b', Converter={StaticResource TranslatedStringConverter}}">
                            <ContentPresenter.Resources>
                                <BitmapImage x:Key="GroupIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Tooltips/ItemIcons/Item_BASE_ALCH_Extract_Shadow_1.png"/>
                                <BitmapImage x:Key="GroupIcon_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Tooltips/ItemIcons/Item_BASE_ALCH_Extract_Shadow_1.png"/>
                            </ContentPresenter.Resources>
                        </ContentPresenter>

                        <ContentPresenter x:Name="ExtractWaterList" ContentTemplate="{StaticResource RecipesListTemplate}" 
                                          Content="{Binding Data.ExtractWaterRecipes}"
                                          ls:AttachedProperties.InheritedTag="{Binding Source='h648fff5ag77efg4846g9752gcaf6a99758e8', Converter={StaticResource TranslatedStringConverter}}">
                            <ContentPresenter.Resources>
                                <BitmapImage x:Key="GroupIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Tooltips/ItemIcons/Item_BASE_ALCH_Extract_Water.png"/>
                                <BitmapImage x:Key="GroupIcon_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Tooltips/ItemIcons/Item_BASE_ALCH_Extract_Water.png"/>
                            </ContentPresenter.Resources>
                        </ContentPresenter>
                    </StackPanel>
                </ScrollViewer>

                <!-- Extract All Ingredients Button -->
                <!-- MOD_ACS: Update margin // BG3: Margin="0,0,0,28" --> 
                <ls:LSButton Grid.Row="2" x:Name="ExtractAllIngredients"
                                 HorizontalAlignment="Center"
                                 Style="{StaticResource BigBrownButtonStyle}"
                                 Command="{Binding CreateExtracts}"
                                 Margin="0,14,0,114"
                                 Width="600"
                                 OverwriteClickSound="UI_HUD_Alchemy_CreateExtracts_Click">
                    <ls:LSButton.Content>
                        <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                            <Binding Source="h4bf5b366g76a0g424dgaa14g37124b33b746"/>
                            <Binding Path="TotalAvailableExtractions"/>
                        </MultiBinding>
                    </ls:LSButton.Content>
                </ls:LSButton>
            </Grid>

            <!-- EXTRACT AND CRAFTING -->
            <StackPanel x:Name="ExtractAndCrafting" Grid.Column="1" HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,44,0,0">
                <!-- Title -->
                <ContentControl Name="CraftingTitle" Style="{StaticResource BaseTitleStyle}">
                    <TextBlock Text="{Binding Source='hd40af023g3265g492dgb433gb272f433a093', Converter={StaticResource TranslatedStringConverter}}"/>
                </ContentControl>

                <!-- Extract and crafting -->
                <Grid x:Name="ExtractCrafting" HorizontalAlignment="Center" VerticalAlignment="Top">
                    <Image x:Name="AlchemyBg" Source="{StaticResource CombineBg}" HorizontalAlignment="Center" VerticalAlignment="Top" Stretch="None"/>

                    <Grid x:Name="AlchemyOrbHolder" HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,312,0,0">
                        <Image x:Name="AlchemyOrb" Source="{StaticResource OrbEnabled}" Stretch="None"/>

                        <ls:AnimatedImage x:Name="AlchemyOrbVFX" Style="{StaticResource AlchemyAnimationStyle}"/>

                        <ls:LSButton x:Name="SecondaryCraftingButton" HorizontalAlignment="Center" VerticalAlignment="Center"
                                         Width="{Binding ActualWidth, ElementName=AlchemyOrb}"
                                         Height="{Binding ActualHeight, ElementName=AlchemyOrb}"
                                         Command="{Binding Command, ElementName=ExtractCraftingButton}"
                                         IsEnabled="{Binding IsEnabled, ElementName=ExtractCraftingButton}"
                                         OverwriteClickSound="UI_HUD_Alchemy_CreateSolution_Click">
                            <ls:LSButton.Template>
                                <ControlTemplate TargetType="ls:LSButton">
                                    <Border Background="Transparent">
                                        <Image x:Name="icon" Source="{StaticResource OrbButtonIcon}" Stretch="None" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                    </Border>

                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="icon" Property="Source" Value="{StaticResource OrbButtonIcon_h}" />
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter TargetName="icon" Property="Margin" Value="0,4,0,0"/>
                                        </Trigger>

                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <Condition Binding="{Binding IsEnabled, RelativeSource={RelativeSource Self}}" Value="False"/>
                                                <Condition Binding="{Binding IsCreatingItems}" Value="False"/>
                                            </MultiDataTrigger.Conditions>
                                            <Setter TargetName="icon" Property="Visibility" Value="Collapsed"/>
                                        </MultiDataTrigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </ls:LSButton.Template>
                        </ls:LSButton>

                        <b:Interaction.Triggers>
                            <b:DataTrigger Binding="{Binding (ls:AnimatedImage.AnimationEnded), ElementName=AlchemyOrbVFX}" Value="True">
                                <b:InvokeCommandAction Command="{Binding DataContext.EndCreationProcess, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                            </b:DataTrigger>
                        </b:Interaction.Triggers>
                    </Grid>

                    <Grid x:Name="Crafting" Visibility="Hidden">

                        <Grid x:Name="CraftingSolution">
                            <ContentPresenter x:Name="BaseItem" ContentTemplate="{StaticResource CraftingSlot}" Content="{Binding SelectedRecipe.BaseExtract.Item}" 
                                              HorizontalAlignment="Left" VerticalAlignment="Top" Margin="-120,132,0,0" 
                                              ToolTipService.Placement="Left" 
                                              Tag="Main">
                                <ContentPresenter.ToolTip>
                                    <ls:LSTooltip Content="{Binding DataContext.SelectedRecipe.BaseExtract, ElementName=Crafting}" ls:TooltipExtender.Owner="{Binding DataContext.CurrentPlayer.SelectedCharacter, ElementName=Crafting}"/>
                                </ContentPresenter.ToolTip>
                            </ContentPresenter>

                            <ContentPresenter x:Name="ExtraExtract" ContentTemplate="{StaticResource CraftingSlot}" Content="{Binding SelectedExtraExtract}" 
                                              HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,132,-118,0" 
                                              ToolTipService.Placement="Left" 
                                              Tag="Extra">
                                <ContentPresenter.ToolTip>
                                    <ls:LSTooltip x:Name="ExtraExtractToolTip" Content="{Binding DataContext.SelectedExtraExtract, ElementName=Crafting}" ls:TooltipExtender.Owner="{Binding DataContext.CurrentPlayer.SelectedCharacter, ElementName=Crafting}"/>
                                </ContentPresenter.ToolTip>
                            </ContentPresenter>
                        </Grid>

                        <Grid x:Name="CraftingExtract" Visibility="Collapsed">
                            <TextBlock x:Name="ExtractResultTut" Text="{Binding Source='h45fd5913g762cg44fbg8498g37522dcff3c3', Converter={StaticResource TranslatedStringConverter}}" FontSize="{StaticResource ScaledMediumFontSize}" Foreground="{StaticResource LS_accent25TxtColor}" MaxWidth="800" TextAlignment="Center" TextWrapping="Wrap"/>

                            <TextBlock x:Name="ExtractResultName" Text="{Binding SelectedRecipe.BaseExtract.Item.Name}" FontSize="{StaticResource ScaledLargeFontSize}" Foreground="{StaticResource LS_accent100TxtColor}" Width="1000" Margin="0,140,0,0" TextAlignment="Center"/>

                            <TextBlock x:Name="ExtractResultCount" FontSize="{StaticResource ScaledMediumFontSize}" Foreground="{StaticResource LS_baseTxtColor}" Margin="0,190,0,0" TextAlignment="Center">
                                <TextBlock.Text>
                                    <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                        <Binding Source="ha1a20103gb5b2g45a8gaf1fgea40cca68201"/>
                                        <Binding Path="SelectedRecipe.BaseExtract.Item.Count"/>
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>
                            <Grid Margin="0,246,0,0" Width="498" VerticalAlignment="Top">
                                <ContentPresenter x:Name="ExtractSlot1" ContentTemplate="{StaticResource ExtractCraftingSlot}" Content="{Binding SelectedRecipe.BaseExtract}" 
                                              HorizontalAlignment="Left" 
                                              ls:AttachedProperties.InheritedNumber="1"/>

                                <ContentPresenter x:Name="ExtractSlot2" ContentTemplate="{StaticResource ExtractCraftingSlot}" Content="{Binding SelectedRecipe.BaseExtract}" 
                                              HorizontalAlignment="Center" 
                                              ls:AttachedProperties.InheritedNumber="2"/>

                                <ContentPresenter x:Name="ExtractSlot3" ContentTemplate="{StaticResource ExtractCraftingSlot}" Content="{Binding SelectedRecipe.BaseExtract}" 
                                              HorizontalAlignment="Right"
                                              ls:AttachedProperties.InheritedNumber="3"/>
                            </Grid>
                        </Grid>
                        
                        <StackPanel x:Name="Result" DataContext="{Binding SelectedRecipe.Result}" 
                                        HorizontalAlignment="Center" Margin="0,658,0,0"
                                        ToolTipService.Placement="Left">
                            <StackPanel.Resources>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Foreground" Value="{StaticResource LS_accent100TxtColor}"/>
                                    <Setter Property="TextAlignment" Value="Center"/>
                                    <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                </Style>
                            </StackPanel.Resources>

                            <StackPanel.ToolTip>
                                <ls:LSTooltip Content="{Binding DataContext.SelectedRecipe.Result, ElementName=Crafting}" ls:TooltipExtender.Owner="{Binding DataContext.CurrentPlayer.SelectedCharacter, ElementName=Crafting}"/>
                            </StackPanel.ToolTip>

                            <ContentControl HorizontalAlignment="Center" VerticalAlignment="Center" ContentTemplate="{StaticResource AlchemySlotTemplate}" Content="{Binding Item}" Tag="{Binding ElementName=Result}">
                                <ContentControl.Resources>
                                    <BitmapImage x:Key="SlotEnabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/crafting_itemFrame_default.png"/>
                                    <BitmapImage x:Key="SlotEnabled_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/crafting_itemFrame_default_h.png"/>
                                    <BitmapImage x:Key="SlotDisabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/crafting_itemFrame_disabled.png"/>
                                    <BitmapImage x:Key="SlotDisabled_h" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/crafting_itemFrame_disabled.png"/>
                                </ContentControl.Resources>
                            </ContentControl>

                            <TextBlock x:Name="ResultName" Text="{Binding Item.Name}" FontSize="{StaticResource ScaledBigFontSize}" Foreground="{StaticResource LS_extraspecialTxtColor}" Width="800" TextWrapping="Wrap" LineStackingStrategy="BlockLineHeight" LineHeight="{StaticResource ScaledIntermediateFontSizeLineHeight}" Margin="0,16,0,0"/>
                        </StackPanel>
                    </Grid>
                </Grid>

                <Grid>
                    <!-- Errors -->
                    <TextBlock x:Name="ExtractCraftingError" 
                                   Style="{StaticResource AlchemyWrappingText}" 
                                   Foreground="{StaticResource LS_alertTxtColor}" 
                                   FontSize="{StaticResource ScaledLargeFontSize}" 
                                   Visibility="Collapsed" MaxWidth="800" Margin="0,16,0,0"
                               VerticalAlignment="Center"/>
                    <TextBlock x:Name="ExtractCraftingTutorial" Text="{Binding Source='h869eeab2g5859g4defg8eb7ge77cc11eaa1a',Converter={StaticResource TranslatedStringConverter}}" 
                                   Style="{StaticResource AlchemyWrappingText}" 
                                   Foreground="{StaticResource LS_accent100TxtColor}" 
                                   FontSize="{StaticResource ScaledDefaultFontSize}" 
                                   Visibility="Collapsed" MaxWidth="800" Margin="0,16,0,0"/>

                    <!-- Amount Input -->
                    <StackPanel x:Name="AmountInput" Visibility="Hidden" Height="120">

                        <TextBlock x:Name="AmountInputTitle" Text="{Binding Source='h7a90a95cgf7b0g4b53g93efg2837c4dc267a', Converter={StaticResource TranslatedStringConverter}}" Foreground="{StaticResource LS_extraspecialTxtColor}" HorizontalAlignment="Center"/>

                        <StackPanel  Orientation="Horizontal" HorizontalAlignment="Center" >
                            <ls:LSButton x:Name="NavigationLeftButton" Template="{StaticResource IconButtonTemplate}" VerticalAlignment="Center">
                                <ls:LSButton.Resources>
                                    <BitmapImage x:Key="ButtonNormal" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/btnHalf_blue_d.png"/>
                                    <BitmapImage x:Key="ButtonHighlight" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/btnHalf_blue_h.png"/>
                                    <BitmapImage x:Key="ButtonPressed" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/btnHalf_blue_p.png"/>
                                    <BitmapImage x:Key="ButtonDisabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/btnHalf_blue_disabled.png"/>
                                    <BitmapImage x:Key="IconNormal" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_browseSmall_d.png"/>
                                    <BitmapImage x:Key="IconHighlight" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_browseSmall_h.png"/>
                                    <BitmapImage x:Key="IconPressed" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_browseSmall_h.png"/>
                                    <BitmapImage x:Key="IconDisabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_browseSmall_d.png"/>
                                </ls:LSButton.Resources>

                                <b:Interaction.Triggers>
                                    <b:EventTrigger EventName="LSButtonPressed">
                                        <b:ChangePropertyAction TargetObject="{Binding .}" PropertyName="ItemsToCraft" Value="{Binding ItemsToCraft, Converter={StaticResource AddConverter}, ConverterParameter=-1}"/>
                                    </b:EventTrigger>
                                    <b:EventTrigger EventName="MouseEnter">
                                        <ls:LSPlaySound Sound="UI_Shared_Hover"/>
                                    </b:EventTrigger>
                                    <b:EventTrigger EventName="MouseLeftButtonUp">
                                        <ls:LSPlaySound Sound="UI_Shared_Click"/>
                                    </b:EventTrigger>
                                    <b:EventTrigger EventName="MouseLeftButtonDown">
                                        <ls:LSPlaySound Sound="UI_Shared_Press"/>
                                    </b:EventTrigger>
                                </b:Interaction.Triggers>
                            </ls:LSButton>

                            <Grid>
                                <Image x:Name="AmountInputBg" Source="{StaticResource AmountInputBg}" Stretch="None"/>
                                <ls:LSTextBox x:Name="AmountInputBox" Text="{Binding ItemsToCraft}" Mask="Integer" TextImmediateSourceUpdate="True" Foreground="{StaticResource LS_extraspecialTxtColor}" VerticalAlignment="Center" Background="Transparent" HorizontalContentAlignment="Center" BorderThickness="0" MaxLines="1" TextAlignment="Center" Focusable="True"/>
                            </Grid>

                            <ls:LSButton x:Name="NavigationRightButton" Template="{StaticResource IconButtonTemplate}" VerticalAlignment="Center" RenderTransformOrigin="0.5, 0.5">
                                <ls:LSButton.Resources>
                                    <BitmapImage x:Key="ButtonNormal" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/btnHalf_blue_d.png"/>
                                    <BitmapImage x:Key="ButtonHighlight" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/btnHalf_blue_h.png"/>
                                    <BitmapImage x:Key="ButtonPressed" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/btnHalf_blue_p.png"/>
                                    <BitmapImage x:Key="ButtonDisabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/btnHalf_blue_disabled.png"/>
                                    <BitmapImage x:Key="IconNormal" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_browseSmall_d.png"/>
                                    <BitmapImage x:Key="IconHighlight" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_browseSmall_h.png"/>
                                    <BitmapImage x:Key="IconPressed" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_browseSmall_h.png"/>
                                    <BitmapImage x:Key="IconDisabled" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/Buttons/ico_browseSmall_d.png"/>
                                </ls:LSButton.Resources>

                                <ls:LSButton.RenderTransform>
                                    <ScaleTransform ScaleX="-1"/>
                                </ls:LSButton.RenderTransform>

                                <b:Interaction.Triggers>
                                    <b:EventTrigger EventName="LSButtonPressed">
                                        <b:ChangePropertyAction TargetObject="{Binding .}" PropertyName="ItemsToCraft" Value="{Binding ItemsToCraft, Converter={StaticResource AddConverter}, ConverterParameter=1}"/>
                                    </b:EventTrigger>
                                    <b:EventTrigger EventName="MouseEnter">
                                        <ls:LSPlaySound Sound="UI_Shared_Hover"/>
                                    </b:EventTrigger>
                                    <b:EventTrigger EventName="MouseLeftButtonUp">
                                        <ls:LSPlaySound Sound="UI_Shared_Click"/>
                                    </b:EventTrigger>
                                    <b:EventTrigger EventName="MouseLeftButtonDown">
                                        <ls:LSPlaySound Sound="UI_Shared_Press"/>
                                    </b:EventTrigger>
                                </b:Interaction.Triggers>
                            </ls:LSButton>
                        </StackPanel>
                    </StackPanel>
                </Grid>

                <!-- Buttons -->
                <ls:LSButton x:Name="ExtractCraftingButton" HorizontalAlignment="Center" Style="{StaticResource BigBrownButtonStyle}" Margin="0,24,0,0">
                    <b:Interaction.Triggers>
                        <b:EventTrigger EventName="Click">
                            <b:ChangePropertyAction TargetName="ExtractSelectionControl" PropertyName="Tag" Value="NewRecipe"/>
                        </b:EventTrigger>
                    </b:Interaction.Triggers>
                </ls:LSButton>

                <ls:LSButton x:Name="CraftAllItemsButton" HorizontalAlignment="Center" Style="{StaticResource BigBrownButtonStyle}" Command="{Binding CraftItems}"
                             CommandParameter="All" Visibility="Collapsed" Margin="12,4,12,0" Padding="40,0">
                    <ls:LSButton.Content>
                        <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                            <Binding Source="hf645785cg182fg40d2g9ed9g3f42fca2053c"/>
                            <Binding Path="SelectedRecipe.Result.Item.Count"/>
                        </MultiBinding>
                    </ls:LSButton.Content>
                    <b:Interaction.Triggers>
                        <b:EventTrigger EventName="MouseEnter">
                            <ls:LSPlaySound Sound="UI_Shared_Hover"/>
                        </b:EventTrigger>
                        <b:EventTrigger EventName="MouseLeftButtonUp">
                            <ls:LSPlaySound Sound="UI_Shared_Click"/>
                        </b:EventTrigger>
                        <b:EventTrigger EventName="MouseLeftButtonDown">
                            <ls:LSPlaySound Sound="UI_Shared_Press"/>
                        </b:EventTrigger>
                        <b:EventTrigger EventName="Click">
                            <b:ChangePropertyAction TargetName="ExtractSelectionControl" PropertyName="Tag" Value="NewRecipe"/>
                        </b:EventTrigger>
                    </b:Interaction.Triggers>
                </ls:LSButton>

                <!-- Craft message -->
                <TextBlock x:Name="ExtractCraftingMessage" 
                               Style="{StaticResource AlchemyWrappingText}"
                               Foreground="{StaticResource LS_accent100TxtColor}" Width="1000" Opacity="0" Margin="0,20,0,0" FontSize="{StaticResource ScaledSmallishFontSize}">
                    <TextBlock.Text>
                        <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                            <Binding Source="h1b698442ga1f1g4ecagba7ag82b58143139a"/>
                            <Binding Path="TotalCreatedItems"/>
                            <Binding Path="CurrentPlayer.SelectedCharacter.Name"/>
                        </MultiBinding>
                    </TextBlock.Text>
                </TextBlock>

            </StackPanel>

            <!-- SORTING -->
            <ls:LSNineSliceImage x:Name="Filters" ImageSource="{StaticResource SortBg}" Slices="40" Padding="20,30" 
                                 HorizontalAlignment="Left" VerticalAlignment="Top" Grid.Column="0" Margin="44,88,0,0"
                                 Visibility="{Binding IsChecked, ElementName=SortToggleButton, Converter={StaticResource BoolToVisibleConverter}}">
                <StackPanel>
                    <TextBlock Text="{Binding Source='h9414328dgbabeg4602g82c1g4c947c1c8e34',Converter={StaticResource TranslatedStringConverter}}" Foreground="{StaticResource LS_accent25TxtColor}" FontSize="{StaticResource ScaledSmallFontSize}" Margin="40,0,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"/>

                    <ls:LSButton x:Name="SortNameButton" Template="{StaticResource SortButtonTemplate}"
                                     Tag="{Binding Source='h86ac5591g3822g45f1ga6d1gd39367a8481d',Converter={StaticResource TranslatedStringConverter}}"
                                     Command="{Binding SetSortMode}" CommandParameter="Name">
                        <b:Interaction.Triggers>
                            <b:EventTrigger EventName="Click">
                                <b:ChangePropertyAction TargetName="SortToggleButton" PropertyName="IsChecked" Value="False"/>
                            </b:EventTrigger>
                        </b:Interaction.Triggers>
                    </ls:LSButton>

                    <ls:LSButton x:Name="SortTimeButton" Template="{StaticResource SortButtonTemplate}"
                                     Tag="{Binding Source='h83250180g4f67g4697g97d4g3f698f3708ea',Converter={StaticResource TranslatedStringConverter}}"
                                     Command="{Binding SetSortMode}" CommandParameter="Time">
                        <b:Interaction.Triggers>
                            <b:EventTrigger EventName="Click">
                                <b:ChangePropertyAction TargetName="SortToggleButton" PropertyName="IsChecked" Value="False"/>
                            </b:EventTrigger>
                        </b:Interaction.Triggers>
                    </ls:LSButton>
                </StackPanel>
            </ls:LSNineSliceImage>

            <Button Height="{Binding ElementName=AlchemyRoot, Path=ActualHeight}" Width="{Binding ElementName=AlchemyRoot, Path=ActualWidth}" Background="Transparent" Grid.ColumnSpan="2"
                    Visibility="{Binding ElementName=ExtractSelectionControl, Path=Visibility}">
                <b:Interaction.Triggers>
                    <b:EventTrigger EventName="Click">
                        <b:ChangePropertyAction TargetName="ExtractSelectionControl" PropertyName="Visibility" Value="Collapsed"/>
                    </b:EventTrigger>
                </b:Interaction.Triggers>
            </Button>

            <!--Popup menu for extract selection-->
            <!--NewRecipe tag used to track, when selected slot in the extracts inventory grid should be updated-->
            <Control x:Name="ExtractSelectionControl" Template="{StaticResource PopOutAlchemyTemplate}" DataContext="{Binding CurrentPlayer.SelectedCharacter}" Grid.Column="1" Margin="0,420,0,100"
                     Tag="NewRecipe" Visibility="Collapsed"/>

            <b:Interaction.Triggers>
                <b:PropertyChangedTrigger Binding="{Binding DataContext.SelectedRecipe, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}">
                    <b:ChangePropertyAction TargetName="ExtractSelectionControl" PropertyName="Tag" Value="NewRecipe"/>
                </b:PropertyChangedTrigger>
            </b:Interaction.Triggers>
        </Grid>

        <ControlTemplate.Triggers>
            <!-- LIST -->
            <DataTrigger Binding="{Binding SelectedRecipe}" Value="{x:Null}">
                <Setter TargetName="AlchemyBg" Property="Source" Value="{StaticResource ExtractBg}"/>
                <Setter TargetName="CraftingTitle" Property="Visibility" Value="Hidden"/>
                <Setter TargetName="ExtractCraftingError" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="ExtractCraftingButton" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="ExtractCraftingButton" Property="IsEnabled" Value="False"/>
                <Setter TargetName="AlchemyOrb" Property="Source" Value="{StaticResource OrbDisabled}"/>
                <Setter TargetName="ExtractCraftingTutorial" Property="Visibility" Value="Visible"/>
            </DataTrigger>

            <!-- ORB -->
            <DataTrigger Binding="{Binding IsMouseOver, ElementName=SecondaryCraftingButton}" Value="True">
                <Setter TargetName="AlchemyOrb" Property="Source" Value="{StaticResource OrbEnabled_h}"/>
            </DataTrigger>

            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding IsMouseOver, ElementName=SecondaryCraftingButton}" Value="True"/>
                    <Condition Binding="{Binding IsCreatingItems}" Value="True"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="AlchemyOrb" Property="Source" Value="{StaticResource OrbActive_h}"/>
            </MultiDataTrigger>

            <!-- EXTRACTS -->
            <DataTrigger Binding="{Binding SelectedRecipe, Converter={StaticResource NullToBoolFalseConverter}}" Value="False">
                <Setter TargetName="ExtractAndCrafting" Property="Visibility" Value="Visible"/>
            </DataTrigger>

            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding IsCreatingItems}" Value="False"/>
                    <Condition Binding="{Binding ExtractAir.Item.Count}" Value="0"/>
                    <Condition Binding="{Binding ExtractEarth.Item.Count}" Value="0"/>
                    <Condition Binding="{Binding ExtractFey.Item.Count}" Value="0"/>
                    <Condition Binding="{Binding ExtractFire.Item.Count}" Value="0"/>
                    <Condition Binding="{Binding ExtractShadow.Item.Count}" Value="0"/>
                    <Condition Binding="{Binding ExtractWater.Item.Count}" Value="0"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="ExtractAllIngredients" Property="IsEnabled" Value="False"/>
            </MultiDataTrigger>

            <!-- CRAFTING -->
            <DataTrigger Binding="{Binding SelectedRecipe, Converter={StaticResource NullToBoolFalseConverter}}" Value="True">
                <Setter TargetName="Crafting" Property="Visibility" Value="Visible"/>
                <Setter TargetName="ExtractCraftingError" Property="Text" Value="{Binding Source='ha593d514gcd01g477dgb588gdfc415f31ef4',Converter={StaticResource TranslatedStringConverter}}"/>
                <Setter TargetName="ExtractCraftingButton" Property="Content" Value="{Binding Source='hfe28d675ga44ag4895gba67gcd86f47fb61b',Converter={StaticResource TranslatedStringConverter}}"/>
                <Setter TargetName="ExtractCraftingButton" Property="Command" Value="{Binding DataContext.CraftItems, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                <Setter TargetName="ExtractCraftingButton" Property="OverwriteClickSound" Value="UI_HUD_Alchemy_CreateSolution_Click"/>
                <Setter TargetName="CraftAllItemsButton" Property="OverwriteClickSound" Value="UI_HUD_Alchemy_CreateSolution_Click"/>
                <Setter TargetName="CraftAllItemsButton" Property="Visibility" Value="Visible"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding SelectedRecipe.Result.Item.Count, Converter={StaticResource GreaterThanConverter}, ConverterParameter=1, FallbackValue=False}" Value="True">
                <Setter TargetName="AmountInput" Property="Visibility" Value="Visible"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding SelectedRecipe.Result.Item.Count, Converter={StaticResource LessThanConverter}, ConverterParameter=2, FallbackValue=True}" Value="True">
                <Setter TargetName="CraftAllItemsButton" Property="IsEnabled" Value="False"/>
                <Setter TargetName="AmountInput" Property="IsEnabled" Value="False"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding ItemsToCraft, Converter={StaticResource LessThanConverter}, ConverterParameter=2, FallbackValue=True}" Value="False">
                <Setter TargetName="ExtractCraftingButton" Property="Content" Value="{Binding Source='h1deddae4gae4eg4a54gafb5ge2e61529e00e',Converter={StaticResource TranslatedStringConverter}}"/>
                <Setter TargetName="ExtractCraftingButton" Property="OverwriteClickSound" Value="UI_HUD_Alchemy_CreateSolution_Click"/>
            </DataTrigger>

            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding IsCreatingItems}" Value="False"/>
                    <Condition Binding="{Binding SelectedRecipe.Result.Item.Count}" Value="0"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="ExtractCraftingButton" Property="IsEnabled" Value="False"/>
                <Setter TargetName="ExtractCraftingError" Property="Visibility" Value="Visible"/>
                <Setter TargetName="AlchemyOrb" Property="Source" Value="{StaticResource OrbDisabled}"/>
            </MultiDataTrigger>

            <DataTrigger Binding="{Binding IsFocused, ElementName=AmountInputBox}" Value="True">
                <Setter TargetName="AmountInputBg" Property="Source" Value="{StaticResource AmountInputBg_h}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding SelectedRecipe.IsSolutionRecipe}" Value="True">
                <Setter TargetName="ExtractCrafting" Property="Margin" Value="0,-81,0,0"/>
            </DataTrigger>

            <!-- If there's no real selected extra extract, set the tooltip to use the VMTooltipItemSectionDetail instead -->
            <DataTrigger Value="True">
                <DataTrigger.Binding>
                    <MultiBinding Converter="{StaticResource EqualConverter}">
                        <Binding Path="SelectedExtraExtract"/>
                        <Binding Path="ExtractAir.Item"/>
                    </MultiBinding>
                </DataTrigger.Binding>
                <Setter TargetName="ExtraExtractToolTip" Property="Content" Value="{Binding DataContext.ExtractAir, ElementName=Crafting}"/>
            </DataTrigger>
            <DataTrigger Value="True">
                <DataTrigger.Binding>
                    <MultiBinding Converter="{StaticResource EqualConverter}">
                        <Binding Path="SelectedExtraExtract"/>
                        <Binding Path="ExtractEarth.Item"/>
                    </MultiBinding>
                </DataTrigger.Binding>
                <Setter TargetName="ExtraExtractToolTip" Property="Content" Value="{Binding DataContext.ExtractEarth, ElementName=Crafting}"/>
            </DataTrigger>
            <DataTrigger Value="True">
                <DataTrigger.Binding>
                    <MultiBinding Converter="{StaticResource EqualConverter}">
                        <Binding Path="SelectedExtraExtract"/>
                        <Binding Path="ExtractFey.Item"/>
                    </MultiBinding>
                </DataTrigger.Binding>
                <Setter TargetName="ExtraExtractToolTip" Property="Content" Value="{Binding DataContext.ExtractFey, ElementName=Crafting}"/>
            </DataTrigger>
            <DataTrigger Value="True">
                <DataTrigger.Binding>
                    <MultiBinding Converter="{StaticResource EqualConverter}">
                        <Binding Path="SelectedExtraExtract"/>
                        <Binding Path="ExtractFire.Item"/>
                    </MultiBinding>
                </DataTrigger.Binding>
                <Setter TargetName="ExtraExtractToolTip" Property="Content" Value="{Binding DataContext.ExtractFire, ElementName=Crafting}"/>
            </DataTrigger>
            <DataTrigger Value="True">
                <DataTrigger.Binding>
                    <MultiBinding Converter="{StaticResource EqualConverter}">
                        <Binding Path="SelectedExtraExtract"/>
                        <Binding Path="ExtractShadow.Item"/>
                    </MultiBinding>
                </DataTrigger.Binding>
                <Setter TargetName="ExtraExtractToolTip" Property="Content" Value="{Binding DataContext.ExtractShadow, ElementName=Crafting}"/>
            </DataTrigger>
            <DataTrigger Value="True">
                <DataTrigger.Binding>
                    <MultiBinding Converter="{StaticResource EqualConverter}">
                        <Binding Path="SelectedExtraExtract"/>
                        <Binding Path="ExtractWater.Item"/>
                    </MultiBinding>
                </DataTrigger.Binding>
                <Setter TargetName="ExtraExtractToolTip" Property="Content" Value="{Binding DataContext.ExtractWater, ElementName=Crafting}"/>
            </DataTrigger>

            <!-- EXTRACT CRAFTING -->
            <DataTrigger Binding="{Binding SelectedRecipe.IsSolutionRecipe}" Value="False">
                <Setter TargetName="CraftingTitle" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="CraftingSolution" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="CraftingExtract" Property="Visibility" Value="Visible"/>
                <Setter TargetName="ExtractCraftingButton" Property="Content" Value="{Binding Source='hcf348dd3g3108g41b9g88c1gc09ee4f9192a', Converter={StaticResource TranslatedStringConverter}}"/>
                <Setter TargetName="ExtractCraftingButton" Property="OverwriteClickSound" Value="UI_HUD_Alchemy_CreateExtracts_Click"/>
                <Setter TargetName="CraftAllItemsButton" Property="OverwriteClickSound" Value="UI_HUD_Alchemy_CreateExtracts_Click"/>
                <Setter TargetName="CraftAllItemsButton" Property="Content">
                    <Setter.Value>
                        <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                            <Binding Source="hf86950e1g7605g42c7gb789gd894ff687b1b"/>
                            <Binding Path="SelectedRecipe.Result.Item.Count"/>
                        </MultiBinding>
                    </Setter.Value>
                </Setter>
                <Setter TargetName="AlchemyOrbHolder" Property="Visibility" Value="Collapsed"/>

                <Setter TargetName="AlchemyBg" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/extract_flowLines_inactive.png"/>
                <Setter TargetName="AlchemyBg" Property="VerticalAlignment" Value="Center"/>
                <Setter TargetName="AlchemyBg" Property="Margin" Value="0,82,0,-82"/>
            </DataTrigger>

            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding SelectedRecipe.IsSolutionRecipe}" Value="False"/>
                    <Condition Binding="{Binding SelectedRecipe.CanBeCrafted}" Value="True"/>
                </MultiDataTrigger.Conditions>

                <Setter TargetName="AlchemyBg" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Alchemy/extract_flowLines_active.png"/>
            </MultiDataTrigger>

            <DataTrigger Binding="{Binding IsChecked, ElementName=AvailableRecipesButton}" Value="True">
                <Setter TargetName="ExtractAirList" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="ExtractEarthList" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="ExtractFeyList" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="ExtractFireList" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="ExtractShadowList" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="ExtractWaterList" Property="Visibility" Value="Collapsed"/>
            </DataTrigger>

            <!-- PROCESS -->
            <DataTrigger Binding="{Binding IsCreatingItems}" Value="True">
                <Setter TargetName="AlchemyOrb" Property="Source" Value="{StaticResource OrbActive}"/>
                <Setter TargetName="ExtractCraftingButton" Property="IsEnabled" Value="False"/>
                <Setter TargetName="CraftAllItemsButton" Property="IsEnabled" Value="False"/>
            </DataTrigger>

            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding IsCreatingItems}" Value="True"/>
                    <Condition Binding="{Binding IsVisible, ElementName=ExtractAndCrafting}" Value="True"/>
                </MultiDataTrigger.Conditions>
                <MultiDataTrigger.EnterActions>
                    <StopStoryboard BeginStoryboardName="ResultMessageTextStoryboard"/>
                </MultiDataTrigger.EnterActions>
                <MultiDataTrigger.Setters>
                    <Setter TargetName="AlchemyOrbVFX" Property="Visibility" Value="Visible"/>
                </MultiDataTrigger.Setters>
            </MultiDataTrigger>

            <DataTrigger Binding="{Binding IsCreatingItems}" Value="True">
                <DataTrigger.ExitActions>
                    <BeginStoryboard x:Name="ResultMessageTextStoryboard" Storyboard="{StaticResource ResultMessageStoryboard}"/>
                </DataTrigger.ExitActions>
            </DataTrigger>

            <!-- SCALING -->
            <DataTrigger Binding="{Binding CurrentPlayer.UIOptions.UIScaling}" Value="Minimal">
                <Setter TargetName="BaseItem" Property="Margin" Value="-120,152,0,0"/>
                <Setter TargetName="ExtraExtract" Property="Margin" Value="0,152,-118,0"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding CurrentPlayer.UIOptions.UIScaling}" Value="Small">
                <Setter TargetName="BaseItem" Property="Margin" Value="-120,142,0,0"/>
                <Setter TargetName="ExtraExtract" Property="Margin" Value="0,142,-118,0"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding CurrentPlayer.UIOptions.UIScaling}" Value="Large">
                <Setter TargetName="BaseItem" Property="Margin" Value="-120,122,0,0"/>
                <Setter TargetName="ExtraExtract" Property="Margin" Value="0,122,-118,0"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding CurrentPlayer.UIOptions.UIScaling}" Value="ExtraLarge">
                <Setter TargetName="BaseItem" Property="Margin" Value="-120,113,0,0"/>
                <Setter TargetName="ExtraExtract" Property="Margin" Value="0,113,-118,0"/>
            </DataTrigger>

        </ControlTemplate.Triggers>
    </ControlTemplate>

    <!--SINGLE CLICK ITEM TEMPLATE FOR POPOUT-->
    <Style x:Key="SingleClickBaseInvContainerItemStyle" TargetType="ListBoxItem" BasedOn="{StaticResource {x:Type ListBoxItem}}">
        <Setter Property="Padding" Value="0"/>
        <Setter Property="BorderThickness" Value="0"/>
        <Setter Property="noesis:StyleInteraction.Behaviors">
            <Setter.Value>
                <noesis:StyleBehaviorCollection>
                    <ls:MouseModifyBehavior SuppressMouseEvents="{Binding Path=(ls:MultiSelect.IsEnabled) ,RelativeSource={RelativeSource AncestorType=ListBoxItem}}"/>
                </noesis:StyleBehaviorCollection>
            </Setter.Value>
        </Setter>
        <Setter Property="ls:ContextMenuService.Context" Value="Inventory"/>
        <Setter Property="Template" >
            <Setter.Value>
                <ControlTemplate TargetType="ListBoxItem">
                    <ls:LSButton Command="{Binding DataContext.UseGameObject, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="{Binding Object}" Padding="0">

                        <ls:LSEntityObject Context="Inventory" DataContext="{Binding Object}" EntityRef="{Binding EntityHandle}" x:Name="invCellBase" Background="{TemplateBinding Background}" ToolTipService.Placement="Right" Tag="{Binding DataContext,RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" ls:ContextMenuService.GenerateEnabled="False" ls:MoveFocus.Focusable="True" Focusable="True" AllowDrop="False">

                            <b:Interaction.Behaviors>
                                <ls:ContextMenuFillBehavior Context="Inventory" Player="{Binding DataContext.CurrentPlayer, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" TargetObject="{Binding .}" Source="{Binding SelectedItems,ElementName=InventoryHolder}" Command="{Binding DataContext.ContextActionPressed, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                            </b:Interaction.Behaviors>
                            <b:Interaction.Triggers>
                                <b:EventTrigger EventName="MouseEnter">
                                    <b:InvokeCommandAction IsEnabled="{Binding IsNew}" Command="{Binding DataContext.ClearItemNewFlag, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="{Binding .}"/>
                                </b:EventTrigger>
                            </b:Interaction.Triggers>
                            <ls:LSEntityObject.ToolTip>
                                <ls:LSTooltip Content="{Binding Path=DataContext.Object, RelativeSource={RelativeSource Mode=TemplatedParent}}" ls:TooltipExtender.Owner="{Binding Tag.CurrentPlayer.SelectedCharacter, ElementName=invCellBase}"/>
                            </ls:LSEntityObject.ToolTip>
                            <ContentPresenter IsHitTestVisible="False"/>
                            <Control x:Name="EquipmentIcon" Template="{StaticResource EquippedItemIconIndicator}" Height="28" Width="36" HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="4,0,0,4"/>
                            <Control Style="{StaticResource NewInventoryCellItemStyle}" />
                            <Image x:Name="SelectedImg" Source="{StaticResource InvSlot_Selector}" Visibility="Hidden" Stretch="Fill" IsHitTestVisible="False"/>
                            <Rectangle Fill="{StaticResource LS_DisabledPanelColor}" Visibility="{Binding Tag, ElementName=CharacterPanelHolder, Converter={StaticResource BoolToCollapsedConverter}}"/>
                        </ls:LSEntityObject>
                    </ls:LSButton>

                    <ControlTemplate.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter TargetName="SelectedImg" Property="Visibility" Value="Visible"/>
                            <Setter TargetName="SelectedImg" Property="Opacity" Value="0.8"/>
                        </Trigger>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="SelectedImg" Property="Visibility" Value="Visible"/>
                            <Setter TargetName="SelectedImg" Property="Opacity" Value="1"/>
                        </Trigger>
                        <DataTrigger Binding="{Binding Object, Converter={StaticResource TypeConverter}}" Value="ls.Character">
                            <Setter TargetName="EquipmentIcon" Property="Visibility" Value="Collapsed"/>
                        </DataTrigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>

            </Setter.Value>
        </Setter>
    </Style>

    <!--EQUIPMENT STYLE-->

    <Style x:Key="EquipmentSlogBgImageStyle" TargetType="Image">
        <Setter Property="Source"  Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EquipSlots/EQ_torch.png"/>
        <Setter Property="Stretch"  Value="None"/>
        <Setter Property="Margin"  Value="-11"/>
        <Setter Property="IsHitTestVisible"  Value="False"/>
        <Style.Triggers>
            <!--SLOT BACKGROUNDS-->
            <DataTrigger Binding="{Binding SlotType}" Value="Amulet">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EquipSlots/EQ_amulet.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding SlotType}" Value="Ring">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EquipSlots/EQ_ring01.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding SlotType}" Value="Ring2">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EquipSlots/EQ_ring02.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding SlotType}" Value="VanityBody">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EquipSlots/EQ_shirt.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding SlotType}" Value="VanityBoots">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EquipSlots/EQ_shoes.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding SlotType}" Value="Helmet">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EquipSlots/EQ_head.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding SlotType}" Value="Boots">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EquipSlots/EQ_feet.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding SlotType}" Value="Cloak">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EquipSlots/EQ_cloak.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding SlotType}" Value="Gloves">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EquipSlots/EQ_gloves.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding SlotType}" Value="Breast">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EquipSlots/EQ_chest.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding SlotType}" Value="Underwear">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EquipSlots/EQ_underwear.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding SlotType}" Value="MusicalInstrument">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EquipSlots/EQ_instrument.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding SlotType}" Value="MeleeMainHand">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EquipSlots/EQ_melee_mainhand.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding SlotType}" Value="MeleeOffHand">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EquipSlots/EQ_melee_offhand.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding SlotType}" Value="RangedMainHand">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EquipSlots/EQ_ranged_mainhand.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding SlotType}" Value="RangedOffHand">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EquipSlots/EQ_ranged_offhand.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding EquippedType}" Value="Equipped">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EquipSlots/EQ_blank.png"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding EquippedType}" Value="FromTwoHanded">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EquipSlots/EQ_blank.png"/>
            </DataTrigger>
        </Style.Triggers>
    </Style>

    <Style x:Key="EquipmentSlotBaseStyle" TargetType="ls:LSButton" BasedOn="{StaticResource {x:Type ls:LSButton}}">
        <Setter Property="Command" Value="{Binding DataContext.ShowAvailableEquipmentDelayedCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
        <Setter Property="CommandParameter" Value="{Binding}" />
        
        <Setter Property="noesis:StyleInteraction.Triggers">
            <Setter.Value>
                <noesis:StyleTriggerCollection>
                    <b:EventTrigger EventName="MouseEnter">
                        <ls:LSPlaySound Sound="UI_Shared_Hover"/>
                        <b:InvokeCommandAction IsEnabled="{Binding IsNew}" Command="{Binding DataContext.UpdateEquipmentSlotNewFlagCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="{Binding}"/>
                    </b:EventTrigger>
                    <b:EventTrigger EventName="MouseDoubleClick">
                        <b:InvokeCommandAction Command="{Binding DataContext.UnequipItemCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="{Binding .}"/>
                    </b:EventTrigger>
                </noesis:StyleTriggerCollection>
            </Setter.Value>
        </Setter>
        <Setter Property="ToolTipService.Placement" Value="Right"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ls:LSButton">
                    <ControlTemplate.Resources>
                        <System:Double x:Key="EquipmentSlotSize">88</System:Double>
                        <System:Double x:Key="EquipmentIconSlotSize">80</System:Double>
                        <BitmapImage  x:Key="SelArrowUri" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EQSlots_overlaySelected_arrow.png" />
                        <BitmapImage  x:Key="SelOverlayUri" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/EQSlots_overlaySelected.png" />
                    </ControlTemplate.Resources>

                    <Grid x:Name="root"  Width="{StaticResource EquipmentSlotSize}" Height="{StaticResource EquipmentSlotSize}" ToolTipService.IsEnabled="{Binding Item,Converter={StaticResource NullToBoolFalseConverter}}" Background="Transparent" ToolTipService.ShowOnDisabled="True" VerticalAlignment="Center" HorizontalAlignment="Center" ToolTipService.Placement="{TemplateBinding ToolTipService.Placement}">
                        <b:Interaction.Behaviors>
                            <ls:ContextMenuFillBehavior Context="Equipment" Player="{Binding DataContext.CurrentPlayer, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" TargetObject="{Binding Item}" Command="{Binding DataContext.ContextActionPressed, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                        </b:Interaction.Behaviors>
                        <Grid.ToolTip>
                            <ls:LSTooltip x:Name="tooltip" IsHitTestVisible="False" Content="{Binding Path=DataContext.Item,ElementName=root}"/>
                        </Grid.ToolTip>
                        <Image x:Name="SlotBg" Style="{StaticResource EquipmentSlogBgImageStyle}"/>
                        <Grid x:Name="IconControl" Background="{StaticResource EquipmentSlotBg}" Opacity="1.0" DataContext="{Binding Item}" IsHitTestVisible="False">
                            <Image x:Name="RarityBackground" Style="{StaticResource RarityFrameBackgroundImageStyle}"/>
                            <Rectangle Fill="{Binding Icon}" />
                            <Image x:Name="RarityForeground" Style="{StaticResource RarityFrameForegroundImageStyle}"/>
                        </Grid>
                        <Rectangle x:Name="greyscaleImg"  Opacity="0.5" Fill="#17000a" Visibility="Collapsed"/>
                        <!-- Highlight slot when hovered -->
                        <Image x:Name="hoverImg" IsHitTestVisible="False" Visibility="Collapsed" Stretch="Uniform" Source="{StaticResource ActiveSlot_h_img}"/>
                        <Rectangle x:Name="DisableLayer" Opacity="0" Fill="Black" IsHitTestVisible="False"/>
                        <!-- Selected slot indicator -->
                        <Image x:Name="SelOverlay" Source="{StaticResource SelOverlayUri}" Visibility="Collapsed" Stretch="None" HorizontalAlignment="Center" VerticalAlignment="Center" IsHitTestVisible="False"/>
                        <Image x:Name="SelArrow" Source="{StaticResource SelArrowUri}" Visibility="Collapsed" Stretch="None" HorizontalAlignment="Center" VerticalAlignment="Top" IsHitTestVisible="False" Margin="0,-12,0,0"/>
                    </Grid>

                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="hoverImg" Property="Visibility" Value="Visible"/>
                        </Trigger>
                        <DataTrigger Binding="{Binding EquippedType}" Value="FromTwoHanded">
                            <Setter TargetName="RarityBackground" Property="Visibility" Value="Collapsed"/>
                            <Setter TargetName="RarityForeground" Property="Visibility" Value="Collapsed"/>
                            <Setter TargetName="greyscaleImg" Property="Visibility" Value="Visible"/>
                        </DataTrigger>

                        <DataTrigger Binding="{Binding IsSelecting}" Value="True">
                            <Setter TargetName="DisableLayer" Property="Visibility" Value="Hidden"/>
                            <Setter TargetName="SelOverlay" Property="Visibility" Value="Visible"/>
                            <Setter TargetName="SelArrow" Property="Visibility" Value="Visible"/>
                        </DataTrigger>


                        <DataTrigger Binding="{Binding DataContext.HasEquipmentFilter, ElementName=EquipmentSlots}" Value="False">
                            <Setter TargetName="DisableLayer" Property="Visibility" Value="Hidden"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Tag,ElementName=equipmentPanel}" Value="False">
                            <Setter TargetName="IconControl" Property="Opacity" Value="{StaticResource OtherPlayersItemOpacity}"/>
                        </DataTrigger>

                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding DataContext.CurrentPlayer.UIData.DragData.DraggingGameObjects[0], Converter={StaticResource TypeConverter}, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="ls.VMItem"/>
                                <Condition Binding="{Binding DataContext.CurrentPlayer.UIData.DragData.DraggingGameObjects[0].IsEquipment, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="True"/>
                                <Condition Value="True">
                                    <Condition.Binding>
                                        <MultiBinding Converter="{StaticResource EqualConverter}">
                                            <Binding Path="DataContext.CurrentPlayer.UIData.DragData.DraggingGameObjects[0].EquipmentSlotType" RelativeSource="{RelativeSource AncestorType={x:Type ls:UIWidget}}"/>
                                            <Binding Path="SlotType"/>
                                        </MultiBinding>
                                    </Condition.Binding>
                                </Condition>
                                <Condition Value="True">
                                    <Condition.Binding>
                                        <MultiBinding Converter="{StaticResource EqualConverter}">
                                            <Binding RelativeSource="{RelativeSource AncestorType={x:Type ls:UIWidget}}" Path="DataContext.CurrentPlayer.UserId"/>
                                            <Binding Path="DataContext.OwnerUserID" ElementName="EquipmentSlots"/>
                                        </MultiBinding>
                                    </Condition.Binding>
                                </Condition>
                            </MultiDataTrigger.Conditions>
                            <Setter TargetName="hoverImg" Property="Visibility" Value="Visible"/>
                        </MultiDataTrigger>
                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding DataContext.CurrentPlayer.UIData.DragData.DraggingGameObjects[0], Converter={StaticResource TypeConverter}, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="ls.VMItem"/>
                                <Condition Binding="{Binding DataContext.CurrentPlayer.UIData.DragData.DraggingGameObjects[0].IsEquipment, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="True"/>
                                <Condition Binding="{Binding DataContext.CurrentPlayer.UIData.DragData.DraggingGameObjects[0].EquipmentSlotType, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="Ring"/>
                                <Condition Binding="{Binding SlotType}" Value="Ring2"/>
                                <Condition Value="True">
                                    <Condition.Binding>
                                        <MultiBinding Converter="{StaticResource EqualConverter}">
                                            <Binding RelativeSource="{RelativeSource AncestorType={x:Type ls:UIWidget}}" Path="DataContext.CurrentPlayer.UserId"/>
                                            <Binding Path="DataContext.OwnerUserID" ElementName="EquipmentSlots"/>
                                        </MultiBinding>
                                    </Condition.Binding>
                                </Condition>
                            </MultiDataTrigger.Conditions>
                            <Setter TargetName="hoverImg" Property="Visibility" Value="Visible"/>
                        </MultiDataTrigger>
                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding DataContext.CurrentPlayer.UIData.DragData.DraggingGameObjects[0], Converter={StaticResource TypeConverter}, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="ls.VMItem"/>
                                <Condition Binding="{Binding DataContext.CurrentPlayer.UIData.DragData.DraggingGameObjects[0].IsEquipment, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="True"/>
                                <Condition Binding="{Binding DataContext.CurrentPlayer.UIData.DragData.DraggingGameObjects[0].EquipmentSlotType, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="MeleeMainHand"/>
                                <Condition Binding="{Binding SlotType}" Value="MeleeOffHand"/>
                                <Condition Value="True">
                                    <Condition.Binding>
                                        <MultiBinding Converter="{StaticResource EqualConverter}">
                                            <Binding RelativeSource="{RelativeSource AncestorType={x:Type ls:UIWidget}}" Path="DataContext.CurrentPlayer.UserId"/>
                                            <Binding Path="DataContext.OwnerUserID" ElementName="EquipmentSlots"/>
                                        </MultiBinding>
                                    </Condition.Binding>
                                </Condition>
                            </MultiDataTrigger.Conditions>
                            <Setter TargetName="hoverImg" Property="Visibility" Value="Visible"/>
                        </MultiDataTrigger>
                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding DataContext.CurrentPlayer.UIData.DragData.DraggingGameObjects[0], Converter={StaticResource TypeConverter}, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="ls.VMItem"/>
                                <Condition Binding="{Binding DataContext.CurrentPlayer.UIData.DragData.DraggingGameObjects[0].IsEquipment, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="True"/>
                                <Condition Binding="{Binding DataContext.CurrentPlayer.UIData.DragData.DraggingGameObjects[0].EquipmentSlotType, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="RangedMainHand"/>
                                <Condition Binding="{Binding SlotType}" Value="RangedOffHand"/>
                                <Condition Value="True">
                                    <Condition.Binding>
                                        <MultiBinding Converter="{StaticResource EqualConverter}">
                                            <Binding RelativeSource="{RelativeSource AncestorType={x:Type ls:UIWidget}}" Path="DataContext.CurrentPlayer.UserId"/>
                                            <Binding Path="DataContext.OwnerUserID" ElementName="EquipmentSlots"/>
                                        </MultiBinding>
                                    </Condition.Binding>
                                </Condition>
                            </MultiDataTrigger.Conditions>
                            <Setter TargetName="hoverImg" Property="Visibility" Value="Visible"/>
                        </MultiDataTrigger>

                        <Trigger Property="IsEnabled" Value="False">
                            <Setter TargetName="tooltip" Property="Content" Value="{Binding Source='hcc92420fgadcfg4a13g90feg6996722734b6',Converter={StaticResource TranslatedStringConverter}}"/>
                            <Setter TargetName="root" Property="ToolTipService.IsEnabled" Value="True"/>
                        </Trigger>
                        <DataTrigger Binding="{Binding Tag, ElementName=CharacterPanelHolder}" Value="False">
                            <Setter TargetName="DisableLayer" Property="Visibility" Value="Visible"/>
                            <Setter TargetName="DisableLayer" Property="Opacity" Value="0"/>
                            <Setter TargetName="DisableLayer" Property="Fill" Value="{StaticResource LS_DisabledPanelColor}"/>
                        </DataTrigger>


                    </ControlTemplate.Triggers>
                </ControlTemplate>

            </Setter.Value>
        </Setter>
        <Setter Property="IsEnabled" Value="{Binding IsEnabled}"/>
        <Style.Triggers>
            <!--Disable selecting EQ slots on Companion Panel-->
            <DataTrigger Binding="{Binding Name, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="CompanionsPanel" >
                <Setter Property="Command" Value="{x:Null}"/>
            </DataTrigger>
            
            <!--Disable selecting EQ slots on Trade Panel-->
            <DataTrigger Binding="{Binding Name, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="Trade" >
                <Setter Property="Command" Value="{x:Null}"/>
            </DataTrigger>
        </Style.Triggers>
    </Style>

    <Style x:Key="EquipmentSlotStyle" TargetType="ls:LSButton" BasedOn="{StaticResource EquipmentSlotBaseStyle}">
        <Setter Property="noesis:StyleInteraction.Behaviors">
            <Setter.Value>
                <noesis:StyleBehaviorCollection>
                    <ls:DragGenericBehavior StartDragCommand="{Binding DataContext.DragEquipmentSlotCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                    <ls:DropOnGenericBehavior DropCommand="{Binding DataContext.DropEquipmentSlotCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                </noesis:StyleBehaviorCollection>
            </Setter.Value>
        </Setter>
    </Style>

    <!--TOGGLEABLE EQ SLOTS TEMPLATES-->
    <ControlTemplate x:Key="VisibilityButtonTemplate" TargetType="ls:LSButton">
        <StackPanel Orientation="Horizontal">
            <Grid VerticalAlignment="Top" HorizontalAlignment="Left">
                <Image x:Name="frame" VerticalAlignment="Center" HorizontalAlignment="Center" Source="pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/toggle_visibility_d_active.png" Stretch="None"/>
                <Image x:Name="icon" VerticalAlignment="Center" HorizontalAlignment="Center" Source="{DynamicResource IconNormal}" Stretch="None">
                    <!-- Default is hidden-->
                    <Image.Style>
                        <Style TargetType="Image">
                            <Style.Resources>
                                <ImageSource x:Key="IconNormal">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_none_d.png</ImageSource>
                                <ImageSource x:Key="IconHighlight">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_none_h.png</ImageSource>
                                <ImageSource x:Key="IconPressed">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_none_h.png</ImageSource>
                            </Style.Resources>
                        </Style>
                    </Image.Style>
                </Image>
                <Rectangle Fill="{StaticResource LS_DisabledPanelColor}" Visibility="{Binding Tag, ElementName=CharacterPanelHolder, Converter={StaticResource BoolToCollapsedConverter}}"/>
                <Rectangle x:Name="DimDownVisibilityCover" Width="40" Height="40" Opacity="0.6" Fill="Black" IsHitTestVisible="False"/>
            </Grid>
            <TextBlock Name="HelmetToggleString" Text="{Binding Source='h90154bd4g08b9g46efg8e70gbce5d5a99e1a',Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource DetailedListText}" Visibility="Collapsed" Margin="4,0,-600,0" noesis:Text.StrokeThickness="4" noesis:Text.Stroke="{StaticResource LS_PrimaryColorOutlineColor}">
                <TextBlock.Effect>
                    <DropShadowEffect Direction="270" Color="{StaticResource LS_PrimaryColorDropShadowColor}" ShadowDepth="3.0" BlurRadius="8.0"/>
                </TextBlock.Effect>
            </TextBlock>
        </StackPanel>
        <ControlTemplate.Triggers>
            <DataTrigger Binding="{Binding VisibilityType}" Value="Visible">
                <Setter Property="Style" TargetName="icon">
                    <Setter.Value>
                        <Style TargetType="Image">
                            <Style.Resources>
                                <ImageSource x:Key="IconNormal">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_d.png</ImageSource>
                                <ImageSource x:Key="IconHighlight">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_h.png</ImageSource>
                                <ImageSource x:Key="IconPressed">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_h.png</ImageSource>
                            </Style.Resources>
                        </Style>
                    </Setter.Value>
                </Setter>
                <Setter Property="Text" TargetName="HelmetToggleString" Value="{Binding Source='h90154bd4g08b9g46efg8e70gbce5d5a99e1a',Converter={StaticResource TranslatedStringConverter}}"/>

            </DataTrigger>

            <DataTrigger Binding="{Binding VisibilityType}" Value="CinematicsHidden">
                <Setter Property="Style" TargetName="icon">
                    <Setter.Value>
                        <Style TargetType="Image">
                            <Style.Resources>
                                <ImageSource x:Key="IconNormal">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_dialogueNone_d.png</ImageSource>
                                <ImageSource x:Key="IconHighlight">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_dialogueNone_h.png</ImageSource>
                                <ImageSource x:Key="IconPressed">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_dialogueNone_h.png</ImageSource>
                            </Style.Resources>
                        </Style>
                    </Setter.Value>
                </Setter>
                <Setter Property="Text" TargetName="HelmetToggleString" Value="{Binding Source='h57dce093g8d4ag43b4gb7a3g525250a499c1',Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding VisibilityType}" Value="Hidden">
                <Setter Property="Style" TargetName="icon">
                    <Setter.Value>
                        <Style TargetType="Image">
                            <Style.Resources>
                                <ImageSource x:Key="IconNormal">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_none_d.png</ImageSource>
                                <ImageSource x:Key="IconHighlight">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_none_h.png</ImageSource>
                                <ImageSource x:Key="IconPressed">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_none_h.png</ImageSource>
                            </Style.Resources>
                        </Style>
                    </Setter.Value>
                </Setter>
                <Setter Property="Text" TargetName="HelmetToggleString" Value="{Binding Source='h5bd7b04cg842eg4892ga9b7ga421ad707517',Converter={StaticResource TranslatedStringConverter}}"/>

            </DataTrigger>

            <Trigger Property="IsMouseOver" Value="True">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/toggle_visibility_h_active.png" TargetName="frame"/>
                <Setter Property="Source" Value="{DynamicResource IconHighlight}" TargetName="icon"/>
                <Setter Property="Visibility" Value="Visible" TargetName="HelmetToggleString"/>
            </Trigger>

            <Trigger Property="IsPressed" Value="True">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/toggle_visibility_h_active.png" TargetName="frame"/>
                <Setter Property="Source" Value="{DynamicResource IconPressed}" TargetName="icon"/>
            </Trigger>

            <DataTrigger Binding="{Binding IsSelecting}" Value="True">
                <Setter TargetName="DimDownVisibilityCover" Property="Visibility" Value="Hidden"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding DataContext.HasEquipmentFilter, ElementName=EquipmentSlots}" Value="False">
                <Setter TargetName="DimDownVisibilityCover" Property="Visibility" Value="Hidden"/>
            </DataTrigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <ControlTemplate x:Key="HelmetEQTemplate" TargetType="Control">
        <Grid HorizontalAlignment="Left">
            <ls:LSButton Style="{StaticResource EquipmentSlotStyle}"/>
            <ls:LSButton x:Name="VisibilityButton" VerticalAlignment="Top" HorizontalAlignment="Left" Margin="-4,-40,0,0" Command="{Binding DataContext.ChangeEquipmentVisibilityCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="{Binding}" Template="{StaticResource VisibilityButtonTemplate}" Opacity="0"/>
        </Grid>
        <ControlTemplate.Triggers>
            <Trigger Property="IsMouseOver" Value="True">
                <Setter Property="Opacity" Value="1" TargetName="VisibilityButton"/>
            </Trigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <ControlTemplate x:Key="StowedVisibilityButtonTemplate" TargetType="ls:LSButton">
        <StackPanel Orientation="Horizontal">
            <TextBlock Name="MusicalToggleString" Text="{Binding Source='h99bd79aeg8906g4400g9bdbg2ea075945d2e',Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource DetailedListText}" Margin="-600,0,4,0" TextAlignment="Right" Visibility="Collapsed" noesis:Text.StrokeThickness="4" noesis:Text.Stroke="{StaticResource LS_PrimaryColorOutlineColor}">
                <TextBlock.Effect>
                    <DropShadowEffect Direction="270" Color="{StaticResource LS_PrimaryColorDropShadowColor}" ShadowDepth="3.0" BlurRadius="8.0"/>
                </TextBlock.Effect>
            </TextBlock>
            <Grid>
                <Image x:Name="frame" HorizontalAlignment="Left" Source="pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/toggle_visibility_d_active.png" Stretch="None"/>
                <Image x:Name="icon" VerticalAlignment="Center" HorizontalAlignment="Center" Source="{DynamicResource IconNormal}" Stretch="None">
                    <!-- Default is hidden-->
                    <Image.Style>
                        <Style TargetType="Image">
                            <Style.Resources>
                                <ImageSource x:Key="IconNormal">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_none_d.png</ImageSource>
                                <ImageSource x:Key="IconHighlight">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_none_h.png</ImageSource>
                                <ImageSource x:Key="IconPressed">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_none_h.png</ImageSource>
                            </Style.Resources>
                        </Style>
                    </Image.Style>
                </Image>
                <Rectangle Fill="{StaticResource LS_DisabledPanelColor}" Visibility="{Binding Tag, ElementName=CharacterPanelHolder, Converter={StaticResource BoolToCollapsedConverter}}"/>
            </Grid>
        </StackPanel>
        <ControlTemplate.Triggers>
            <DataTrigger Binding="{Binding StowedVisibility}" Value="ShowWeaponOnly">
                <Setter Property="Style" TargetName="icon">
                    <Setter.Value>
                        <Style TargetType="Image">
                            <Style.Resources>
                                <ImageSource x:Key="IconNormal">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_d.png</ImageSource>
                                <ImageSource x:Key="IconHighlight">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_h.png</ImageSource>
                                <ImageSource x:Key="IconPressed">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_h.png</ImageSource>
                            </Style.Resources>
                        </Style>
                    </Setter.Value>
                </Setter>
                <Setter Property="Text" TargetName="MusicalToggleString" Value="{Binding Source='hddb17d4eg181fg4e65g9f0cg8e430dc903ca',Converter={StaticResource TranslatedStringConverter}}"/>

            </DataTrigger>

            <DataTrigger Binding="{Binding StowedVisibility}" Value="ShowMusicalInstrumentOnly">
                <Setter Property="Style" TargetName="icon">
                    <Setter.Value>
                        <Style TargetType="Image">
                            <Style.Resources>
                                <ImageSource x:Key="IconNormal">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_dialogueNone_d.png</ImageSource>
                                <ImageSource x:Key="IconHighlight">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_dialogueNone_h.png</ImageSource>
                                <ImageSource x:Key="IconPressed">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_dialogueNone_h.png</ImageSource>
                            </Style.Resources>
                        </Style>
                    </Setter.Value>
                </Setter>
                <Setter Property="Text" TargetName="MusicalToggleString" Value="{Binding Source='hfb427664gb836g49ebga804g0aa44391e8ad',Converter={StaticResource TranslatedStringConverter}}"/>

            </DataTrigger>

            <DataTrigger Binding="{Binding StowedVisibility}" Value="ShowAll">
                <Setter Property="Style" TargetName="icon">
                    <Setter.Value>
                        <Style TargetType="Image">
                            <Style.Resources>
                                <ImageSource x:Key="IconNormal">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_none_d.png</ImageSource>
                                <ImageSource x:Key="IconHighlight">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_none_h.png</ImageSource>
                                <ImageSource x:Key="IconPressed">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/ico_visibility_none_h.png</ImageSource>
                            </Style.Resources>
                        </Style>
                    </Setter.Value>
                </Setter>
            </DataTrigger>

            <Trigger Property="IsMouseOver" Value="True">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/toggle_visibility_h_active.png" TargetName="frame"/>
                <Setter Property="Source" Value="{DynamicResource IconHighlight}" TargetName="icon"/>
                <Setter Property="Visibility" Value="Visible" TargetName="MusicalToggleString"/>

            </Trigger>

            <Trigger Property="IsPressed" Value="True">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/toggle_visibility_h_active.png" TargetName="frame"/>
                <Setter Property="Source" Value="{DynamicResource IconPressed}" TargetName="icon"/>
            </Trigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <ControlTemplate x:Key="MuscialEQTemplate">

        <Grid>
            <ls:LSButton Style="{StaticResource EquipmentSlotStyle}" VerticalAlignment="Bottom"/>
            <ls:LSButton x:Name="VisibilityButton" Command="{Binding DataContext.ChangeStowedVisibilityCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="{Binding}" Template="{StaticResource StowedVisibilityButtonTemplate}" Visibility="Collapsed" VerticalAlignment="Top" HorizontalAlignment="Right" Margin="0,-40,0,0">
            </ls:LSButton>
        </Grid>

        <ControlTemplate.Triggers>
            <Trigger Property="IsMouseOver" Value="True">
                <Setter Property="Visibility" Value="Visible" TargetName="VisibilityButton"/>
            </Trigger>

        </ControlTemplate.Triggers>
    </ControlTemplate>

    <ControlTemplate x:Key="VanityButtonTemplate" TargetType="ls:LSButton">
        <ControlTemplate.Resources>
            <ImageSource x:Key="ActiveFrame">pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/toggle_visibility_d_active.png</ImageSource>
        </ControlTemplate.Resources>

        <StackPanel Orientation="Horizontal">
            <TextBlock Name="VanityToggleString" DockPanel.Dock="Top" Text="{Binding Source='h5c3d81adg53ffg44f7gaabfg58ddbfb5d13d',Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource DetailedListText}" TextAlignment="Right" Visibility="Collapsed" Margin="-600,0,0,0" noesis:Text.StrokeThickness="4" noesis:Text.Stroke="{StaticResource LS_PrimaryColorOutlineColor}">
                <TextBlock.Effect>
                    <DropShadowEffect Direction="270" Color="{StaticResource LS_PrimaryColorDropShadowColor}" ShadowDepth="3.0" BlurRadius="8.0"/>
                </TextBlock.Effect>
            </TextBlock>
            <Grid>
                <Image x:Name="frame" HorizontalAlignment="Left" Source="pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/toggle_visibility_d.png" Stretch="None"/>
                <Image x:Name="icon" VerticalAlignment="Center" HorizontalAlignment="Center" Source="{DynamicResource IconNormal}" Stretch="None" Margin="-44">
                    <Image.Style>
                        <Style TargetType="Image">
                            <Style.Resources>
                                <ImageSource x:Key="IconNormal">pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ico_EQ_selected.png</ImageSource>
                                <ImageSource x:Key="IconHighlight">pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ico_EQ_selected.png</ImageSource>
                                <ImageSource x:Key="IconPressed">pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/ico_EQ_selected.png</ImageSource>
                            </Style.Resources>
                        </Style>
                    </Image.Style>
                </Image>
                <Rectangle Fill="{StaticResource LS_DisabledPanelColor}" Visibility="{Binding Tag, ElementName=CharacterPanelHolder, Converter={StaticResource BoolToCollapsedConverter}}"/>
            </Grid>
        </StackPanel>
        <ControlTemplate.Triggers>
            <DataTrigger Binding="{Binding ArmorSetVisibility}" Value="Vanity">
                <Setter Property="Style" TargetName="icon">
                    <Setter.Value>
                        <Style TargetType="Image">
                            <Style.Resources>
                                <ImageSource x:Key="IconNormal">pack://application:,,,/GustavNoesisGUI;component/Assets/BottomBar/ico_camp_d.png</ImageSource>
                                <ImageSource x:Key="IconHighlight">pack://application:,,,/GustavNoesisGUI;component/Assets/BottomBar/ico_camp_h.png</ImageSource>
                                <ImageSource x:Key="IconPressed">pack://application:,,,/GustavNoesisGUI;component/Assets/BottomBar/ico_camp_h.png</ImageSource>
                            </Style.Resources>
                        </Style>
                    </Setter.Value>
                </Setter>
                <Setter Property="Text" Value="{Binding Source='hd0ce1dceg17fcg427cga007gad73bae7e0ab',Converter={StaticResource TranslatedStringConverter}}" TargetName="VanityToggleString"/>
                <Setter Property="Source" Value="{StaticResource ActiveFrame}" TargetName="frame"/>
            </DataTrigger>

            <Trigger Property="IsMouseOver" Value="True">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/toggle_visibility_h_active.png" TargetName="frame"/>
                <Setter Property="Source" Value="{DynamicResource IconHighlight}" TargetName="icon"/>
                <Setter Property="Visibility" Value="Visible" TargetName="VanityToggleString"/>

            </Trigger>

            <Trigger Property="IsPressed" Value="True">
                <Setter Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Equipment/toggle_visibility_h_active.png" TargetName="frame"/>
                <Setter Property="Source" Value="{DynamicResource IconPressed}" TargetName="icon"/>
            </Trigger>

        </ControlTemplate.Triggers>
    </ControlTemplate>

    <ControlTemplate x:Key="WeaponAttackBonusTemplate" TargetType="Control">
        <Grid HorizontalAlignment="Stretch" DataContext="{Binding Stats}" Background="{StaticResource LS_PopUpBackgroundColor}">
            <Grid.Resources>
                <Style TargetType="TextBlock" BasedOn="{StaticResource DetailedListValue}">
                    <Setter Property="HorizontalAlignment" Value="Stretch"/>
                    <Setter Property="VerticalAlignment" Value="Center"/>
                    <Setter Property="IsHitTestVisible" Value="False"/>
                    <Setter Property="TextAlignment" Value="Center"/>
                </Style>
                <Style x:Key="DualLineBreaks" TargetType="Border">
                    <Setter Property="BorderBrush" Value="{StaticResource LS_tint20}"/>
                    <Setter Property="BorderThickness" Value="0,0,3,0"/>
                    <Setter Property="Margin" Value="0,6"/>
                </Style>
                <Style x:Key="DualLineBreaksMirror" BasedOn="{StaticResource DualLineBreaks}" TargetType="Border">
                    <Setter Property="BorderThickness" Value="3,0,0,0"/>
                </Style>
            </Grid.Resources>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- ==== ATTACK BONUS ROW ==== -->
            <Border x:Name="AtackBonusRow" Grid.Row="0" Style="{StaticResource RowBG_d}" HorizontalAlignment="Stretch" Margin="2,0" ToolTipService.Placement="Right"  ToolTipService.VerticalOffset="-80">
                <Border.ToolTip>
                    <ls:LSTooltip Content="{Binding Path=DataContext.AttackBonus, ElementName=AtackBonusRow}"/>
                </Border.ToolTip>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="{StaticResource CSSlotSize}"/>
                        <ColumnDefinition Width="{StaticResource CSSlotSize}"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="{StaticResource CSSlotSize}"/>
                        <ColumnDefinition Width="{StaticResource CSSlotSize}"/>
                    </Grid.ColumnDefinitions>
                    <!--MELEE BONUS-->
                    <TextBlock Grid.Column="0" x:Name="MeleeBonus_MainH" Text="{Binding MeleeAttackBonus.Value, StringFormat=' {0:+#;-#;- }'}"/>
                    <Border x:Name="MeleeBonusSeparatorLine" Grid.Column="0" Style="{StaticResource DualLineBreaks}"/>
                    <TextBlock Grid.Column="1" x:Name="MeleeBonus_OffH" Text="{Binding OffHandMeleeAttackBonus.Value, StringFormat=' {0:+#;-#;- }'}"/>

                    <!--LABEL-->
                    <TextBlock Grid.Column="2" Text="{Binding Source='h4db5409ag8fb5g4d46g88a1g465c84e20fef',Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource DetailedListText}" HorizontalAlignment="Center"/>

                    <!--RANGED BONUS-->
                    <TextBlock Grid.Column="3" x:Name="RangedBonus_MainH" Text="{Binding RangedAttackBonus.Value, StringFormat=' {0:+#;-#;- }'}"/>
                    <Border x:Name="RangedBonusSeparatorLine" Grid.Column="4" Style="{StaticResource DualLineBreaksMirror}"/>
                    <TextBlock x:Name="RangedBonus_OffH" Grid.Column="4" Text="{Binding OffHandRangedAttackBonus.Value, StringFormat=' {0:+#;-#;- }'}"/>
                </Grid>
            </Border>

            <!-- ==== DAMAGE ROW ==== -->
            <Border x:Name="DamageBonusRow"  Grid.Row="1" Style="{StaticResource RowBG_d}" HorizontalAlignment="Stretch" Margin="2,0" ToolTipService.Placement="Right" ToolTipService.VerticalOffset="-80">
                <Border.ToolTip>
                    <ls:LSTooltip Content="{Binding Path=DataContext.EquippedWeaponDamage, ElementName=DamageBonusRow}"/>
                </Border.ToolTip>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="{StaticResource CSSlotSize}"/>
                        <ColumnDefinition Width="{StaticResource CSSlotSize}"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="{StaticResource CSSlotSize}"/>
                        <ColumnDefinition Width="{StaticResource CSSlotSize}"/>
                    </Grid.ColumnDefinitions>
                    <!--MELEE DAMAGE -->
                    <TextBlock Grid.Column="0" x:Name="MeleeDamage_MainH">
                        <ls:TextBlockFormatter.SourceText>                                 
                            <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                <Binding Source="h1c706361g066ag4701gb902g31e2406b5dea"/>
                                <Binding Path="MeleeAttackDamageRange.Value"/>
                                <Binding Path="MeleeAttackDamageRange.Max"/>
                            </MultiBinding>
                        </ls:TextBlockFormatter.SourceText>
                    </TextBlock>
                    <Border Grid.Column="0" x:Name="MeleeDamageSeparatorLine" Style="{StaticResource DualLineBreaks}"/>
                    <TextBlock Grid.Column="1" x:Name="MeleeDamage_OffH">
                        <ls:TextBlockFormatter.SourceText>
                            <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                <Binding Source="h1c706361g066ag4701gb902g31e2406b5dea"/>
                                <Binding Path="OffHandMeleeAttackDamageRange.Value"/>
                                <Binding Path="OffHandMeleeAttackDamageRange.Max"/>
                            </MultiBinding>
                        </ls:TextBlockFormatter.SourceText>
                    </TextBlock>
                    <!--LABEL-->
                    <TextBlock Grid.Column="2" Text="{Binding Source='h53477166gd2ebg4769gad58gc949e73e89c4',Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource DetailedListText}" HorizontalAlignment="Center"/>

                    <!--RANGED DAMAGE -->
                    <TextBlock Grid.Column="3" x:Name="RangedDamage_MainH">
                        <ls:TextBlockFormatter.SourceText>       
                            <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                <Binding Source="h1c706361g066ag4701gb902g31e2406b5dea"/>
                                <Binding Path="RangedAttackDamageRange.Value"/>
                                <Binding Path="RangedAttackDamageRange.Max"/>
                            </MultiBinding>
                        </ls:TextBlockFormatter.SourceText>
                    </TextBlock>
                    <Border Grid.Column="4" x:Name="RangedDamageSeparatorLine" Style="{StaticResource DualLineBreaksMirror}"/>
                    <TextBlock Grid.Row="4" x:Name="RangedDamage_OffH" Grid.Column="4">
                        <ls:TextBlockFormatter.SourceText>       
                            <MultiBinding Converter="{StaticResource ParameterizedTranslatedStringConverter}">
                                <Binding Source="h1c706361g066ag4701gb902g31e2406b5dea"/>
                                <Binding Path="OffHandRangedAttackDamageRange.Value"/>
                                <Binding Path="OffHandRangedAttackDamageRange.Max"/>
                            </MultiBinding>
                        </ls:TextBlockFormatter.SourceText>
                    </TextBlock>
                </Grid>
            </Border>
        </Grid>

        <ControlTemplate.Triggers>
            <Trigger Property="IsMouseOver" Value="True" SourceName="AtackBonusRow">
                <Setter TargetName="AtackBonusRow" Property="Background" Value="{StaticResource RowBG_h}"/>
            </Trigger>
            <Trigger Property="IsMouseOver" Value="True" SourceName="DamageBonusRow">
                <Setter TargetName="DamageBonusRow" Property="Background" Value="{StaticResource RowBG_h}"/>
            </Trigger>

            <DataTrigger Binding="{Binding HasMeleeDualWielding}" Value="False">
                <Setter TargetName="MeleeBonus_MainH" Property="Grid.ColumnSpan" Value="2"/>
                <Setter TargetName="MeleeBonus_OffH" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="MeleeBonusSeparatorLine" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="MeleeDamage_MainH" Property="Grid.ColumnSpan" Value="2"/>
                <Setter TargetName="MeleeDamage_OffH" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="MeleeDamageSeparatorLine" Property="Visibility" Value="Collapsed"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding HasRangedDualWielding}" Value="False">
                <Setter TargetName="RangedBonus_MainH" Property="Grid.ColumnSpan" Value="2"/>
                <Setter TargetName="RangedBonus_OffH" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="RangedBonusSeparatorLine" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="RangedDamage_MainH" Property="Grid.ColumnSpan" Value="2"/>
                <Setter TargetName="RangedDamage_OffH" Property="Visibility" Value="Collapsed"/>
                <Setter TargetName="RangedDamageSeparatorLine" Property="Visibility" Value="Collapsed"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding Equipment.RangedMainHand.Item, Converter={StaticResource NullToBoolTrueConverter}}" Value="True">
                <Setter TargetName="RangedBonus_MainH" Property="Text" Value="-"/>
                <Setter TargetName="RangedDamage_MainH" Property="ls:TextBlockFormatter.SourceText" Value="-"/>
            </DataTrigger>


        </ControlTemplate.Triggers>
    </ControlTemplate>

    <!-- ===== INVENTORY GRID  ===== -->

    <Style x:Key="InventoryGridStyle" TargetType="ls:LSGrid">
        <Setter Property="noesis:Element.PPAAMode" Value="Disabled"/>
        <Setter Property="SnapsToDevicePixels" Value="True"/>
        <Setter Property="ContainerData" Value="{Binding .}"/>
        <Setter Property="IndexParam" Value="Index"/>
        <Setter Property="AllowDrop" Value="True"/>
        <Setter Property="CellWidth" Value="{StaticResource ScaledSlotSize}"/>
        <Setter Property="CellHeight" Value="{StaticResource ScaledSlotSize}"/>
        <Setter Property="AutoIndex" Value="False"/>
        <Setter Property="ViewportExtension" Value="2,2"/>
        <Setter Property="Background">
            <Setter.Value>
                <ImageBrush x:Name="BackgroundBrush" ImageSource="{StaticResource InventorySlotsTileImage}" TileMode="Tile" Stretch="Fill" ViewportUnits="Absolute" Viewport="{StaticResource ScaledTileViewport}" AlignmentX="Left" AlignmentY="Top"/>
            </Setter.Value>
        </Setter>

        <Style.Triggers>
            <DataTrigger Binding="{Binding CurrentFilter, ElementName='FilteringContainerHolder', Converter={StaticResource NullToBoolTrueConverter}}" Value="False">
                <Setter Property="AutoIndex" Value="True"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding IsChecked, ElementName=ChangePartyContextButton}" Value="True">
                <Setter Property="AutoIndex" Value="True"/>
            </DataTrigger>

            <DataTrigger Binding="{Binding (ls:AttachedProperties.InheritedNumber), RelativeSource={RelativeSource Self}, Converter={StaticResource GreaterThanConverter}, ConverterParameter=0}" Value="True">
                <Setter Property="Columns">
                    <Setter.Value>
                        <MultiBinding Converter="{StaticResource DivideMultiConverter}" ConverterParameter="Floor">
                            <Binding Path="(ls:AttachedProperties.InheritedNumber)" RelativeSource="{RelativeSource Self}"/>
                            <Binding Source="{StaticResource ScaledSlotSize}"/>
                        </MultiBinding>
                    </Setter.Value>
                </Setter>
            </DataTrigger>
        </Style.Triggers>
    </Style>

    <Style x:Key="FilterInventoryGridStyle" BasedOn="{StaticResource InventoryGridStyle}" TargetType="ls:LSGrid">
        <Setter Property="AllowDrop" Value="False"/>
    </Style>


    <ItemsPanelTemplate x:Key="FilterInventoryGridTemplate">
        <ls:LSGrid x:Name="InvGrid" Style="{StaticResource FilterInventoryGridStyle}" ContainerData="{Binding Inventory}" ExtendedRows="False">
            <b:Interaction.Triggers>
                <b:EventTrigger EventName="MouseEnter">
                    <ls:LSPlaySound Sound="UI_State_MouseOverInventory"/>
                </b:EventTrigger>
                <b:EventTrigger EventName="MouseLeave">
                    <ls:LSPlaySound Sound="UI_State_MouseOverInventory_Off"/>
                </b:EventTrigger>
                <b:EventTrigger EventName="WidgetClosing">
                    <b:InvokeCommandAction Command="{Binding DataContext.ClearInventoryNewFlags, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="{Binding }"/>
                </b:EventTrigger>

                <b:EventTrigger EventName="WidgetClosing" >
                    <b:Interaction.Behaviors>
                        <b:ConditionBehavior>
                            <b:ConditionalExpression>
                                <b:ComparisonCondition LeftOperand="{Binding IsVisible, ElementName=CharacterPanelHolder}" Operator="Equal" RightOperand="True"/>
                            </b:ConditionalExpression>
                        </b:ConditionBehavior>
                    </b:Interaction.Behaviors>
                    <!-- Tutorial UI Event - Inventory Closed-->
                    <b:InvokeCommandAction Command="{Binding DataContext.TutorialEvent, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="3b433da9-3bd4-4273-8e7f-f85e03ee1601"/>
                </b:EventTrigger>
            </b:Interaction.Triggers>
        </ls:LSGrid>
    </ItemsPanelTemplate>

    <ItemsPanelTemplate x:Key="InventoryGridTemplate">
        <ls:LSGrid x:Name="InvGrid" Style="{StaticResource InventoryGridStyle}" ContainerData="{Binding Inventory}">
            <b:Interaction.Behaviors>
                <ls:DropOnInventoryGridBehavior DropCommand="{Binding DataContext.DropOnInventorySlotCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
            </b:Interaction.Behaviors>
            <b:Interaction.Triggers>
                <b:EventTrigger EventName="PreviewDrop">
                    <ls:LSPlaySound Sound="UI_State_MouseOverInventory"/>
                </b:EventTrigger>
                <b:EventTrigger EventName="MouseEnter">
                    <ls:LSPlaySound Sound="UI_State_MouseOverInventory"/>
                </b:EventTrigger>
                <b:EventTrigger EventName="MouseLeave">
                    <ls:LSPlaySound Sound="UI_State_MouseOverInventory_Off"/>
                </b:EventTrigger>
                <b:EventTrigger EventName="WidgetClosing">
                    <b:InvokeCommandAction Command="{Binding DataContext.ClearInventoryNewFlags, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="{Binding }"/>
                </b:EventTrigger>

                <b:EventTrigger EventName="WidgetClosing" >
                    <b:Interaction.Behaviors>
                        <b:ConditionBehavior>
                            <b:ConditionalExpression>
                                <b:ComparisonCondition LeftOperand="{Binding IsVisible, ElementName=CharacterPanelHolder}" Operator="Equal" RightOperand="True"/>
                            </b:ConditionalExpression>
                        </b:ConditionBehavior>
                    </b:Interaction.Behaviors>
                    <!-- Tutorial UI Event - Inventory Closed-->
                    <b:InvokeCommandAction Command="{Binding DataContext.TutorialEvent, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="3b433da9-3bd4-4273-8e7f-f85e03ee1601"/>
                </b:EventTrigger>
            </b:Interaction.Triggers>
        </ls:LSGrid>
    </ItemsPanelTemplate>

    <Style x:Key="InvContainerItemStyle"  TargetType="ListBoxItem"   BasedOn="{StaticResource BaseInvContainerItemStyle}">
        <Setter Property="Template" >
            <Setter.Value>
                <ControlTemplate TargetType="ListBoxItem">
                    <ls:LSEntityObject x:Name="invCellBase" Context="{Binding (ls:ContextMenuService.Context) , RelativeSource={RelativeSource Mode=TemplatedParent} }" DataContext="{Binding Object}" EntityRef="{Binding EntityHandle}" Background="{TemplateBinding Background}"
                                                               ToolTipService.Placement="Right" Tag="{Binding (ls:WidgetData.DataContext), RelativeSource={RelativeSource TemplatedParent}}"
                                                               ls:ContextMenuService.GenerateEnabled="False" ls:MoveFocus.Focusable="True" Focusable="True">
                        <b:Interaction.Behaviors>
                            <ls:ContextMenuFillBehavior Context="{Binding (ls:ContextMenuService.Context) , RelativeSource={RelativeSource Mode=TemplatedParent} }" Player="{Binding (ls:WidgetData.DataContext).CurrentPlayer, RelativeSource={RelativeSource TemplatedParent}}" TargetObject="{Binding .}" Source="{Binding SelectedItems,ElementName=InventoryHolder}" Command="{Binding (ls:WidgetData.DataContext).ContextActionPressed, RelativeSource={RelativeSource TemplatedParent}}"/>
                        </b:Interaction.Behaviors>
                        <b:Interaction.Triggers>
                            <b:EventTrigger EventName="MouseEnter">
                                <b:InvokeCommandAction IsEnabled="{Binding IsNew}" Command="{Binding (ls:WidgetData.DataContext).ClearItemNewFlag, RelativeSource={RelativeSource TemplatedParent}}" CommandParameter="{Binding .}"/>
                            </b:EventTrigger>
                            <b:EventTrigger EventName="MouseLeftButtonDown">
                                <b:Interaction.Behaviors>
                                    <b:ConditionBehavior>
                                        <b:ConditionalExpression>
                                            <b:ComparisonCondition LeftOperand="{Binding Path=DataContext.Object, Converter={StaticResource TypeConverter}, RelativeSource={RelativeSource Mode=TemplatedParent}}" Operator="Equal" RightOperand="ls.Character"/>
                                        </b:ConditionalExpression>
                                    </b:ConditionBehavior>
                                </b:Interaction.Behaviors>
                                <ls:LSPlaySound Sound="UI_HUD_Inventory_PickupCharacter"/>
                            </b:EventTrigger>
                            <b:EventTrigger EventName="DragEnter">
                                <b:InvokeCommandAction Command="{Binding (ls:WidgetData.DataContext).UpdateDragErrorCommand, RelativeSource={RelativeSource TemplatedParent}}" CommandParameter="{Binding Path=DataContext.Object, RelativeSource={RelativeSource Mode=TemplatedParent}}"/>
                            </b:EventTrigger>
                            <b:EventTrigger EventName="DragLeave">
                                <b:InvokeCommandAction Command="{Binding (ls:WidgetData.DataContext).UpdateDragErrorCommand, RelativeSource={RelativeSource TemplatedParent}}" CommandParameter="{x:Null}"/>
                            </b:EventTrigger>
                        </b:Interaction.Triggers>
                        <ls:LSEntityObject.ToolTip>
                            <ls:LSTooltip Content="{Binding Path=DataContext.Object, RelativeSource={RelativeSource Mode=TemplatedParent}}" ls:TooltipExtender.Owner="{Binding Tag.CurrentPlayer.SelectedCharacter, ElementName=invCellBase}"/>
                        </ls:LSEntityObject.ToolTip>
                        <ContentPresenter IsHitTestVisible="False"/>
                        <Control x:Name="EquipmentIcon" Template="{StaticResource EquippedItemIconIndicator}" Height="28" Width="36" HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="4,0,0,4"/>
                        <Control Style="{StaticResource NewInventoryCellItemStyle}" />
                        <Image x:Name="SelectedImg" Source="{StaticResource InvSlot_Selector}" Visibility="Hidden" Stretch="Fill" IsHitTestVisible="False"/>
                        <Rectangle x:Name="LockForeground" Fill="{StaticResource LS_DisabledPanelColor}" Visibility="Collapsed"/>
                    </ls:LSEntityObject>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter TargetName="SelectedImg" Property="Visibility" Value="Visible"/>
                            <Setter TargetName="SelectedImg" Property="Opacity" Value="0.8"/>
                        </Trigger>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="SelectedImg" Property="Visibility" Value="Visible"/>
                            <Setter TargetName="SelectedImg" Property="Opacity" Value="1"/>
                        </Trigger>
                        <DataTrigger Binding="{Binding Object, Converter={StaticResource TypeConverter}}" Value="ls.Character">
                            <Setter TargetName="EquipmentIcon" Property="Visibility" Value="Collapsed"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding Object.IsGroupingBlocked}" Value="True">
                            <Setter TargetName="LockForeground" Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>

            </Setter.Value>
        </Setter>
    </Style>

    <Style x:Key="InvWorldContainerItemStyle" TargetType="ListBoxItem" BasedOn="{StaticResource InvContainerItemStyle}">
        <Setter Property="ls:ContextMenuService.Context" Value="WorldContainer"/>
    </Style>


    <!--INVENTORY TEMPLATE WITH FILTERS-->
    <ControlTemplate x:Key="CharacterInventoryTemplate" TargetType="Control">
        <Grid x:Name="CharacterPanelHolder" Tag="{Binding IsContentEditable}" Margin="0,0,0,0">
            <b:Interaction.Triggers>
                <b:DataTrigger Binding="{Binding IsVisible, ElementName=CharacterPanelHolder}" Value="True">
                    <!-- Tutorial UI Event - Inventory Opened-->
                    <b:InvokeCommandAction Command="{Binding DataContext.TutorialEvent, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="e2d0dd0a-5958-454f-9ec3-0bfba58c7153"/>
                </b:DataTrigger>
                <b:DataTrigger Binding="{Binding IsVisible, ElementName=CharacterPanelHolder}" Value="False">
                    <!-- Tutorial UI Event - Inventory Closed-->
                    <b:InvokeCommandAction Command="{Binding DataContext.TutorialEvent, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="3b433da9-3bd4-4273-8e7f-f85e03ee1601"/>
                </b:DataTrigger>

            </b:Interaction.Triggers>

            <!-- MOD_ACS: Add margin -->
            <Grid x:Name="InventoryColumnHolder" Tag="JustCreated" HorizontalAlignment="Stretch" Margin="0,-7,-1,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <b:Interaction.Triggers>
                    <b:DataTrigger Binding="{Binding IsKeyboardFocusWithin, ElementName=InventoryHolder}" Value="False">
                        <b:ChangePropertyAction TargetName="InventoryHolder" PropertyName="SelectedIndex" Value="-1" />
                    </b:DataTrigger>
                    <b:EventTrigger EventName="MouseRightButtonUp" SourceObject="{Binding RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}">
                        <b:Interaction.Behaviors>
                            <b:ConditionBehavior>
                                <b:ConditionalExpression>
                                    <b:ComparisonCondition LeftOperand="{Binding Path=IsMouseOver, ElementName=InventoryHolder}" Operator="Equal" RightOperand="False"/>
                                </b:ConditionalExpression>
                            </b:ConditionBehavior>
                        </b:Interaction.Behaviors>
                        <b:ChangePropertyAction TargetName="InventoryHolder" PropertyName="SelectedIndex" Value="-1" />
                    </b:EventTrigger>
                </b:Interaction.Triggers>

                <ls:LSInputBinding BoundEvent="ActionCancel" EatInput="False" IsEnabled="True" PlayerId="{Binding PlayerId, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}">
                    <b:Interaction.Triggers>
                        <b:EventTrigger EventName="LSInputBindingPressed">
                            <b:ChangePropertyAction TargetName="InventoryHolder" PropertyName="SelectedIndex" Value="-1" />
                        </b:EventTrigger>
                    </b:Interaction.Triggers>
                </ls:LSInputBinding>

                <!-- Inventory -->
                <ListBox Grid.Row="1" x:Name="InventoryHolder" ItemsSource="{Binding GeneratedItemsList, ElementName=FilteringContainerHolder}" ItemsPanel="{StaticResource InventoryGridTemplate}" SelectionMode="Extended" ls:MultiSelect.IsEnabled="False" ItemTemplate="{StaticResource Template.InventorySlot}" ls:AttachedProperties.InheritedNumber="{Binding ActualWidth, ElementName=InventoryColumnHolder}" ScrollViewer.HorizontalScrollBarVisibility="Disabled" HorizontalAlignment="Right" ItemContainerStyle="{StaticResource InvContainerItemStyle}">

                    <b:Interaction.Behaviors>
                        <ls:DragGenericBehavior StartDragCommand="{Binding DataContext.DragInventoryCommand , RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                        <ls:WidgetDataConnectionBehavior/>
                    </b:Interaction.Behaviors>

                    <ListBox.Template>
                        <ControlTemplate TargetType="ListBox">
                            <Grid x:Name="TemplateRoot" >
                                <!-- MOD_ACS: Inventory Border - Update margin // BG3: Margin="-6,-4,20,-6" -->
                                <Border x:Name="InventoryTint" Background="{StaticResource InventoryBGShade}" Margin="-27,-8,16,-7" BorderBrush="Transparent" BorderThickness="2"/>
                                <!-- MOD_ACS: Add name / Update padding & align // BG3: Padding="0,0,0,0" // HorizontalContentAlignment="Right" -->
                                <ScrollViewer x:Name="InventoryScrolling" VerticalScrollBarVisibility="Visible"  HorizontalContentAlignment="Center" Template="{StaticResource NoForcedStyleScrollViewerTemplate}" HorizontalScrollBarVisibility="Disabled" Padding="6,0,-6,0">
                                    <b:Interaction.Behaviors>
                                        <ls:DragScrollingBehavior/>
                                    </b:Interaction.Behaviors>
                                    <!-- MOD_ACS: Inventory contain - Add margin to equalize top gap -->
                                    <ItemsPresenter x:Name="itemsContainer" Margin="0,0,-4,1"/>
                                </ScrollViewer>
                                <Grid x:Name="NoItemsFoundOverlay" Visibility="Collapsed">
                                    <!-- MOD_ACS: Add margin to search bg shading -->
                                    <Rectangle x:Name="NoItemsFoundBg" Fill="{StaticResource LS_DisabledPanelColor}" Margin="7,0,24,1"/>
                                    <!-- MOD_ACS: Update margin & align // BG3: Margin="0,40,0,0" VerticalAlignment="Top" -->
                                    <Control  x:Name="NoItemsFoundControl" Template="{StaticResource NoResultsFoundTemplate}" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="8,0,26,0"/>
                                </Grid>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding CurrentFilter, ElementName=FilteringContainerHolder, Converter={StaticResource NullToBoolTrueConverter}}" Value="False"/>
                                        <Condition Binding="{Binding ItemsSource.Count, RelativeSource={RelativeSource Self}}" Value="0"/>
                                    </MultiDataTrigger.Conditions>
                                    <Setter TargetName="NoItemsFoundOverlay" Property="Visibility" Value="Visible"/>
                                    <!-- MOD_ACS: Add to Recenter on search -->
                                    <Setter TargetName="itemsContainer" Property="Margin" Value="0,0,-10,1"/>
                                    <Setter TargetName="InventoryTint" Property="Margin" Value="0,-6,19,-5"/>
                                </MultiDataTrigger>

                                <!--Hide the no items found overlay if we're attempting to drag-->

                                <DataTrigger Binding="{Binding DataContext.CurrentPlayer.UIData.DragData.DraggingGameObjects.Count,Converter={StaticResource GreaterThanConverter}, ConverterParameter='0', RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="True">
                                    <Setter TargetName="NoItemsFoundOverlay" Property="Visibility" Value="Collapsed"/>
                                </DataTrigger>

                                <DataTrigger Binding="{Binding CurrentFilter, ElementName=FilteringContainerHolder, Converter={StaticResource NullToBoolTrueConverter}}" Value="False">
                                    <Setter TargetName="InventoryTint" Property="Background" Value="{StaticResource InventoryBGShadeFilter}"/>
                                    <Setter TargetName="InventoryTint" Property="BorderBrush" Value="{StaticResource InventoryBGShadeFilterBorder}"/>
                                </DataTrigger>
                                
                                <!-- MOD_ACS: Add trigger for Party Panel context -->
                                <DataTrigger Binding="{Binding Name, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel" >
                                    <Setter TargetName="InventoryTint" Property="Margin" Value="-7,-6,18,-5"/>
                                    <Setter TargetName="InventoryScrolling" Property="Padding" Value="19,0,-19,0"/>
                                    <Setter TargetName="itemsContainer" Property="Margin" Value="0,0,-3,1"/>
                                    <Setter TargetName="NoItemsFoundBg" Property="Margin" Value="9,0,25,1"/>
                                    <Setter TargetName="NoItemsFoundControl" Property="Margin" Value="11,0,27,0"/>
                                </DataTrigger>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Name, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel" />
                                        <Condition Binding="{Binding CurrentFilter, ElementName=FilteringContainerHolder, Converter={StaticResource NullToBoolTrueConverter}}" Value="False"/>
                                        <Condition Binding="{Binding ItemsSource.Count, RelativeSource={RelativeSource Self}}" Value="0"/>
                                    </MultiDataTrigger.Conditions>
                                    <!-- MOD_ACS: Add recenter -->
                                    <Setter TargetName="itemsContainer" Property="Margin" Value="0,0,-12,1"/>
                                    <Setter TargetName="InventoryTint" Property="Margin" Value="0,-8,17,-7"/>
                                </MultiDataTrigger>
                                
                                <!-- MOD_ACS: Add triggers for BCPP Party panel-->
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Name, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel" />
                                        <Condition Binding="{Binding VerticalAlignment, ElementName=PanelsContainer}" Value="Top"/>
                                    </MultiDataTrigger.Conditions>
                                    <Setter TargetName="InventoryTint" Property="Margin" Value="-7,-7,21,-7"/>
                                    <Setter TargetName="InventoryScrolling" Property="Padding" Value="4,0,-4,0"/>
                                    <Setter TargetName="itemsContainer" Property="Margin" Value="0,0,0,0"/>
                                    <Setter TargetName="NoItemsFoundBg" Property="Margin" Value="0,0,28,0"/>
                                    <Setter TargetName="NoItemsFoundControl" Property="Margin" Value="2,0,30,0"/>
                                </MultiDataTrigger>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Name, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel" />
                                        <Condition Binding="{Binding CurrentFilter, ElementName=FilteringContainerHolder, Converter={StaticResource NullToBoolTrueConverter}}" Value="False"/>
                                        <Condition Binding="{Binding ItemsSource.Count, RelativeSource={RelativeSource Self}}" Value="0"/>
                                        <Condition Binding="{Binding VerticalAlignment, ElementName=PanelsContainer}" Value="Top"/>
                                    </MultiDataTrigger.Conditions>
                                    <!-- MOD_ACS: Add recenter -->
                                    <Setter TargetName="itemsContainer" Property="Margin" Value="0,0,0,0"/>
                                    <Setter TargetName="InventoryTint" Property="Margin" Value="-7,-7,21,-7"/>
                                </MultiDataTrigger>
                                
                                <!-- MOD_ACS: Add trigger for Companions Panel-->
                                <DataTrigger Binding="{Binding Name, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="CompanionsPanel"> 
                                    <Setter TargetName="InventoryTint" Property="Margin" Value="-8,-8,16,-7"/>
                                    <Setter TargetName="InventoryScrolling" Property="Padding" Value="7,0,-7,0"/>
                                    <Setter TargetName="NoItemsFoundBg" Property="Margin" Value="6,0,24,1"/>
                                    <Setter TargetName="NoItemsFoundControl" Property="Margin" Value="8,0,27,0"/>
                                </DataTrigger>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Name, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="CompanionsPanel" />
                                        <Condition Binding="{Binding CurrentFilter, ElementName=FilteringContainerHolder, Converter={StaticResource NullToBoolTrueConverter}}" Value="False"/>
                                        <Condition Binding="{Binding ItemsSource.Count, RelativeSource={RelativeSource Self}}" Value="0"/>
                                    </MultiDataTrigger.Conditions>
                                    <Setter TargetName="InventoryTint" Property="Margin" Value="0,-6,19,-5"/>
                                </MultiDataTrigger>
                                
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </ListBox.Template>
                </ListBox>

                <!-- Filter -->
                <Grid x:Name="FiltersControl" Grid.Row="0" VerticalAlignment="Top" Height="88">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <b:Interaction.Behaviors>
                        <ls:InventoriesMergerBehavior x:Name="InventoriesMerger" Inventories="{Binding Inventories}"/>
                        <ls:InventoriesMergerBehavior x:Name="PartyInventoriesMerger" Inventories="{Binding DataContext.CurrentPlayer.PartyInventory, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                    </b:Interaction.Behaviors>

                    <ls:LSComboBox x:Name="InventorySortListHolder"
                                   Template="{StaticResource SortListTemplate}"
                                   ItemsSource="{Binding DataContext.CurrentPlayer.UIData.InventorySortOptions, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"       
                                   Text="{Binding CurrentInventorySortOption.Name, Mode=OneWay}"
                                   AllowRepeatedSelection="True"
                                   VerticalAlignment="Center"
                                   Margin="0,-6,0,0"
                                   Grid.Column="0">
                        <b:Interaction.Triggers>
                            <b:EventTrigger EventName="SelectionChanged">
                                <b:InvokeCommandAction Command="{Binding DataContext.SelectSortCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}">
                                    <b:InvokeCommandAction.CommandParameter>
                                        <MultiBinding Converter="{StaticResource PassThroughConverter}">
                                            <Binding Path="SelectedItem" ElementName="InventorySortListHolder"/>
                                            <Binding Path="DataContext" ElementName="InventorySortListHolder"/>
                                        </MultiBinding>
                                    </b:InvokeCommandAction.CommandParameter>
                                </b:InvokeCommandAction>
                            </b:EventTrigger>
                        </b:Interaction.Triggers>
                    </ls:LSComboBox>

                    <ls:FilteringContainer Grid.Column="1" x:Name="FilteringContainerHolder" Margin="4,0,4,0" FilterPredicate="{Binding InventoryPredicate}" Template="{StaticResource FilterHolderTemplate}"
                                           CurrentFilter="{Binding DataContext.CurrentPlayer.UIData.GlobalSelectedFilter, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}, Mode=OneWay}"
                                           ItemsList="{Binding InventoriesSlots, ElementName=InventoriesMerger}" DefaultViewItemsList="{Binding Inventory.Slots}" MaxDisplayedFilters="12"
                                           SortComparer="{Binding DataContext.Data.InventoryIndexSortComparer, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}">
                        <ls:FilteringContainer.EnumFiltersList>
                            <ls:EnumFilterItem EnumId="gui::EPopularFilters" Label="h977af483ga6d9g4334g9ee0g3b85b94c67db" AlwaysVisible="True" />
                            <ls:EnumFilterItem EnumId="eoc::EProficiencyGroup" Label="ha4c5f0cfg93ebg47ecg8eecg6524ad70aee0" />
                        </ls:FilteringContainer.EnumFiltersList>

                        <b:Interaction.Triggers>

                            <b:DataTrigger Binding="{Binding IsKeyboardFocusWithin, ElementName=FilteringContainerHolder}" Value="True">
                                <b:InvokeCommandAction Command="{Binding DataContext.HideAvailableEquipmentCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="{Binding DataContext.CurrentPlayer.SelectedCharacter.Equipment, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                            </b:DataTrigger>

                            <b:EventTrigger EventName="FilterCleared">
                                <b:InvokeCommandAction Command="{Binding DataContext.ClearFilterCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                                <b:ChangePropertyAction TargetName="ChangePartyContextButton" PropertyName="IsChecked" Value="False"/>
                            </b:EventTrigger>

                            <b:PropertyChangedTrigger Binding="{Binding DataContext.CurrentPlayer.UIData.GlobalSelectedFilter, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}">
                                <b:ChangePropertyAction TargetName="FilteringContainerHolder" PropertyName="CurrentFilter" Value="{Binding DataContext.CurrentPlayer.UIData.GlobalSelectedFilter, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}, Mode=OneWay}"/>
                            </b:PropertyChangedTrigger>

                        </b:Interaction.Triggers>
                    </ls:FilteringContainer>

                    <!--Infotip-->
                    <Control Grid.Column="2" Template="{StaticResource CharacterSheetInfotipTemplate}" VerticalAlignment="Center" Margin="-8,-8,8,0"  HorizontalAlignment="Right" ToolTipService.Placement="Right"/>



                </Grid>

            </Grid>
        </Grid>
        <ControlTemplate.Triggers>
            <DataTrigger Binding="{Binding SelectedItems.Count,ElementName=InventoryHolder,Converter={StaticResource GreaterThanConverter},ConverterParameter=1}" Value="True">
                <Setter TargetName="InventoryHolder" Property="ls:MultiSelect.IsEnabled" Value="True"/>
            </DataTrigger>
            
            <DataTrigger Binding="{Binding Name, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel" >
                <Setter TargetName="FiltersControl" Property="Visibility" Value="Collapsed"/>
                
                <!-- MOD_ACS: Add setters for inventory Party Panel context -->
                <!-- MOD_ACS: Get width from widget -->
                <Setter TargetName="InventoryColumnHolder" Property="Width" Value="{Binding ActualWidth, ElementName=InventoryTemplateHolder}"/>
                <Setter TargetName="InventoryColumnHolder" Property="Height" Value="Auto"/>
                <Setter TargetName="InventoryColumnHolder" Property="HorizontalAlignment" Value="Center"/>
                <Setter TargetName="InventoryColumnHolder" Property="Margin" Value="10,-4,-10,0"/>
            </DataTrigger>
            
            <!-- MOD_ACS: Add triggers for BCPP Party panel-->
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding Name, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel" />
                    <Condition Binding="{Binding VerticalAlignment, ElementName=PanelsContainer}" Value="Top"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="InventoryColumnHolder" Property="Margin" Value="10,-4,-10,1"/>
            </MultiDataTrigger>
            
            <!-- MOD_ACS: Add trigger for Companions Panel-->
            <DataTrigger Binding="{Binding Name, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="CompanionsPanel"> 
                <Setter TargetName="FiltersControl" Property="Margin" Value="0,7,0,0"/>
                <Setter TargetName="InventoryColumnHolder" Property="Margin" Value="0,-7,0,0"/>
            </DataTrigger>
            
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <!--===== POP OUT INVENTORY TEMPLATE =====-->

    <ControlTemplate x:Key="PopOutInventoryTemplate" TargetType="Control">
        <ls:LSNineSliceImage Name="EquipmentInvHolder" Style="{StaticResource Generic9SliceBG}" AllowDrop="False"  Visibility="{Binding Equipment.ShowAvailableEquipment, Converter={StaticResource BoolToVisibleConverter}}" RenderTransformOrigin="0.5,0.2" >
            <ls:LSNineSliceImage.RenderTransform>
                <TransformGroup>
                    <ScaleTransform/>
                    <SkewTransform/>
                    <RotateTransform/>
                    <TranslateTransform/>
                </TransformGroup>
            </ls:LSNineSliceImage.RenderTransform>

            <b:Interaction.Behaviors>
                <ls:LSMouseDragElementBehavior x:Name="DragBehavior" PositionBounds="{Binding WorldBounds}"/>
            </b:Interaction.Behaviors>


            <Grid x:Name="CharacterPanelHolder" Tag="{Binding IsContentEditable}" MaxWidth="450">
                <b:Interaction.Triggers>

                    <!-- Selecting the slot while it's not active = enabling all the filters -->
                    <b:PropertyChangedTrigger Binding="{Binding ActiveEquipmentSlot}" >
                        <b:Interaction.Behaviors>
                            <b:ConditionBehavior>
                                <b:ConditionalExpression>
                                    <b:ComparisonCondition LeftOperand="{Binding ActiveEquipmentSlot}" Operator="NotEqual" RightOperand="{x:Null}"/>
                                </b:ConditionalExpression>
                            </b:ConditionBehavior>
                        </b:Interaction.Behaviors>
                        <b:ChangePropertyAction TargetName="FilteringContainerHolder" PropertyName="CurrentFilter" Value="{Binding ActiveEquipmentSlot.FilterType}"/>
                        <b:ChangePropertyAction TargetName="ChangePartyContextButton" PropertyName="IsChecked" Value="True"/>
                    </b:PropertyChangedTrigger>

                    <!-- Selecting the slot while it's active = no more filtering -->

                    <b:DataTrigger Binding="{Binding ActiveEquipmentSlot}" Value="{x:Null}">
                        <b:ChangePropertyAction TargetName="FilteringContainerHolder" PropertyName="CurrentFilter" Value="{x:Null}"/>
                        <b:ChangePropertyAction TargetName="ChangePartyContextButton" PropertyName="IsChecked" Value="False"/>
                    </b:DataTrigger>

                </b:Interaction.Triggers>


                <Grid x:Name="FilterHolder" MinWidth="388" HorizontalAlignment="Stretch" Tag="JustCreated">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition MaxHeight="488"/>
                    </Grid.RowDefinitions>
                    <b:Interaction.Triggers>
                        <b:DataTrigger Binding="{Binding IsKeyboardFocusWithin, ElementName=InventoryHolder}" Value="False">
                            <b:ChangePropertyAction TargetName="InventoryHolder" PropertyName="SelectedIndex" Value="-1" />
                        </b:DataTrigger>
                        <b:EventTrigger EventName="MouseRightButtonUp" SourceObject="{Binding RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}">
                            <b:Interaction.Behaviors>
                                <b:ConditionBehavior>
                                    <b:ConditionalExpression>
                                        <b:ComparisonCondition LeftOperand="{Binding Path=IsMouseOver, ElementName=InventoryHolder}" Operator="Equal" RightOperand="False"/>
                                    </b:ConditionalExpression>
                                </b:ConditionBehavior>
                            </b:Interaction.Behaviors>
                            <b:ChangePropertyAction TargetName="InventoryHolder" PropertyName="SelectedIndex" Value="-1" />
                        </b:EventTrigger>
                    </b:Interaction.Triggers>

                    <DockPanel>
                        <ls:LSButton DockPanel.Dock="Right" Style="{StaticResource SmallCloseButton}" HorizontalAlignment="Right" VerticalAlignment="Center" Command="{Binding DataContext.HideAvailableEquipmentCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="{Binding Equipment}" />
                        <Border DockPanel.Dock="Left" x:Name="Dragbox" Grid.Row="0" Background="Transparent" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                            <TextBlock x:Name="EquipmentFilterHeader" Text="{Binding CurrentFilter.Name, ElementName=FilteringContainerHolder}" Margin="12,0,0,0" Style="{StaticResource DetailedListText}" VerticalAlignment="Center" HorizontalAlignment="Left" TextTrimming="CharacterEllipsis"/>
                            <b:Interaction.Triggers>
                                <b:EventTrigger EventName="MouseEnter">
                                    <b:InvokeCommandAction Command="{Binding DataContext.SetCursorCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="Resize"/>
                                </b:EventTrigger>
                                <b:EventTrigger EventName="MouseLeave">
                                    <b:InvokeCommandAction Command="{Binding DataContext.SetCursorCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter=""/>
                                </b:EventTrigger>
                            </b:Interaction.Triggers>
                        </Border>
                        
                    </DockPanel>


                    <!--  POPOUT INVENTORY TEMPLATE  -->

                    <ListBox x:Name="PopOutInventoryHolder" Grid.Row="1" VerticalAlignment="Top" HorizontalAlignment="Stretch"  ItemsSource="{Binding GeneratedItemsList, ElementName=FilteringContainerHolder}" ItemsPanel="{StaticResource FilterInventoryGridTemplate}"  SelectionMode="Extended" ls:MultiSelect.IsEnabled="False" ItemTemplate="{StaticResource Template.InventorySlot}" ItemContainerStyle="{StaticResource SingleClickBaseInvContainerItemStyle}" AllowDrop="False" ls:AttachedProperties.InheritedNumber="{Binding ActualWidth, ElementName=CharacterPanelHolder}" ScrollViewer.HorizontalScrollBarVisibility="Disabled"  Margin="0,0,0,10">
                        <b:Interaction.Behaviors>
                            <ls:DragGenericBehavior StartDragCommand="{Binding DataContext.DragInventoryCommand , RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                        </b:Interaction.Behaviors>
                        <ListBox.Template>
                            <ControlTemplate TargetType="ListBox">
                                    <ScrollViewer VerticalScrollBarVisibility="Visible" Template="{StaticResource NoForcedStyleScrollViewerTemplate}" HorizontalScrollBarVisibility="Disabled" Padding="0" AllowDrop="False">
                                        <b:Interaction.Behaviors>
                                            <ls:DragScrollingBehavior/>
                                        </b:Interaction.Behaviors>
                                    <ItemsPresenter x:Name="itemsContainer"/>
                                    </ScrollViewer>
                            </ControlTemplate>
                        </ListBox.Template>
                    </ListBox>
                    <Grid x:Name="NoItemsFoundOverlay" Visibility="Collapsed" Grid.Row="1" VerticalAlignment="Top" HorizontalAlignment="Stretch">
                                        <Rectangle Fill="{StaticResource LS_DisabledPanelColor}"/>
                                        <Control Template="{StaticResource NoResultsFoundTemplate}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Grid>

                    <!-- Filter -->
                    <StackPanel x:Name="FiltersControl" Grid.Row="0" Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Center" Grid.RowSpan="3">
                        <b:Interaction.Behaviors>
                            <ls:InventoriesMergerBehavior x:Name="InventoriesMerger" Inventories="{Binding Inventories}"/>
                            <ls:InventoriesMergerBehavior x:Name="PartyInventoriesMerger" Inventories="{Binding DataContext.CurrentPlayer.PartyInventory, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                        </b:Interaction.Behaviors>

                        <ls:LSToggleButton x:Name="SortToggleButton" Template="{StaticResource SortToggleButtonTemplate}" VerticalAlignment="Top" HorizontalAlignment="Left" Visibility="Collapsed"/>
                        <ls:LSToggleButton x:Name="ChangePartyContextButton" Visibility="Collapsed"/>

                        <ls:FilteringContainer x:Name="FilteringContainerHolder" Margin="8,0,0,0" FilterPredicate="{Binding InventoryPredicate}" Template="{StaticResource FilterHolderTemplate}"
                                           CurrentFilter="{Binding DataContext.CurrentPlayer.UIData.GlobalSelectedFilter, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}, Mode=OneWay}"
                                           ItemsList="{Binding InventoriesSlots, ElementName=InventoriesMerger}" DefaultViewItemsList="{Binding Inventory.Slots}" MaxDisplayedFilters="7"
                                           SortComparer="{Binding DataContext.Data.InventoryIndexSortComparer, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Visibility="Collapsed">
                            <ls:FilteringContainer.EnumFiltersList>
                                <ls:EnumFilterItem EnumId="gui::EPopularFilters" Label="h977af483ga6d9g4334g9ee0g3b85b94c67db" AlwaysVisible="True" />
                                <ls:EnumFilterItem EnumId="eoc::EProficiencyGroup" Label="ha4c5f0cfg93ebg47ecg8eecg6524ad70aee0" />
                            </ls:FilteringContainer.EnumFiltersList>

                            <b:Interaction.Triggers>
                                <b:EventTrigger EventName="FilterCleared">
                                    <b:InvokeCommandAction Command="{Binding DataContext.ClearFilterCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                                    <b:ChangePropertyAction TargetName="ChangePartyContextButton" PropertyName="IsChecked" Value="False"/>
                                </b:EventTrigger>

                                <b:PropertyChangedTrigger Binding="{Binding DataContext.CurrentPlayer.UIData.GlobalSelectedFilter, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}">
                                    <b:ChangePropertyAction TargetName="FilteringContainerHolder" PropertyName="CurrentFilter" Value="{Binding DataContext.CurrentPlayer.UIData.GlobalSelectedFilter, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}, Mode=OneWay}"/>
                                </b:PropertyChangedTrigger>
                            </b:Interaction.Triggers>
                        </ls:FilteringContainer>
                    </StackPanel>
                </Grid>
            </Grid>
        </ls:LSNineSliceImage>
        <ControlTemplate.Triggers>
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding CurrentFilter, ElementName=FilteringContainerHolder, Converter={StaticResource NullToBoolTrueConverter}}" Value="False"/>
                    <Condition Binding="{Binding ItemsSource.Count, ElementName=PopOutInventoryHolder}" Value="0"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="NoItemsFoundOverlay" Property="Visibility" Value="Visible"/>
            </MultiDataTrigger>
            <!-- Hide the no items found overlay if we're attempting to drag-->
            <DataTrigger Binding="{Binding DataContext.CurrentPlayer.UIData.DragData.DraggingGameObjects.Count,Converter={StaticResource GreaterThanConverter}, ConverterParameter='0', RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="True">
                <Setter TargetName="NoItemsFoundOverlay" Property="Visibility" Value="Collapsed"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding CurrentFilter.Enum, ElementName=FilteringContainerHolder}" Value="MAX">
                <Setter TargetName="EquipmentFilterHeader" Property="Text" Value="{Binding Source='haedaccc7gffa0g4a2fg99bcg6703ffbb8ad7', Converter={StaticResource TranslatedStringConverter}}"/>
            </DataTrigger>
            
            <DataTrigger Binding="{Binding IsChecked, ElementName=ChangePartyContextButton}" Value="True">
                <Setter TargetName="FilteringContainerHolder" Property="ItemsList" Value="{Binding InventoriesSlots, ElementName=PartyInventoriesMerger}"/>
                <Setter TargetName="FilteringContainerHolder" Property="DefaultViewItemsList" Value="{Binding DataContext.CurrentPlayer.PartyInventory.Slots, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
            </DataTrigger>

            <Trigger SourceName="EquipmentInvHolder"  Property="IsVisible" Value="True">
                <Trigger.EnterActions>
                    <BeginStoryboard x:Name="OpenPopupAnim">
                        <BeginStoryboard.Storyboard>
                            <Storyboard FillBehavior="Stop">
                                <DoubleAnimation
                                            Storyboard.TargetName="EquipmentInvHolder"
                                            Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleX)"                                        
                                            From="0"
                                            To="1"
                                            Duration="0:0:0.26">
                                    <DoubleAnimation.EasingFunction>
                                        <CubicEase EasingMode="EaseOut"/>
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                                <DoubleAnimation
                                            Storyboard.TargetName="EquipmentInvHolder"
                                            Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[0].(ScaleTransform.ScaleY)"                                        
                                            From="0"
                                            To="1"
                                            Duration="0:0:0.26">
                                    <DoubleAnimation.EasingFunction>
                                        <CubicEase EasingMode="EaseOut"/>
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                            </Storyboard>
                        </BeginStoryboard.Storyboard>
                    </BeginStoryboard>
                </Trigger.EnterActions>
                <Trigger.ExitActions>
                    <StopStoryboard BeginStoryboardName="OpenPopupAnim"/>
                </Trigger.ExitActions>
            </Trigger>
            <EventTrigger RoutedEvent="Unloaded">
                <StopStoryboard BeginStoryboardName="OpenPopupAnim"/>
            </EventTrigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <!--===== CONTAINER INVENTORY TEMPLATE =====-->

    <ControlTemplate x:Key="ContainerInventoryTemplate" TargetType="Control">
        <Grid x:Name="InventoryPanelHolder">
            
            <Grid x:Name="InventoryColumnHolder">
                <Grid.RowDefinitions>
                    <!-- MOD_ACS: Add Row -->
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <b:Interaction.Triggers>
                    <b:DataTrigger Binding="{Binding IsKeyboardFocusWithin, ElementName=InventoryHolder}" Value="False">
                        <b:ChangePropertyAction TargetName="InventoryHolder" PropertyName="SelectedIndex" Value="-1" />
                    </b:DataTrigger>
                    <b:EventTrigger EventName="MouseRightButtonUp" SourceObject="{Binding RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}">
                        <b:Interaction.Behaviors>
                            <b:ConditionBehavior>
                                <b:ConditionalExpression>
                                    <b:ComparisonCondition LeftOperand="{Binding Path=IsMouseOver, ElementName=InventoryHolder}" Operator="Equal" RightOperand="False"/>
                                </b:ConditionalExpression>
                            </b:ConditionBehavior>
                        </b:Interaction.Behaviors>
                        <b:ChangePropertyAction TargetName="InventoryHolder" PropertyName="SelectedIndex" Value="-1" />
                    </b:EventTrigger>
                </b:Interaction.Triggers>

                <ls:LSInputBinding BoundEvent="ActionCancel" EatInput="False" IsEnabled="True" PlayerId="{Binding PlayerId, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}">
                    <b:Interaction.Triggers>
                        <b:EventTrigger EventName="LSInputBindingPressed">
                            <b:ChangePropertyAction TargetName="InventoryHolder" PropertyName="SelectedIndex" Value="-1" />
                        </b:EventTrigger>
                    </b:Interaction.Triggers>
                </ls:LSInputBinding>

                <!-- Inventory -->
                <!-- MOD_ACS: Add Height -->
                <ListBox Grid.Row="1" x:Name="InventoryHolder" Height="1290" ItemsSource="{Binding Inventories[0].Slots}" ItemsPanel="{StaticResource InventoryGridTemplate}" SelectionMode="Extended" ls:MultiSelect.IsEnabled="False" ItemTemplate="{StaticResource Template.InventorySlot}" ls:AttachedProperties.InheritedNumber="{Binding ActualWidth, ElementName=InventoryColumnHolder}" ScrollViewer.HorizontalScrollBarVisibility="Disabled" HorizontalAlignment="Stretch" ItemContainerStyle="{StaticResource InvContainerItemStyle}">

                    <b:Interaction.Behaviors>
                        <ls:DragGenericBehavior StartDragCommand="{Binding DataContext.DragInventoryCommand , RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                        <ls:WidgetDataConnectionBehavior/>
                    </b:Interaction.Behaviors>

                    <ListBox.Template>
                        <ControlTemplate TargetType="ListBox">
                            <Grid x:Name="TemplateRoot" >
                                <!-- MOD_ACS: Update Margin // BG3: Margin="-6,-4,20,-6" -->
                                <Border x:Name="InventoryTint" Background="{StaticResource InventoryBGShade}" Margin="-6,-6,22,-6" BorderBrush="Transparent" IsHitTestVisible="False"/>
                                <!-- MOD_ACS: Update Padding // BG3: Padding="0,0,0,0" -->
                                <ScrollViewer VerticalScrollBarVisibility="Visible" HorizontalContentAlignment="Right" Template="{StaticResource NoForcedStyleScrollViewerTemplate}" HorizontalScrollBarVisibility="Disabled" Padding="3,0,-3,-1" >
                                    <b:Interaction.Behaviors>
                                        <ls:DragScrollingBehavior/>
                                    </b:Interaction.Behaviors>
                                    <ItemsPresenter x:Name="itemsContainer"/>
                                </ScrollViewer>
                            </Grid>
                        </ControlTemplate>
                    </ListBox.Template>
                </ListBox>

                <!-- MOD_ACS: Add CampChest footer informations - PartySupplies, Inspiration & Gold / CampChest Gold & ItemsNumber / CampInventory Weight & TotalGoldValue -->
                <Grid x:Name="CampChestFooterInfo" Grid.Row="2" VerticalAlignment="Center" Margin="0,10,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- MOD_ACS: Party ressources -->
                    <Control Grid.Column="0" Template="{StaticResource HeaderInspirationPointsGold}" DataContext="{Binding DataContext.CurrentPlayer, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Panel.ZIndex="1" VerticalAlignment="Center" Margin="0,0,0,0"/>
                    
                    <!-- MOD_ACS: CampChest Gold & ItemsNumber -->
                    <DockPanel Grid.Column="1" Margin="0,0,0,0">
                        <!-- MOD_ACS: Gold -->
                        <StackPanel x:Name="GoldContainer" DockPanel.Dock="Center" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,0,0,0" Style="{StaticResource ACS_MouseOverStyle}">
                            <TextBlock Text="{Binding Inventories[0].Gold, StringFormat={}{0:N0}}"/>
                            <Image Source="{StaticResource GoldIconImg}" Stretch="Uniform" Width="40" VerticalAlignment="Center" Margin="0,-6,-4,-6"/>
                            <StackPanel.ToolTip>
                                <ls:LSTooltip IsHitTestVisible="False" ls:AttachedProperties.InheritedTag="ha05da9d3gb54ag4c42g96feg553ca035d918" Content="h1e646e86g3c05g4c96g9fd8g9c521871d554" ContentTemplate="{StaticResource ACS_CompactTooltipTemplate}"/>
                            </StackPanel.ToolTip>
                        </StackPanel>
                        <!-- MOD_ACS: Number of items -->
                        <StackPanel x:Name="ItemsCount"  DockPanel.Dock="Center" Orientation="Horizontal" Background="Transparent" HorizontalAlignment="Center" VerticalAlignment="Center" Style="{StaticResource ACS_MouseOverStyle}">
                            <b:Interaction.Behaviors>
                                <ls:InventoriesMergerBehavior x:Name="CampInventoriesMerged" Inventories="{Binding Inventories}"/>
                            </b:Interaction.Behaviors>
                            <TextBlock Text="{Binding InventoriesSlots.Count, ElementName=CampInventoriesMerged}"/>
                            <Image Source="pack://application:,,,/GustavNoesisGUI;component/Assets/Tutorial/TutIcons/tutorial_concertina.png" Stretch="None" Margin="-10,-6" VerticalAlignment="Center"/>
                            <StackPanel.ToolTip>
                                <ls:LSTooltip IsHitTestVisible="False" ls:AttachedProperties.InheritedTag="h364ef14dg5963g48abg84e0gc5f0d33c9955" Content="he6f95c33g7ad7g49c8gbf8dg4133dc34d096" ContentTemplate="{StaticResource ACS_CompactTooltipTemplate}"/>
                            </StackPanel.ToolTip>
                        </StackPanel>
                    </DockPanel>
                    
                    <!-- MOD_ACS: Camp Chest Weight & TotalGoldValue -->
                    <DockPanel Grid.Column="2" Margin="0,0,30,0">
                        <!-- MOD_ACS: Total Gold Value -->
                        <StackPanel x:Name="TotalValue" DockPanel.Dock="Right" Orientation="Horizontal" Background="Transparent" HorizontalAlignment="Right" VerticalAlignment="Center" Style="{StaticResource ACS_MouseOverStyle}">
                            <TextBlock Text="{Binding Gold, StringFormat={}{0:N0}}"/>
                            <Image Source="{StaticResource IconGold}" Stretch="Uniform" Width="40" Margin="0,-6" VerticalAlignment="Center"/>
                            <StackPanel.ToolTip>
                                <ls:LSTooltip IsHitTestVisible="False" ls:AttachedProperties.InheritedTag="hf9b209b9g3745g41a1g85dfg129065b9b215" Content="hcea50cc0gbeebg4aaeg992bgdb79cbfef7e8" ContentTemplate="{StaticResource HeaderBodyTemplate}"/>
                            </StackPanel.ToolTip>
                        </StackPanel>                        
                        <!-- MOD_ACS: Weight -->
                        <StackPanel x:Name="WeightContainer" DockPanel.Dock="Right" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,0,0" Style="{StaticResource ACS_MouseOverStyle}">
                            <TextBlock ls:TextBlockFormatter.SourceText="{Binding Inventories[0].Weight, Converter={StaticResource UnitConverter}, ConverterParameter='Weight N2'}"/>
                            <Image Source="{StaticResource IconWeight}" Stretch="None" Margin="-10,0,-16,6" VerticalAlignment="Center"/>
                            <StackPanel.ToolTip>
                                <ls:LSTooltip IsHitTestVisible="False" ls:AttachedProperties.InheritedTag="hd4969285gc8d8g41afg8e2cg12d5444acbe2" Content="h9b3f757dgbe75g41a6gae52g0c2b1a5e49f2" ContentTemplate="{StaticResource HeaderBodyTemplate}"/>
                            </StackPanel.ToolTip>
                        </StackPanel>
                    </DockPanel>
                    
                </Grid>

                <!-- Filter -->
                <Grid x:Name="FiltersControl" Grid.Row="0" VerticalAlignment="Top" Height="88">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="1*"/>
                    </Grid.ColumnDefinitions>

                    <!--SORT BY-->
                    <Border HorizontalAlignment="Left">
                        <ls:LSComboBox x:Name="ContainerSortList" SoundID="UI_HUD_Inventory_Sort"
                                                                               Template="{StaticResource SortListTemplate}"
                                                                               SelectedItem="{Binding LootInventory.ContainerSortOption, Mode=OneWay}"
                                                                               ItemsSource="{Binding DataContext.CurrentPlayer.UIData.InventorySortOptions, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"
                                                                               Text="{Binding LootInventory.ContainerSortOption.Name, Mode=OneWay}"
                                                                               AllowRepeatedSelection="True">
                            <b:Interaction.Triggers>
                                <b:EventTrigger EventName="SelectionChanged">
                                    <b:InvokeCommandAction Command="{Binding DataContext.SortContainerInventoryCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}">
                                        <b:InvokeCommandAction.CommandParameter>
                                            <MultiBinding Converter="{StaticResource PassThroughConverter}">
                                                <Binding Path="SelectedItem" ElementName="ContainerSortList"/>
                                                <Binding Path="LootInventory"/>
                                            </MultiBinding>
                                        </b:InvokeCommandAction.CommandParameter>
                                    </b:InvokeCommandAction>
                                </b:EventTrigger>
                            </b:Interaction.Triggers>
                        </ls:LSComboBox>
                    </Border>


                    <!-- MOD_ACS: Add Margin -->
                    <TextBlock Text="{Binding name}" Grid.Column="1" VerticalAlignment="Center" TextAlignment="Center" FontSize="{StaticResource ScaledIntermediateFontSize}" Foreground="{StaticResource LS_accent100TxtColor}" noesis:Text.StrokeThickness="4" noesis:Text.Stroke="{StaticResource LS_PrimaryColorOutlineColor}" TextWrapping="Wrap" Margin="0,-6,0,6"/>                        

                    <!--Infotip-->
                    <!-- MOD_ACS: Update Margin // BG3: Margin="-8,-8,8,0" -->
                    <Control Grid.Column="2" Template="{StaticResource CharacterSheetInfotipTemplate}" VerticalAlignment="Center" Margin="-12,-8,12,0"  HorizontalAlignment="Right" ToolTipService.Placement="Right"/>
                </Grid>

            </Grid>
        </Grid>
        <ControlTemplate.Triggers>
            <DataTrigger Binding="{Binding SelectedItems.Count,ElementName=InventoryHolder,Converter={StaticResource GreaterThanConverter},ConverterParameter=1}" Value="True">
                <Setter TargetName="InventoryHolder" Property="ls:MultiSelect.IsEnabled" Value="True"/>
            </DataTrigger>
            <DataTrigger Binding="{Binding Inventory.IsCampChestInventory}" Value="True">
                <Setter TargetName="InventoryHolder" Property="ItemContainerStyle" Value="{StaticResource InvWorldContainerItemStyle}"/>
            </DataTrigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <!-- =====  EQUIPMENT TEMPLATE ===== -->

    <ControlTemplate x:Key="CharacterEquipmentTemplate" TargetType="Control">
        <Grid x:Name="CharacterPanelHolder" Tag="{Binding IsContentEditable}">
            <b:Interaction.Triggers>

                <!--Selecting the slot while it's not active = enabling all the filters-->
                <b:PropertyChangedTrigger Binding="{Binding ActiveEquipmentSlot}" >
                    <b:Interaction.Behaviors>
                        <b:ConditionBehavior>
                            <b:ConditionalExpression>
                                <b:ComparisonCondition LeftOperand="{Binding ActiveEquipmentSlot}" Operator="NotEqual" RightOperand="{x:Null}"/>
                            </b:ConditionalExpression>
                        </b:ConditionBehavior>
                    </b:Interaction.Behaviors>
                    <b:ChangePropertyAction TargetName="FilteringContainerHolder" PropertyName="CurrentFilter" Value="{Binding ActiveEquipmentSlot.FilterType}"/>
                    <b:ChangePropertyAction TargetName="ChangePartyContextButton" PropertyName="IsChecked" Value="True"/>
                    <b:InvokeCommandAction Command="{Binding DataContext.SelectCharacter, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="{Binding}"/>
                </b:PropertyChangedTrigger>

                <!--Selecting the slot while it's active = no more filtering-->
                <b:DataTrigger Binding="{Binding ActiveEquipmentSlot}" Value="{x:Null}">
                    <b:ChangePropertyAction TargetName="FilteringContainerHolder" PropertyName="CurrentFilter" Value="{x:Null}"/>
                    <b:ChangePropertyAction TargetName="ChangePartyContextButton" PropertyName="IsChecked" Value="False"/>
                </b:DataTrigger>

                <b:DataTrigger Binding="{Binding IsVisible, ElementName=CharacterPanelHolder}" Value="True">
                    <!--Tutorial UI Event - Equipment Opened-->
                    <b:InvokeCommandAction Command="{Binding DataContext.TutorialEvent, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="56affdac-faef-448a-94fb-55182779b482"/>
                </b:DataTrigger>

            </b:Interaction.Triggers>
            <!-- MOD_ACS: Add margin -->
            <Grid x:Name="EquipmentHolder" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Margin="-34,33,-24,0">
                <Grid.RenderTransform>
                    <TransformGroup>
                        <ScaleTransform/>
                        <SkewTransform/>
                        <RotateTransform/>
                        <TranslateTransform/>
                    </TransformGroup>
                </Grid.RenderTransform>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>


                <!-- EQUIPMENT SLOTS -->
                <Grid x:Name="EquipmentSlots" Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.Resources>
                        <!-- MOD_ACS: Update margin // BG3: 0,72,0,0 -->
                        <Thickness x:Key="EquipMargin">0,26,0,0</Thickness>
                    </Grid.Resources>

                    <DockPanel Name="EquipmentRight" Grid.Column="2" Grid.Row="0" HorizontalAlignment="Right" Margin="{StaticResource EquipMargin}">

                        <Control DockPanel.Dock="Bottom" Template="{StaticResource MuscialEQTemplate}" Panel.ZIndex="{Binding IsSelecting, Converter={StaticResource BoolToIntConverter}, ConverterParameter=20}" DataContext="{Binding Equipment.MusicalInstrument}"/>
                        <StackPanel DockPanel.Dock="Top">
                            <!--VANITY-->
                            <Grid HorizontalAlignment="Left">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <Border x:Name="VanityToggleHighlight" Grid.RowSpan="2" BorderBrush="{StaticResource LS_tempHPColor}" BorderThickness="2" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Margin="-3" Background="{StaticResource InventoryBGShade}" Visibility="Collapsed">
                                    <Border.Effect>
                                        <DropShadowEffect BlurRadius="20" ShadowDepth="0" Color="{StaticResource tempHPColor}" />
                                    </Border.Effect>
                                </Border>

                                <!-- MOD_ACS: Add margin -->
                                <ls:LSButton Grid.Row="0" Style="{StaticResource EquipmentSlotStyle}" Panel.ZIndex="{Binding IsSelecting, Converter={StaticResource BoolToIntConverter}, ConverterParameter=20}" DataContext="{Binding Equipment.VanityBody}" Margin="0,0,0,2"/>
                                <ls:LSButton Grid.Row="1" Style="{StaticResource EquipmentSlotStyle}" Panel.ZIndex="{Binding IsSelecting, Converter={StaticResource BoolToIntConverter}, ConverterParameter=20}" DataContext="{Binding Equipment.VanityBoots}"/>
                                <!-- MOD_ACS: Update margin // BG3: Margin="0,-40,-6,0" -->
                                <ls:LSButton Grid.RowSpan="2" VerticalAlignment="Top" Command="{Binding DataContext.ToggleArmorSetVisibility, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" CommandParameter="{Binding .}" Template="{StaticResource VanityButtonTemplate}" HorizontalAlignment="Right" Margin="0,-41,-5,0">
                                    <ls:LSButton.ToolTip>
                                        <ls:LSTooltip Content="{Binding Source='had94b224g2d0eg43a9g96a7g27311c05ef99',Converter={StaticResource TranslatedStringConverter}}" x:Name="TooltipContent"/>
                                    </ls:LSButton.ToolTip>
                                </ls:LSButton>
                            </Grid>
                            <!-- MOD_ACS: Update margin // MOD_BCPP: Margin="0,8" // BG3: Margin="0,24" -->
                            <ls:LSButton Margin="0,16" Style="{StaticResource EquipmentSlotStyle}" Panel.ZIndex="{Binding IsSelecting, Converter={StaticResource BoolToIntConverter}, ConverterParameter=20}" DataContext="{Binding Equipment.Underwear}"/>
                            <!-- MOD_ACS: Add marginS -->
                            <ls:LSButton Style="{StaticResource EquipmentSlotStyle}" Panel.ZIndex="{Binding IsSelecting, Converter={StaticResource BoolToIntConverter}, ConverterParameter=20}" DataContext="{Binding Equipment.Amulet}" Margin="0,0,0,2"/>
                            <ls:LSButton Style="{StaticResource EquipmentSlotStyle}" Panel.ZIndex="{Binding IsSelecting, Converter={StaticResource BoolToIntConverter}, ConverterParameter=20}" DataContext="{Binding Equipment.Ring}" Margin="0,0,0,2"/>
                            <ls:LSButton Style="{StaticResource EquipmentSlotStyle}" Panel.ZIndex="{Binding IsSelecting, Converter={StaticResource BoolToIntConverter}, ConverterParameter=20}" DataContext="{Binding Equipment.Ring2}"/>
                        </StackPanel>
                    </DockPanel>

                    <DockPanel Name="EquipmentLeft" Grid.Column="0" Grid.Row="0" HorizontalAlignment="Left" Margin="{StaticResource EquipMargin}">
                        <!--LIGHTSOURCE-->
                        <ls:LSButton x:Name="LightSource" DockPanel.Dock="Bottom" VerticalAlignment="Bottom" Style="{StaticResource EquipmentSlotBaseStyle}" Panel.ZIndex="{Binding IsSelecting, Converter={StaticResource BoolToIntConverter}, ConverterParameter=20}" DataContext="{Binding Equipment.LightSource}" ToolTipService.Placement="Left">
                            <b:Interaction.Behaviors>
                                <ls:DropOnGenericBehavior DropCommand="{Binding DataContext.DropLightSourceCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                            </b:Interaction.Behaviors>
                        </ls:LSButton>

                        <StackPanel DockPanel.Dock="Top">

                            <!-- MOD_ACS: Add marginS -->
                            <Control Template="{StaticResource HelmetEQTemplate}" Panel.ZIndex="{Binding IsSelecting, Converter={StaticResource BoolToIntConverter}, ConverterParameter=20}" DataContext="{Binding Equipment.Helmet}" ToolTipService.Placement="Left" Margin="0,0,0,2"/>
                            <ls:LSButton Style="{StaticResource EquipmentSlotStyle}" Panel.ZIndex="{Binding IsSelecting, Converter={StaticResource BoolToIntConverter}, ConverterParameter=20}" DataContext="{Binding Equipment.Cloak}" ToolTipService.Placement="Left" Margin="0,0,0,2"/>
                            <ls:LSButton Style="{StaticResource EquipmentSlotStyle}" Panel.ZIndex="{Binding IsSelecting, Converter={StaticResource BoolToIntConverter}, ConverterParameter=20}" DataContext="{Binding Equipment.Breast}" ToolTipService.Placement="Left" Margin="0,0,0,2"/>
                            <ls:LSButton Style="{StaticResource EquipmentSlotStyle}" Panel.ZIndex="{Binding IsSelecting, Converter={StaticResource BoolToIntConverter}, ConverterParameter=20}" DataContext="{Binding Equipment.Gloves}" ToolTipService.Placement="Left" Margin="0,0,0,2"/>
                            <ls:LSButton Style="{StaticResource EquipmentSlotStyle}" Panel.ZIndex="{Binding IsSelecting, Converter={StaticResource BoolToIntConverter}, ConverterParameter=20}" DataContext="{Binding Equipment.Boots}" ToolTipService.Placement="Left"/>
                        </StackPanel>

                        <!-- MOD_ACS: Move Armor Class to left panel RenderTransformOrigin="0.5,0.5" -->
                        <StackPanel x:Name="ArmorClassLeft"  DockPanel.Dock="Top" HorizontalAlignment="Left" Margin="-10,8,-40,-40">
                            <Control Template="{StaticResource ACHolder}"/>
                            <Control.RenderTransform>
                                <ScaleTransform ScaleX="0.92" ScaleY="0.92"/>
                            </Control.RenderTransform>
                        </StackPanel>

                    </DockPanel>

                    <!--Melee Weapons-->
                    <StackPanel Grid.Column="0" Grid.Row="1" VerticalAlignment="Bottom">
                        <TextBlock Style="{StaticResource DetailedListText}" Text="{Binding Source='hde2dafecgf6f5g489ag9baeg23d0610570f5',Converter={StaticResource TranslatedStringConverter}}" TextAlignment="Center" IsHitTestVisible="False" TextWrapping="Wrap" noesis:Text.StrokeThickness="4" noesis:Text.Stroke="{StaticResource LS_PrimaryColorOutlineColor}">
                            <TextBlock.Effect>
                                <DropShadowEffect Direction="270" Color="{StaticResource LS_PrimaryColorDropShadowColor}" ShadowDepth="3.0" BlurRadius="8.0"/>
                            </TextBlock.Effect>
                        </TextBlock>
                        <StackPanel Orientation="Horizontal">
                            <ls:LSButton Style="{StaticResource EquipmentSlotStyle}" Panel.ZIndex="{Binding IsSelecting, Converter={StaticResource BoolToIntConverter}, ConverterParameter=20}" DataContext="{Binding Equipment.MeleeMainHand}" ToolTipService.Placement="Left"/>
                            <ls:LSButton Style="{StaticResource EquipmentSlotStyle}" Panel.ZIndex="{Binding IsSelecting, Converter={StaticResource BoolToIntConverter}, ConverterParameter=20}" DataContext="{Binding Equipment.MeleeOffHand}" ToolTipService.Placement="Left"/>
                        </StackPanel>
                    </StackPanel>


                    <!--Ranged Weapons-->
                    <StackPanel Grid.Column="2" Grid.Row="1" VerticalAlignment="Bottom">
                        <TextBlock Style="{StaticResource DetailedListText}" Text="{Binding Source='h52df2583g5fc1g4182g9511g36238e4e0c19',Converter={StaticResource TranslatedStringConverter}}" TextAlignment="Center" IsHitTestVisible="False" TextWrapping="Wrap" noesis:Text.StrokeThickness="4" noesis:Text.Stroke="{StaticResource LS_PrimaryColorOutlineColor}">
                            <TextBlock.Effect>
                                <DropShadowEffect Direction="270" Color="{StaticResource LS_PrimaryColorDropShadowColor}" ShadowDepth="3.0" BlurRadius="8.0"/>
                            </TextBlock.Effect>
                        </TextBlock>
                        <StackPanel Orientation="Horizontal">
                            <ls:LSButton Style="{StaticResource EquipmentSlotStyle}" Panel.ZIndex="{Binding IsSelecting, Converter={StaticResource BoolToIntConverter}, ConverterParameter=20}" DataContext="{Binding Equipment.RangedMainHand}"/>
                            <ls:LSButton Style="{StaticResource EquipmentSlotStyle}" Panel.ZIndex="{Binding IsSelecting, Converter={StaticResource BoolToIntConverter}, ConverterParameter=20}" DataContext="{Binding Equipment.RangedOffHand}"/>
                        </StackPanel>
                    </StackPanel>

                    <!--ArmorClass-->
                    <!-- MOD_ACS: Moved to left side but still here for BCPP compatibility if needed -->
                    <!-- BG3: <Control Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="3" Template="{StaticResource ACHolder}" VerticalAlignment="Bottom" HorizontalAlignment="Center" Visibility="Collapsed"/> -->
                    <StackPanel x:Name="ArmorClassBottom" Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="3" VerticalAlignment="Bottom" HorizontalAlignment="Center" Visibility="Collapsed" Margin="0,0,0,-20">
                        <Control Template="{StaticResource ACHolder}"/>
                        <Control.RenderTransform>
                            <ScaleTransform ScaleX="0.92" ScaleY="0.92"/>
                        </Control.RenderTransform>
                    </StackPanel>
                </Grid>

                <Control Grid.Row="2" Template="{StaticResource WeaponAttackBonusTemplate}" VerticalAlignment="Bottom" Margin="0,8,0,20"/>

            </Grid>
        </Grid>

        <ControlTemplate.Triggers>
            <DataTrigger Binding="{Binding ArmorSetVisibility}" Value="Vanity">
                <Setter TargetName="VanityToggleHighlight" Property="Visibility" Value="Visible"/>
            </DataTrigger>
            
            <!-- MOD_ACS: Add triggers for Party Panel context -->
            <DataTrigger Binding="{Binding ParentState, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel">
                <Setter TargetName="EquipmentHolder" Property="Margin" Value="-25,70,-25,0"/>
            </DataTrigger>
            
            <!-- MOD_ACS: Add triggers for BCPP Party panel-->
            <MultiDataTrigger>
                <MultiDataTrigger.Conditions>
                    <Condition Binding="{Binding Name, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="PartyPanel" />
                    <Condition Binding="{Binding VerticalAlignment, ElementName=PanelsContainer}" Value="Top"/>
                </MultiDataTrigger.Conditions>
                <Setter TargetName="EquipmentHolder" Property="Margin" Value="8,70,8,0"/>
            </MultiDataTrigger>
            
            <!-- MOD_ACS: Add trigger for Companions Panel-->
            <DataTrigger Binding="{Binding Name, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="CompanionsPanel"> 
                <Setter TargetName="EquipmentHolder" Property="Margin" Value="-10,40,-25,0"/>
            </DataTrigger>
            
            <!-- MOD_ACS: Add trigger for Trade Panel-->
            <DataTrigger Binding="{Binding Name, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}" Value="Trade" >
                <Setter TargetName="EquipmentHolder" Property="Margin" Value="16,20,16,40"/>
            </DataTrigger>
            
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <!-- Used in LevelUp -->
    <ControlTemplate x:Key="ExtendedPassivesHolderTemplate" TargetType="Control">
        <ScrollViewer x:Name="Scroll" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Hidden" Template="{StaticResource ScrollViewerTemplate}" Background="Transparent" VerticalAlignment="Top" HorizontalAlignment="Left">
            <Grid>
                <Grid.Resources>
                    <Style TargetType="ItemsControl">
                        <Setter Property="ItemsPanel">
                            <Setter.Value>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Vertical"/>
                                </ItemsPanelTemplate>
                            </Setter.Value>
                        </Setter>

                        <Setter Property="ItemTemplate">
                            <Setter.Value>
                                <DataTemplate>
                                    <Grid Margin="0,0,0,20">
                                        <Image x:Name="BackgroundFeature" Source="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/features_bg_d.png" Stretch="None" VerticalAlignment="Bottom" Margin="0,0,0,0"/>

                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="0,0,0,16">
                                            <Grid VerticalAlignment="Top">
                                                <Image x:Name="SlotHolder" Source="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/features_slot_d.png" Stretch="None"/>
                                                <Ellipse Width="60" Height="60" Fill="{Binding Icon}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Grid>

                                            <StackPanel x:Name="ContentContainer" Orientation="Vertical" MaxWidth="600" Margin="8,0,0,0">
                                                <TextBlock x:Name="Name" Text="{Binding Name}" FontSize="{DynamicResource ScaledDefaultFontSize}" Foreground="{StaticResource LS_tint100}" TextWrapping="Wrap" VerticalAlignment="Top"/>
                                                <TextBlock TextWrapping="Wrap" Foreground="{StaticResource LS_baseTxtColor}" FontSize="{DynamicResource ScaledDefaultFontSize}" VerticalAlignment="Top" HorizontalAlignment="Left">
                                                    <b:Interaction.Behaviors>
                                                        <ls:CtxTransStringRunGeneratorBehavior Source="{Binding Description}" ParamRunStyle="{StaticResource TooltipUnitParamRun}"/>
                                                    </b:Interaction.Behaviors>
                                                </TextBlock>
                                                <b:Interaction.Triggers>
                                                    <b:EventTrigger EventName="MouseEnter">
                                                        <ls:LSPlaySound Sound="UI_Shared_Hover"/>
                                                    </b:EventTrigger>
                                                </b:Interaction.Triggers>
                                            </StackPanel>
                                        </StackPanel>
                                    </Grid>

                                    <DataTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="SlotHolder" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/features_slot_h.png"/>
                                            <Setter TargetName="BackgroundFeature" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/CharacterPanel/features_bg_h.png"/>
                                        </Trigger>

                                        <DataTrigger Binding="{Binding ., Converter={StaticResource TypeConverter}}" Value="ls.VMPassiveFeatureBoost">
                                            <Setter TargetName="Name" Property="Text" Value="{Binding NameCTS.Text}"/>
                                        </DataTrigger>

                                        <DataTrigger Binding="{Binding ParentState, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}" Value="CharacterLevelUp">
                                            <Setter TargetName="ContentContainer" Property="MaxWidth" Value="550"/>
                                        </DataTrigger>
                                    </DataTemplate.Triggers>
                                </DataTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Grid.Resources>

                <StackPanel HorizontalAlignment="Left" VerticalAlignment="Top">
                    <ItemsControl x:Name="FeaturesList" ItemsSource="{Binding Path=(b:Interaction.Behaviors)[0].FilteredItems, ElementName=PassivesHolder}" Visibility="{Binding Path=(b:Interaction.Behaviors)[0].FilteredItems.Count, ElementName=PassivesHolder, Converter={StaticResource CountToVisibilityConverter}}"/>
                    <ItemsControl x:Name="ClassFeaturesList" ItemsSource="{Binding Path=(b:Interaction.Behaviors)[1].FilteredItems, ElementName=PassivesHolder}" Visibility="{Binding Path=(b:Interaction.Behaviors)[1].FilteredItems.Count, ElementName=PassivesHolder, Converter={StaticResource CountToVisibilityConverter}}"/>
                    <ItemsControl x:Name="SubClassFeaturesList" ItemsSource="{Binding Path=(b:Interaction.Behaviors)[2].FilteredItems, ElementName=PassivesHolder}" Visibility="{Binding Path=(b:Interaction.Behaviors)[2].FilteredItems.Count, ElementName=PassivesHolder, Converter={StaticResource CountToVisibilityConverter}}"/>
                </StackPanel>

                <TextBlock TextWrapping="Wrap" VerticalAlignment="Top" HorizontalAlignment="Left" ls:TextBlockFormatter.SourceText="{Binding Source='hf235de4fg6999g4be2gaaffgb79ffac98628',Converter={StaticResource TranslatedStringConverter}}" Visibility="{Binding Visibility, ElementName=FeaturesList, Converter={StaticResource InvertVisibilityConverter}}"/>
            </Grid>
        </ScrollViewer>

        <ControlTemplate.Triggers>
            <DataTrigger Binding="{Binding ParentState, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ls:UIWidget}}}" Value="CharacterLevelUp">
                <Setter TargetName="Scroll" Property="Padding" Value="20,0,-100,0"/>
            </DataTrigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>    

    <!-- Party inventory view -->

    <Style x:Key="ListItemStyle" BasedOn="{StaticResource BaseInvContainerItemStyle}"/>

    <ItemsPanelTemplate x:Key="CharacterInventoryPanelTemplate">
        <ls:LSGrid x:Name="CharacterInventoryGrid" Style="{StaticResource InventoryGridStyle}">
            <b:Interaction.Behaviors>
                <ls:DropOnInventoryGridBehavior DropCommand="{Binding DataContext.DropOnInventorySlotCommand, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                <ls:DragGameObjectGridBehavior/>
            </b:Interaction.Behaviors>
        </ls:LSGrid>
    </ItemsPanelTemplate>

    <ControlTemplate x:Key="PartyCharacterExpanderTemplate" TargetType="{x:Type Expander}">
        <ControlTemplate.Resources>
            <BitmapImage x:Key="ExpanderIcon" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SaveLoad/ico_expander_d.png"/>
            <BitmapImage x:Key="ListItemSelected" UriSource="pack://application:,,,/GustavNoesisGUI;component/Assets/SaveLoad/listItem_selected.png"/>
            <ImageSource x:Key="ItemBG">pack://application:,,,/GustavNoesisGUI;component/Assets/Trade/trade_accordion_d.png</ImageSource>
            <ImageSource x:Key="ItemBGHL">pack://application:,,,/GustavNoesisGUI;component/Assets/Trade/trade_accordion_h.png</ImageSource>
        </ControlTemplate.Resources>

        <DockPanel x:Name="DockRoot" Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType={x:Type ScrollContentPresenter}}}">
            <Grid DockPanel.Dock="Top">
                <ls:LSToggleButton x:Name="ExpanderButton" IsChecked="{Binding IsExpanded, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}">
                    <ToggleButton.Template>
                        <ControlTemplate TargetType="{x:Type ToggleButton}">
                            <Grid Width="{TemplateBinding Width}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="32"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Image x:Name="Background" Grid.Column="0" Grid.ColumnSpan="2" Source="{StaticResource ItemBG}" Stretch="None" VerticalAlignment="Bottom" Margin="0,0,0,-8"/>
                                <Image x:Name="Arrow" Grid.Column="0" Width="32" Source="{StaticResource ExpanderIcon}" VerticalAlignment="Center" Stretch="None" />
                                <ContentPresenter Grid.Column="1"/>
                            </Grid>

                            <ControlTemplate.Triggers>
                                <Trigger Property="IsChecked" Value="False">
                                    <Setter TargetName="Arrow" Property="RenderTransform">
                                        <Setter.Value>
                                            <RotateTransform Angle="-90" CenterX="16" CenterY="10"/>
                                        </Setter.Value>
                                    </Setter>
                                </Trigger>

                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="Arrow" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/SaveLoad/ico_expander_h.png"/>
                                    <Setter TargetName="Background" Property="Source" Value="{StaticResource ItemBGHL}"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </ToggleButton.Template>
                    <ContentPresenter ContentSource="Header"/>
                </ls:LSToggleButton>
            </Grid>
            <ContentPresenter Name="Content"/>
        </DockPanel>

        <ControlTemplate.Triggers>
            <Trigger Property="IsExpanded" Value="False">
                <Setter TargetName="Content" Property="Visibility" Value="Collapsed"/>
            </Trigger>
            <Trigger SourceName="ExpanderButton" Property="IsChecked" Value="True">
                <Setter Property="IsExpanded" Value="True"/>
            </Trigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <ControlTemplate x:Key="PartyCharacterExpanderHeaderTemplate" TargetType="Control">
        <ControlTemplate.Resources>
            <Style x:Key="CharacterHeaderTextStyle" TargetType="TextBlock">
                <Setter Property="FontSize" Value="{StaticResource ScaledMediumFontSize}" />
                <Setter Property="Foreground" Value="{StaticResource LS_extraspecialTxtColor}" />
                <Setter Property="VerticalAlignment" Value="Center"/>
                <Setter Property="FontWeight" Value="DemiBold"/>
            </Style>
        </ControlTemplate.Resources>

        <Grid Width="{TemplateBinding Width}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock x:Name="CharacterName" 
                       Style="{StaticResource CharacterHeaderTextStyle}" 
                       HorizontalAlignment="Left" 
                       TextTrimming="CharacterEllipsis"
                       TextWrapping="NoWrap"
                       Grid.Column="0"
                       Text="{Binding Name}"
                       Margin="8,0,0,0"/>

            <Control x:Name="WeightDisplayControl" 
                     VerticalAlignment="Center" 
                     Grid.Column="1"
                     Margin="0,0,16,0">
                <Control.Template>
                    <ControlTemplate>
                        <StackPanel Orientation="Horizontal" Focusable="False" Height="70">
                            <Image x:Name="IconHolder" Source="{StaticResource NormalWeightIcon}" Stretch="None" VerticalAlignment="Center"/>
                            <TextBlock x:Name="text1" Text="{Binding EncumbranceStats.CurrentWeight, Converter={StaticResource UnitConverter}, ConverterParameter='Weight N2'}" Style="{StaticResource CharacterHeaderTextStyle}"/>
                            <TextBlock x:Name="text2" Text="{Binding Source='hd64bfe4cgadadg4468g8b0ag70330ffc717c', Converter={StaticResource TranslatedStringConverter}}" Style="{StaticResource CharacterHeaderTextStyle}"/>
                            <TextBlock x:Name="text3" Text="{Binding EncumbranceStats.WeightMaximum, Converter={StaticResource UnitConverter}, ConverterParameter='Weight N2'}" Style="{StaticResource CharacterHeaderTextStyle}"/>
                        </StackPanel>

                        <ControlTemplate.Triggers>
                            <!-- Light encumbrance -->
                            <DataTrigger Value="True">
                                <DataTrigger.Binding>
                                    <MultiBinding Converter="{StaticResource GreaterOrEqualThanMultiConverter}">
                                        <Binding Path="EncumbranceStats.CurrentWeight"/>
                                        <Binding Path="EncumbranceStats.WeightLight"/>
                                    </MultiBinding>
                                </DataTrigger.Binding>
                                <Setter TargetName="text1" Property="Foreground" Value="{StaticResource LS_warning100TxtColor}"/>
                                <Setter TargetName="text2" Property="Foreground" Value="{StaticResource LS_warning100TxtColor}"/>
                                <Setter TargetName="text3" Property="Foreground" Value="{StaticResource LS_warning100TxtColor}"/>
                                <Setter TargetName="IconHolder" Property="Source" Value="{StaticResource IconWeightEncumbered}"/>
                            </DataTrigger>

                            <!-- Heavy encumbrance -->
                            <DataTrigger Value="True">
                                <DataTrigger.Binding>
                                    <MultiBinding Converter="{StaticResource GreaterOrEqualThanMultiConverter}">
                                        <Binding Path="EncumbranceStats.CurrentWeight"/>
                                        <Binding Path="EncumbranceStats.WeightHeavy"/>
                                    </MultiBinding>
                                </DataTrigger.Binding>

                                <Setter TargetName="text1" Property="Foreground" Value="{StaticResource LS_alertTxtColor}"/>
                                <Setter TargetName="text2" Property="Foreground" Value="{StaticResource LS_alertTxtColor}"/>
                                <Setter TargetName="text3" Property="Foreground" Value="{StaticResource LS_alertTxtColor}"/>
                                <Setter TargetName="IconHolder" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/Weight_Encumbrance/ico_weight_heavilyEncumbered.png"/>
                            </DataTrigger>

                            <!-- Over encumbrance -->
                            <DataTrigger Value="True">
                                <DataTrigger.Binding>
                                    <MultiBinding Converter="{StaticResource GreaterOrEqualThanMultiConverter}">
                                        <Binding Path="EncumbranceStats.CurrentWeight"/>
                                        <Binding Path="EncumbranceStats.WeightMaximum"/>
                                    </MultiBinding>
                                </DataTrigger.Binding>
                                <Setter TargetName="IconHolder" Property="Source" Value="pack://application:,,,/GustavNoesisGUI;component/Assets/Shared/Weight_Encumbrance/ico_weight_weightLimit.png"/>
                            </DataTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Control.Template>
            </Control>
        </Grid>
    </ControlTemplate>

    <ControlTemplate x:Key="PartyCharacterInventoryTemplate" TargetType="ContentControl">
        <Grid>
            <b:Interaction.Triggers>
                <b:DataTrigger Binding="{Binding IsKeyboardFocusWithin, ElementName=Items}" Value="False">
                    <b:ChangePropertyAction TargetName="Items" PropertyName="SelectedIndex" Value="-1" />
                </b:DataTrigger>
                <b:EventTrigger EventName="MouseRightButtonUp" SourceObject="{Binding RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}">
                    <b:Interaction.Behaviors>
                        <b:ConditionBehavior>
                            <b:ConditionalExpression>
                                <b:ComparisonCondition LeftOperand="{Binding Path=IsMouseOver, ElementName=Items}" Operator="Equal" RightOperand="False"/>
                            </b:ConditionalExpression>
                        </b:ConditionBehavior>
                    </b:Interaction.Behaviors>
                    <b:ChangePropertyAction TargetName="Items" PropertyName="SelectedIndex" Value="-1" />
                </b:EventTrigger>
            </b:Interaction.Triggers>
            <ls:LSInputBinding BoundEvent="ActionCancel" EatInput="False" IsEnabled="True" PlayerId="{Binding PlayerId, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}">
                <b:Interaction.Triggers>
                    <b:EventTrigger EventName="LSInputBindingPressed">
                        <b:ChangePropertyAction TargetName="Items" PropertyName="SelectedIndex" Value="-1" />
                    </b:EventTrigger>
                </b:Interaction.Triggers>
            </ls:LSInputBinding>

            <ListBox x:Name="Items"
                     ItemsSource="{Binding Content, RelativeSource={RelativeSource TemplatedParent}}"
                     ItemTemplate="{StaticResource Template.InventorySlot}"
                     ItemContainerStyle="{DynamicResource ListItemStyle}"
                     Template="{StaticResource MinimalItemsControlTemplate}"
                     ItemsPanel="{DynamicResource CharacterInventoryPanelTemplate}"
                     SelectionMode="Single"/>
        </Grid>

        <ControlTemplate.Triggers>
            <DataTrigger Binding="{Binding SelectedItems.Count, ElementName=Items, Converter={StaticResource GreaterThanConverter},ConverterParameter=1}" Value="True">
                <Setter TargetName="Items" Property="ls:MultiSelect.IsEnabled" Value="True"/>
            </DataTrigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <Style x:Key="PartyCharacterExpanderStyle" TargetType="Expander">
        <Setter Property="HorizontalAlignment" Value="Center"/>
        <Setter Property="VerticalAlignment" Value="Top"/>
        <Setter Property="Margin" Value="0,0,0,20"/>
        <Setter Property="IsExpanded" Value="True"/>
        <Setter Property="Width" Value="{Binding Width, RelativeSource={RelativeSource TemplatedParent}}"/>
        <Setter Property="Template" Value="{StaticResource PartyCharacterExpanderTemplate}"/>

        <Style.Resources>
            <System:UInt32 x:Key="invRows">1</System:UInt32>
        </Style.Resources>
    </Style>

    <Style x:Key="PartyHolderStyle" TargetType="ListBox" BasedOn="{StaticResource {x:Type ListBox}}">
        <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Visible"/>
        <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Hidden"/>
        <Setter Property="VirtualizingPanel.ScrollUnit" Value="Pixel"/>
        <Setter Property="VirtualizingPanel.VirtualizationMode" Value="Recycling"/>
        <Setter Property="ScrollViewer.CanContentScroll" Value="True"/>
        <Setter Property="ItemsPanel">
            <Setter.Value>
                <ItemsPanelTemplate>
                    <VirtualizingStackPanel Orientation="Vertical"/>
                </ItemsPanelTemplate>
            </Setter.Value>
        </Setter>
        <Style.Resources>
            <Style TargetType="ScrollViewer" BasedOn="{StaticResource {x:Type ContentControl}}">
                <Setter Property="OverridesDefaultStyle" Value="True"/>
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="PanningMode" Value="VerticalFirst"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ScrollViewer">
                            <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="{DynamicResource Corner.Border0}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Decorator x:Name="ShowBarsRef" IsEnabled="False"/>
                                    <ScrollContentPresenter Grid.Column="1" Grid.RowSpan="2" Grid.ColumnSpan="2" Content="{TemplateBinding Content}" ContentTemplate="{TemplateBinding ContentTemplate}" ContentTemplateSelector="{TemplateBinding ContentTemplateSelector}" CanContentScroll="{TemplateBinding CanContentScroll}" Margin="{TemplateBinding Padding}"/>
                                    <Rectangle x:Name="Corner" Grid.Row="1" Grid.Column="2" Fill="{DynamicResource Brush.Track.Normal}" IsEnabled="False" Opacity="0"/>
                                    <ScrollBar x:Name="PART_HorizontalScrollBar" Grid.Column="1" Grid.Row="1" Orientation="Horizontal" MaxHeight="{TemplateBinding MinHeight}" Visibility="{TemplateBinding ComputedHorizontalScrollBarVisibility}" Value="{Binding HorizontalOffset, Mode=OneWay, RelativeSource={RelativeSource TemplatedParent}}" ViewportSize="{TemplateBinding ViewportWidth}" Minimum="0" Maximum="{TemplateBinding ScrollableWidth}" Opacity="0"/>
                                    <ScrollBar x:Name="PART_VerticalScrollBar" Grid.Column="0" Grid.Row="0" Orientation="Vertical" MaxWidth="{TemplateBinding MinWidth}" Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"
                                               Value="{Binding VerticalOffset, Mode=OneWay, RelativeSource={RelativeSource TemplatedParent}}" ViewportSize="{TemplateBinding ViewportHeight}" Minimum="0"
                                               Maximum="{TemplateBinding ScrollableHeight}" Opacity="0"/>
                                </Grid>
                            </Border>
                            <ControlTemplate.Resources>
                                <Storyboard x:Key="Anim.ShowBars" BeginTime="0:0:0.1">
                                    <DoubleAnimation Storyboard.TargetName="PART_HorizontalScrollBar" Storyboard.TargetProperty="Opacity" To="1" Duration="0:0:0.1" AccelerationRatio="0.5" DecelerationRatio="0.5"/>
                                    <DoubleAnimation Storyboard.TargetName="PART_VerticalScrollBar" Storyboard.TargetProperty="Opacity" To="1" Duration="0:0:0.1" AccelerationRatio="0.5" DecelerationRatio="0.5"/>
                                </Storyboard>
                                <Storyboard x:Key="Anim.HideBars" BeginTime="0:0:2">
                                    <DoubleAnimation Storyboard.TargetName="PART_HorizontalScrollBar" Storyboard.TargetProperty="Opacity" To="0" Duration="0:0:0.15" AccelerationRatio="0.75" DecelerationRatio="0.25"/>
                                    <DoubleAnimation Storyboard.TargetName="PART_VerticalScrollBar" Storyboard.TargetProperty="Opacity" To="0" Duration="0:0:0.15" AccelerationRatio="0.75" DecelerationRatio="0.25"/>
                                </Storyboard>
                                <Storyboard x:Key="Anim.ShowCorner" BeginTime="0:0:0.1">
                                    <DoubleAnimation Storyboard.TargetName="Corner" Storyboard.TargetProperty="Opacity" To="1" Duration="0:0:0.1" AccelerationRatio="0.75" DecelerationRatio="0.25"/>
                                </Storyboard>
                                <Storyboard x:Key="Anim.HideCorner" BeginTime="0:0:2">
                                    <DoubleAnimation Storyboard.TargetName="Corner" Storyboard.TargetProperty="Opacity" To="0" Duration="0:0:0.15" AccelerationRatio="0.75" DecelerationRatio="0.25"/>
                                </Storyboard>
                            </ControlTemplate.Resources>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsKeyboardFocusWithin" Value="True">
                                    <Setter Property="IsEnabled" Value="True" TargetName="ShowBarsRef"/>
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="IsEnabled" Value="True" TargetName="ShowBarsRef"/>
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="True" SourceName="ShowBarsRef">
                                    <Trigger.EnterActions>
                                        <BeginStoryboard Storyboard="{StaticResource Anim.ShowBars}"/>
                                    </Trigger.EnterActions>
                                    <Trigger.ExitActions>
                                        <BeginStoryboard Storyboard="{StaticResource Anim.HideBars}"/>
                                    </Trigger.ExitActions>
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True" SourceName="PART_HorizontalScrollBar">
                                    <Setter Property="IsEnabled" Value="True" TargetName="Corner"/>
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True" SourceName="PART_VerticalScrollBar">
                                    <Setter Property="IsEnabled" Value="True" TargetName="Corner"/>
                                </Trigger>
                                <Trigger Property="IsEnabled" Value="True" SourceName="Corner">
                                    <Trigger.EnterActions>
                                        <BeginStoryboard Storyboard="{StaticResource Anim.ShowCorner}"/>
                                    </Trigger.EnterActions>
                                    <Trigger.ExitActions>
                                        <BeginStoryboard Storyboard="{StaticResource Anim.HideCorner}"/>
                                    </Trigger.ExitActions>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <DataTemplate DataType="ls:Character">
                <Expander x:Name="SingleInventoryRoot" Style="{StaticResource PartyCharacterExpanderStyle}">
                    <b:Interaction.Behaviors>
                        <ls:InventoriesMergerBehavior x:Name="PlayerInventoriesMerged" Inventories="{Binding Inventories}" MergeSubInventories="False"/>
                        <ls:CollectionFilterBehavior x:Name="PlayerInventoryFiltered" ItemsSource="{Binding InventoriesSlots, ElementName=PlayerInventoriesMerged}" Predicate="{Binding TradeInventories[0].TabFiltersPredicate}"/>
                        <ls:CollectionSortBehavior x:Name="PlayerInventoryFilteredSorted" ItemsSource="{Binding FilteredItems, ElementName=PlayerInventoryFiltered}" Comparer="{Binding DataContext.CurrentPlayer.SelectedCharacter.TradeSortComparer, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                    </b:Interaction.Behaviors>

                    <Expander.Header>
                        <Control Template="{StaticResource PartyCharacterExpanderHeaderTemplate}"/>
                    </Expander.Header>

                    <ContentControl x:Name="PlayerBarterInventory" Template="{StaticResource PartyCharacterInventoryTemplate}" Content="{Binding Path=(b:Interaction.Behaviors)[2].SortedItems, ElementName=SingleInventoryRoot}"/>
                </Expander>
            </DataTemplate>

            <DataTemplate DataType="ls:VMTradeInventory">
                <Expander x:Name="SingleInventoryRoot" Style="{StaticResource PartyCharacterExpanderStyle}">
                    <b:Interaction.Behaviors>
                        <ls:InventoriesMergerBehavior x:Name="PlayerInventoriesMerged" Inventories="{Binding TradeInventories}" MergeSubInventories="False"/>
                        <ls:CollectionFilterBehavior x:Name="PlayerInventoryFiltered" ItemsSource="{Binding InventoriesSlots, ElementName=PlayerInventoriesMerged}" Predicate="{Binding TradeInventories[0].TabFiltersPredicate}"/>
                        <ls:CollectionSortBehavior x:Name="PlayerInventoryFilteredSorted" ItemsSource="{Binding FilteredItems, ElementName=PlayerInventoryFiltered}" Comparer="{Binding DataContext.CurrentPlayer.SelectedCharacter.TradeSortComparer, RelativeSource={RelativeSource AncestorType={x:Type ls:UIWidget}}}"/>
                    </b:Interaction.Behaviors>

                    <Expander.Header>
                        <Control Template="{StaticResource PartyCharacterExpanderHeaderTemplate}" DataContext="{Binding Character}"/>
                    </Expander.Header>

                    <ContentControl x:Name="PlayerBarterInventory" Template="{StaticResource PartyCharacterInventoryTemplate}" Content="{Binding Path=(b:Interaction.Behaviors)[2].SortedItems, ElementName=SingleInventoryRoot}"/>
                </Expander>
            </DataTemplate>
        </Style.Resources>
    </Style>

</ResourceDictionary>